import{g as G}from"./@tencentcloud-7fc831ec.js";var M={exports:{}};(function(A,W){var R;R=function(){function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?k(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function I(t){return(I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function O(t,e,n){return e&&q(t.prototype,e),n&&q(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function N(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function z(t,e){if(t==null)return{};var n,r,a=function(u,f){if(u==null)return{};var o,c,l={},i=Object.keys(u);for(c=0;c<i.length;c++)o=i[c],f.indexOf(o)>=0||(l[o]=u[o]);return l}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}var U=typeof wx<"u"&&typeof wx.getSystemInfoSync=="function"&&!!wx.getSystemInfoSync().fontSizeSetting,T=typeof qq<"u"&&typeof qq.getSystemInfoSync=="function"&&!!qq.getSystemInfoSync().fontSizeSetting,_=typeof tt<"u"&&typeof tt.getSystemInfoSync=="function"&&!!tt.getSystemInfoSync().fontSizeSetting,B=typeof swan<"u"&&typeof swan.getSystemInfoSync=="function"&&!!swan.getSystemInfoSync().fontSizeSetting,S=typeof my<"u"&&typeof my.getSystemInfoSync=="function"&&!!my.getSystemInfoSync().fontSizeSetting,h=typeof uni<"u"&&typeof window>"u"&&typeof uni.requireNativePlugin=="function",F=h&&uni.getDeviceInfo().platform.toLocaleLowerCase()==="ios",H=(h&&uni.getDeviceInfo().platform.toLocaleLowerCase(),U||T||_||B||S||h),J=T?qq:_?tt:B?swan:S?my:U?wx:h?uni:{},D=function(t){if(I(t)!=="object"||t===null)return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(var n=e;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return e===n};function L(t){if(t==null)return!0;if(typeof t=="boolean")return!1;if(typeof t=="number")return t===0;if(typeof t=="string"||typeof t=="function"||Array.isArray(t))return t.length===0;if(t instanceof Error)return t.message==="";if(D(t)){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}return!1}var K=function(){function t(){b(this,t)}return O(t,[{key:"request",value:function(e,n){var r=this,a=e.downloadUrl||"",s=(e.method||"PUT").toUpperCase(),u=e.url;if(e.qs){var f=function(i){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"&",d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"=";return L(i)?"":D(i)?Object.keys(i).map(function(p){var v=encodeURIComponent(p)+d;return Array.isArray(i[p])?i[p].map(function(w){return v+encodeURIComponent(w)}).join(y):v+encodeURIComponent(i[p])}).filter(Boolean).join(y):void 0}(e.qs);f&&(u+="".concat(u.indexOf("?")===-1?"?":"&").concat(f))}var o=new XMLHttpRequest;o.open(s,u,!0),o.responseType=e.dataType||"text";var c=e.headers||{};if(!L(c))for(var l in c)c.hasOwnProperty(l)&&l.toLowerCase()!=="content-length"&&l.toLowerCase()!=="user-agent"&&l.toLowerCase()!=="origin"&&l.toLowerCase()!=="host"&&o.setRequestHeader(l,c[l]);return o.onload=function(){if(o.status===200)n(null,r._xhrRes(o,r._xhrBody(o,a)));else{var i={code:o.status,message:JSON.stringify(o.responseText)};n(i,r._xhrRes(o,r._xhrBody(o)))}},o.onerror=function(i){var y=r._xhrBody(o),d={code:o.status,message:JSON.stringify(o.responseText)};y||o.statusText||o.status!==0||(i.message="CORS blocked or network error"),n(d,r._xhrRes(o,y)),d=null},e.onProgress&&o.upload&&(o.upload.onprogress=function(i){var y=i.total,d=i.loaded,p=Math.floor(100*d/y);e.onProgress({total:y,loaded:d,percent:(p>=100?100:p)/100})}),o.send(e.resources),o}},{key:"_xhrRes",value:function(e,n){var r={};return e.getAllResponseHeaders().trim().split(`
`).forEach(function(a){if(a){var s=a.indexOf(":"),u=a.substr(0,s).trim().toLowerCase(),f=a.substr(s+1).trim();r[u]=f}}),{statusCode:e.status,statusMessage:e.statusText,headers:r,data:n}}},{key:"_xhrBody",value:function(e,n){return e.status===200&&n?{location:n}:{response:e.responseText}}}]),t}(),V=["unknown","image","video","audio","log"],X=["name"],$=function(){function t(){b(this,t)}return O(t,[{key:"request",value:function(e,n){var r=this,a=e.resources,s=a===void 0?"":a,u=e.headers,f=u===void 0?{}:u,o=e.url,c=e.downloadUrl,l=c===void 0?"":c,i=o,y=null,d=l.match(/^(https?:\/\/[^/]+\/)([^/]*\/?)(.*)$/),p=decodeURIComponent(d[3]),v=p.indexOf("?")>-1?p.split("?")[0]:p,w={key:e.fileKey?e.fileKey:v,success_action_status:200,"Content-Type":""},C={};if(F){var x=o.split("?sign=");if(x.length>1){var P=x[1];i="".concat(x[0],"?sign=").concat(encodeURIComponent("".concat(P))),C.sign=decodeURIComponent(P),C.signature=decodeURIComponent(P)}}var j={url:i,header:f,name:"file",filePath:s,formData:g(g({},w),C),timeout:e.timeout||3e5};if(S){var E=j;E.name,j=g(g({},z(E,X)),{},{fileName:"file",fileType:V[e.fileType]})}return(y=J.uploadFile(g(g({},j),{},{success:function(m){r._handleResponse({response:m,downloadUrl:l,callback:n})},fail:function(m){r._handleResponse({response:m,downloadUrl:l,callback:n})}}))).onProgressUpdate&&y.onProgressUpdate(function(m){e.onProgress&&e.onProgress({total:m.totalBytesExpectedToSend,loaded:m.totalBytesSent,percent:Math.floor(m.progress)/100})}),y}},{key:"_handleResponse",value:function(e){var n=e.downloadUrl,r=e.response,a=e.callback,s=r.header,u={};if(s)for(var f in s)s.hasOwnProperty(f)&&(u[f.toLowerCase()]=s[f]);var o=+r.statusCode;o===200?a(null,{statusCode:o,headers:u,data:g(g({},r.data),{},{location:n})}):a({code:o,message:JSON.stringify(r.data)},{statusCode:o,headers:u,data:void 0})}}]),t}();return function(){function t(){b(this,t),console.log("TIMUploadPlugin.VERSION: ".concat("1.3.0")),this.retry=1,this.tryCount=0,this.systemClockOffset=0,this.httpRequest=H?new $:new K}return O(t,[{key:"uploadFile",value:function(e,n){var r=this;return this.httpRequest.request(e,function(a,s){a&&r.tryCount<r.retry&&r.allowRetry(a)?(r.tryCount++,r.uploadFile(e,n)):(r.tryCount=0,n(a,s))})}},{key:"allowRetry",value:function(e){var n=!1,r=!1;if(e){var a=e.headers&&(e.headers.date||e.headers.Date)||e.error&&e.error.ServerTime;try{var s=e.error&&e.error.Code,u=e.error&&e.error.Message;(s==="RequestTimeTooSkewed"||s==="AccessDenied"&&u==="Request has expired")&&(r=!0)}catch{}if(r&&a){var f=Date.now(),o=Date.parse(a);Math.abs(f+this.systemClockOffset-o)>=3e4&&(this.systemClockOffset=o-f,n=!0)}else Math.floor(e.statusCode/100)===5&&(n=!0)}return n}}]),t}()},A.exports=R()})(M);var Q=M.exports;const Z=G(Q);export{Z as t};
