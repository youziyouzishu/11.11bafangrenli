var Q=Object.defineProperty;var Z=(g,s,l)=>s in g?Q(g,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):g[s]=l;var k=(g,s,l)=>(Z(g,typeof s!="symbol"?s+"":s,l),l);import{z as u,B as C,q as m,o as p,i as J,_ as ee}from"./@tencentcloud-7fc831ec.js";import"./adapter-vue-24f22062.js";import te from"./Icon-2c0593f3.js";import{T as x}from"./index-cfdb213d.js";import{e as ne}from"./enableSampleTaskStatus-a12ec87d.js";import{t as se}from"./index-7909557f.js";import{i as S,a as b,c as ae}from"./env-a593fd1d.js";import{T as oe}from"./config-58aee8b5.js";import{T as w}from"./index-e4ac2ab7.js";import{d as ie,r as U,aZ as le,a$ as re,b6 as ce,b as ue,a_ as y,o as h,c as M,ap as de,y as E,a as N,F as R,ao as me,M as ve,aB as fe,ae as P}from"./@vue-a164be7a.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";import"./constant-bad60a54.js";const ge="/admin/assets/msg-del-8e1884b8.svg",F="/admin/assets/msg-copy-91b797d7.svg",pe="/admin/assets/msg-quote-6ed4649b.svg",Ie="/admin/assets/msg-revoke-a0b46d31.svg",Te="/admin/assets/msg-forward-b9d14da1.svg",ye="/admin/assets/translate-a0cfa550.svg",Ce="/admin/assets/multiple-select-63011d60.svg",he="/admin/assets/convertText_zh-ea05cc29.svg",I=class I{constructor(){k(this,"savedSelection");this.savedSelection=null}static getInstance(){return I.instance||(I.instance=new I),I.instance}saveCurrentSelection(){const s=window.getSelection();S||!s||(this.savedSelection={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset})}restoreSelection(){const s=window.getSelection();if(S||!s||!this.savedSelection)return;const{anchorNode:l,anchorOffset:v,focusNode:n,focusOffset:a}=this.savedSelection;if(!l||!n)return;const o=document.createRange();(l===n?v<=a:l.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_FOLLOWING)?(o.setStart(l,v),o.setEnd(n,a)):(o.setStart(n,a),o.setEnd(l,v)),s.removeAllRanges(),s.addRange(o)}async copySelection(s){this.restoreSelection();const l=window.getSelection();if(S||!l||l.rangeCount===0){await this.copyTextOrHtml(s,"text");return}const n=l.getRangeAt(0).cloneContents(),a=document.createElement("div");a.appendChild(n);const o=a.innerHTML||s,r=a.innerHTML?"html":"text";await this.copyTextOrHtml(o,r),this.savedSelection=null}async copyTextOrHtml(s,l){const v=l==="html"?"text/html":"text/plain";if(navigator.clipboard)try{const a=new Blob([s],{type:v}),o=new ClipboardItem({[v]:a});await navigator.clipboard.write([o]);return}catch{}let n;if(l==="html"){n=document.createElement("div"),n.style.position="fixed",n.style.opacity="0",n.contentEditable="true",n.innerHTML=s,document.body.appendChild(n);const a=document.createRange();a.selectNodeContents(n);const o=window.getSelection();o==null||o.removeAllRanges(),o==null||o.addRange(a),n.focus()}else n=document.createElement("textarea"),n.value=s,n.style.position="fixed",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy")}catch(a){x({message:u.t("TUIChat.此机型暂不支持复制"),type:w.ERROR}),console.warn("use document.execCommand copy failed:",a)}finally{document.body.removeChild(n)}}};k(I,"instance");let _=I;const G=_.getInstance(),Me=["onClick","onMousedown"],xe={class:"list-item-text"},Se=ie({__name:"index",props:{messageItem:{default:()=>({})},isMultipleSelectMode:{type:Boolean,default:!1}},emits:["toggleMultipleSelectMode"],setup(g,{expose:s,emit:l}){const v=l,n=g,a=oe.getFeatureConfig(),o=C.TYPES,r=U([{key:"open",text:u.t("TUIChat.打开"),iconUrl:F,renderCondition(){var t;return!a.DownloadFile||!e.value?!1:b&&(((t=e.value)==null?void 0:t.type)===o.MSG_FILE||e.value.type===o.MSG_VIDEO||e.value.type===o.MSG_IMAGE)},clickEvent:B},{key:"copy",text:u.t("TUIChat.复制"),iconUrl:F,renderCondition(){return!a.CopyMessage||!e.value?!1:e.value.type===o.MSG_TEXT},clickEvent:Y},{key:"revoke",text:u.t("TUIChat.撤回"),iconUrl:Ie,renderCondition(){return!a.RevokeMessage||!e.value?!1:e.value.flow==="out"&&e.value.status==="success"},clickEvent:V},{key:"delete",text:u.t("TUIChat.删除"),iconUrl:ge,renderCondition(){return!a.DeleteMessage||!e.value?!1:e.value.status==="success"},clickEvent:q},{key:"forward",text:u.t("TUIChat.转发"),iconUrl:Te,renderCondition(){return!a.ForwardMessage||!e.value?!1:e.value.status==="success"},clickEvent:$},{key:"quote",text:u.t("TUIChat.引用"),iconUrl:pe,renderCondition(){if(!a.QuoteMessage||!e.value)return!1;const t=m.getMessageModel(e.value.ID);return e.value.status==="success"&&!t.getSignalingInfo()},clickEvent:W},{key:"translate",text:u.t("TUIChat.翻译"),visible:!1,iconUrl:ye,renderCondition(){return!a.TranslateMessage||!e.value?!1:e.value.status==="success"&&e.value.type===o.MSG_TEXT},clickEvent:j},{key:"convert",text:u.t("TUIChat.转文字"),visible:!1,iconUrl:he,renderCondition(){return!a.VoiceToText||!e.value?!1:e.value.status==="success"&&e.value.type===o.MSG_AUDIO},clickEvent:X},{key:"multi-select",text:u.t("TUIChat.多选"),iconUrl:Ce,renderCondition(){return!a.MultiSelection||!e.value?!1:e.value.status==="success"},clickEvent:K}]),e=U(),D=U();le(()=>{m.watch(p.CHAT,{translateTextInfo:O,voiceToTextInfo:A})}),re(()=>{m.unwatch(p.CHAT,{translateTextInfo:O,voiceToTextInfo:A})}),ce(()=>{e.value=m.getMessageModel(n.messageItem.ID)});const H=ue(()=>{for(let t=0;t<r.value.length;++t)if(r.value[t].renderCondition())return!1;return!0});function L(t){r.value[t].clickEvent()}function B(){var c;let t="";switch((c=e.value)==null?void 0:c.type){case C.TYPES.MSG_FILE:t=e.value.payload.fileUrl;break;case C.TYPES.MSG_VIDEO:t=e.value.payload.remoteVideoUrl;break;case C.TYPES.MSG_IMAGE:t=e.value.payload.imageInfoArray[0].url;break}window==null||window.open(t,"_blank")}function V(){if(!e.value)return;m.getMessageModel(e.value.ID).revokeMessage().then(()=>{ne("revokeMessage")}).catch(c=>{if(c.code===20016){const i=u.t("TUIChat.已过撤回时限");x({message:i,type:w.ERROR})}})}function q(){if(!e.value)return;m.getMessageModel(e.value.ID).deleteMessage()}async function Y(){var t,c,i,d,f;ae?(i=J)==null||i.setClipboardData({data:se((c=(t=e.value)==null?void 0:t.payload)==null?void 0:c.text)}):G.copySelection((f=(d=e.value)==null?void 0:d.payload)==null?void 0:f.text)}function z(t){t!=="copy"||S||G.saveCurrentSelection()}function $(){e.value&&m.update(p.CUSTOM,"singleForwardMessageID",e.value.ID)}function W(){e.value&&e.value.quoteMessage()}function j(){if(!m.getData(p.APP,"enabledTranslationPlugin")){x({message:u.t("TUIChat.请开通翻译功能"),type:w.WARNING});return}if(!e.value)return;const c=r.value.findIndex(i=>i.key==="translate");m.update(p.CHAT,"translateTextInfo",{conversationID:e.value.conversationID,messageID:e.value.ID,visible:!r.value[c].visible})}function X(){if(!m.getData(p.APP,"enabledVoiceToText")){x({message:u.t("TUIChat.请开通语音转文字功能")});return}if(!e.value)return;const c=r.value.findIndex(i=>i.key==="convert");m.update(p.CHAT,"voiceToTextInfo",{conversationID:e.value.conversationID,messageID:e.value.ID,visible:!r.value[c].visible})}function K(){v("toggleMultipleSelectMode")}function O(t){if(t===void 0)return;const c=t.get(n.messageItem.conversationID)||[],i=r.value.findIndex(d=>d.key==="translate");for(let d=0;d<c.length;++d){const{messageID:f,visible:T}=c[d];if(f===n.messageItem.ID){r.value[i].text=u.t(T?"TUIChat.隐藏":"TUIChat.翻译"),r.value[i].visible=!!T;return}}r.value[i].text=u.t("TUIChat.翻译")}function A(t){if(t===void 0)return;const c=t.get(n.messageItem.conversationID)||[],i=r.value.findIndex(d=>d.key==="convert");for(let d=0;d<c.length;++d){const{messageID:f,visible:T}=c[d];if(f===n.messageItem.ID){r.value[i].text=u.t(T?"TUIChat.隐藏":"TUIChat.转文字"),r.value[i].visible=!!T;return}}r.value[i].text=u.t("TUIChat.转文字")}return s({messageToolDom:D}),(t,c)=>!y(H)&&!t.messageItem.hasRiskContent?(h(),M("div",{key:0,ref_key:"messageToolDom",ref:D,class:P(["dialog-item",y(b)?"dialog-item-web":"dialog-item-h5"])},[y(a).EmojiReaction?de(t.$slots,"TUIEmojiPlugin",{key:0},void 0,!0):E("",!0),N("div",{class:P(["dialog-item-list",y(b)?"dialog-item-list-web":"dialog-item-list-h5"])},[(h(!0),M(R,null,me(y(r),(i,d)=>(h(),M(R,null,[i.renderCondition()?(h(),M("div",{key:i.key,class:"list-item",onClick:f=>L(d),onMousedown:f=>z(i.key)},[ve(te,{file:i.iconUrl,size:"15px"},null,8,["file"]),N("span",xe,fe(i.text),1)],40,Me)):E("",!0)],64))),256))],2)],2)):E("",!0)}});const je=ee(Se,[["__scopeId","data-v-b7150281"]]);export{je as default};
