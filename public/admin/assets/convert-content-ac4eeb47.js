var V=Object.defineProperty;var W=(a,e,t)=>e in a?V(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var v=(a,e,t)=>(W(a,typeof e!="symbol"?e+"":e,t),t);import"./adapter-vue-24f22062.js";import{q as U,X as z,z as D,h as u,_ as M}from"./@tencentcloud-7fc831ec.js";import{d as q,r as l,w as E,o as _,c as y,a_ as s,ae as b,aB as w,y as H,a as L,ag as F,b7 as x}from"./@vue-a164be7a.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";const r=class r{constructor(){v(this,"isUseCache",!0);v(this,"convertCache",new Map)}static getInstance(){return r.instance||(r.instance=new r),r.instance}async get(e){if(this.isUseCache){const c=this.convertCache.get(e.ID);if(c!==void 0)return c}const t=U.getMessageModel(e.ID);if(!t)return Promise.reject("message not found");const n=await z.convertVoiceToText({message:t});let{data:{result:o}={}}=n;return o?this.convertCache.set(t.ID,o):o="",o}clear(){this.convertCache.clear()}disableCache(){this.isUseCache=!1}enableCache(){this.isUseCache=!0}};v(r,"instance");let d=r;const N=d.getInstance(),X=q({__name:"convert-content",props:{message:{default:()=>({})},contentVisible:{type:Boolean},convertWrapperRef:{},isSingleConvert:{type:Boolean,default:!1}},emits:["toggleErrorStatus"],setup(a,{emit:e}){const t=e,n=a,o=l(!1),c=l(""),i=l(0),m=l(0),p=l(),f=l();return E(()=>n.contentVisible,C=>{C&&N.get(n.message).then(h=>{o.value=!0,c.value=h,x(()=>{const{height:g,width:I}=u(p.value),{height:k,width:R}=u(f.value);i.value=g,m.value=I,requestAnimationFrame(()=>{i.value=k,m.value=R,n.isSingleConvert&&x(()=>{const{bottom:S}=u(n.convertWrapperRef),{bottom:T}=u("#messageScrollList");if(S>T){const B=setTimeout(()=>{n.convertWrapperRef.scrollIntoView({block:"end",behavior:"smooth"}),clearTimeout(B)},150)}})})})}).catch(h=>{o.value=!0,t("toggleErrorStatus",!0);const{height:g}=u(p.value);i.value=g,c.value=h.message})},{immediate:!0}),(C,h)=>(_(),y("div",{class:"message-convert-container",style:F({height:s(i)>0?`${s(i)}px`:"auto",width:s(m)>0?`${s(m)}px`:"auto"})},[s(o)?(_(),y("div",{key:0,ref_key:"convertContentRef",ref:f,class:b({"convert-content":!0,occur:s(i)>0})},w(s(c)),3)):H("",!0),L("div",{ref_key:"convertLoadingRef",ref:p,class:b({loading:!0,"loading-end":s(o)})},w(s(D).t("TUIChat.转换中"))+"... ",3)],4))}});const ae=M(X,[["__scopeId","data-v-e75ee18d"]]);export{ae as default};
