var K=Object.defineProperty;var F=(n,e,t)=>e in n?K(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var m=(n,e,t)=>(F(n,typeof e!="symbol"?e+"":e,t),t);import{f as X}from"./adapter-vue-24f22062.js";import{R as d,r as i,q as C,o as E,X as y,z as S,i as D,J as G,Q as B,W as q,Z as P,O as W,_ as $}from"./@tencentcloud-7fc831ec.js";import Y from"./index-1d71231f.js";import{T as z}from"./config-58aee8b5.js";import Z from"./index-3fe8b1e8.js";import{e as _}from"./constant-bad60a54.js";import{c as b,i as l}from"./env-a593fd1d.js";import{c as J,a as Q}from"./index-407d0dca.js";import{e as j}from"./enableSampleTaskStatus-a12ec87d.js";import N from"./index-7081e279.js";import w from"./index-def612b1.js";import{T as tt}from"./index.vue_vue_type_script_setup_true_lang-ef98ab22.js";import k from"./index-8950ccd3.js";import{T as et}from"./server-fb151bb0.js";import{d as rt,r as R,aZ as it,o as u,c as h,ap as ot,a as f,a_ as r,F as st,ao as at,ae as M,aB as H,y as v,M as I,aR as nt,x as ct}from"./@vue-a164be7a.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";import"./index-c49585c2.js";import"./Icon-2c0593f3.js";import"./back-16f17fde.js";import"./index-faa4755e.js";import"./lodash-f986f62a.js";import"./index-7f4dadfc.js";import"./index-6b0c1d9b.js";import"./index-95ee9b8a.js";import"./index-cfa97a9d.js";import"./close-dark-98fe05f7.js";import"./message-text-fa779d57.js";import"./index-7909557f.js";import"./message-image-5b640b78.js";import"./utils-14df48f1.js";import"./message-audio-c2671f84.js";import"./index-79ddaf2a.js";import"./video-play-6934d780.js";import"./message-container-d845128f.js";import"./message-file-66d98bfb.js";import"./files-37ebf78f.js";import"./message-face-a8df59a3.js";import"./message-custom-f995a3d6.js";import"./type-check-5e73d261.js";import"./star-light-645157ed.js";import"./message-tip-5fd87ded.js";import"./message-bubble-03765614.js";import"./index-63059e66.js";import"./index-7077c717.js";import"./index-cfdb213d.js";import"./index-e4ac2ab7.js";import"./index-e69feb26.js";import"./translation-content-19d02e38.js";import"./index-1a28bf3f.js";import"./convert-content-ac4eeb47.js";import"./index-c630b3a2.js";import"./message-location-f4d00aa4.js";import"./message-timestamp-4c57a5eb.js";import"./message-video-ab63f1fe.js";import"./icon-close-7ee462f2.js";import"./index-27a06473.js";import"./message-revoked-5cb51986.js";import"./message-plugin-b82b97f2.js";import"./message-plugin-layout-b05ad9de.js";import"./message-call-group-b36cd21c.js";import"./message-call-c2c-215680ac.js";import"./index-0978e08a.js";import"./message-customer-service-0c77f761.js";import"./message-room-default-e8ce0c6a.js";import"./index-fd7f70ae.js";import"./index-9d4666cb.js";import"./index-315de94f.js";import"./index-1dfefc7d.js";import"./index-f37edc42.js";import"./image-item.vue_vue_type_style_index_0_lang-58c86db8.js";import"./index-944a8f08.js";import"./index-a27f8461.js";import"./message-input-editor-1f6c7004.js";import"./@tiptap-57ba56f9.js";import"./prosemirror-state-c6000de8.js";import"./prosemirror-model-4222e734.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-8a42477f.js";import"./prosemirror-view-88df7d8c.js";import"./prosemirror-keymap-55db6e93.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-6d2c6479.js";import"./prosemirror-schema-list-d5a5352e.js";import"./index-0fa64378.js";import"./index-b5b8c0ea.js";import"./message-input-button-b0c1c96c.js";import"./index-bb7b8f99.js";import"./index-07258cd8.js";import"./index.vue_vue_type_script_setup_true_lang-9ec32410.js";import"./index-20817905.js";import"./selected-a3efc726.js";import"./index-6146692d.js";import"./index-043f784c.js";import"./emoji-picker-dialog-66c4a991.js";import"./index-ca5aad75.js";import"./index-9da5d87d.js";import"./camera-uni-de12e41a.js";import"./index-09f1251e.js";import"./index-088f9895.js";import"./index-b0dc35a7.js";import"./documentLink-a7b030c0.js";import"./index-a7c8e24e.js";import"./index.vue_vue_type_script_setup_true_lang-71ceb69d.js";import"./index-1ff7e933.js";import"./index-b997e70b.js";import"./index-83edc23d.js";import"./index-a93d99ed.js";import"./search-aefae6e3.js";import"./input-close-0334b363.js";import"./type-b7afadd9.js";import"./index-02a532b6.js";import"./dayjs-0ab82212.js";import"./search-type-list-f8ecda48.js";import"./index-7552e016.js";import"./date-picker-panel-c0a79893.js";import"./date-table-8e59b520.js";import"./down-icon-f2c30b56.js";import"./index-a6352ef7.js";import"./index-33a5e791.js";import"./message-abstract-text-a56998d2.js";import"./message-abstract-file-c22ad605.js";import"./message-abstract-custom-c473a1e7.js";import"./message-abstract-image-ba75a391.js";import"./message-abstract-video-da9ef47d.js";import"./index-adb923fe.js";import"./index-5a1654d8.js";import"./index-bd812f53.js";import"./right-icon-89a49395.js";import"./index-fc18fb49.js";import"./index-ae1fc72e.js";import"./index-2cbca33d.js";import"./index-654c371f.js";import"./index-cb5533b0.js";import"./index-f08d2b61.js";import"./edit-3cf9aa40.js";import"./index-20504119.js";import"./index.vue_vue_type_script_setup_true_lang-b448363d.js";import"./index-601165eb.js";import"./index-904d7f29.js";import"./index-1db2e9f5.js";import"./index-46cd7c98.js";import"./manage-name-ac8a998c.js";import"./manage-notification-b1241dba.js";import"./manage-member-e11e9b59.js";import"./manage-profile-1beca0b6.js";import"./manage-admin-7d604784.js";import"./index-aef6e63d.js";import"./index.vue_vue_type_script_setup_true_lang-9ec06412.js";class pt{constructor(){m(this,"currentConversationID","");m(this,"currentMessageList",[]);d.registerService(i.TUIChat.SERVICE.NAME,this),C.watch(E.CONV,{currentConversationID:e=>{this.currentConversationID=e}}),C.watch(E.CHAT,{messageList:e=>{this.currentMessageList=e}})}onCall(e,t,o){let a;switch(e){case i.TUIChat.SERVICE.METHOD.UPDATE_MESSAGE_LIST:if(a=t.message,(a==null?void 0:a.conversationID)===this.currentConversationID){const c=[...this.currentMessageList,a];C.update(E.CHAT,"messageList",c)}break;case i.TUIChat.SERVICE.METHOD.SEND_CUSTOM_MESSAGE:y.sendCustomMessage(t).then(c=>{o&&o(c)});break;case i.TUIChat.SERVICE.METHOD.SEND_TEXT_MESSAGE:y.sendTextMessage(t).then(c=>{o&&o(c)});break;case i.TUIChat.SERVICE.METHOD.SET_CHAT_TYPE:z.setChatType(t==null?void 0:t.chatType);break;case i.TUIChat.SERVICE.METHOD.CLOSE_MESSAGE_POP_MENU:C.update(E.CUSTOM,"isShowMessagePopMenu",!1);break}}}new pt;const T=class T{constructor(){m(this,"onCallParamsMap");m(this,"onCallCallbackMap");m(this,"constants");m(this,"hideConversationHeader",()=>{C.update(E.CUSTOM,"isShowConversationHeader",!1)});d.registerService(i.TUIConversation.SERVICE.NAME,this),d.registerExtension(i.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID,this),this.onCallParamsMap=new Map,this.onCallCallbackMap=new Map,this.constants=i}static getInstance(){return T.instance||(T.instance=new T),T.instance}getOnCallParams(e){return this.onCallParamsMap.get(e)}getOnCallCallback(e){return this.onCallCallbackMap.get(e)}onCall(e,t,o){switch(this.onCallParamsMap.set(e,t),this.onCallCallbackMap.set(e,o),e){case i.TUIConversation.SERVICE.METHOD.CREATE_CONVERSATION:this.createConversation(t);break;case i.TUIConversation.SERVICE.METHOD.HIDE_CONVERSATION_HEADER:this.hideConversationHeader();break}}onGetExtension(e){if(e===i.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID)return[{weight:100,icon:J,text:S.t("TUIConversation.发起单聊"),data:{name:_.TYPEC2C},listener:{onClicked:this.createConversation.bind(this)}},{weight:100,icon:Q,text:S.t("TUIConversation.发起群聊"),data:{name:_.TYPEGROUP},listener:{onClicked:this.createConversation.bind(this)}}]}createConversation(e){d.callService({serviceName:i.TUIContact.SERVICE.NAME,method:i.TUIContact.SERVICE.METHOD.SELECT_FRIEND,params:{title:e.text,isRadio:e.data.name!==_.TYPEGROUP,isNeedSearch:!C.getData(E.APP,"isOfficial")},callback:async t=>{if(!t||t.length===0)return this.routerForward(null);if(e.data.name===_.TYPEGROUP)this.createGroup(t);else{const{userID:o}=t[0];await this.generateConversation(`C2C${o}`),this.routerForward(`C2C${o}`)}}})}createGroup(e){d.callService({serviceName:i.TUIGroup.SERVICE.NAME,method:i.TUIGroup.SERVICE.METHOD.CREATE_GROUP,params:{title:S.t("TUIConversation.发起群聊"),memberList:e},callback:async t=>{let o=null;if(t){const{groupID:a}=t;await this.generateConversation(`GROUP${a}`),o=`GROUP${a}`}this.routerForward(o)}})}async routerForward(e){var t,o;b&&(await((t=D)==null?void 0:t.reLaunch({url:"/TUIKit/components/TUIConversation/index"})),e&&((o=D)==null||o.navigateTo({url:"/TUIKit/components/TUIChat/index"})))}generateConversation(e){G.switchConversation(e).then(()=>{e.startsWith("GROUP")&&j("groupChat"),console.warn("打开会话成功")}).catch(t=>{console.warn("打开会话失败",t.code,t.msg)})}};m(T,"instance");let O=T;new O;class mt{constructor(){d.registerService(i.TUISearch.SERVICE.NAME,this),d.registerExtension(i.TUIChat.EXTENSION.INPUT_MORE.EXT_ID,this)}onCall(e,t){switch(e){case i.TUISearch.SERVICE.METHOD.SEARCH_GROUP:return this.searchGroup(t==null?void 0:t.groupID);case i.TUISearch.SERVICE.METHOD.SEARCH_USER:return this.searchUser(t==null?void 0:t.userID);case i.TUISearch.SERVICE.METHOD.SEARCH_FRIEND:return this.searchFriend(t==null?void 0:t.userID);case i.TUISearch.SERVICE.METHOD.SEARCH_GROUP_MEMBER:return this.searchGroupMember(t==null?void 0:t.groupID,t==null?void 0:t.userID)}}onGetExtension(e){if(e===i.TUIChat.EXTENSION.INPUT_MORE.EXT_ID){const t=[],o={weight:3e3,text:"搜索",icon:"https://web.sdk.qcloud.com/component/TUIKit/assets/message-search.svg",data:{name:"search"},listener:{onClicked:()=>{var a;C.update(E.SEARCH,"isShowInConversationSearch",!0),b&&((a=D)==null||a.navigateTo({url:"/TUIKit/components/TUISearch/index"}))}}};return t.push(o),t}}async searchFriend(e){return B.getFriendProfile({userIDList:[e]})}async searchUser(e){return q.getUserProfile({userIDList:[e]})}async searchGroup(e){return P.searchGroupByID(e)}async searchGroupMember(e,t){return P.getGroupMemberProfile({groupID:e,userIDList:[t]})}}new mt;tt.getInstance();et.getInstance();const lt={key:0,class:"TUIKit-navbar"},ut=["onClick"],Ct={class:"TUIKit-main-container"},Et={key:0,class:"TUIKit-main"},ht={key:0,class:"TUIKit-main-aside"},It={key:1,class:"TUIKit-main-main"},Tt={key:1,class:"TUIKit-main"},dt=rt({__name:"index",props:{SDKAppID:{type:Number,default:0,required:!1},userID:{type:String,default:"",required:!1},userSig:{type:String,default:"",required:!1},conversationID:{type:String,default:"",required:!1}},setup(n){const e=R(""),t=R("message"),o=R("zh"),a=[{id:"message",label:"消息"},{id:"contact",label:"通讯录"}],c=n;it(()=>{C.watch(E.CONV,{currentConversationID:s=>{e.value=s}}),A(),x(),L()});function A(){const{SDKAppID:s,userID:U,userSig:p,conversationID:g}=c;s&&U&&p&&W.login({SDKAppID:s,userID:U,userSig:p,useUploadPlugin:!0,framework:X}).then(()=>{(g.startsWith("C2C")||g.startsWith("GROUP"))&&G.switchConversation(g)}).catch(St=>{})}function V(s){return s===0||s>=2e7&&s<9e7||s>=172e7&&s<179e7}function x(){o.value=V(c.SDKAppID)?"en":"zh",S.changeLanguage(o.value)}function L(){if(l){const s=document.getElementsByTagName("body")[0].style;s.setProperty("--callLeft","0"),s.setProperty("--callTop","0"),s.setProperty("--callWidth","100%"),s.setProperty("--callHeight","100%")}}return(s,U)=>(u(),h("div",{key:r(o)},[ot(s.$slots,"default",{},()=>[f("div",{class:M(["TUIKit",r(l)&&"TUIKit-h5"])},[r(l)&&r(e)?v("",!0):(u(),h("div",lt,[(u(),h(st,null,at(a,p=>f("div",{key:p.id,class:M(["TUIKit-navbar-item",r(t)===p.id&&"TUIKit-navbar-item-active"]),onClick:g=>t.value=p.id},H(r(S).t(p.label)),11,ut)),64))])),f("div",Ct,[r(t)==="message"?(u(),h("div",Et,[r(l)&&r(e)?v("",!0):(u(),h("div",ht,[I(r(N),{searchType:"global"}),I(r(Z))])),!r(l)||r(e)?(u(),h("div",It,[I(r(Y),null,{default:nt(()=>[f("h1",null,H(r(S).t("欢迎使用腾讯云即时通信IM")),1)]),_:1}),I(r(k),{class:M(r(l)?"chat-popup":"chat-aside")},null,8,["class"]),I(r(N),{class:M(r(l)?"chat-popup":"chat-aside"),searchType:"conversation"},null,8,["class"])])):v("",!0),r(l)&&!r(e)?(u(),ct(r(k),{key:2,class:"chat-popup"})):v("",!0),I(r(w),{displayType:"selectFriend"})])):r(t)==="contact"?(u(),h("div",Tt,[I(r(w),{displayType:"contactList",onSwitchConversation:U[0]||(U[0]=p=>t.value="message")})])):v("",!0)])],2)],!0)]))}});const Ti=$(dt,[["__scopeId","data-v-a6876a06"]]);export{Ti as default};
