import{d as F,r as C,b6 as N,o as g,c as T,ae as p,a as y,a_ as r,aB as u,x as M,aW as w,y as D,M as P}from"./@vue-a164be7a.js";import{J as O,q as b,o as $,i as Y,z as f,X as _,B as R,_ as q}from"./@tencentcloud-7fc831ec.js";import"./adapter-vue-24f22062.js";import B from"./message-abstract-text-a56998d2.js";import H from"./message-abstract-file-c22ad605.js";import V from"./message-abstract-custom-c473a1e7.js";import K from"./message-abstract-image-ba75a391.js";import z from"./message-abstract-video-da9ef47d.js";import{a as X}from"./search-type-list-f8ecda48.js";import{T as U}from"./index-cfdb213d.js";import{m as E}from"./type-b7afadd9.js";import{c as W,a as j}from"./env-a593fd1d.js";import{T as A}from"./index-e4ac2ab7.js";const Me=e=>_.searchCloudMessages(e).then(o=>o).catch(o=>(U({message:f.t("TUISearch.消息云端搜索失败：")+(o==null?void 0:o.message),type:A.ERROR,duration:3e3}),null)),J=e=>{const o=(e==null?void 0:e.conversationID)||(e!=null&&e.groupID?`GROUP${e==null?void 0:e.groupID}`:`C2C${e==null?void 0:e.userID}`);O.switchConversation(o).then(()=>{var s;b.update($.SEARCH,"currentSearchingStatus",{isSearching:!1,searchType:"global"}),b.update($.SEARCH,"currentSearchInputValue",{value:"",searchType:"global"}),W&&((s=Y)==null||s.navigateTo({url:"/TUIKit/components/TUIChat/index"}))}).catch(s=>{console.warn("switch conversation failed:",s==null?void 0:s.message),U({message:f.t("TUISearch.进入会话失败"),type:A.ERROR,duration:1e3})})},L=(e,o)=>{var s,a,i;return e?e.ID?o==null?void 0:o.showName:e.groupID?e.name||e.groupID:e.userID?e.remark||e.nick||e.userID||"":(s=e.conversation)!=null&&s.conversationID?typeof e.conversation.getShowName=="function"?e.conversation.getShowName():((i=(a=b.getConversationModel(e.conversation.conversationID))==null?void 0:a.getShowName)==null?void 0:i.call(a))||e.conversation.conversationID:"":""},Z=e=>{var o,s,a,i;return e?e.ID?e.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png":e.groupID?e.avatar||`https://web.sdk.qcloud.com/im/assets/images/${e==null?void 0:e.type}.svg`:e.userID?e.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png":(o=e==null?void 0:e.conversation)!=null&&o.conversationID?typeof e.conversation.getAvatar=="function"?(s=e.conversation)==null?void 0:s.getAvatar():(i=(a=b.getConversationModel(e.conversation.conversationID))==null?void 0:a.getAvatar)==null?void 0:i.call(a):"":""},Q=(e,o,s,a=!0)=>{var i,m,h,l;if(e!=null&&e.groupID)return[{text:"groupID: ",isHighlight:!1},{text:e.groupID,isHighlight:!0}];if(e!=null&&e.userID)return[{text:"userID: ",isHighlight:!1},{text:e.userID,isHighlight:!0}];if(e!=null&&e.conversation||e!=null&&e.flow)if((e==null?void 0:e.messageCount)===1||e!=null&&e.flow){const n=e!=null&&e.flow?e:e==null?void 0:e.messageList[0],c=((i=n==null?void 0:n.payload)==null?void 0:i.text)||((m=n==null?void 0:n.payload)==null?void 0:m.fileName)||((h=n==null?void 0:n.payload)==null?void 0:h.description),d=[];return n!=null&&n.type&&a&&n.type!==R.TYPES.MSG_TEXT&&d.push({text:f.t(`TUISearch.${E[n.type]}`),isHighlight:!1}),d.push(...x(c,s)),d}else return[{text:`${e==null?void 0:e.messageCount}${f.t("TUISearch.条相关")}${f.t(`TUISearch.${o==="allMessage"?"结果":(l=X[o])==null?void 0:l.label}`)}`,isHighlight:!1}];return[]},x=(e,o)=>{var l;if(!e||!o||!o.length)return[{text:e||"",isHighlight:!1}];const s=[];for(let n=0;n<o.length;n++){const c=(l=o[n])==null?void 0:l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(c,"gi");let v;for(;(v=d.exec(e))!==null;){const S=v.index,k=v.index+v[0].length-1;s.push([S,k])}}const a=[s[0]];if(s.length>1){s.sort((n,c)=>n[0]-c[0]);for(let n=1;n<s.length;n++){const c=s[n],d=a[a.length-1];c[0]-1<=d[1]?d[1]=Math.max(d[1],c[1]):a.push(c)}}if(!a[0])return[{text:e,isHighlight:!1}];const i=[];let m=0;for(let n=0;n<a.length;n++){const c=e.substring(m,a[n][0]);c&&i.push({text:c,isHighlight:!1});const d=e.substring(a[n][0],a[n][1]+1);d&&i.push({text:d,isHighlight:!0}),m=a[n][1]+1}const h=e.substring(m);return h&&i.push({text:h,isHighlight:!1}),i},ee=e=>{const o=new Date().setHours(0,0,0,0),s=new Date(new Date().getFullYear(),0,1,0,0,0,0).getTime(),a=new Date(e),i=24*60*60*1e3,m=7*i,h=o-a.getTime();function l(n){return n<10?"0"+n:n.toString()}if(h<=0)return`${l(a.getHours())}:${l(a.getMinutes())}`;if(h<=i)return`${f.t("time.昨天")} ${l(a.getHours())}:${l(a.getMinutes())}`;if(h<=m-i){const c=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][a.getDay()];return`${f.t("time."+c)} ${l(a.getHours())}:${l(a.getMinutes())}`}else return a.getTime()>=s?`${a.getMonth()+1}/${a.getDate()} ${l(a.getHours())}:${l(a.getMinutes())}`:`${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()} ${l(a.getHours())}:${l(a.getMinutes())}`},De=e=>{const o=new Date(e*1e3),s=o.getFullYear(),a=("0"+(o.getMonth()+1)).slice(-2),i=("0"+o.getDate()).slice(-2);return`${s}-${a}-${i}`},be=(e,o)=>{let s=null;return(...i)=>{s!==null&&(clearTimeout(s),s=null),s=setTimeout(()=>e(...i),o)}},te=["src"],se={key:2},ae={key:3},ne={key:5},oe=["src"],ie={key:2,class:"image-container-hover"},re={class:"image-container-hover-text"},le=F({__name:"index",props:{listItem:{default:()=>({})},listItemContent:{default:()=>({})},type:{default:"allMessage"},displayType:{default:"info"},keywordList:{default:()=>[]}},emits:["showResultDetail","navigateToChatPosition"],setup(e,{emit:o}){const s=e,a=o,i=C(R.TYPES),m=C(""),h=C(""),l=C([]),n=C(""),c=C(!1);N(()=>{var t,I;m.value=Z(s.listItem),h.value=L(s.listItem,s==null?void 0:s.listItemContent),l.value=Q(s.listItem,s.type,s.keywordList,(s==null?void 0:s.displayType)==="info"),n.value=(t=s.listItem)!=null&&t.time?ee(((I=s.listItem)==null?void 0:I.time)*1e3):""});const d=()=>{var t;s.type==="contact"||s.type==="group"?J(s.listItem):s.displayType==="info"&&!((t=s.listItem)!=null&&t.ID)?a("showResultDetail",!0,s.type,s.listItem):S()},v=t=>{c.value=t},S=()=>{a("navigateToChatPosition",s.listItem)},k=t=>t!=null&&t.type?f.t(`TUISearch.${E[t.type]}`):f.t("TUISearch.[合并消息]");return(t,I)=>(g(),T("div",{class:p(["search-result-list-item",!r(j)&&"search-result-list-item-h5","search-result-list-item-"+t.displayType,r(c)&&"hover-"+t.displayType]),onClick:d,onMouseenter:I[0]||(I[0]=G=>v(!0)),onMouseleave:I[1]||(I[1]=G=>v(!1))},[t.displayType==="info"||t.displayType==="bubble"?(g(),T("div",{key:0,class:p([t.displayType])},[y("div",{class:p(t.displayType+"-left")},[y("img",{class:p(t.displayType+"-left-avatar"),src:r(m)||"",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,10,te)],2),y("div",{class:p([t.displayType+"-main"])},[y("div",{class:p([t.displayType+"-main-name"])},u(r(h)),3),y("div",{class:p([t.displayType+"-main-content"])},[t.displayType==="info"||t.listItem.type===r(i).MSG_TEXT?(g(),M(B,{key:0,content:r(l),highlightType:t.displayType==="info"?"font":"background",displayType:t.displayType},null,8,["content","highlightType","displayType"])):t.listItem.type===r(i).MSG_FILE?(g(),M(H,{key:1,contentText:r(l),messageContent:t.listItemContent,displayType:t.displayType},null,8,["contentText","messageContent","displayType"])):t.listItem.type===r(i).MSG_IMAGE?(g(),T("div",se)):t.listItem.type===r(i).MSG_VIDEO?(g(),T("div",ae)):t.listItem.type===r(i).MSG_CUSTOM?(g(),M(V,{key:4,contentText:r(l),message:t.listItem,messageContent:t.listItemContent},null,8,["contentText","message","messageContent"])):(g(),T("div",ne,u(k(t.listItem)),1))],2)],2),y("div",{class:p(t.displayType+"-right")},[y("div",{class:p(t.displayType+"-right-time")},u(r(n)),3),t.displayType==="bubble"&&r(c)?(g(),T("div",{key:0,class:p(t.displayType+"-right-to"),onClick:w(S,["stop"])},u(r(f).t("TUISearch.定位到聊天位置")),3)):D("",!0)],2)],2)):t.displayType==="file"?(g(),T("div",{key:1,class:p([t.displayType])},[y("div",{class:p([t.displayType+"-header"])},[y("img",{class:p(t.displayType+"-header-avatar"),src:r(m),onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,10,oe),y("div",{class:p([t.displayType+"-header-name"])},u(r(h)),3),r(c)?(g(),T("div",{key:0,class:p(t.displayType+"-header-to"),onClick:w(S,["stop"])},u(r(f).t("TUISearch.定位到聊天位置")),3)):D("",!0),y("div",{class:p(t.displayType+"-header-time")},u(r(n)),3)],2),y("div",{class:p([t.displayType+"-main-content"])},[P(H,{contentText:r(l),messageContent:t.listItemContent,displayType:"bubble"},null,8,["contentText","messageContent"])],2)],2)):t.displayType==="image"?(g(),T("div",{key:2,class:p([t.displayType])},[y("div",{class:"image-container",onClick:w(S,["stop"])},[t.listItem.type===r(i).MSG_IMAGE?(g(),M(K,{key:0,messageContent:t.listItemContent},null,8,["messageContent"])):t.listItem.type===r(i).MSG_VIDEO?(g(),M(z,{key:1,messageContent:t.listItemContent},null,8,["messageContent"])):D("",!0),r(c)?(g(),T("div",ie,[y("div",re,u(r(f).t("TUISearch.定位到聊天位置")),1)])):D("",!0)])],2)):D("",!0)],34))}});const ce=q(le,[["__scopeId","data-v-5443d4fc"]]),ke=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"}));export{ce as S,be as d,J as e,De as g,ke as i,Me as s};
