import"./adapter-vue-24f22062.js";import{q as v,o as C,j as F,C as j,z as G,B as J,i as X,J as Q,_ as W}from"./@tencentcloud-7fc831ec.js";import Y from"./Icon-2c0593f3.js";import Z from"./index-6b0c1d9b.js";import K from"./index-b997e70b.js";import{c as k,a as M,d as ee,i as te}from"./env-a593fd1d.js";import{d as ne,r as o,aZ as se,a$ as oe,o as i,c as u,a_ as n,x as N,y as l,F as ie,ao as ae,ae as b,a,M as re,aB as d}from"./@vue-a164be7a.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";import"./constant-bad60a54.js";import"./index-cfa97a9d.js";import"./index-1dfefc7d.js";const ce="/admin/assets/mute-94c8513a.svg",ue=["id"],le=["onClick","onLongpress","onContextmenu"],de={class:"left"},me={key:1,class:"num"},pe={key:2,class:"num-notify"},_e={class:"content"},fe={class:"content-header"},ve={class:"content-header-label"},Ce={class:"name"},he={class:"middle-box"},ge={key:0,class:"middle-box-draft"},ye={key:1,class:"middle-box-at"},Se={class:"middle-box-content"},De={class:"content-footer"},Le={class:"time"},xe=ne({__name:"index",emits:["handleSwitchConversation","getPassingRef"],setup(ke,{expose:T,emit:V}){const I=V,p=o(),h=o(),z=o(),_=o(!1),g=o([]),y=o(),f=o(),S=o({top:0,left:void 0,conversationHeight:void 0}),O=o(!1),m=o();let D=null;se(()=>{v.watch(C.CONV,{currentConversationID:R,conversationList:A,currentConversation:w}),v.watch(C.USER,{displayOnlineStatus:U,userStatusList:B}),!k&&F&&!M&&$()}),oe(()=>{v.unwatch(C.CONV,{currentConversationID:R,conversationList:A,currentConversation:w}),v.unwatch(C.USER,{displayOnlineStatus:U,userStatusList:B})});const H=t=>O.value&&t.type===J.TYPES.CONV_C2C,L=(t,r,e,s)=>{s&&(t.preventDefault(),k)||(p.value=r,D=Date.now(),q(t,e))},P=()=>{D&&Date.now()-D>300&&(p.value=void 0,_.value=!1)},q=(t,r)=>{var e,s;if(k)typeof y.value>"u"&&I("getPassingRef",y),((e=X)==null?void 0:e.createSelectorQuery().in(y.value)).select(`#convlistitem-${r}`).boundingClientRect(x=>{x&&(S.value={top:x.bottom+(te?44:0),left:t.touches[0].pageX,conversationHeight:x.height},_.value=!0)}).exec();else{const c=((s=t.currentTarget||t.target)==null?void 0:s.getBoundingClientRect())||{};c&&(S.value={top:c.bottom,left:M?t.clientX:void 0,conversationHeight:c.height}),_.value=!0}},E=t=>{I("handleSwitchConversation",t),Q.switchConversation(t)};function $(){f.value&&j({element:f.value,onLongPress:(t,r)=>{const e=Array.from(f.value.children).indexOf(r);L(t,g.value[e],e)},options:{eventDelegation:{subSelector:".tui-conversation-content"}}})}function w(t){p.value=t}function A(t){g.value=t}function R(t){h.value=t}function U(t){O.value=t}function B(t){t.size!==0&&(m.value=[...t.entries()].reduce((r,[e,s])=>(r[e]=s,r),{}))}return T({closeChildren:P}),(t,r)=>(i(),u("div",{ref_key:"conversationListInnerDomRef",ref:f,class:"tui-conversation-list"},[n(_)?(i(),N(K,{key:0,selectedConversation:n(p),actionsMenuPosition:n(S),selectedConversationDomRect:n(z),onCloseConversationActionMenu:P},null,8,["selectedConversation","actionsMenuPosition","selectedConversationDomRect"])):l("",!0),(i(!0),u(ie,null,ae(n(g),(e,s)=>(i(),u("div",{id:`convlistitem-${s}`,key:s,class:b(["tui-conversation-content",n(ee)&&"tui-conversation-content-h5 disable-select"])},[a("div",{class:b([n(M)&&"isPC","tui-conversation-item",n(h)===e.conversationID&&"tui-conversation-item-selected",e.isPinned&&"tui-conversation-item-pinned"]),onClick:c=>E(e.conversationID),onLongpress:c=>L(c,e,s),onContextmenu:c=>L(c,e,s,!0)},[a("aside",de,[re(Z,{useSkeletonAnimation:"",url:e.getAvatar(),size:"30px"},null,8,["url"]),n(m)&&H(e)?(i(),u("div",{key:0,class:b(["online-status",Object.keys(n(m)).length>0&&Object.keys(n(m)).includes(e.userProfile.userID)&&n(m)[e.userProfile.userID].statusType===1?"online-status-online":"online-status-offline"])},null,2)):l("",!0),e.unreadCount>0&&!e.isMuted?(i(),u("span",me,d(e.unreadCount>99?"99+":e.unreadCount),1)):l("",!0),e.unreadCount>0&&e.isMuted?(i(),u("span",pe)):l("",!0)]),a("div",_e,[a("div",fe,[a("label",ve,[a("p",Ce,d(e.getShowName()),1)]),a("div",he,[e.draftText&&e.conversationID!==n(h)?(i(),u("span",ge,d(n(G).t("TUIChat.[草稿]")),1)):e.type==="GROUP"&&e.groupAtInfoList&&e.groupAtInfoList.length>0?(i(),u("span",ye,d(e.getGroupAtInfo()),1)):l("",!0),a("div",Se,d(e.getLastMessage("text")),1)])]),a("div",De,[a("span",Le,d(e.getLastMessage("time")),1),e.isMuted?(i(),N(Y,{key:0,file:n(ce)},null,8,["file"])):l("",!0)])])],42,le)],10,ue))),128))],512))}});const Je=W(xe,[["__scopeId","data-v-d3b64486"]]);export{Je as default};
