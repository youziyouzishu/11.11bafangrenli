import{q as y,o as c,B as I,X as d,z as B,_ as R}from"./@tencentcloud-7fc831ec.js";import"./adapter-vue-24f22062.js";import w from"./message-input-editor-1f6c7004.js";import v from"./index-0fa64378.js";import D from"./message-input-button-b0c1c96c.js";import U from"./index-bb7b8f99.js";import{T as N}from"./index-cfdb213d.js";import{i as G}from"./utils-14df48f1.js";import{e as V}from"./enableSampleTaskStatus-a12ec87d.js";import{O as A}from"./index-0978e08a.js";import{T as H}from"./index-e4ac2ab7.js";import{a as L}from"./index-7909557f.js";import{a as Y,i as q}from"./env-a593fd1d.js";import{d as C,r as E,o as h,c as j,a as z,M as S,x as P,y as O,ae as X,a_ as F}from"./@vue-a164be7a.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";import"./@tiptap-57ba56f9.js";import"./prosemirror-state-c6000de8.js";import"./prosemirror-model-4222e734.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-8a42477f.js";import"./prosemirror-view-88df7d8c.js";import"./prosemirror-keymap-55db6e93.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-6d2c6479.js";import"./prosemirror-schema-list-d5a5352e.js";import"./type-check-5e73d261.js";import"./index-b5b8c0ea.js";import"./config-58aee8b5.js";import"./Icon-2c0593f3.js";import"./icon-close-7ee462f2.js";import"./constant-bad60a54.js";const k=new Map([[3123,"文本包含本地审核拦截词"],[4004,"图片消息失败,无效的图片格式"],[4005,"文件消息失败,禁止发送违规封禁的文件"],[7004,"文件不存在,请检查文件路径是否正确"],[7005,"文件大小超出了限制,如果上传文件,最大限制是100MB"],[8001,"消息长度超出限制,消息长度不要超过12K"],[80001,"消息或者资料中文本存在敏感内容,发送失败"],[80004,"消息中图片存在敏感内容,发送失败"]]),J=async(m,o)=>{y.getData(c.CHAT,"messageSource")&&y.update(c.CHAT,"messageSource",void 0),m==null||m.forEach(async p=>{var i,T,t,u,f,M,_;try{const e={to:((i=o==null?void 0:o.groupProfile)==null?void 0:i.groupID)||((T=o==null?void 0:o.userProfile)==null?void 0:T.userID),conversationType:o==null?void 0:o.type,payload:{},needReadReceipt:G()};let g;const l={offlinePushInfo:{}},n={conversation:o,payload:p.payload,messageType:""};switch(p==null?void 0:p.type){case"text":if(g=JSON.parse(JSON.stringify((t=p.payload)==null?void 0:t.text)),!g)break;e.payload={text:g},n.messageType=I.TYPES.MSG_TEXT,l.offlinePushInfo=A.create(n),(u=p.payload)!=null&&u.atUserList?(e.payload.atUserList=p.payload.atUserList,await d.sendTextAtMessage(e,l)):await d.sendTextMessage(e,l);break;case"image":e.payload={file:(f=p.payload)==null?void 0:f.file},n.messageType=I.TYPES.MSG_IMAGE,l.offlinePushInfo=A.create(n),await d.sendImageMessage(e,l);break;case"video":e.payload={file:(M=p.payload)==null?void 0:M.file},n.messageType=I.TYPES.MSG_VIDEO,l.offlinePushInfo=A.create(n),await d.sendVideoMessage(e,l);break;case"file":e.payload={file:(_=p.payload)==null?void 0:_.file},n.messageType=I.TYPES.MSG_FILE,l.offlinePushInfo=A.create(n),await d.sendFileMessage(e,l);break;default:break}V("sendMessage")}catch(e){N({message:k.get(e==null?void 0:e.code)?B.t(`TUIChat.${k.get(e.code)}`):e==null?void 0:e.message,type:H.ERROR}),y.getData(c.CHAT,"quoteMessage")&&y.update(c.CHAT,"quoteMessage",{})}})},K=(m,o)=>{!m&&!o?d.enterTypingState():d.leaveTypingState()},Q={class:"message-input-wrapper"},W=C({__name:"index",props:{placeholder:{type:String,default:"this is placeholder"},isMuted:{type:Boolean,default:!0},muteText:{type:String,default:""},enableInput:{type:Boolean,default:!0},enableAt:{type:Boolean,default:!0},enableDragUpload:{type:Boolean,default:!0},enableTyping:{type:Boolean,default:!0}},emits:["sendMessage","resetReplyOrReference","onTyping"],setup(m,{expose:o,emit:p}){const i=m,T=p,t=E(),u=E(),f=E();y.watch(c.CONV,{currentConversation:a=>{f.value=a}});const M=(a,s)=>{K(a,s)},_=a=>{var s;(s=u.value)==null||s.toggleAtList(a)},e=async()=>{var r,x;const a=(r=t.value)==null?void 0:r.getEditorContent();if(!a||!f.value)return;const s=a.map(b=>(b.type==="text"&&(b.payload.text=L(b.payload.text)),b));await J(s,f.value),T("sendMessage"),(x=t.value)==null||x.resetEditor()},g=a=>{var s;(s=t.value)==null||s.addEmoji(a)},l=()=>{var a;q&&((a=t.value)==null||a.blur())},n=a=>{var s,r;(s=t==null?void 0:t.value)!=null&&s.insertAt&&((r=t==null?void 0:t.value)==null||r.insertAt(a))};return o({insertEmoji:g,reEdit:a=>{var s,r;(s=t.value)==null||s.resetEditor(),(r=t.value)==null||r.setEditorContent(a)}}),(a,s)=>(h(),j("div",Q,[z("div",{class:X(["message-input-container",!F(Y)&&"message-input-container-h5"])},[S(w,{ref_key:"editor",ref:t,placeholder:i.placeholder,isMuted:i.isMuted,muteText:i.muteText,enableInput:i.enableInput,enableAt:i.enableAt,enableTyping:i.enableTyping,enableDragUpload:i.enableDragUpload,onSendMessage:e,onOnTyping:M,onOnAt:_},null,8,["placeholder","isMuted","muteText","enableInput","enableAt","enableTyping","enableDragUpload"]),i.isMuted?O("",!0):(h(),P(D,{key:0,onSendMessage:e})),i.enableAt?(h(),P(v,{key:1,ref_key:"messageInputAtRef",ref:u,onInsertAt:n,onOnAtListOpen:l},null,512)):O("",!0)],2),S(U)]))}});const Le=R(W,[["__scopeId","data-v-c94b6a0a"]]);export{Le as default};
