import{d as Ce,r as c,aZ as Ue,b7 as Ae,b6 as Ne,b as P,o as v,c as b,a_ as a,M as O,a as l,aB as d,y as T,F as Le,ao as Ye,aW as F,x as $,aT as $e,aP as Be,aR as ve,ak as Ve,aj as We}from"./@vue-a164be7a.js";import"./adapter-vue-24f22062.js";import{B as n,I as xe,q as J,o as Z,z as i,Z as R,Q as He,i as qe,J as Ke,_ as Fe}from"./@tencentcloud-7fc831ec.js";import Je from"./index-46cd7c98.js";import Ze from"./index-1dfefc7d.js";import je from"./index-20817905.js";import ze from"./manage-name-ac8a998c.js";import Qe from"./manage-notification-b1241dba.js";import Xe from"./manage-member-e11e9b59.js";import es from"./manage-profile-1beca0b6.js";import ss from"./manage-admin-7d604784.js";import B from"./Icon-2c0593f3.js";import{b as ts}from"./back-16f17fde.js";import{e as j}from"./right-icon-89a49395.js";import{T as w}from"./index-cfdb213d.js";import{c as z,a as Q}from"./env-a593fd1d.js";import{T as as}from"./server-fb151bb0.js";import{e as fe}from"./enableSampleTaskStatus-a12ec87d.js";import{T as G}from"./index-e4ac2ab7.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";import"./selected-a3efc726.js";import"./edit-3cf9aa40.js";import"./index-6b0c1d9b.js";import"./index-aef6e63d.js";const os=C=>(Ve("data-v-de6efec4"),C=C(),We(),C),ls={key:0,class:"manage-header"},rs={class:"manage-header-content"},ns=os(()=>l("div",null,null,-1)),is={key:1,class:"main"},us={class:"user-info space-top"},ms={class:"user-info-header-left"},cs={class:"user-info-header-right"},ds={class:"span"},ps={class:"user-info-list"},vs=["onClick"],fs=["src"],Is={class:"user-info-list-item-info"},_s={key:0,class:"user-info-list-item"},bs={key:1,class:"user-info-list-item"},Ts={class:"aside"},gs={class:"label"},Rs={class:"article"},Ms={class:"label"},hs={class:"list-item"},ks={class:"label"},Ss={class:"groupID"},Es={class:"span"},Ps={class:"list-item"},Os={class:"label"},ws=["src"],Gs={class:"list-item"},ys={class:"label"},Ds={class:"span"},Cs={class:"list-item"},Us={class:"label"},As={class:"span"},Ns={class:"footer list space-top"},Ls={key:0,class:"del-dialog-title"},Ys={key:1,class:"del-dialog-title"},$s=Ce({__name:"index",props:{groupID:{type:String,default:""},groupCurrentTab:{type:String,default:""}},setup(C){const V=as.getInstance(),X=V.constants,Ie=C,W=c(void 0),_=c(""),x=c(""),y=c(""),U=c(!1),M=c(""),A=c({list:[]}),ee=c({}),se=c({[n.TYPES.GRP_WORK]:"好友工作群",[n.TYPES.GRP_PUBLIC]:"陌生人社交群",[n.TYPES.GRP_MEETING]:"临时会议群",[n.TYPES.GRP_AVCHATROOM]:"直播群",[n.TYPES.GRP_COMMUNITY]:"社群",[n.TYPES.JOIN_OPTIONS_FREE_ACCESS]:"自由加入",[n.TYPES.JOIN_OPTIONS_NEED_PERMISSION]:"需要验证",[n.TYPES.JOIN_OPTIONS_DISABLE_APPLY]:"禁止加群"}),p=c({admin:[],member:[],muteMember:[]}),u=c([]),k=c(""),_e=c(!1),S=c(!1),te=c([]),N=c(!1),D=c([]),L=c([]),o=c(),Y=c(""),ae=c("");Ue(()=>{Ae(()=>{W.value&&xe.listen({domRefs:W.value,handler:K})})}),J.watch(Z.GRP,{currentGroup:t=>{var e,s;t&&(o.value=t,Y.value=(s=(e=o.value)==null?void 0:e.selfInfo)==null?void 0:s.role)},currentGroupMemberList:t=>{D.value=t,p.value={admin:[],member:[],muteMember:[]},Array.from(t).map(s=>{switch(s==null?void 0:s.role){case n.TYPES.GRP_MBR_ROLE_ADMIN:p.value.admin.push(s);break;case n.TYPES.GRP_MBR_ROLE_MEMBER:p.value.member.push(s);break}return s});const e=new Date().getTime();p.value.muteMember=Array.from(t).filter(s=>(s==null?void 0:s.muteUntil)*1e3-e>0)}}),J.watch(Z.CONV,{currentConversation:t=>{var e;ae.value=(e=t==null?void 0:t.groupProfile)==null?void 0:e.groupID}}),Ne(()=>{const t=V.getOnCallParams(X.TUIGroup.SERVICE.METHOD.OPEN_GROUP_MANAGEMENT);M.value=t.groupID||ae.value,_.value=Ie.groupCurrentTab});const be=P(()=>{let t="";switch(_.value){case"notification":t="群公告";break;case"member":t="群成员";break;case"profile":t="群成员";break;default:t="群管理";break}return t}),H=P(()=>{var r,m;const t=(m=(r=o==null?void 0:o.value)==null?void 0:r.selfInfo)==null?void 0:m.role,e=t===n.TYPES.GRP_MBR_ROLE_OWNER,s=t===n.TYPES.GRP_MBR_ROLE_ADMIN;return e||s}),oe=P(()=>{var g,I,f;const t=(g=o==null?void 0:o.value)==null?void 0:g.type,s=((f=(I=o==null?void 0:o.value)==null?void 0:I.selfInfo)==null?void 0:f.role)===n.TYPES.GRP_MBR_ROLE_OWNER,r=t===n.TYPES.GRP_WORK,m=t===n.TYPES.GRP_AVCHATROOM;return!!(!r&&!m&&s)}),le=P(()=>{var s;return!(((s=o==null?void 0:o.value)==null?void 0:s.type)===n.TYPES.GRP_WORK||!H.value)}),Te=P(()=>{var s;return((s=o==null?void 0:o.value)==null?void 0:s.type)!==n.TYPES.GRP_AVCHATROOM}),q=async t=>{const{key:e,value:s}=t,r={groupID:o.value.groupID,[e]:s};R.updateGroupProfile(r).then(m=>{o.value=m.data.group,x.value=""}).catch(m=>{w({message:m==null?void 0:m.message,type:G.ERROR})})},h=t=>{_.value=t,x.value="",_.value==="member"&&(y.value="remove"),_.value||(y.value="")},ge=()=>{E()},E=async t=>{var s;te.value=[];let e=[];switch(t){case"add":S.value=!1,e=[...p.value.admin,...p.value.member].map(r=>r.userID),u.value=(await Re()).filter(r=>r.userID&&e.indexOf(r.userID)<0),k.value="添加成员";break;case"remove":S.value=!1,u.value=D.value.filter(r=>{var m,g;return r.userID!==((g=(m=o==null?void 0:o.value)==null?void 0:m.selfInfo)==null?void 0:g.userID)}),k.value="删除成员";break;case"addAdmin":S.value=!0,u.value=p.value.member,k.value="新增管理员";break;case"removeAdmin":S.value=!0,u.value=p.value.admin,k.value="移除管理员";break;case"changeOwner":S.value=!0,u.value=[...p.value.admin,...p.value.member],k.value="转让群组";break;case"addMute":S.value=!0,u.value=p.value.member,o.value.selfInfo.role==="Owner"&&(u.value=[...p.value.admin,...p.value.member]),u.value=(s=u==null?void 0:u.value)==null?void 0:s.filter(r=>{var m,g;return((g=(m=p==null?void 0:p.value)==null?void 0:m.muteMember)==null?void 0:g.indexOf(r))<0}),k.value="新增禁言用户";break;case"removeMute":S.value=!0,u.value=p.value.muteMember,k.value="移除禁言用户";break}t&&(y.value=t),U.value=!U.value},Re=async()=>(await He.getFriendList()).data.map(s=>s==null?void 0:s.profile).filter(s=>!A.value.list.some(r=>r.userID===s.userID)),Me=P(()=>{var s,r,m;const t=(r=(s=o==null?void 0:o.value)==null?void 0:s.selfInfo)==null?void 0:r.role,e=(m=o==null?void 0:o.value)==null?void 0:m.type;return t===n.TYPES.GRP_MBR_ROLE_OWNER&&e!==n.TYPES.GRP_WORK}),re=P(()=>{var e;return((e=o==null?void 0:o.value)==null?void 0:e.type)===n.TYPES.GRP_WORK}),he=P(()=>{var e,s;let t=3;return re.value||(t+=1),((s=(e=o==null?void 0:o.value)==null?void 0:e.selfInfo)==null?void 0:s.role)!=="Owner"&&(t+=1),t}),ke=async t=>{const s={groupID:M.value,count:100,offset:t&&t==="more"?A.value.list.length:0};await R.getGroupMemberList(s).then(r=>{t&&t==="more"?A.value.list=[...A.value.list,...r.data.memberList]:A.value.list=r.data.memberList})},ne=t=>{ee.value=t,h("profile")},ie=t=>{y.value==="remove"?(L.value=t,N.value=!N.value):me(t,y.value),U.value=!1},Se=async t=>{await R.dismissGroup(t.groupID),fe("dismissGroup"),w({message:i.t("TUIGroup.群组解散成功"),type:G.SUCCESS}),ue()},ue=()=>{var t;z?(t=qe)==null||t.switchTab({url:"/TUIKit/components/TUIConversation/index"}):(K(),Ke.switchConversation())},Ee=t=>{q({key:"muteAllMembers",value:t}),t?(fe("muteGroup"),w({message:i.t("TUIGroup.禁言设置成功"),type:G.SUCCESS})):w({message:i.t("TUIGroup.取消禁言成功"),type:G.SUCCESS})},Pe=async t=>{var m,g;let e={},s={};const r={groupID:M.value,userIDList:[t]};switch(y.value){case"add":try{s=await R.getGroupMemberProfile(r),u.value=u.value.filter(I=>{var f;return I.userID!==((f=e.data[0])==null?void 0:f.userID)}),u.value=[...u.value,...e.data],((m=s==null?void 0:s.data)==null?void 0:m.memberList.length)>0&&(u.value=u.value.map(I=>{var f;return I.userID===((f=s==null?void 0:s.data)==null?void 0:f.memberList[0].userID)&&(I.isDisabled=!0),I}))}catch{const f=i.t("TUIGroup.该用户不存在");w({message:f,type:G.ERROR})}break;case"remove":try{if(e=await R.getGroupMemberProfile(r),e.data.memberList.length===0){const I=i.t("TUIGroup.该用户不在群组内");w({message:I,type:G.ERROR})}u.value=u.value.filter(I=>{var f,pe;return I.userID!==((pe=(f=e==null?void 0:e.data)==null?void 0:f.memberList[0])==null?void 0:pe.userID)}),(g=e==null?void 0:e.data)!=null&&g.memberList.length&&(u.value=[...u.value,...e.data.memberList])}catch{const f=i.t("TUIGroup.该用户不存在");w({message:f,type:G.ERROR})}break}},me=(t,e)=>{const s=[];switch(t.map(r=>(s.push(r.userID),r)),e){case"add":Oe(s);break;case"remove":Ge(s);break;case"addAdmin":de(t[0]);break;case"removeAdmin":de(t[0]);break;case"changeOwner":we(s[0]);break;case"addMute":ce(s[0],"add");break;case"removeMute":ce(s[0],"remove");break}},Oe=async t=>{const e={groupID:M.value,userIDList:t};await R.addGroupMember(e)},we=async t=>{const e={groupID:M.value,newOwnerID:t},s=await R.changeGroupOwner(e);o.value={},o.value=s.data.group},ce=async(t,e)=>{const s={groupID:M.value,userID:t,muteTime:e==="add"?2592e3:0};await R.setGroupMemberMuteTime(s)},de=async t=>{let e="";switch(t.role){case n.TYPES.GRP_MBR_ROLE_ADMIN:e=n.TYPES.GRP_MBR_ROLE_MEMBER;break;case n.TYPES.GRP_MBR_ROLE_MEMBER:e=n.TYPES.GRP_MBR_ROLE_ADMIN;break}const s={groupID:M.value,userID:t.userID,role:e};await R.setGroupMemberRole(s)},Ge=async t=>{const e={groupID:M.value,userIDList:t,reason:""};await R.deleteGroupMember(e)},ye=async t=>{await R.quitGroup(t.groupID),ue()},De=()=>{_.value?h(""):K()},K=()=>{J.update(Z.GRP,"isShowManageComponent",!1);const t=V.getOnCallCallback(X.TUIGroup.SERVICE.METHOD.OPEN_GROUP_MANAGEMENT);t&&t()};return(t,e)=>(v(),b("div",{ref_key:"manageRef",ref:W,class:"manage"},[!a(z)||a(_)==="admin"?(v(),b("header",ls,[O(B,{file:a(ts),onOnClick:De},null,8,["file"]),l("div",rs,d(a(i).t(`TUIGroup.${a(be)}`)),1),ns])):T("",!0),!a(_)||a(z)&&a(_)!="admin"?(v(),b("main",is,[O(ze,{class:"space-top",isAuthor:a(H),data:a(o),onUpdate:q},null,8,["isAuthor","data"]),l("div",us,[l("header",{class:"user-info-header",onClick:e[0]||(e[0]=s=>h("member"))},[l("label",ms,d(a(i).t("TUIGroup.群成员")),1),l("div",cs,[l("span",ds,d(a(o).memberCount||a(D).length)+" "+d(a(i).t("TUIGroup.人")),1),O(B,{file:a(j)},null,8,["file"])])]),l("ol",ps,[(v(!0),b(Le,null,Ye(a(D).slice(0,a(he)),(s,r)=>(v(),b("dl",{key:r,class:"user-info-list-item"},[l("dt",{class:"user-info-list-item-main",onClick:m=>ne(s)},[l("img",{class:"avatar",src:s.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,fs)],8,vs),l("dd",Is,d(s.nick||s.userID),1)]))),128)),a(re)?(v(),b("dl",_s,[l("dt",{class:"avatar",onClick:e[1]||(e[1]=s=>E("add"))}," + ")])):T("",!0),a(Y)==="Owner"?(v(),b("dl",bs,[l("dt",{class:"avatar",onClick:e[2]||(e[2]=s=>E("remove"))}," - ")])):T("",!0)])]),l("ul",{class:"content list space-top",onClick:e[5]||(e[5]=s=>x.value="")},[l("li",{class:"list-item",onClick:e[3]||(e[3]=s=>h("notification"))},[l("aside",Ts,[l("label",gs,d(a(i).t("TUIGroup.群公告")),1),l("article",Rs,d(a(o).notification),1)]),O(B,{file:a(j),class:"end"},null,8,["file"])]),a(oe)&&a(le)?(v(),b("li",{key:0,class:"list-item",onClick:e[4]||(e[4]=s=>h("admin"))},[l("label",Ms,d(a(i).t("TUIGroup.群管理")),1),O(B,{file:a(j)},null,8,["file"])])):T("",!0),l("li",hs,[l("label",ks,d(a(i).t("TUIGroup.群ID")),1),l("div",Ss,[l("span",Es,d(a(M)),1)])]),l("li",Ps,[l("label",Os,d(a(i).t("TUIGroup.群头像")),1),l("img",{class:"avatar",src:a(o).avatar||"https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.svg'"},null,8,ws)]),l("li",Gs,[l("label",ys,d(a(i).t("TUIGroup.群类型")),1),l("span",Ds,d(a(i).t(`TUIGroup.${a(se)[a(o).type]}`)),1)]),l("li",Cs,[l("label",Us,d(a(i).t("TUIGroup.加群方式")),1),l("span",As,d(a(i).t(`TUIGroup.${a(se)[a(o).joinOption]}`)),1)])]),l("ul",Ns,[a(Y)==="Owner"&&a(D).length>1?(v(),b("li",{key:0,class:"list-item",onClick:e[6]||(e[6]=F(s=>E("changeOwner"),["stop"]))},d(a(i).t("TUIGroup.转让群组")),1)):T("",!0),a(Me)?(v(),b("li",{key:1,class:"list-item",onClick:e[7]||(e[7]=F(s=>Se(a(o)),["stop"]))},d(a(i).t("TUIGroup.解散群聊")),1)):(v(),b("li",{key:2,class:"list-item",onClick:e[8]||(e[8]=F(s=>ye(a(o)),["stop"]))},d(a(i).t("TUIGroup.退出群组")),1))])])):T("",!0),a(_)==="member"?(v(),$(Xe,{key:2,self:a(o).selfInfo,list:a(D),total:~~a(o).memberCount,isShowDel:a(Y)==="Owner"&&a(Te),onMore:e[9]||(e[9]=s=>ke("more")),onDel:ie,onHandleMemberProfileShow:ne,onClose:e[10]||(e[10]=s=>h(""))},null,8,["self","list","total","isShowDel"])):T("",!0),a(_)==="profile"?(v(),$(es,{key:3,userInfo:a(ee),onClose:e[11]||(e[11]=s=>h(""))},null,8,["userInfo"])):T("",!0),a(_)==="notification"?(v(),$(Qe,{key:4,isAuthor:a(H),data:a(o),onUpdate:q,onClose:e[12]||(e[12]=s=>h(""))},null,8,["isAuthor","data"])):T("",!0),a(_)==="admin"?$e((v(),$(ss,{key:5,isSetMuteTime:a(le),member:a(p),currentGroup:a(o),onAddAdmin:e[13]||(e[13]=s=>E("addAdmin")),onRemoveAdmin:e[14]||(e[14]=s=>E("removeAdmin")),onSetAllMuteTime:Ee,onAddMute:e[15]||(e[15]=s=>E("addMute")),onRemoveMute:e[16]||(e[16]=s=>E("removeMute")),onClose:e[17]||(e[17]=s=>h(""))},null,8,["isSetMuteTime","member","currentGroup"])),[[Be,a(oe)]]):T("",!0),O(Je,{show:a(U),"onUpdate:show":e[18]||(e[18]=s=>U.value=s)},{default:ve(()=>[O(je,{title:a(i).t(`TUIGroup.${a(k)}`),list:a(u),isSearch:a(_e),isRadio:a(S),selectedList:a(te),isH5:!a(Q),onSubmit:ie,onCancel:ge,onSearch:Pe},null,8,["title","list","isSearch","isRadio","selectedList","isH5"])]),_:1},8,["show"]),O(Ze,{class:"deleted-dialog",title:a(i).t("TUIGroup.删除成员"),show:a(N),isH5:!a(Q),center:!0,isHeaderShow:a(Q),onSubmit:e[19]||(e[19]=s=>me(a(L),"remove")),"onUpdate:show":e[20]||(e[20]=s=>N.value=s)},{default:ve(()=>[a(L).length===1?(v(),b("p",Ls,d(a(i).t("TUIGroup.确定从群聊中删除该成员？")),1)):T("",!0),a(L).length>1?(v(),b("p",Ys,d(a(i).t("TUIGroup.确定从群聊中删除所选成员？")),1)):T("",!0)]),_:1},8,["title","show","isH5","isHeaderShow"])],512))}});const gt=Fe($s,[["__scopeId","data-v-de6efec4"]]);export{gt as default};
