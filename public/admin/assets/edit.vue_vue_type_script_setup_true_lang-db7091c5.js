import{x as P,y as K,_ as M,K as Q,L as z,Q as G,A as H}from"./element-plus-69d92160.js";import{P as J}from"./index-943d816c.js";import{a as W}from"./useDictOptions-8702f1a7.js";import{r as m}from"./index-90bac5cf.js";import{r as X}from"./role-e3d4b914.js";import{e as Y}from"./post-a49d878c.js";import{d as Z}from"./department-2d25a8b5.js";import{d as $,b5 as j,r as ee,b as le,b2 as C,aq as ae,o as u,c as g,M as t,aR as r,a_ as a,a as p,F as h,ao as q,x as c,y as R}from"./@vue-a164be7a.js";function ve(d){return m.get({url:"/auth.admin/lists",params:d},{ignoreCancelToken:!0})}function oe(d){return m.post({url:"/auth.admin/add",params:d})}function te(d){return m.post({url:"/auth.admin/edit",params:d})}function Ve(d){return m.post({url:"/auth.admin/delete",params:d})}function re(d){return m.get({url:"/auth.admin/detail",params:d})}const se={class:"edit-popup"},de=p("div",{class:"form-tips"},"建议尺寸：100*100px，支持jpg，jpeg，png格式",-1),ne=p("div",{class:"form-tips"},"允许多人同时在线登录",-1),we=$({__name:"edit",emits:["success","close"],setup(d,{expose:D,emit:A}){const y=A,k=j(),f=j(),_=ee("add"),F=le(()=>_.value=="edit"?"编辑管理员":"新增管理员"),l=C({id:"",account:"",name:"",dept_id:[],jobs_id:[],role_id:[],avatar:"",password:"",password_confirm:"",disable:0,multipoint_login:1,root:0}),x=(i,e,s)=>{l.password&&(e||s(new Error("请再次输入密码")),e!==l.password&&s(new Error("两次输入密码不一致!"))),s()},b=C({account:[{required:!0,message:"请输入账号",trigger:["blur"]}],name:[{required:!0,message:"请输入名称",trigger:["blur"]}],role_id:[{type:"array",required:!1,message:"请选择角色",trigger:["blur"]}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],password_confirm:[{required:!0,message:"请输入确认密码",trigger:["blur"]},{validator:x,trigger:"blur"}]}),{optionsData:v}=W({role:{api:X},jobs:{api:Y},dept:{api:Z}}),B=async()=>{var i,e;await((i=k.value)==null?void 0:i.validate()),_.value=="edit"?await te(l):await oe(l),(e=f.value)==null||e.close(),y("success")},S=(i="add")=>{var e;_.value=i,(e=f.value)==null||e.open()},L=async i=>{b.password=[],b.password_confirm=[{validator:x,trigger:"blur"}];const e=await re({id:i.id});for(const s in l)e[s]!=null&&e[s]!=null&&(l[s]=e[s])},N=()=>{y("close")};return D({open:S,setFormData:L}),(i,e)=>{const s=P,n=K,T=ae("material-picker"),I=M,V=Q,E=z,U=G,O=H;return u(),g("div",se,[t(J,{ref_key:"popupRef",ref:f,title:a(F),async:!0,width:"550px",onConfirm:B,onClose:N},{default:r(()=>[t(O,{ref_key:"formRef",ref:k,model:a(l),"label-width":"84px",rules:a(b)},{default:r(()=>[t(n,{label:"账号",prop:"account"},{default:r(()=>[t(s,{modelValue:a(l).account,"onUpdate:modelValue":e[0]||(e[0]=o=>a(l).account=o),disabled:a(l).root==1,placeholder:"请输入账号",clearable:""},null,8,["modelValue","disabled"])]),_:1}),t(n,{label:"头像"},{default:r(()=>[p("div",null,[p("div",null,[t(T,{modelValue:a(l).avatar,"onUpdate:modelValue":e[1]||(e[1]=o=>a(l).avatar=o),limit:1},null,8,["modelValue"])]),de])]),_:1}),t(n,{label:"名称",prop:"name"},{default:r(()=>[t(s,{modelValue:a(l).name,"onUpdate:modelValue":e[2]||(e[2]=o=>a(l).name=o),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])]),_:1}),t(n,{label:"归属部门",prop:"dept_id"},{default:r(()=>[t(I,{class:"flex-1",modelValue:a(l).dept_id,"onUpdate:modelValue":e[3]||(e[3]=o=>a(l).dept_id=o),data:a(v).dept,clearable:"",multiple:"","node-key":"id",props:{value:"id",label:"name",disabled(o){return o.status!==1}},"check-strictly":"","default-expand-all":!0,placeholder:"请选择上级部门"},null,8,["modelValue","data","props"])]),_:1}),t(n,{label:"岗位",prop:"jobs_id"},{default:r(()=>[t(E,{class:"flex-1",modelValue:a(l).jobs_id,"onUpdate:modelValue":e[4]||(e[4]=o=>a(l).jobs_id=o),clearable:"",multiple:"",placeholder:"请选择岗位"},{default:r(()=>[(u(!0),g(h,null,q(a(v).jobs,(o,w)=>(u(),c(V,{key:w,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"角色",prop:"role_id"},{default:r(()=>[t(E,{modelValue:a(l).role_id,"onUpdate:modelValue":e[5]||(e[5]=o=>a(l).role_id=o),disabled:a(l).root==1,class:"flex-1",multiple:"",placeholder:"请选择角色",clearable:""},{default:r(()=>[a(l).root==1?(u(),c(V,{key:0,label:"系统管理员",value:0})):R("",!0),(u(!0),g(h,null,q(a(v).role,(o,w)=>(u(),c(V,{key:w,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(n,{label:"密码",prop:"password"},{default:r(()=>[t(s,{modelValue:a(l).password,"onUpdate:modelValue":e[6]||(e[6]=o=>a(l).password=o),"show-password":"",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(n,{label:"确认密码",prop:"password_confirm"},{default:r(()=>[t(s,{modelValue:a(l).password_confirm,"onUpdate:modelValue":e[7]||(e[7]=o=>a(l).password_confirm=o),"show-password":"",clearable:"",placeholder:"请输入确认密码"},null,8,["modelValue"])]),_:1}),a(l).root!=1?(u(),c(n,{key:0,label:"管理员状态"},{default:r(()=>[t(U,{modelValue:a(l).disable,"onUpdate:modelValue":e[8]||(e[8]=o=>a(l).disable=o),"active-value":0,"inactive-value":1},null,8,["modelValue"])]),_:1})):R("",!0),t(n,{label:"多处登录"},{default:r(()=>[p("div",null,[t(U,{modelValue:a(l).multipoint_login,"onUpdate:modelValue":e[9]||(e[9]=o=>a(l).multipoint_login=o),"active-value":1,"inactive-value":0},null,8,["modelValue"]),ne])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])])}}});export{we as _,ve as a,te as b,Ve as c};
