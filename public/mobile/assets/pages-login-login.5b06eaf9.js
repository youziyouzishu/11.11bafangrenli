import{o as e,c as t,w as a,f as l,n as o,a as s,r,j as i,i as n,k as u,a3 as d,m as c,d as m,e as p,v as f,ad as g,h as _,t as h,G as x,H as y,ae as b,af as v,ag as k,B as w,ah as C,ai as S,x as j,ab as V,s as B,a7 as $,a4 as L,z as U,aj as W,ak as z,b as T,P as N,al as F,am as I,p as q,F as G,E,ac as H,an as O,ao as P,A,U as Q,ap as R,aq as D,ar as J,as as K,C as M,g as X,at as Y}from"./index-40b5c4cd.js";import{_ as Z}from"./u-image.cd7d0fd7.js";import{_ as ee}from"./u-icon.4067ae16.js";import{_ as te,a as ae}from"./u-form-item.8f125d67.js";import{_ as le}from"./u-verification-code.c21d5ee3.js";import{_ as oe}from"./u-form.5fab2264.js";import{_ as se}from"./u-checkbox.ce0fa119.js";import{_ as re}from"./u-button.d0ae8aa1.js";import{_ as ie}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as ne}from"./avatar-upload.4a287532.js";import{_ as ue}from"./u-popup.2526b79a.js";import{u as de}from"./useLockFn.ef459021.js";import"./emitter.1571a5d9.js";import"./util.b50fc651.js";import"./_commonjsHelpers.02d3be64.js";const ce=ie({name:"u-divider",props:{halfWidth:{type:[Number,String],default:150},borderColor:{type:String,default:"#dcdfe6"},type:{type:String,default:"primary"},color:{type:String,default:"#909399"},fontSize:{type:[Number,String],default:26},bgColor:{type:String,default:"#ffffff"},height:{type:[Number,String],default:"auto"},marginTop:{type:[String,Number],default:0},marginBottom:{type:[String,Number],default:0},paddingBottom:{type:[String,Number],default:0},useSlot:{type:Boolean,default:!0}},computed:{lineStyle(){let e={};return-1!=String(this.halfWidth).indexOf("%")?e.width=this.halfWidth:e.width=this.halfWidth+"rpx",this.borderColor&&(e.borderColor=this.borderColor),e}},methods:{click(){this.$emit("click")}}},[["render",function(u,d,c,m,p,f){const g=n;return e(),t(g,{class:"u-divider",style:s({height:"auto"==c.height?"auto":c.height+"rpx",backgroundColor:c.bgColor,marginBottom:c.marginBottom+"rpx",marginTop:c.marginTop+"rpx",paddingBottom:c.paddingBottom+"rpx"}),onClick:f.click},{default:a((()=>[l(g,{class:o(["u-divider-line",[c.type?"u-divider-line--bordercolor--"+c.type:""]]),style:s([f.lineStyle])},null,8,["class","style"]),c.useSlot?(e(),t(g,{key:0,class:"u-divider-text",style:s({color:c.color,fontSize:c.fontSize+"rpx"})},{default:a((()=>[r(u.$slots,"default",{},void 0,!0)])),_:3},8,["style"])):i("",!0),l(g,{class:o(["u-divider-line",[c.type?"u-divider-line--bordercolor--"+c.type:""]]),style:s([f.lineStyle])},null,8,["class","style"])])),_:3},8,["style","onClick"])}],["__scopeId","data-v-a040296e"]]),me=u({__name:"mplogin-popup",props:{show:{type:Boolean},logo:{type:String},title:{type:String}},emits:["update:show","update"],setup(o,{emit:s}){const r=o,i=d({get:()=>r.show,set(e){s("update:show",e)}}),u=c(),w=e=>{const{nickname:t}=e.detail.value;return u.value?t?void s("update",{avatar:u.value,nickname:t}):uni.$u.toast({title:"请输入昵称"}):uni.$u.toast({title:"请添加头像"})};return(s,r)=>{const d=x,c=y,C=n,S=m(p("avatar-upload"),ne),j=m(p("u-form-item"),te),V=b,B=v,$=k,L=m(p("u-popup"),ue);return e(),t(C,null,{default:a((()=>[l(L,{modelValue:f(i),"onUpdate:modelValue":r[2]||(r[2]=e=>g(i)?i.value=e:null),mode:"bottom","border-radius":"14","mask-close-able":!1},{default:a((()=>[l(C,{class:"h-[1000rpx] p-[40rpx]"},{default:a((()=>[l(C,{class:"flex items-center"},{default:a((()=>[l(d,{class:"w-[100rpx] h-[100rpx] rounded",mode:"heightFix",src:o.logo},null,8,["src"]),l(c,{class:"text-3xl ml-5 font-bold"},{default:a((()=>[_(h(o.title),1)])),_:1})])),_:1}),l(C,{class:"mt-5 text-muted"},{default:a((()=>[_(" 建议使用您的微信头像和昵称，以便获得更好的体验 ")])),_:1}),l(C,{class:"mt-[30rpx]"},{default:a((()=>[l($,{onSubmit:w},{default:a((()=>[l(j,{required:"",label:"头像",labelWidth:120},{default:a((()=>[l(C,{class:"flex-1"},{default:a((()=>[l(S,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=e=>u.value=e)},null,8,["modelValue"])])),_:1})])),_:1}),l(j,{required:"",label:"昵称",labelWidth:120},{default:a((()=>[l(V,{class:"flex-1 h-[60rpx]",name:"nickname",type:"nickname",placeholder:"请输入昵称"})])),_:1}),l(C,{class:"mt-[80rpx]"},{default:a((()=>[l(B,{class:"bg-primary rounded-full text-white text-lg h-[80rpx] leading-[80rpx]","hover-class":"none","form-type":"submit"},{default:a((()=>[_(" 确定 ")])),_:1})])),_:1}),l(C,{class:"flex justify-center mt-[60rpx]"},{default:a((()=>[l(C,{class:"text-muted",onClick:r[1]||(r[1]=e=>i.value=!1)},{default:a((()=>[_("暂不登录")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}}),pe=ie(u({__name:"login",setup(s){w((()=>{})),C((()=>{}));const r=c(!0);r.value=S();const u=j(),g=V(),x=B(),b=c(""),v=c(!1),k=c(!1),ie=$({scene:1,account:"",password:"",code:"",clientInfo:{}}),ne=c(),ue=e=>{b.value=e},pe=d((()=>g.getWebsiteConfig)),fe=async()=>{var e,t;ie.account&&(null==(e=x.value)?void 0:e.canGetCode)&&(await O({scene:P.LOGIN,mobile:ie.account}),uni.$u.toast("发送成功"),null==(t=x.value)||t.start())},ge=e=>{ie.scene=e},_e=e=>{var t;return null==(t=g.getLoginConfig.login_way)?void 0:t.includes(String(e))},he=d((()=>g.getLoginConfig.wechat_auth)),xe=d((()=>1==g.getLoginConfig.login_agreement)),ye=d((()=>1==g.getLoginConfig.third_auth)),be=d((()=>1==g.getLoginConfig.coerce_mobile)),ve=d((()=>1==g.getLoginConfig.coerce_role)),ke=async e=>{const{token:t,mobile:a,role:l}=e;if(!a&&be.value)return u.temToken=t,A({url:"/pages/bind/mobile"}),void z();if(!l&&ve.value)return uni.$u.toast("登录成功"),u.temToken=t,Q.login(e.unilogin.newToken),A({url:"/pages/bind/role"}),void z();u.login(e.token),await u.getUser(),uni.$u.toast("登录成功"),z(),Q.login(e.unilogin.newToken);const o=R();if(o.length>1){console.log(" 刷新上一个页面");const e=o[o.length-2];T({success:()=>{const{onLoad:t,options:a}=e;t&&t(a)}})}else D.get(J)?I({url:D.get(J)}):N({url:"/pages/tasks/index"});D.remove(J)},{lockFn:we}=de((async()=>{if(!k.value&&xe.value)return uni.$u.toast("请勾选已阅读并同意《服务协议》和《隐私协议》");if(1==ie.scene){if(!ie.account)return uni.$u.toast("请输入账号/手机号码");if(!ie.password)return uni.$u.toast("请输入密码")}if(2==ie.scene){if(!ie.account)return uni.$u.toast("请输入手机号码");if(!ie.code)return uni.$u.toast("请输入验证码")}W({title:"请稍后..."});try{ie.clientInfo=X();const e=await Y(ie);ke(e)}catch(e){z(),uni.$u.toast(e)}})),Ce=async()=>{if(!k.value&&xe.value)return uni.$u.toast("请勾选已阅读并同意《服务协议》和《隐私协议》");r.value&&F.getUrl()},Se=async e=>{await K(e,{token:u.temToken}),v.value=!1,ke(ne.value)};return L((()=>g.getLoginConfig),(e=>{e.login_way&&(ie.scene=e.login_way[0])}),{immediate:!0}),U((async()=>{try{u.isLogin&&(W({title:"请稍后..."}),await u.getUser(),z(),T())}catch(e){z()}})),w((async e=>{if(u.isLogin)return void N({url:"/pages/tasks/index"});const{code:t}=e;if(t){W({title:"请稍后..."});try{const e=await F.authLogin(t);ke(e)}catch(a){throw z(),I({url:"/pages/login/login"}),new Error(a)}}})),(s,u)=>{const d=m(p("u-image"),Z),c=n,w=m(p("u-icon"),ee),C=m(p("u-input"),ae),S=m(p("u-form-item"),te),j=M,V=m(p("u-verification-code"),le),B=y,$=m(p("u-form"),oe),L=m(p("u-checkbox"),se),U=m(p("u-button"),re),W=m(p("u-divider"),ce),z=m(p("mplogin-popup"),me);return e(),t(c,{class:"bg-white login min-h-full flex flex-col items-center px-[40rpx] pt-[80rpx] box-border"},{default:a((()=>[l(c,null,{default:a((()=>[l(d,{src:f(g).getWebsiteConfig.shop_logo,mode:"widthFix",height:"160",width:"160"},null,8,["src"])])),_:1}),l(c,{class:"mt-4 text-xl font-medium"},{default:a((()=>[_(h(f(g).getWebsiteConfig.shop_name),1)])),_:1}),l(c,{class:"w-full mt-[60rpx] pb-[60rpx]"},{default:a((()=>[l($,{borderBottom:""},{default:a((()=>[1==ie.scene&&_e(1)?(e(),q(G,{key:0},[l(S,{borderBottom:""},{default:a((()=>[l(w,{class:"mr-2",size:36,name:"/static/images/icon/icon_user.png"}),l(C,{class:"flex-1",modelValue:ie.account,"onUpdate:modelValue":u[0]||(u[0]=e=>ie.account=e),border:!1,placeholder:"请输入账号/手机号码"},null,8,["modelValue"])])),_:1}),l(S,{borderBottom:""},{default:a((()=>[l(w,{class:"mr-2",size:36,name:"/static/images/icon/icon_password.png"}),l(C,{class:"flex-1",modelValue:ie.password,"onUpdate:modelValue":u[1]||(u[1]=e=>ie.password=e),type:"password",placeholder:"请输入密码",border:!1},null,8,["modelValue"]),l(j,{url:"/pages/forget_pwd/forget_pwd","hover-class":"none"},{default:a((()=>[l(c,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3"},{default:a((()=>[_(" 忘记密码？ ")])),_:1})])),_:1})])),_:1})],64)):i("",!0),2==ie.scene&&_e(2)?(e(),q(G,{key:1},[l(S,{borderBottom:""},{default:a((()=>[l(w,{class:"mr-2",size:36,name:"/static/images/icon/icon_mobile.png"}),l(C,{class:"flex-1",modelValue:ie.account,"onUpdate:modelValue":u[2]||(u[2]=e=>ie.account=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),l(S,{borderBottom:""},{default:a((()=>[l(w,{class:"mr-2",size:36,name:"/static/images/icon/icon_code.png"}),l(C,{class:"flex-1",modelValue:ie.code,"onUpdate:modelValue":u[3]||(u[3]=e=>ie.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),l(c,{class:"border-l border-solid border-0 border-light pl-3 leading-4 ml-3 w-[180rpx]",onClick:fe},{default:a((()=>[l(V,{ref_key:"uCodeRef",ref:x,seconds:60,onChange:ue,"change-text":"x秒"},null,512),l(B,{class:o(ie.account?"text-primary":"text-muted")},{default:a((()=>[_(h(b.value),1)])),_:1},8,["class"])])),_:1})])),_:1})],64)):i("",!0)])),_:1}),f(xe)?(e(),t(c,{key:0,class:"mt-[40rpx]"},{default:a((()=>[l(L,{modelValue:k.value,"onUpdate:modelValue":u[6]||(u[6]=e=>k.value=e),shape:"circle"},{default:a((()=>[l(c,{class:"text-xs flex"},{default:a((()=>[_(" 已阅读并同意 "),l(c,{onClick:u[4]||(u[4]=E((()=>{}),["stop"]))},{default:a((()=>[l(j,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=service"},{default:a((()=>[_(" 《服务协议》 ")])),_:1})])),_:1}),_(" 和 "),l(c,{onClick:u[5]||(u[5]=E((()=>{}),["stop"]))},{default:a((()=>[l(j,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=privacy"},{default:a((()=>[_(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):i("",!0),l(c,{class:"mt-[60rpx]"},{default:a((()=>[l(U,{type:"primary",shape:"circle",onClick:u[7]||(u[7]=e=>f(we)(ie.scene))},{default:a((()=>[_(" 登 录 or 注 册 ")])),_:1})])),_:1}),l(c,{class:"text-content flex justify-between mt-[40rpx]"},{default:a((()=>[l(c,{class:"flex-1"},{default:a((()=>[2==ie.scene&&_e(1)?(e(),t(c,{key:0,onClick:u[8]||(u[8]=e=>ge(1))},{default:a((()=>[_(" 账号密码登录 ")])),_:1})):i("",!0),1==ie.scene&&_e(2)?(e(),t(c,{key:1,onClick:u[9]||(u[9]=e=>ge(2))},{default:a((()=>[_(" 短信验证码登录 ")])),_:1})):i("",!0)])),_:1})])),_:1}),f(ye)&&r.value?(e(),t(c,{key:1,class:"mt-[80rpx]"},{default:a((()=>[l(W,null,{default:a((()=>[_("第三方登录")])),_:1}),H("div",{class:"flex justify-center mt-[40rpx]"},[f(he)&&r.value?(e(),q("div",{key:0,class:"flex flex-col items-center",onClick:Ce},[H("img",{src:"/mobile/assets/icon_wx-a848c744.png",class:"w-[80rpx] h-[80rpx]"}),H("div",{class:"text-sm mt-[10px]"},"微信登录")])):i("",!0)])])),_:1})):i("",!0)])),_:1}),l(z,{show:v.value,"onUpdate:show":u[10]||(u[10]=e=>v.value=e),logo:f(pe).shop_logo,title:f(pe).shop_name,onUpdate:Se},null,8,["show","logo","title"])])),_:1})}}}),[["__scopeId","data-v-ab986ce1"]]);export{pe as default};
