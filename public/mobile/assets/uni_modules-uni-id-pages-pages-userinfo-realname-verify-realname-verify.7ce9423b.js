import{W as e,J as i,M as t,R as a,aj as s,ax as r,br as l,ak as o,o as n,c as u,w as d,i as f,f as m,p as c,h as y,t as p,j as h,F as g,d as C,e as v,G as _,af as F,H as I}from"./index-40b5c4cd.js";import{a as N}from"./uni-list-item.88aca6c2.js";import{_ as j}from"./uni-list.8cb35de1.js";import{_ as k}from"./uni-easyinput.6e29bfd5.js";import{_ as x}from"./uni-forms-item.8b14ffbf.js";import{_ as b}from"./uni-forms.64077140.js";import{_ as A}from"./uni-id-pages-agreements.f4e51e5d.js";import{m as V}from"./login-page.mixin.14267b3e.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-icons.4f8d1bfc.js";import"./uni-popup-dialog.91400977.js";import"./uni-popup.52abe24b.js";e.importObject("uni-id-co");const w="uni-id-pages-temp-frv";const R=T({mixins:[V],data:()=>({realName:"",idCard:"",certifyId:"",verifyFail:!1,verifyFailCode:0,verifyFailTitle:"",verifyFailContent:""}),computed:{userInfo:()=>i.userInfo,certifyIdNext(){return Boolean(this.realName)&&Boolean(this.idCard)&&this.needAgreements&&this.agree},isCertify(){return this.userInfo.realNameAuth&&2===this.userInfo.realNameAuth.authStatus},isDev:()=>!1},onLoad(){const e=t(w);e&&(this.realName=e.realName,this.idCard=e.idCard)},methods:{async getCertifyId(){if(this.certifyIdNext)return a({content:"暂不支持实名认证",showCancel:!1})},startFacialRecognitionVerify(){},async getFrvAuthResult(){const i=e.importObject("uni-id-co",{customUI:!0});try{s({title:"验证中...",mask:!1});const e=await i.getFrvAuthResult({certifyId:this.certifyId}),{errCode:t,...o}=e;this.verifyFailContent&&console.log(`[frv-debug] 客户端刷脸失败，由实人认证服务查询具体原因，原因：${this.verifyFailContent}`),a({content:"实名认证成功",showCancel:!1,success:()=>{r.setUserInfo({realNameAuth:o}),this.verifyFail=!1}}),l({key:w})}catch(t){this.verifyFail=!0,this.verifyFailTitle=t.errMsg,console.error(JSON.stringify(t))}finally{o()}},retry(){10013!==this.verifyFailCode?this.getCertifyId():this.verifyFail=!1}}},[["render",function(e,i,t,a,s,r){const l=C(v("uni-list-item"),N),o=C(v("uni-list"),j),V=_,T=f,w=F,R=I,U=C(v("uni-easyinput"),k),O=C(v("uni-forms-item"),x),B=C(v("uni-forms"),b),D=C(v("uni-id-pages-agreements"),A);return n(),u(T,null,{default:d((()=>[r.isCertify?(n(),u(o,{key:0},{default:d((()=>[m(l,{class:"item",title:"姓名",rightText:r.userInfo.realNameAuth.realName},null,8,["rightText"]),m(l,{class:"item",title:"身份证号码",rightText:r.userInfo.realNameAuth.identity},null,8,["rightText"])])),_:1})):(n(),u(T,{key:1,class:"uni-content"},{default:d((()=>[s.verifyFail?(n(),c(g,{key:0},[m(T,{class:"face-icon"},{default:d((()=>[m(V,{src:"/mobile/assets/face-verify-icon-da277dd7.svg",class:"face-icon-image"})])),_:1}),m(T,{class:"error-title"},{default:d((()=>[y(p(s.verifyFailTitle),1)])),_:1}),m(T,{class:"error-description"},{default:d((()=>[y(p(s.verifyFailContent),1)])),_:1}),10013!==s.verifyFailCode?(n(),u(w,{key:0,type:"primary",onClick:r.retry},{default:d((()=>[y("重新开始验证")])),_:1},8,["onClick"])):(n(),u(w,{key:1,type:"primary",onClick:r.retry},{default:d((()=>[y("返回")])),_:1},8,["onClick"])),r.isDev?(n(),u(T,{key:2,class:"dev-tip"},{default:d((()=>[y("请在控制台查看详细错误（此提示仅在开发环境展示）")])),_:1})):h("",!0)],64)):(n(),c(g,{key:1},[m(R,{class:"title"},{default:d((()=>[y("实名认证")])),_:1}),m(B,null,{default:d((()=>[m(O,{name:"realName"},{default:d((()=>[m(U,{placeholder:"姓名",class:"input-box",modelValue:s.realName,"onUpdate:modelValue":i[0]||(i[0]=e=>s.realName=e),clearable:!1},null,8,["modelValue"])])),_:1}),m(O,{name:"idCard"},{default:d((()=>[m(U,{placeholder:"身份证号码",class:"input-box",modelValue:s.idCard,"onUpdate:modelValue":i[1]||(i[1]=e=>s.idCard=e),clearable:!1},null,8,["modelValue"])])),_:1})])),_:1}),m(D,{scope:"realNameVerify",ref:"agreements",style:{"margin-bottom":"20px"}},null,512),m(w,{type:"primary",disabled:!r.certifyIdNext,onClick:r.getCertifyId},{default:d((()=>[y("确定")])),_:1},8,["disabled","onClick"])],64))])),_:1}))])),_:1})}],["__scopeId","data-v-c5de76fb"]]);export{R as default};
