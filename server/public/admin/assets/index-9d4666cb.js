import"./adapter-vue-24f22062.js";import{z as f,q as E,X as U,_ as X}from"./@tencentcloud-7fc831ec.js";import{c as Z}from"./icon-close-7ee462f2.js";import $ from"./Icon-2c0593f3.js";import j from"./index-cfa97a9d.js";import w from"./index-6b0c1d9b.js";import H from"./index-315de94f.js";import{d as D}from"./env-a593fd1d.js";import{d as J,r as d,aZ as K,b7 as Q,w as W,o as i,x as Y,aR as ee,a as n,ae as O,a_ as t,aB as m,M as _,c,F as h,ao as L,y as b}from"./@vue-a164be7a.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";const te={class:"header"},ae={class:"header-text"},se={class:"header-close-icon"},re={class:"read-status-counter-container"},oe=["onClick"],ne={class:"status-text"},ie={class:"status-count"},ce={class:"read-status-member-list"},le={key:0,class:"empty-list-tip"},ue={class:"username"},de={class:"username"},me={key:2,class:"fetch-more-container"},fe=J({__name:"index",props:{message:{default:()=>({})}},emits:["setReadReceiptPanelVisible"],setup(B,{emit:P}){const S=P,g=B;let R="",C="";const z=["unread","read"],l={unread:!1,read:!1,close:!1},p=d(!1),y=d(!1),v=d(!1),I=d(!1),r=d("unread"),s=d(V());K(async()=>{await x(),Q(()=>{v.value=!0})}),W(()=>g.message.readReceiptInfo.readCount,()=>{x()});async function M(a="all"){const o=E.getMessageModel(g.message.ID);let e={},u={};(a==="all"||a==="unread")&&(e=await U.getGroupMessageReadMemberList({message:o,filter:1,cursor:R,count:100}),e&&(R=e.data.cursor,e.data.isCompleted&&(l.unread=!0))),(a==="all"||a==="read")&&(u=await U.getGroupMessageReadMemberList({message:o,filter:0,cursor:C,count:100}),u&&(C=u.data.cursor,u.data.isCompleted&&(l.read=!0)));const{unreadCount:G,readCount:q}=o.readReceiptInfo;return{unreadResult:{count:G,...e.data},readResult:{count:q,...u.data}}}async function A(){if(!(l[r.value]||p.value)&&(p.value=!0,r.value==="unread"||r.value==="read")){const{unreadResult:a,readResult:o}=await M(r.value);F();try{s.value.unread.memberList=s.value.unread.memberList.concat(a.unreadUserInfoList||[]),s.value.read.memberList=s.value.read.memberList.concat(o.readUserInfoList||[])}finally{p.value=!1}}}async function x(){R="",C="",I.value=!1,l.unread=!1,l.read=!1;const{unreadResult:a,readResult:o}=await M("all");F(),k("read",o.count,o.readUserInfoList),k("unread",a.count,a.unreadUserInfoList),k("close")}function F(){l.read&&l.unread&&(I.value=!0)}function k(a,o,e){s.value[a].count=o,s.value[a].memberList=e||[]}function V(){return{read:{tabName:f.t("TUIChat.已读"),count:void 0,memberList:[]},unread:{tabName:f.t("TUIChat.未读"),count:void 0,memberList:[]},close:{tabName:f.t("TUIChat.关闭"),count:void 0,memberList:[]}}}function N(a){r.value=a}function T(){y.value=!0,setTimeout(()=>{S("setReadReceiptPanelVisible",!1)},200)}return(a,o)=>(i(),Y(j,{maskColor:"transparent",onOnOverlayClick:T},{default:ee(()=>[n("div",{class:O({"read-receipt-panel":!0,"read-receipt-panel-mobile":t(D),"read-receipt-panel-close-mobile":t(D)&&t(y)})},[n("div",te,[n("div",ae,m(t(f).t("TUIChat.消息详情")),1),n("div",se,[_($,{size:"12px",hotAreaSize:"8",file:t(Z),onOnClick:T},null,8,["file"])])]),n("div",re,[(i(),c(h,null,L(z,e=>n("div",{key:e,class:O({"read-status-counter":!0,active:e===t(r)}),onClick:u=>N(e)},[n("div",ne,m(t(s)[e].tabName),1),n("div",ie,m(t(s)[e].count===void 0?"":t(s)[e].count),1)],10,oe)),64))]),n("div",ce,[t(s)[t(r)].count===0&&t(v)?(i(),c("div",le," - "+m(t(f).t("TUIChat.空"))+" - ",1)):t(v)?(i(),c(h,{key:1},[t(r)==="unread"?(i(!0),c(h,{key:0},L(t(s)[t(r)].memberList,e=>(i(),c("div",{key:e.userID,class:"read-status-member-container"},[_(w,{class:"read-status-avatar",useSkeletonAnimation:"",url:e.avatar||""},null,8,["url"]),n("div",ue,m(e.nick||e.userID),1)]))),128)):b("",!0),t(r)==="read"?(i(!0),c(h,{key:1},L(t(s)[t(r)].memberList,e=>(i(),c("div",{key:e.userID,class:"read-status-member-container"},[_(w,{class:"read-status-avatar",useSkeletonAnimation:"",url:e.avatar},null,8,["url"]),n("div",de,m(e.nick||e.userID),1)]))),128)):b("",!0)],64)):b("",!0),t(v)?(i(),c("div",me,[_(H,{isFetching:t(p),isTerminateObserve:t(I),onOnExposed:A},null,8,["isFetching","isTerminateObserve"])])):b("",!0)])],2)]),_:1}))}});const Be=X(fe,[["__scopeId","data-v-ee287e9c"]]);export{Be as default};
