import"./adapter-vue-24f22062.js";import{q as T,o as m,z as k,J as Ce,i as ce,_ as ke}from"./@tencentcloud-7fc831ec.js";import{S as L,e as De,s as Me,d as we,g as ve}from"./index-33a5e791.js";import xe from"./index-adb923fe.js";import he from"./index-5a1654d8.js";import{s as K,a as Y}from"./search-type-list-f8ecda48.js";import b from"./Icon-2c0593f3.js";import{s as de}from"./search-aefae6e3.js";import{e as Ue}from"./right-icon-89a49395.js";import{e as Pe}from"./enableSampleTaskStatus-a12ec87d.js";import{a as w,c as pe}from"./env-a593fd1d.js";import"./type-b7afadd9.js";import{d as Re,r as v,b as Be,aZ as Ee,a$ as He,w as Ne,a_ as s,o as r,x as q,ae as g,c as i,a as u,F as U,ao as P,aB as f,y as S,M as N,ak as $e,aj as Ve}from"./@vue-a164be7a.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";import"./message-abstract-text-a56998d2.js";import"./index-7909557f.js";import"./constant-bad60a54.js";import"./message-abstract-file-c22ad605.js";import"./message-abstract-custom-c473a1e7.js";import"./type-check-5e73d261.js";import"./star-light-645157ed.js";import"./message-abstract-image-ba75a391.js";import"./message-abstract-video-da9ef47d.js";import"./video-play-6934d780.js";import"./index-cfdb213d.js";import"./index-e4ac2ab7.js";import"./index-bd812f53.js";const ye=D=>($e("data-v-ba604638"),D=D(),Ve(),D),ze={key:0,class:"tui-search-result-main"},Fe={class:"tui-search-result-list"},Ke={key:0,class:"header"},Ye={class:"list"},qe=["onClick"],Ae={class:"more-text"},Je={key:1,class:"tui-search-message-header"},Ge={class:"header-content"},We={class:"header-content-count normal"},Ze={class:"header-content-keyword"},Qe=ye(()=>u("span",{class:"normal"},'"',-1)),Xe={class:"highlight"},Le=ye(()=>u("span",{class:"normal"},'"',-1)),be={class:"header-content-type normal"},Oe={key:2,class:"tui-search-message-list"},je={class:g(["list-group-date"])},ea={class:"more-text"},aa=Re({__name:"index",props:{searchType:{type:String,default:"global",validator(D){return["global","conversation"].includes(D)}}},setup(D){var le,ne;const l=D,h=v([]),$=v((le=K[l.searchType])==null?void 0:le.value),A=v(0),J=v(0),fe=v("and"),o=v((ne=K[l.searchType])==null?void 0:ne.key),c=v({}),d=v([]),Te=v(0),_=v(""),M=v(),y=v([]),G=v(),V=v([]),x=v(!1),R=v(!1),B=v(!1),me=Be(()=>{var e,t,a;return R.value?!1:l.searchType==="global"?!(!((e=h==null?void 0:h.value)!=null&&e.length)||(t=Object==null?void 0:Object.keys(c.value))!=null&&t.length):!((a=y==null?void 0:y.value)!=null&&a.length)});function O(e){l.searchType==="conversation"&&(_.value=e)}function j(e){(e==null?void 0:e.searchType)===(l==null?void 0:l.searchType)&&(h.value=e!=null&&e.value?e.value.trim().split(/\s+/):[])}function ee(e){var t,a,n,p;(e==null?void 0:e.searchType)===(l==null?void 0:l.searchType)&&(o.value=((t=e==null?void 0:e.value)==null?void 0:t.key)||((a=K[l.searchType])==null?void 0:a.key),$.value=((n=e==null?void 0:e.value)==null?void 0:n.value)||((p=K[l.searchType])==null?void 0:p.value))}function ae(e){var t,a,n,p;(e==null?void 0:e.searchType)===(l==null?void 0:l.searchType)&&(A.value=(a=(t=e==null?void 0:e.value)==null?void 0:t.value)==null?void 0:a.timePosition,J.value=(p=(n=e==null?void 0:e.value)==null?void 0:n.value)==null?void 0:p.timePeriod)}Ee(()=>{T.watch(m.CONV,{currentConversationID:O}),T.watch(m.SEARCH,{currentSearchInputValue:j,currentSearchMessageType:ee,currentSearchMessageTime:ae})}),He(()=>{T.unwatch(m.CONV,{currentConversationID:O}),T.unwatch(m.SEARCH,{currentSearchInputValue:j,currentSearchMessageType:ee,currentSearchMessageTime:ae})});const z=e=>{var t;Me({keywordList:(t=h==null?void 0:h.value)!=null&&t.length?h.value:void 0,messageTypeList:typeof $.value=="string"?[$.value]:$.value,timePosition:A.value,timePeriod:J.value,conversationID:(e==null?void 0:e.conversationID)||void 0,cursor:(e==null?void 0:e.cursor)||void 0,keywordListMatchType:fe.value}).then(a=>{var n,p,I,E,H,C,re,oe,ie,ue;if(Pe("searchCloudMessage"),e!=null&&e.conversationID)M.value=a==null?void 0:a.data,e!=null&&e.cursor?y.value=[...y.value,...(re=(C=a==null?void 0:a.data)==null?void 0:C.searchResultList[0])==null?void 0:re.messageList]:y.value=(ie=(oe=a==null?void 0:a.data)==null?void 0:oe.searchResultList[0])==null?void 0:ie.messageList,G.value=(ue=a==null?void 0:a.data)==null?void 0:ue.totalCount,(l==null?void 0:l.searchType)==="conversation"&&(o.value==="fileMessage"||o.value==="imageMessage")?V.value=Ie(y.value):V.value=[];else{e!=null&&e.cursor?d.value=[...d.value,...a.data.searchResultList]:d.value=(n=a==null?void 0:a.data)==null?void 0:n.searchResultList,Te.value=(p=a==null?void 0:a.data)==null?void 0:p.totalCount;const F=o.value==="all"?"allMessage":o.value;(I=d==null?void 0:d.value)!=null&&I.length&&o.value!=="contact"&&o.value!=="group"?c.value=Object.assign({},c.value,{[F]:{key:F,label:Y[F].label,list:o.value==="all"?(E=d==null?void 0:d.value)==null?void 0:E.slice(0,3):d==null?void 0:d.value,cursor:((H=a==null?void 0:a.data)==null?void 0:H.cursor)||null}}):c==null||delete c.value[F]}R.value=!1,B.value=!1})},se=we(z,500),W=()=>{c.value={},M.value={},y.value=[],V.value=[]};Ne(()=>[h.value,o.value,A.value,J.value],(e,t)=>{var a,n,p;if(e!==t){if(!((a=h==null?void 0:h.value)!=null&&a.length)&&(l==null?void 0:l.searchType)==="global"){W();return}if(R.value=!0,l.searchType==="conversation")W(),z({conversationID:_.value});else{if(t&&t[1]==="all"&&e&&e[1]==="allMessage"){(n=c==null?void 0:c.value.allMessage)!=null&&n.list&&(c.value.allMessage.list=d==null?void 0:d.value),(p=Object==null?void 0:Object.keys(c==null?void 0:c.value))==null||p.forEach(I=>{I!=="allMessage"&&(c==null||delete c.value[I])}),R.value=!1;return}else x.value=!1,W();se()}}},{immediate:!0});const ge=e=>{o.value==="all"?T.update(m.SEARCH,"currentSearchMessageType",{value:Y[e.key],searchType:l.searchType}):z({cursor:(e==null?void 0:e.cursor)||void 0})},_e=()=>{var e;z({cursor:(e=M==null?void 0:M.value)==null?void 0:e.cursor,conversationID:_==null?void 0:_.value})},Z=(e,t,a)=>{var n;x.value=e,t&&T.update(m.SEARCH,"currentSearchMessageType",{value:Y[t],searchType:l.searchType}),_.value=((n=a==null?void 0:a.conversation)==null?void 0:n.conversationID)||"",G.value=a==null?void 0:a.messageCount,a&&(B.value=!0,se({conversationID:_.value}))},Se=e=>{var t;return _.value===((t=e==null?void 0:e.conversation)==null?void 0:t.conversationID)?["list-item","list-item-selected"]:["list-item"]},te=()=>l.searchType==="conversation"&&o.value==="fileMessage"?"file":l.searchType==="conversation"&&o.value==="imageMessage"?"image":w?"bubble":"info",Ie=e=>{var p,I,E,H;const t=[];if(e!=null&&e.length){if((e==null?void 0:e.length)===1)return t.push({date:ve((p=e[0])==null?void 0:p.time),list:e}),t}else return t;let a="",n="";for(let C=0;C<(e==null?void 0:e.length);C++)n=ve((I=e[C])==null?void 0:I.time),a!==n?t.push({date:n,list:[e[C]]}):(H=(E=t[(t==null?void 0:t.length)-1])==null?void 0:E.list)==null||H.push(e[C]),a=n;return t},Q=e=>{var t;l.searchType==="global"?(T.update(m.SEARCH,"currentSearchingStatus",{isSearching:!1,searchType:l.searchType}),Ce.switchConversation(e==null?void 0:e.conversationID).then(()=>{var a;T.update(m.CHAT,"messageSource",e),pe&&((a=ce)==null||a.navigateTo({url:"/TUIKit/components/TUIChat/index"}))})):l.searchType==="conversation"&&(T.update(m.SEARCH,"isShowInConversationSearch",!1),T.update(m.CHAT,"messageSource",e),pe&&((t=ce)==null||t.navigateBack()))},X=e=>`${o}-${e}`;return(e,t)=>s(R)?(r(),q(he,{key:0,class:g(["search-result-loading",!s(w)&&"search-result-loading-h5"])},null,8,["class"])):s(me)?(r(),q(xe,{key:1,class:g(["search-result-default",!s(w)&&"search-result-default-h5"])},null,8,["class"])):(r(),i("div",{key:2,class:g(["tui-search-result",!s(w)&&"tui-search-result-h5",s(w)&&s(x)&&"tui-search-result-with-border"])},[l.searchType!=="conversation"&&(s(w)||!s(x))?(r(),i("div",ze,[u("div",Fe,[(r(!0),i(U,null,P(s(c),a=>(r(),i("div",{key:a.key,class:"tui-search-result-list-item"},[l.searchType==="global"?(r(),i("div",Ke,f(s(k).t(`TUISearch.${a.label}`)),1)):S("",!0),u("div",Ye,[(r(!0),i(U,null,P(a.list,n=>(r(),i("div",{key:n.conversation.conversationID,class:g([Se(n)])},[a.key==="contact"||a.key==="group"||n.conversation?(r(),q(L,{key:0,listItem:n,type:a.key,displayType:"info",keywordList:s(h),onShowResultDetail:Z,onNavigateToChatPosition:Q},null,8,["listItem","type","keywordList"])):S("",!0)],2))),128))]),s(o)==="all"||a.cursor?(r(),i("div",{key:1,class:"more",onClick:n=>ge(a)},[N(b,{class:"more-icon",file:s(de),width:"12px",height:"12px"},null,8,["file"]),u("div",Ae,[u("span",null,f(s(k).t("TUISearch.查看更多")),1),u("span",null,f(s(k).t(`TUISearch.${a.label}`)),1)])],8,qe)):S("",!0)]))),128))])])):S("",!0),s(x)||l.searchType==="conversation"?(r(),i("div",{key:1,class:g(["tui-search-result-detail",l.searchType==="conversation"&&"tui-search-result-in-conversation"])},[s(B)?(r(),q(he,{key:0,class:g(["search-result-loading",!s(w)&&"search-result-loading-h5"])},null,8,["class"])):S("",!0),!s(B)&&s(x)&&l.searchType!=="conversation"?(r(),i("div",Je,[u("div",Ge,[u("div",We,[u("span",null,f(s(G)),1),u("span",null,f(s(k).t("TUISearch.条与")),1)]),u("div",Ze,[(r(!0),i(U,null,P(s(h),(a,n)=>(r(),i("span",{key:n},[Qe,u("span",Xe,f(a),1),Le]))),128))]),u("div",be,[u("span",null,f(s(k).t("TUISearch.相关的")),1),u("span",null,f(s(k).t(`TUISearch.${s(o)==="allMessage"?"结果":s(Y)[s(o)].label}`)),1)])]),u("div",{class:"header-enter",onClick:t[0]||(t[0]=a=>s(De)({conversationID:s(_)}))},[u("span",null,f(s(k).t("TUISearch.进入聊天")),1),N(b,{class:"enter-icon",file:s(Ue),width:"14px",height:"14px"},null,8,["file"])])])):S("",!0),!s(B)&&s(y)&&s(y)[0]?(r(),i("div",Oe,[l.searchType==="global"||s(o)!=="imageMessage"&&s(o)!=="fileMessage"?(r(!0),i(U,{key:0},P(s(y),a=>(r(),i("div",{key:X(a.ID),class:g(["list-item"])},[N(L,{listItem:a,listItemContent:a.getMessageContent(),type:s(o),displayType:te(),keywordList:s(h),onShowResultDetail:Z,onNavigateToChatPosition:Q},null,8,["listItem","listItemContent","type","displayType","keywordList"])]))),128)):(r(!0),i(U,{key:1},P(s(V),a=>(r(),i("div",{key:X(a.date),class:g(["list-group",s(o)==="fileMessage"?"list-group-file":"list-group-image"])},[u("div",je,f(a.date),1),(r(!0),i(U,null,P(a.list,n=>(r(),i("div",{key:X(n.ID),class:g(["list-group-item"])},[N(L,{listItem:n,listItemContent:n.getMessageContent(),type:s(o),displayType:te(),keywordList:s(h),onShowResultDetail:Z,onNavigateToChatPosition:Q},null,8,["listItem","listItemContent","type","displayType","keywordList"])]))),128))],2))),128)),s(M)&&s(M).cursor?(r(),i("div",{key:2,class:"more",onClick:_e},[N(b,{class:"more-icon",file:s(de),width:"12px",height:"12px"},null,8,["file"]),u("div",ea,f(s(k).t("TUISearch.查看更多历史记录")),1)])):S("",!0)])):S("",!0)],2)):S("",!0)],2))}});const Fa=ke(aa,[["__scopeId","data-v-ba604638"]]);export{Fa as default};
