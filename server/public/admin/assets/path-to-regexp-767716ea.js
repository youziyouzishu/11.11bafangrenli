function M(r){for(var n=[],e=0;e<r.length;){var t=r[e];if(t==="*"||t==="+"||t==="?"){n.push({type:"MODIFIER",index:e,value:r[e++]});continue}if(t==="\\"){n.push({type:"ESCAPED_CHAR",index:e++,value:r[e++]});continue}if(t==="{"){n.push({type:"OPEN",index:e,value:r[e++]});continue}if(t==="}"){n.push({type:"CLOSE",index:e,value:r[e++]});continue}if(t===":"){for(var f="",i=e+1;i<r.length;){var c=r.charCodeAt(i);if(c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||c===95){f+=r[i++];continue}break}if(!f)throw new TypeError("Missing parameter name at ".concat(e));n.push({type:"NAME",index:e,value:f}),e=i;continue}if(t==="("){var x=1,o="",i=e+1;if(r[i]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(i));for(;i<r.length;){if(r[i]==="\\"){o+=r[i++]+r[i++];continue}if(r[i]===")"){if(x--,x===0){i++;break}}else if(r[i]==="("&&(x++,r[i+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(i));o+=r[i++]}if(x)throw new TypeError("Unbalanced pattern at ".concat(e));if(!o)throw new TypeError("Missing pattern at ".concat(e));n.push({type:"PATTERN",index:e,value:o}),e=i;continue}n.push({type:"CHAR",index:e,value:r[e++]})}return n.push({type:"END",index:e,value:""}),n}function _(r,n){n===void 0&&(n={});for(var e=M(r),t=n.prefixes,f=t===void 0?"./":t,i="[^".concat(A(n.delimiter||"/#?"),"]+?"),c=[],x=0,o=0,v="",u=function(p){if(o<e.length&&e[o].type===p)return e[o++].value},m=function(p){var s=u(p);if(s!==void 0)return s;var R=e[o],N=R.type,O=R.index;throw new TypeError("Unexpected ".concat(N," at ").concat(O,", expected ").concat(p))},h=function(){for(var p="",s;s=u("CHAR")||u("ESCAPED_CHAR");)p+=s;return p};o<e.length;){var d=u("CHAR"),w=u("NAME"),y=u("PATTERN");if(w||y){var g=d||"";f.indexOf(g)===-1&&(v+=g,g=""),v&&(c.push(v),v=""),c.push({name:w||x++,prefix:g,suffix:"",pattern:y||i,modifier:u("MODIFIER")||""});continue}var l=d||u("ESCAPED_CHAR");if(l){v+=l;continue}v&&(c.push(v),v="");var T=u("OPEN");if(T){var g=h(),C=u("NAME")||"",a=u("PATTERN")||"",E=h();m("CLOSE"),c.push({name:C||(a?x++:""),pattern:C&&!a?i:a,prefix:g,suffix:E,modifier:u("MODIFIER")||""});continue}m("END")}return c}function W(r,n){var e=[],t=D(r,e,n);return H(t,e,n)}function H(r,n,e){e===void 0&&(e={});var t=e.decode,f=t===void 0?function(i){return i}:t;return function(i){var c=r.exec(i);if(!c)return!1;for(var x=c[0],o=c.index,v=Object.create(null),u=function(h){if(c[h]===void 0)return"continue";var d=n[h-1];d.modifier==="*"||d.modifier==="+"?v[d.name]=c[h].split(d.prefix+d.suffix).map(function(w){return f(w,d)}):v[d.name]=f(c[h],d)},m=1;m<c.length;m++)u(m);return{path:x,index:o,params:v}}}function A(r){return r.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function P(r){return r&&r.sensitive?"":"i"}function I(r,n){if(!n)return r;for(var e=/\((?:\?<(.*?)>)?(?!\?)/g,t=0,f=e.exec(r.source);f;)n.push({name:f[1]||t++,prefix:"",suffix:"",modifier:"",pattern:""}),f=e.exec(r.source);return r}function S(r,n,e){var t=r.map(function(f){return D(f,n,e).source});return new RegExp("(?:".concat(t.join("|"),")"),P(e))}function b(r,n,e){return F(_(r,e),n,e)}function F(r,n,e){e===void 0&&(e={});for(var t=e.strict,f=t===void 0?!1:t,i=e.start,c=i===void 0?!0:i,x=e.end,o=x===void 0?!0:x,v=e.encode,u=v===void 0?function(O){return O}:v,m=e.delimiter,h=m===void 0?"/#?":m,d=e.endsWith,w=d===void 0?"":d,y="[".concat(A(w),"]|$"),g="[".concat(A(h),"]"),l=c?"^":"",T=0,C=r;T<C.length;T++){var a=C[T];if(typeof a=="string")l+=A(u(a));else{var E=A(u(a.prefix)),p=A(u(a.suffix));if(a.pattern)if(n&&n.push(a),E||p)if(a.modifier==="+"||a.modifier==="*"){var s=a.modifier==="*"?"?":"";l+="(?:".concat(E,"((?:").concat(a.pattern,")(?:").concat(p).concat(E,"(?:").concat(a.pattern,"))*)").concat(p,")").concat(s)}else l+="(?:".concat(E,"(").concat(a.pattern,")").concat(p,")").concat(a.modifier);else a.modifier==="+"||a.modifier==="*"?l+="((?:".concat(a.pattern,")").concat(a.modifier,")"):l+="(".concat(a.pattern,")").concat(a.modifier);else l+="(?:".concat(E).concat(p,")").concat(a.modifier)}}if(o)f||(l+="".concat(g,"?")),l+=e.endsWith?"(?=".concat(y,")"):"$";else{var R=r[r.length-1],N=typeof R=="string"?g.indexOf(R[R.length-1])>-1:R===void 0;f||(l+="(?:".concat(g,"(?=").concat(y,"))?")),N||(l+="(?=".concat(g,"|").concat(y,")"))}return new RegExp(l,P(e))}function D(r,n,e){return r instanceof RegExp?I(r,n):Array.isArray(r)?S(r,n,e):b(r,n,e)}export{W as m};
