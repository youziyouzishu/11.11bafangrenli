import"./adapter-vue-24f22062.js";import{q as o,o as n,z as m,B as U,X as D}from"./@tencentcloud-7fc831ec.js";import k from"./index-cfa97a9d.js";import v from"./index-20817905.js";import{T}from"./index-cfdb213d.js";import{c as E}from"./env-a593fd1d.js";import{i as b}from"./utils-14df48f1.js";import{O as B}from"./index-0978e08a.js";import{T as h}from"./index-e4ac2ab7.js";import{d as x,r as F,aZ as y,a$ as G,o as N,x as q,aR as z,M as A,a_ as l}from"./@vue-a164be7a.js";const W=x({__name:"index",emits:["toggleMultipleSelectMode"],setup(H,{emit:S}){const I=S;let f=[],i=!1;const d=F(!1),u=F();y(()=>{o.watch(n.CUSTOM,{singleForwardMessageID:c,multipleForwardMessageID:g})}),G(()=>{o.unwatch(n.CUSTOM,{singleForwardMessageID:c,multipleForwardMessageID:g}),M()});function c(e){typeof e<"u"&&(i=!1,f=[e],w())}function g(e){if(!e)return;i=!1;const{isMergeForward:s,messageIDList:r}=e||{};(r==null?void 0:r.length)>0?(i=s,f=r,w()):T({message:m.t("TUIChat.未选择消息"),type:h.ERROR})}function M(){o.update(n.CUSTOM,"singleForwardMessageID",void 0),o.update(n.CUSTOM,"multipleForwardMessageID",void 0)}function p(){M(),d.value=!1}function w(){_(),d.value=!0}function R(e){if((e==null?void 0:e.length)===0)return;const s=e.map(a=>o.getConversationModel(a.userID)),r=f.map(a=>o.getMessageModel(a)).sort((a,t)=>a.time-t.time),C=s.map(a=>{const t={conversation:a,messageType:U.TYPES.MSG_MERGER};return D.sendForwardMessage([a],r,{needMerge:i,offlinePushInfo:B.create(t),params:{needReadReceipt:b()}})});Promise.allSettled(C).then(a=>{for(const t of a){const{status:O}=t;if(O==="rejected"){const P=t.reason.code===80001?m.t("TUIChat.内容包含敏感词汇"):t.reason.message;T({message:P,type:h.ERROR});break}}}),p(),I("toggleMultipleSelectMode",!1)}function _(){const e=o.getData(n.CONV,"conversationList");u.value=e.map(s=>({userID:s.conversationID,nick:s.getShowName(),avatar:s.getAvatar()}))}return(e,s)=>(N(),q(k,{visible:l(d),useMask:!1},{default:z(()=>[A(v,{title:l(m).t("TUIChat.转发"),isSearch:!1,isCustomItem:!1,list:l(u),isHiddenBackIcon:l(E),onCancel:p,onSubmit:R},null,8,["title","list","isHiddenBackIcon"])]),_:1},8,["visible"]))}});export{W as _};
