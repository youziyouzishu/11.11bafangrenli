import"./adapter-vue-24f22062.js";import{B as T,z as m,X as z,q as N,_ as w}from"./@tencentcloud-7fc831ec.js";import q from"./index-cfa97a9d.js";import X from"./index-95ee9b8a.js";import{b as Y}from"./back-16f17fde.js";import{p as J}from"./video-play-6934d780.js";import S from"./Icon-2c0593f3.js";import W from"./message-container-d845128f.js";import{p as H,C as K,D as Q,t as Z}from"./index-7909557f.js";import{c as h,d as ee,a as se,i as ae}from"./env-a593fd1d.js";import{d as R,r as y,w as O,b as L,o as a,c as t,a as d,M as _,a_ as e,aB as c,F as B,ao as C,ae as E,aR as b,y as x,x as G}from"./@vue-a164be7a.js";const te={class:"header-container"},oe={key:0},ne={key:1},le={class:"title"},re={key:0},ie={key:0,class:"message-text"},de={key:0,class:"text"},ce=["src"],me={key:1,class:"message-image"},pe=["src"],ue={key:2,class:"message-video"},_e=["onClick"],ge=["src"],ye=["poster"],ve=["src"],fe={key:3,class:"message-audio"},he={key:4,class:"message-face"},Me=["src"],Ie={key:5,class:"message-file"},ke={key:6},De=["onClickCapture"],Be={key:8},Ce=R({__name:"index",props:{messageID:{default:""},isMounted:{type:Boolean,default:!1}},emits:["closeOverlay"],setup(M,{emit:I}){const k=I,i=M,o=T.TYPES,g=y(!1),l=y([]),p=y({title:"",messageList:[]}),v=y();O(()=>l.value.length,async r=>{if(g.value=!1,r<1)return;const n=l.value[l.value.length-1];if(n.downloadKey&&n.messageList.length===0)try{const s=await z.downloadMergedMessages({payload:n,type:T.TYPES.MSG_MERGER});l.value[l.value.length-1]=s.payload}catch{g.value=!0}p.value=l.value[l.value.length-1]}),O(()=>i.isMounted,r=>{if(r){if(!i.messageID)throw new Error("messageID is required when first render of simple-message-list.");const n=N.getMessageModel(i.messageID).getMessage().payload;l.value=[n]}else l.value=[]},{immediate:!0});const f=L(()=>l.value.length>1),D=L(()=>{var r;return(r=p.value)!=null&&r.messageList?p.value.messageList.length>0:!1});function V(r,n){l.value.push(n.messageBody[0].payload),r.stopPropagation()}function F(){l.value.pop(),l.value.length<1&&k("closeOverlay")}function $(r){if(h){const n=encodeURIComponent(r);uni.navigateTo({url:`/TUIKit/components/TUIChat/video-play?videoUrl=${n}`})}}function A(r){let n="";return r.indexOf("@custom")>-1?n=K+r:(n=Q+r,n.indexOf("@2x")===-1?n+="@2x.png":n+=".png"),n}return(r,n)=>(a(),t("div",{class:E({"simple-message-list-container":!0,"simple-message-list-container-mobile":e(ee)})},[d("div",te,[d("span",{class:"back",onClick:F},[_(S,{class:"close-icon",file:e(Y),size:"18px"},null,8,["file"]),e(f)?(a(),t("span",oe,c(e(m).t("TUIChat.返回")),1)):(a(),t("span",ne,c(e(m).t("TUIChat.关闭")),1))]),d("span",le,c(e(p).title),1)]),e(g)?(a(),t("div",re," Load Merge Message Error ")):e(D)?(a(),t("div",{key:1,ref_key:"simpleMessageListRef",ref:v,class:"message-list"},[(a(!0),t(B,null,C(e(p).messageList,s=>(a(),t("div",{key:s.ID,class:E({"message-item":!0})},[_(W,{sender:s.nick,avatar:s.avatar,type:s.messageBody[0].type,time:s.time},{default:b(()=>[s.messageBody[0].type===e(o).MSG_TEXT?(a(),t("div",ie,[(a(!0),t(B,null,C(e(H)(s.messageBody[0].payload.text),(u,j)=>(a(),t("span",{key:j,class:"message-text-container"},[u.type==="text"?(a(),t("span",de,c(u.content),1)):(a(),t("img",{key:1,class:"simple-emoji",src:u.content,alt:"small-face"},null,8,ce))]))),128))])):s.messageBody[0].type===e(o).MSG_IMAGE?(a(),t("div",me,[d("img",{class:"image",src:s.messageBody[0].payload.imageInfoArray[2].url,mode:"widthFix",alt:"image"},null,8,pe)])):s.messageBody[0].type===e(o).MSG_VIDEO?(a(),t("div",ue,[e(h)?(a(),t("div",{key:0,onClick:u=>$(s.messageBody[0].payload.remoteVideoUrl)},[d("image",{class:"image",src:s.messageBody[0].payload.thumbUrl,mode:"widthFix",alt:"image"},null,8,ge),_(S,{class:"video-play-icon",file:e(J)},null,8,["file"])],8,_e)):(a(),t("video",{key:1,class:"video",controls:"",poster:s.messageBody[0].payload.thumbUrl},[d("source",{src:s.messageBody[0].payload.remoteVideoUrl,type:"video/mp4"},null,8,ve)],8,ye))])):s.messageBody[0].type===e(o).MSG_AUDIO?(a(),t("div",fe,[d("span",null,c(e(m).t("TUIChat.语音"))+" ",1),d("span",null,c(s.messageBody[0].payload.second)+"s",1)])):s.messageBody[0].type===e(o).MSG_FACE?(a(),t("div",he,[d("img",{class:"image",src:A(s.messageBody[0].payload.data),alt:"face"},null,8,Me)])):s.messageBody[0].type===e(o).MSG_FILE?(a(),t("div",Ie,c(e(m).t("TUIChat.[文件]")),1)):s.messageBody[0].type===e(o).MSG_LOCATION?(a(),t("div",ke,c(e(m).t("TUIChat.[地理位置]")),1)):s.messageBody[0].type===e(o).MSG_MERGER?(a(),t("div",{key:7,class:"message-merger",onClickCapture:u=>V(u,s)},[_(P,{disabled:"",renderData:s.messageBody[0].payload},null,8,["renderData"])],40,De)):s.messageBody[0].type===e(o).MSG_CUSTOM?(a(),t("div",Be,c(e(m).t("TUIChat.[自定义消息]")),1)):x("",!0)]),_:2},1032,["sender","avatar","type","time"])]))),128))],512)):x("",!0)],2))}});const U=w(Ce,[["__scopeId","data-v-bf0213a0"]]),Ae=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"})),be={class:"record-title"},xe={class:"record-abstract-container"},Ue={class:"record-footer"},Te=R({__name:"index",props:{renderData:{},disabled:{type:Boolean,default:!1},messageItem:{default:()=>({})}},emits:["assignMessageIDInUniapp"],setup(M,{emit:I}){const k=I,i=M,o=y(!1);function g(){i.disabled||(h?k("assignMessageIDInUniapp",i.messageItem.ID):o.value=!0)}function l(){o.value=!1}return(p,v)=>(a(),t("div",null,[d("div",{class:"message-record-container",onClick:g},[d("div",be,c(i.renderData.title),1),d("div",xe,[(a(!0),t(B,null,C(i.renderData.abstractList.slice(0,7),(f,D)=>(a(),t("div",{key:D,class:"record-abstract-item"},c(e(Z)(f)),1))),128))]),d("div",Ue,c(e(m).t("TUIChat.聊天记录")),1)]),!i.disabled&&e(se)?(a(),G(q,{key:0,visible:e(o),onOnOverlayClick:v[0]||(v[0]=f=>o.value=!1)},{default:b(()=>[_(U,{isMounted:e(o),renderData:i.renderData,messageID:i.messageItem.ID,onCloseOverlay:l},null,8,["isMounted","renderData","messageID"])]),_:1},8,["visible"])):!i.disabled&&e(ae)&&!e(h)?(a(),G(X,{key:1,visible:e(o),isFullScreen:!0,overlayColor:"transparent",popDirection:"right"},{default:b(()=>[_(U,{isMounted:e(o),renderData:i.renderData,messageID:i.messageItem.ID,onCloseOverlay:l},null,8,["isMounted","renderData","messageID"])]),_:1},8,["visible"])):x("",!0)]))}});const P=w(Te,[["__scopeId","data-v-549e94d8"]]),je=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"}));export{P as M,je as a,Ae as i};
