var me=Object.defineProperty;var Ie=(t,l,i)=>l in t?me(t,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[l]=i;var q=(t,l,i)=>(Ie(t,typeof l!="symbol"?l+"":l,i),i);import{M as ce,an as ue,d as Q,r as R,w as ae,b as K,aZ as ye,o as h,x as M,aR as Ce,aT as Le,a as _,ae as v,a_ as a,ag as j,c as y,aB as w,y as b,aP as Re,k as Oe,ap as de,aW as be,b7 as Te,F as se,ao as ne}from"./@vue-a164be7a.js";import{w as ee,_ as te,i as $e,z as L,I as Pe,B as O,q as D,o as H,X as ke,W as X}from"./@tencentcloud-7fc831ec.js";import Ue from"./About-f35869e5.js";import Ee from"./EditProfile-564f59a5.js";let Z,fe="vue2",ie=(t,l)=>({}),F=(t,l)=>{};try{Z=3,fe="vue3",ie=ce,F=ue}catch{Z=3,fe="vue3",ie=ce,F=ue}console.warn(`[adapter-vue]: vue version is ${Z}`);const xe={SUCCESS:"success",WARNING:"warning",ERROR:"error",NORMAL:"normal"},A=xe,f=ee()==="pc",N=ee()==="h5",Me=ee()==="wechat",_e=ee()==="app",le=typeof uni<"u",ht=N||Me||_e,Ae={key:0},De={key:1},Ne=Q({__name:"index",props:{message:{type:String,default:""},duration:{type:Number,default:3e3},repeatNum:{type:Number,default:1},id:{type:String,default:""},onClose:{type:Function,required:!1},offset:{type:Number,default:20},zIndex:{type:Number,default:0},type:{type:String,default:""}},setup(t){const l=t,i=R(!1);let e;const o=()=>{l.duration>0&&(e=setTimeout(()=>{i.value&&d()},l.duration))},s=()=>{clearTimeout(e)},d=()=>{i.value=!1,typeof l.onClose=="function"&&l.onClose()};ae(()=>l.repeatNum,()=>{s(),o()});const c=K(()=>({top:`${l.offset}px`,zIndex:l.zIndex}));ye(()=>{o(),i.value=!0});const u=r=>r&&(r===A.ERROR||r===A.SUCCESS||r===A.WARNING)?r:A.NORMAL;return(r,g)=>(h(),M(Oe,{name:"fade",onAfterLeave:g[0]||(g[0]=S=>r.$emit("destroy"))},{default:Ce(()=>[Le(_("div",{class:v(["message",[u(t.type),a(N)&&"message-h5"]]),style:j(a(c))},[a(N)?b("",!0):(h(),y("p",Ae,w(t.message),1)),a(N)?(h(),y("span",De,w(t.message),1)):b("",!0)],6),[[Re,a(i)]])]),_:1}))}});const pe=te(Ne,[["__scopeId","data-v-f601456a"]]),T=[];let he=1;const Be=Math.trunc(Z),ge=document.body,J=function(t){var c;let l=t.offset||20;T.forEach(({vm:u})=>{var r,g;l+=(((r=u==null?void 0:u.el)==null?void 0:r.offsetHeight)||((g=u==null?void 0:u.$el)==null?void 0:g.offsetHeight)||0)+20}),l+=20;const i=`message_${he+=1}`,e=t.onClose,o={zIndex:20+he,offset:l,id:i,...t,onClose:()=>{J.close(i,e)}};let s,d;switch(Be){case 2:const u=(c=$e)==null?void 0:c.Vue;if(!u)return{};const r=u.extend(pe),g=new r({propsData:o});return g.$mount(),ge.appendChild(g.$el),g.$el.style.zIndex=o.zIndex,g.verticalOffset=o.verticalOffset,g.visible=!0,T.push({vm:g}),{close:()=>{g.visible=!1}};case 3:return s=ie(pe,o),d=document.createElement("div"),s!=null&&s.props&&(s.props.onDestroy=()=>{F(null,d)}),s!=null&&s.data&&(s.data.onDestroy=()=>{F(null,d)}),F(s,d),T.push({vm:s}),ge.appendChild(d.firstElementChild),{close:()=>{var S;(S=s==null?void 0:s.component)!=null&&S.proxy&&(s.component.proxy.visible=!1)}}}return{}};function ze(t,l){var d,c,u,r,g,S,$,m,U,E,V,B,z,G,x,Y,W;const i=T==null?void 0:T.findIndex(({vm:C})=>{var n,k,p;return t===((k=(n=C==null?void 0:C.component)==null?void 0:n.props)==null?void 0:k.id)||t===((p=C==null?void 0:C._props)==null?void 0:p.id)});if(i===-1)return;const{vm:e}=T[i];if(!e)return;l==null||l(e);const o=((d=e==null?void 0:e.el)==null?void 0:d.offsetHeight)||((c=e==null?void 0:e.$el)==null?void 0:c.offsetHeight);T.splice(i,1);const s=T.length;if(!(s<1))for(let C=i;C<s;C++){const n=Number.parseInt(((S=(g=(r=(u=T[C])==null?void 0:u.vm)==null?void 0:r.el)==null?void 0:g.style)==null?void 0:S.top)||((E=(U=(m=($=T[C])==null?void 0:$.vm)==null?void 0:m.$el)==null?void 0:U.style)==null?void 0:E.top),10)-o-16;(G=(z=(B=(V=T[C])==null?void 0:V.vm)==null?void 0:B.component)==null?void 0:z.props)!=null&&G.offset&&(T[C].vm.component.props.offset=n),(W=(Y=(x=T[C])==null?void 0:x.vm)==null?void 0:Y._props)!=null&&W.offset&&(T[C].vm._props.offset=n)}}J.close=ze;const Ye={key:0},We={key:0,class:"header"},je={key:0,class:"header-title"},He={key:1,class:"footer"},Fe=Q({__name:"index",props:{show:{type:Boolean,default:!1},modal:{type:Boolean,default:!0},height:{type:String,default:"fit-content"},closeByClickOutside:{type:Boolean,default:!0},borderRadius:{type:String,default:"0px"},title:{type:String,default:""},showHeaderCloseButton:{type:Boolean,default:!1},showFooterSubmitButton:{type:Boolean,default:!1},submitButtonContent:{type:String,default:()=>L.t("确定")}},emits:["onOpen","onClose","onSubmit"],setup(t,{emit:l}){const i=t,e=l,o=R();ae(()=>i.show,(c,u)=>{if(c!==u)switch(c){case!0:e("onOpen",o),Te(()=>{N&&!le&&i.closeByClickOutside&&Pe.listen({domRefs:o.value,handler:s})});break;case!1:e("onClose",o);break}});const s=()=>{(le||N)&&e("onClose",o)},d=()=>{e("onSubmit"),s()};return(c,u)=>i.show?(h(),y("div",Ye,[a(f)?de(c.$slots,"default",{key:1},void 0,!0):(h(),y("div",{key:0,class:v(["bottom-popup",a(le)&&"bottom-popup-uni",!a(f)&&"bottom-popup-h5",!a(f)&&i.modal&&"bottom-popup-modal"]),onClick:s},[_("div",{ref_key:"dialogRef",ref:o,class:v(["bottom-popup-main",!a(f)&&"bottom-popup-h5-main"]),style:j({height:i.height,borderTopLeftRadius:i.borderRadius,borderTopRightRadius:i.borderRadius}),onClick:u[0]||(u[0]=be(()=>{},["stop"]))},[t.title||t.showHeaderCloseButton?(h(),y("div",We,[t.title?(h(),y("div",je,w(t.title),1)):b("",!0),t.showHeaderCloseButton?(h(),y("div",{key:1,class:"header-close",onClick:s},w(a(L).t("关闭")),1)):b("",!0)])):b("",!0),de(c.$slots,"default",{},void 0,!0),t.showFooterSubmitButton?(h(),y("div",He,[_("div",{class:"footer-submit",onClick:d},w(t.submitButtonContent),1)])):b("",!0)],6)],2))])):b("",!0)}});const Ve=te(Fe,[["__scopeId","data-v-a9778d6a"]]),Ge=["src"],qe=["src"],Ke=Q({__name:"Icon",props:{file:{default:""},size:{},width:{default:"20px"},height:{default:"20px"},hotAreaSize:{}},emits:["onClick"],setup(t,{emit:l}){const i=l,e=t,o=K(()=>{if(e.hotAreaSize)return isNaN(Number(e.hotAreaSize))?String(e.hotAreaSize):`${e.hotAreaSize}px`}),s=K(()=>e.size?e.size:e.width),d=K(()=>e.size?e.size:e.height),c=u=>{i("onClick",u)};return(u,r)=>(h(),y("div",{class:v(["common-icon-container",!a(f)&&"common-icon-container-mobile"]),style:j({padding:a(o)}),onClick:c},[a(_e)?(h(),y("image",{key:0,class:"common-icon",src:e.file,style:j({width:a(s),height:a(d)})},null,12,Ge)):(h(),y("img",{key:1,class:"common-icon",src:e.file,style:j({width:a(s),height:a(d)})},null,12,qe))],6))}});const ve=te(Ke,[["__scopeId","data-v-77821faf"]]),Xe="/admin/assets/right-icon-a24fdba0.svg",Ze="/admin/assets/selected-0a1e59e6.svg";function we(t,l=new WeakMap){if(typeof t!="object"||t===null||t===void 0)return t;if(l.has(t))return l.get(t);const i=Object.create(Object.getPrototypeOf(t));return Object.keys(t).forEach(o=>{const s=t[o];typeof s!="object"||s===null?i[o]=s:Array.isArray(s)?i[o]=[...s]:s instanceof Set?i[o]=new Set([...s]):s instanceof Map?i[o]=new Map([...s]):(l.set(t,t),i[o]=we(s,l))}),i}const gt=(t,l,i,e)=>{const o=t/l,s=i/e;return t<=i&&l<=e?{width:t,height:l}:t<=i&&l>e||t>i&&l>e&&o<=s?{width:t*(e/l),height:e}:{width:i,height:l*(i/t)}},vt=t=>{var l;return t.type===O.TYPES.MSG_CUSTOM&&((l=t==null?void 0:t.getMessageContent())==null?void 0:l.businessID)==="group_create"};function yt(){return D.getData(H.USER,"displayMessageReadReceipt")&&D.getData(H.APP,"enabledMessageReadReceipt")}function Ct(t){return Object.assign({},t)}function bt(t){const l=new Date().setHours(0,0,0,0),i=new Date(new Date().getFullYear(),0,1,0,0,0,0).getTime(),e=new Date(t),o=24*60*60*1e3,s=7*o,d=l-e.getTime();function c(u){return u<10?"0"+u:u.toString()}if(d<=0)return`${c(e.getHours())}:${c(e.getMinutes())}`;if(d<=o)return`${L.t("time.昨天")} ${c(e.getHours())}:${c(e.getMinutes())}`;if(d<=s-o){const r=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][e.getDay()];return`${L.t("time."+r)} ${c(e.getHours())}:${c(e.getMinutes())}`}else return e.getTime()>=i?`${e.getMonth()+1}/${e.getDate()} ${c(e.getHours())}:${c(e.getMinutes())}`:`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()} ${c(e.getHours())}:${c(e.getMinutes())}`}const P=class P{constructor(){q(this,"isUseCache",!0);q(this,"translationCache",new Map)}static getInstance(){return P.instance||(P.instance=new P),P.instance}async get(l){if(this.isUseCache){const r=this.translationCache.get(l.ID);if(r!==void 0)return r}const i=D.getMessageModel(l.ID);if(!i)return[];const{text:e}=i.getMessageContent()||{},o=[],s=await this.getNickList(i);for(let r=0;r<e.length;++r){const g=e[r];if(g.name==="img"){o.push({type:"face",value:g.src});continue}const{transSplitingList:S,atNickList:$}=this.getSplitResult(g.text,s);for(let m=0;m<S.length;++m)o.push({type:"text",value:S[m]}),m<$.length&&o.push({type:"mention",value:$[m]})}const d=[],c=o.filter((r,g)=>r.type==="text"&&r.value.trim()!==""?(d.push(g),!0):!1).map(r=>r.value);return c.length===0?(this.translationCache.set(i.ID,o),o):((await this.getTranslationStandard(c)).forEach((r,g)=>{o[d[g]].value=r}),this.translationCache.set(i.ID,o),o)}clear(){this.translationCache.clear()}disableCache(){this.isUseCache=!1}enableCache(){this.isUseCache=!0}getTranslationStandard(l){return new Promise((i,e)=>{ke.translateText({sourceTextList:l,sourceLanguage:"auto"}).then(o=>{const{data:{translatedTextList:s}}=o;i(s)}).catch(o=>{e(o)})})}async getNickList(l){const i=[],{atUserList:e=[]}=l,o=O.TYPES.MSG_AT_ALL;if(e.includes(o)&&i.push(`@${L.t("TUIChat.所有人")}`),e.length>0){const{data:s}=await X.getUserProfile({userIDList:e});s.forEach(d=>{const c=`@${d.nick||d.userID}`;i.push(c)})}return[...new Set(i)]}getSplitResult(l,i){let e=0;const o=[],s=[];for(;e<l.length;){const d=l.indexOf("@",e);if(d===-1){o.push(l.substring(e));break}let c=!1;for(let u=0;u<i.length;++u){const r=l.indexOf(i[u],d);if(r!==-1&&r===d){o.push(l.substring(e,r)),s.push(i[u]),e=r+i[u].length,c=!0;break}}if(!c){o.push(l.substring(e));break}}return{transSplitingList:o,atNickList:s}}};q(P,"instance");let oe=P;const Je=oe.getInstance(),Qe=["src"],et=["onClick"],tt={class:v(["label-left"])},st={class:v(["label-title"])},nt={key:0,class:v(["label-desc"])},lt={class:v(["label-right"])},it=["onClick"],ot=["onClick"],at=Q({__name:"Profile",props:{displayType:{type:String,default:"profile"},showSetting:{type:Boolean,default:!1}},emits:["update:showSetting"],setup(t,{emit:l}){const i=t,e=l,o=R(),s=R({}),d=R(!1),c=R(!1),u=R(!1),r=R({editProfile:{value:"editProfile",label:"编辑资料",onClick:()=>{u.value=!0,c.value=!0}},allowType:{value:"allowType",label:"加我为好友时",selectedChild:"",childrenShowType:"bottomPopup",showChildren:!1,onClick:n=>{f||(n.showChildren=!0)},children:{[O.TYPES.ALLOW_TYPE_ALLOW_ANY]:{value:O.TYPES.ALLOW_TYPE_ALLOW_ANY,label:"同意任何用户加好友",onClick:n=>{x(n.value)}},[O.TYPES.ALLOW_TYPE_NEED_CONFIRM]:{value:O.TYPES.ALLOW_TYPE_NEED_CONFIRM,label:"需要验证",onClick:n=>{x(n.value)}},[O.TYPES.ALLOW_TYPE_DENY_ANY]:{value:O.TYPES.ALLOW_TYPE_DENY_ANY,label:"拒绝任何人加好友",onClick:n=>{x(n.value)}}}},displayMessageReadReceipt:{value:"displayMessageReadReceipt",label:"消息阅读状态",selectedChild:"userLevelReadReceiptOpen",childrenShowType:"bottomPopup",showChildren:!1,onClick(n){f||(n.showChildren=!0)},children:{userLevelReadReceiptOpen:{value:"userLevelReadReceiptOpen",label:"开启",onClick(){Y(!0)}},userLevelReadReceiptClose:{value:"userLevelReadReceiptClose",label:"关闭",onClick(){Y(!1)}}}},displayOnlineStatus:{value:"displayOnlineStatus",label:"显示在线状态",selectedChild:"userLevelOnlineStatusOpen",childrenShowType:"bottomPopup",showChildren:!1,onClick(n){f||(n.showChildren=!0)},children:{userLevelOnlineStatusOpen:{value:"userLevelOnlineStatusOpen",label:"开启",onClick(){W(!0)}},userLevelOnlineStatusClose:{value:"userLevelOnlineStatusClose",label:"关闭",onClick(){W(!1)}}}},translateLanguage:{value:"translateLanguage",label:"翻译语言",selectedChild:"zh",childrenShowType:"bottomPopup",showChildren:!1,onClick(n){f||(n.showChildren=!0)},children:{zh:{value:"zh",label:"zh",onClick(){C("zh")}},en:{value:"en",label:"en",onClick(){C("en")}},jp:{value:"jp",label:"jp",onClick(){C("jp")}},kr:{value:"kr",label:"kr",onClick(){C("kr")}}}},about:{value:"about",label:"关于腾讯云IM",selectedChild:"",childrenShowType:"bottomPopup",showChildren:!1,children:{},onClick:()=>{u.value=!0,d.value=!0}},exit:{value:"exit",label:"退出登录",onClick:()=>{}}}),g=n=>{n!=null&&n.onClick&&typeof(n==null?void 0:n.onClick)=="function"&&n.onClick(n)},S=()=>{d.value=!1,e("update:showSetting",!1)},$=()=>{c.value=!1,e("update:showSetting",!1)},m=n=>{X.updateMyProfile(n).then(()=>{J({message:"更新用户资料成功",type:A.SUCCESS})}).catch(k=>{console.warn("更新用户资料失败",k),J({message:"更新用户资料失败",type:A.ERROR})})};D.watch(H.USER,{userProfile:n=>{var k,p;s.value=we(n),(k=s==null?void 0:s.value)!=null&&k.allowType&&(r.value.allowType.selectedChild=(p=s==null?void 0:s.value)==null?void 0:p.allowType)},displayMessageReadReceipt(n){r.value.displayMessageReadReceipt.selectedChild=n?"userLevelReadReceiptOpen":"userLevelReadReceiptClose"},displayOnlineStatus(n){r.value.displayOnlineStatus.selectedChild=n?"userLevelOnlineStatusOpen":"userLevelOnlineStatusClose"}});let U=!1,E=!1;const V=n=>{document.addEventListener("mousedown",B),n!=null&&n.addEventListener&&(n==null||n.addEventListener("mousedown",z))},B=()=>{U=!0,!E&&U&&(e("update:showSetting",!1),G(o.value)),U=!1,E=!1},z=()=>{E=!0},G=n=>{document.removeEventListener("mousedown",B),n!=null&&n.removeEventListener&&(n==null||n.removeEventListener("mousedown",z))};ae(()=>i.showSetting,(n,k)=>{f&&n&&!k&&Te(()=>{V(o.value)})},{immediate:!0}),ye(()=>{X.getUserProfile().then(k=>{s.value=k.data});const n=D.getData(H.USER,"targetLanguage");n&&(r.value.translateLanguage.selectedChild=n)});function x(n){m({allowType:n}),r.value.allowType.showChildren=!1}function Y(n){D.update(H.USER,"displayMessageReadReceipt",n),r.value.displayMessageReadReceipt.showChildren=!1}function W(n){X.switchUserStatus({displayOnlineStatus:n}),r.value.displayOnlineStatus.showChildren=!1}function C(n){Je.clear(),ke.setTranslationLanguage(n),r.value.translateLanguage.selectedChild=n,r.value.translateLanguage.showChildren=!1}return(n,k)=>(h(),y("div",{class:v(["TUI-profile",!a(f)&&"TUI-profile-h5"])},[t.displayType!=="setting"?(h(),y("div",{key:0,class:v(["TUI-profile-basic",!a(f)&&"TUI-profile-h5-basic"])},[_("img",{class:v(["TUI-profile-basic-avatar",!a(f)&&"TUI-profile-h5-basic-avatar"]),src:a(s).avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png"},null,10,Qe),_("div",{class:v(["TUI-profile-basic-info",!a(f)&&"TUI-profile-h5-basic-info"])},[_("div",{class:v(["TUI-profile-basic-info-nick",!a(f)&&"TUI-profile-h5-basic-info-nick"])},w(a(s).nick||"-"),3),_("div",{class:v(["TUI-profile-basic-info-id",!a(f)&&"TUI-profile-h5-basic-info-id"])},[_("label",{class:v(["TUI-profile-basic-info-id-label",!a(f)&&"TUI-profile-h5-basic-info-id-label"])},w(a(L).t("Profile.用户ID"))+":",3),_("div",{class:v(["TUI-profile-basic-info-id-value",!a(f)&&"TUI-profile-h5-basic-info-id-value"])},w(a(s).userID),3)],2)],2)],2)):b("",!0),t.displayType!=="profile"&&(!a(f)||t.showSetting&&!a(u))?(h(),y("div",{key:1,ref_key:"settingDomRef",ref:o,class:v(["TUI-profile-setting",!a(f)&&"TUI-profile-h5-setting"]),onClick:k[0]||(k[0]=be(()=>{},["stop"]))},[(h(!0),y(se,null,ne(a(r),p=>{var re;return h(),y("div",{key:p.value,class:v(["TUI-profile-setting-item",!a(f)&&"TUI-profile-h5-setting-item",p.value==="exit"&&"TUI-profile-h5-setting-item-exit"])},[_("div",{class:v(["TUI-profile-setting-item-label",!a(f)&&"TUI-profile-h5-setting-item-label"]),onClick:I=>g(p)},[_("div",tt,[_("div",st,w(a(L).t(`Profile.${p.label}`)),1),p.children&&!a(f)&&p.childrenShowType==="switch"?(h(),y("div",nt,w(p.value),1)):b("",!0)]),_("div",lt,[!a(f)&&p.children&&p.selectedChild&&p.childrenShowType==="bottomPopup"?(h(),y("div",{key:0,class:v(["TUI-profile-setting-item-label-value",!a(f)&&"TUI-profile-h5-setting-item-label-value"])},w(a(L).t(`Profile.${(re=p==null?void 0:p.children[p.selectedChild])==null?void 0:re.label}`)),3)):b("",!0),p.children?(h(),M(ve,{key:1,file:a(Xe),width:"14px",height:"14px"},null,8,["file"])):b("",!0)])],10,et),p.children&&a(f)?(h(),y("div",{key:0,class:v(["TUI-profile-setting-item-children",!a(f)&&"TUI-profile-h5-setting-item-children"])},[(h(!0),y(se,null,ne(p.children,I=>(h(),y("div",{key:I.value,class:v(["TUI-profile-setting-item-children-item",!a(f)&&"TUI-profile-h5-setting-item-children-item"]),onClick:Se=>g(I)},[_("div",{class:v(["TUI-profile-setting-item-children-item-label",!a(f)&&"TUI-profile-h5-setting-item-children-item-label"])},w(a(L).t(`Profile.${I.label}`)),3),p.selectedChild===I.value?(h(),M(ve,{key:0,file:a(Ze),width:"14px",height:"14px"},null,8,["file"])):b("",!0)],10,it))),128))],2)):b("",!0),p.children&&!a(f)&&p.childrenShowType==="bottomPopup"?(h(),M(Ve,{key:1,show:p.showChildren,onOnClose:I=>p.showChildren=!1},{default:Ce(()=>[(h(!0),y(se,null,ne(p.children,I=>(h(),y("div",{key:I.value,class:v(["TUI-profile-setting-item-bottom-popup",!a(f)&&"TUI-profile-h5-setting-item-bottom-popup"]),onClick:Se=>g(I)},w(a(L).t(`Profile.${I.label}`)),11,ot))),128))]),_:2},1032,["show","onOnClose"])):b("",!0)],2)}),128))],2)):b("",!0),a(d)?(h(),M(Ue,{key:2,userProfile:a(s),onCloseAboutBox:S},null,8,["userProfile"])):b("",!0),a(c)?(h(),M(Ee,{key:3,onCloseEditProfileBox:$})):b("",!0)],2))}});const rt=te(at,[["__scopeId","data-v-45eec6f7"]]),Tt=Object.freeze(Object.defineProperty({__proto__:null,default:rt},Symbol.toStringTag,{value:"Module"}));export{Ve as B,ve as I,rt as P,J as T,le as a,ht as b,Me as c,bt as d,N as e,A as f,yt as g,gt as h,f as i,vt as j,we as k,Ze as l,fe as m,Tt as n,Xe as r,Ct as s,Je as t};
