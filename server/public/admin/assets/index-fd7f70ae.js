import"./adapter-vue-24f22062.js";import{z as y,q as o,o as r,E as A,_ as H}from"./@tencentcloud-7fc831ec.js";import U from"./Icon-2c0593f3.js";import{J as V}from"./type-check-5e73d261.js";import{d as k,r as a,b as E,w as $,aZ as j,a$ as q,a_ as g,o as z,c as J,M as R,a as Z,aB as F,y as G}from"./@vue-a164be7a.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";import"./env-a593fd1d.js";const K="/admin/assets/double-arrow-a1a15b8b.svg",P={class:"scroll-button-text"},Q=k({__name:"index",emits:["scrollToLatestMessage"],setup(W,{expose:M,emit:x}){const S=x,p=a([]),d=a(""),c=a(0),u=a(0),l=a(!1),m=a(!1),i=a(!1),b=E(()=>u.value?`${u.value}${y.t("TUIChat.条新消息")}`:y.t("TUIChat.回到最新位置"));$(()=>[l.value,m.value],()=>{i.value=l.value||m.value,i.value||f()},{immediate:!0}),j(()=>{o.watch(r.CHAT,{messageList:v,newMessageList:_}),o.watch(r.CONV,{currentConversation:h})}),q(()=>{o.unwatch(r.CHAT,{messageList:v,newMessageList:_}),o.unwatch(r.CONV,{currentConversation:h})});function I(e){var t,s;return((s=V((t=e.payload)==null?void 0:t.data))==null?void 0:s.businessID)==="user_typing_status"}function v(e){var s,n;p.value=e||[];const t=(n=p.value)==null?void 0:n[((s=p.value)==null?void 0:s.length)-1];m.value=!!(t&&(t==null?void 0:t.time)<(c==null?void 0:c.value))}function _(e){Array.isArray(e)&&i.value&&e.forEach(t=>{t&&t.conversationID===d.value&&!t.isDeleted&&!t.isRevoked&&!I(t)&&(u.value+=1)})}function h(e){var t;(e==null?void 0:e.conversationID)!==d.value&&f(),d.value=(e==null?void 0:e.conversationID)||"",c.value=((t=e==null?void 0:e.lastMessage)==null?void 0:t.lastTime)||0}async function L(e){var t,s,n,C,w;if(e.target)try{const{height:T}=await A(`#${(t=e.target)==null?void 0:t.id}`,"messageList")||{},N=((s=e.target)==null?void 0:s.scrollHeight)||((n=e.detail)==null?void 0:n.scrollHeight),O=((C=e.target)==null?void 0:C.scrollTop)||((w=e.detail)==null?void 0:w.scrollTop)||0;if(N-O>2*T){l.value=!0;return}l.value=!1}catch{l.value=!1}}function B(){o.getData(r.CHAT,"messageSource")!==void 0&&o.update(r.CHAT,"messageSource",void 0)}function f(){u.value=0}function D(){B(),f(),S("scrollToLatestMessage")}return M({judgeScrollOverOneScreen:L,isScrollButtonVisible:i}),(e,t)=>g(i)?(z(),J("div",{key:0,class:"scroll-button",onClick:D},[R(U,{width:"10px",height:"10px",file:g(K)},null,8,["file"]),Z("div",P,F(g(b)),1)])):G("",!0)}});const ge=H(Q,[["__scopeId","data-v-f109caf6"]]);export{ge as default};
