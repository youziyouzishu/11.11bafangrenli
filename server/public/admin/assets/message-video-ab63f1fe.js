import{d as S,r as u,b6 as $,b as z,w as A,o as m,c as v,a as g,a_ as a,ae as f,M as N,aW as C,y as j,b7 as q}from"./@vue-a164be7a.js";import"./adapter-vue-24f22062.js";import{_ as D}from"./@tencentcloud-7fc831ec.js";import{h as O}from"./utils-14df48f1.js";import R from"./Icon-2c0593f3.js";import{c as T}from"./icon-close-7ee462f2.js";import{a as d}from"./env-a593fd1d.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";const F={class:"message-video"},G=["src"],J=["src","poster"],K=["src","poster"],Q={key:0,class:"dialog-video"},X=["src"],_="https://web.sdk.qcloud.com/im/assets/images/transparent.png",Y=S({__name:"message-video",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},emits:["uploading"],setup(P,{emit:H}){const t=P,b=H,y=u(!1),h=u(""),U=u(0),W=u(0),c=u(),r=u();$(async()=>{t.content&&(h.value=await L(t.content,t.messageItem),q(async()=>{var o,n,l,p,B;const s=((o=document.getElementById("messageScrollList"))==null?void 0:o.clientWidth)||0,e=d?300:Math.min(s-172,300);let i;if(t.messageItem.status==="success"){let{snapshotWidth:k=0,snapshotHeight:x=0}=t.content;const{snapshotUrl:M}=t.content;if(k===0||x===0)return;M===_&&(k=U.value,x=W.value),i=O(k,x,e,e),(n=c==null?void 0:c.value)!=null&&n.style&&(c.value.style.width=`${i.width}px`),(l=c==null?void 0:c.value)!=null&&l.style&&(c.value.style.height=`${i.height}px`),d&&((p=r==null?void 0:r.value)!=null&&p.style&&(r.value.style.width=`${i.width}px`),(B=r==null?void 0:r.value)!=null&&B.style&&(r.value.style.height=`${i.height}px`))}else b("uploading")}))});const V=z(()=>{const{snapshotWidth:s=0,snapshotHeight:e=0}=t.messageItem.payload;return s>=e});A(()=>t.messageItem.status,(s,e)=>{s==="success"&&e!=="success"&&b("uploading")});function w(){t.messageItem.progress>0&&t.messageItem.progress<1||(y.value=!y.value)}function E(s){return new Promise(e=>{let i="";const o=document.createElement("video");o.setAttribute("crossOrigin","anonymous"),o.setAttribute("src",s),o.setAttribute("preload","auto"),o.addEventListener("loadeddata",function(){const n=document.createElement("canvas"),l=o.videoWidth,p=o.videoHeight;n.width=l,n.height=p,n.getContext("2d").drawImage(o,0,0,l,p),i=n.toDataURL("image/jpeg"),U.value=l,W.value=p,e(i)},{once:!0})})}async function L(s,e){var i,o,n,l;return e?e.status!=="success"?await E(s.url):s.snapshotUrl!==_&&s.snapshotUrl||((i=e==null?void 0:e.payload)==null?void 0:i.snapshotUrl)!==_&&((o=e==null?void 0:e.payload)==null?void 0:o.snapshotUrl)||((n=e.payload)==null?void 0:n.thumbUrl)!==_&&((l=e==null?void 0:e.payload)==null?void 0:l.thumbUrl)||await E(s.url):""}return(s,e)=>(m(),v("div",F,[g("div",{ref_key:"skeleton",ref:c,class:f(["message-video-box",[(!t.messageItem.progress||t.messageItem.progress===1)&&!a(d)&&"message-video-cover"]]),onClick:w},[t.messageItem.progress>0&&t.messageItem.progress<1&&a(h)||!a(d)&&a(h)?(m(),v("img",{key:0,class:f(["message-img",[a(V)?"is-width":"is-height"]]),src:a(h)},null,10,G)):a(d)?(m(),v("video",{key:2,ref_key:"videoRef",ref:r,class:"message-img video-web",src:t.content.url,controls:"",preload:"metadata",poster:a(h)},null,8,K)):(m(),v("video",{key:1,ref_key:"videoRef",ref:r,class:"message-img video-h5-uploading",src:t.content.url+"#t=0.1",poster:t.content.url,preload:"auto",muted:""},null,8,J))],2),a(y)&&!a(d)?(m(),v("div",Q,[g("div",{class:"dialog-video-close",onClick:C(w,["stop"])},[N(R,{file:a(T)},null,8,["file"])]),g("div",{class:f(["dialog-video-box",[a(d)?"":"dialog-video-h5"]]),onClick:C(w,["self"])},[g("video",{class:f([a(V)?"is-width":"is-height"]),src:t.content.url,controls:"",autoplay:""},null,10,X)],2)])):j("",!0)]))}});const ge=D(Y,[["__scopeId","data-v-ed12656c"]]);export{ge as default};
