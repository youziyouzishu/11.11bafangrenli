import{T as Me,D as Ne,k as We,b as Ge,q as Ye,r as qe,s as Ke,U as Ze,E as Qe,C as Je,K as Oe,L as Xe,x as He,a as et,B as tt,F as lt,V as nt,G as at,I as ot}from"./element-plus-69d92160.js";import{_ as st}from"./index.vue_vue_type_script_setup_true_lang-3ac3301c.js";import{_ as it}from"./index-8d613ba7.js";import{r as T,f as Ve,b as Ae,h as dt}from"./index-90bac5cf.js";import{P as ct}from"./index-943d816c.js";import{U as rt}from"./index-e65fd93b.js";import{_ as ut}from"./index.vue_vue_type_script_setup_true_lang-6fb43bf5.js";import{d as J,b5 as O,b2 as Ee,o as s,c as f,M as n,ad as ft,a_ as e,b as Re,r as I,w as Z,aT as Q,aP as ce,x as z,y as v,aR as a,b0 as F,b7 as xe,a as o,ap as mt,ag as ze,ba as pt,b3 as _t,aZ as vt,L as _,aW as q,F as $,ao as K,aU as ht,ae as Se,aB as ie,ak as gt,aj as yt}from"./@vue-a164be7a.js";import{u as Ct}from"./usePaging-6e60bb31.js";import{_ as Ie}from"./@tencentcloud-7fc831ec.js";import{g as kt}from"./vue3-video-play-2f8ccca9.js";const bt=J({__name:"index",props:{src:{type:String,required:!0},width:String,height:String,poster:String},setup(l,{expose:A}){const g=l,p=O(),h=Ee({color:"var(--el-color-primary)",muted:!1,webFullScreen:!1,speedRate:["0.75","1.0","1.25","1.5","2.0"],autoPlay:!0,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,title:"",poster:"",...g}),b=()=>{p.value.play()},y=()=>{p.value.pause()},d=r=>{console.log(r,"播放")},S=r=>{console.log(r,"暂停")},i=r=>{console.log(r,"时间更新")},w=r=>{console.log(r,"可以播放")};return A({play:b,pause:y}),(r,D)=>(s(),f("div",null,[n(e(kt),ft({ref_key:"playerRef",ref:p},h,{src:l.src,onPlay:d,onPause:S,onTimeupdate:i,onCanplay:w}),null,16,["src"])]))}}),wt={key:0},xt={key:1},St=J({__name:"preview",props:{modelValue:{type:Boolean,default:!1},url:{type:String,default:""},type:{type:String,default:"image"}},emits:["update:modelValue"],setup(l,{emit:A}){const g=l,p=A,h=O(),b=Re({get(){return g.modelValue},set(S){p("update:modelValue",S)}}),y=()=>{p("update:modelValue",!1)},d=I([]);return Z(()=>g.modelValue,S=>{S?xe(()=>{var i;d.value=[g.url],(i=h.value)==null||i.play()}):xe(()=>{var i;d.value=[],(i=h.value)==null||i.pause()})}),(S,i)=>{const w=Me,r=bt,D=Ne;return Q((s(),f("div",null,[l.type=="image"?(s(),f("div",wt,[e(d).length?(s(),z(w,{key:0,"url-list":e(d),"hide-on-click-modal":"",onClose:y},null,8,["url-list"])):v("",!0)])):v("",!0),l.type=="video"?(s(),f("div",xt,[n(D,{modelValue:e(b),"onUpdate:modelValue":i[0]||(i[0]=j=>F(b)?b.value=j:null),width:"740px",title:"视频预览","before-close":y},{default:a(()=>[n(r,{ref_key:"playerRef",ref:h,src:l.url,width:"100%",height:"450px"},null,8,["src"])]),_:1},8,["modelValue"])])):v("",!0)],512)),[[ce,l.modelValue]])}}}),Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAACJElEQVRYR+2YMWsUURSFz3m7s+nskjUIQSutbMRi7WzUVjSadMHCbVLkByjmLygaCVYWRqMEUhkFS9Gg0cJfYCPZjYUQFbPs+I7c2R1Q2ZjZfRNYYS4MAzPv3vnmvDvL3kMA2Hl5/CjLI9ckf4ZwY3Zt15C+gfwIao3So0rt3XsJtPUk9M/cAW6y9ap2DIyfAjgCwANwGeoYiEFtk/5e5CvXeer1D2neATcGgiTZM4+t9RNLEKcBtAFEGeBsiRWzl7EoSXo+8rV9gWc/fDc1B1VSEoEnDpj0KTB33tS26DGaEezvZQZpRxmODyoT5+vwBwS3zeTcT4yjTdZNJEiPSykk1bjZX6HeD/WQJ1zUApgq2w+etcsniBuAVlH9vELOx6Yo1VywgkmTB4X1kEGGhyAtg/Ecq3NNqnknDwVTrNBaactEts88OHs5b8Bw/Tof4M+kr4WrwwhoL9n5uRPWhxWwsxPEl+EGNMacP5I8evCPGgVgqKSFgoWCoQqE5hc9WCgYqkBoftGDeSiYz1/+UJLe+foftvh2A2B1fwQIrapkaFoDcK4PVyH0qVnyU4fjGdW4NQ2WlgDE5hLkMoJmQdh9zW9Dk59K5lhtLjyE01TX/jDILP5MGEbvbFPOJroIXvc5PjvTBbx7GM4vAjjd9WdSc2g/IPaqaTv5Aq58haP1TSb2Au20GGErvgTxIqiTAA7tVSnn+2Z9vAXdCsa4bD6Nsf0C/gYA5PMzcW0AAAAASUVORK5CYII=";function At(l){return T.post({url:"/file/addCate",params:l})}function Et(l){return T.post({url:"/file/editCate",params:l})}function Rt(l){return T.post({url:"/file/delCate",params:l})}function zt(l){return T.get({url:"/file/listCate",params:l})}function It(l){return T.get({url:"/file/lists",params:l})}function Dt(l){return T.post({url:"/file/delete",params:l})}function Pt(l){return T.post({url:"/file/move",params:l})}function Tt(l){return T.post({url:"/file/rename",params:l})}function $t(l){const A=O(),g=I([]),p=I(""),h=async()=>{const i=await zt({page_type:0,type:l}),w=[{name:"全部",id:""},{name:"未分组",id:0}];g.value=i.lists,g.value.unshift(...w),setTimeout(()=>{var r;(r=A.value)==null||r.setCurrentKey(p.value)},0)};return{treeRef:A,cateId:p,cateLists:g,handleAddCate:async i=>{await At({type:l,name:i,pid:0}),h()},handleEditCate:async(i,w)=>{await Et({id:w,name:i}),h()},handleDeleteCate:async i=>{await Ve.confirm("确定要删除？"),await Rt({id:i}),p.value="",h()},getCateLists:h,handleCatSelect:i=>{p.value=i.id}}}function Ft(l,A,g,p){const h=O(),b=I("normal"),y=I(0),d=I([]),S=I(!1),i=I(!1),w=Ee({name:"",type:A,cid:l}),{pager:r,getLists:D,resetPage:j}=Ct({fetchFun:It,params:w,firstLoading:!0,size:p}),L=()=>{D()},H=()=>{j()},ee=c=>!!d.value.find(m=>m.id==c),te=async c=>{await Ve.confirm("确认删除后，本地或云存储文件也将同步删除，如文件已被使用，请谨慎操作！");const m=c||d.value.map(U=>U.id);await Dt({ids:m}),L(),E()},le=async()=>{const c=d.value.map(m=>m.id);await Pt({ids:c,cid:y.value}),y.value=0,L(),E()},P=c=>{const m=d.value.findIndex(U=>U.id==c.id);if(m!=-1){d.value.splice(m,1);return}if(d.value.length==g.value){if(g.value==1){d.value=[],d.value.push(c);return}We.warning("已达到选择上限");return}d.value.push(c)},E=()=>{d.value=[]};return{listShowType:b,tableRef:h,moveId:y,pager:r,fileParams:w,select:d,isCheckAll:S,isIndeterminate:i,getFileList:L,refresh:H,batchFileDelete:te,batchFileMove:le,selectFile:P,isSelect:ee,clearSelect:E,cancelSelete:c=>{d.value=d.value.filter(m=>m.id!=c)},selectAll:c=>{var m;if(i.value=!1,(m=h.value)==null||m.toggleAllSelection(),c){d.value=[...r.lists];return}E()},handleFileRename:async(c,m)=>{await Tt({id:m,name:c}),L()}}}const Lt=J({props:{uri:{type:String},fileSize:{type:String,default:"100px"},type:{type:String,default:"image"}},emits:["close"]});const Ut=["src"],jt={key:2,class:"absolute left-1/2 top-1/2 translate-x-[-50%] translate-y-[-50%] rounded-full w-5 h-5 flex justify-center items-center bg-[rgba(0,0,0,0.3)]"};function Bt(l,A,g,p,h,b){const y=Ge,d=Ae;return s(),f("div",null,[o("div",{class:"file-item relative",style:ze({height:l.fileSize,width:l.fileSize})},[l.type=="image"?(s(),z(y,{key:0,class:"image",fit:"contain",src:l.uri},null,8,["src"])):l.type=="video"?(s(),f("video",{key:1,class:"video",src:l.uri},null,8,Ut)):v("",!0),l.type=="video"?(s(),f("div",jt,[n(d,{name:"el-icon-CaretRight",size:18,color:"#fff"})])):v("",!0),mt(l.$slots,"default",{},void 0,!0)],4)])}const de=Ie(Lt,[["render",Bt],["__scopeId","data-v-ec4ebd66"]]),X=l=>(gt("data-v-51a98951"),l=l(),yt(),l),Mt={class:"material"},Nt={class:"material__left"},Wt={class:"flex-1 min-h-0"},Gt={class:"material-left__content pt-4 p-b-4"},Yt={class:"flex flex-1 items-center min-w-0 pr-4"},qt=X(()=>o("img",{class:"w-[20px] h-[16px] mr-3",src:Vt},null,-1)),Kt={class:"flex-1 truncate mr-2"},Zt=X(()=>o("span",{class:"muted m-r-10"},"···",-1)),Qt=["onClick"],Jt={class:"flex justify-center p-2 border-t border-br"},Ot={class:"material__center flex flex-col"},Xt={class:"operate-btn flex"},Ht={class:"flex-1 flex"},el=X(()=>o("span",{class:"mr-5"},"移动文件至",-1)),tl={class:"flex items-center ml-2"},ll={key:0,class:"mt-3"},nl={class:"material-center__content flex flex-col flex-1 mb-1 min-h-0"},al={class:"file-list flex flex-wrap mt-4"},ol={key:0,class:"item-selected"},sl={class:"operation-btns flex items-center"},il={class:"inline-block"},dl={class:"inline-block"},cl={class:"inline-block"},rl={key:1,class:"flex flex-1 justify-center items-center"},ul={class:"material-center__footer flex justify-between items-center mt-2"},fl={class:"flex"},ml={class:"mr-3"},pl=X(()=>o("span",{class:"mr-5"},"移动文件至",-1)),_l={key:0,class:"material__right"},vl={class:"flex justify-between p-2 flex-wrap"},hl={class:"sm flex items-center"},gl={key:0},yl={class:"flex-1 min-h-0"},Cl={class:"select-lists flex flex-col p-t-3"},kl={class:"select-item"},bl=J({__name:"index",props:{fileSize:{type:String,default:"100px"},limit:{type:Number,default:1},type:{type:String,default:"image"},mode:{type:String,default:"picker"},pageSize:{type:Number,default:15}},emits:["change"],setup(l,{expose:A,emit:g}){const p=l,h=g,{limit:b}=pt(p),y=Re(()=>{switch(p.type){case"image":return 10;case"video":return 20;case"file":return 30;default:return 0}}),d=_t("visible"),S=I(""),i=I(!1),{treeRef:w,cateId:r,cateLists:D,handleAddCate:j,handleEditCate:L,handleDeleteCate:H,getCateLists:ee,handleCatSelect:te}=$t(y.value),{tableRef:le,listShowType:P,moveId:E,pager:x,fileParams:N,select:R,isCheckAll:c,isIndeterminate:m,getFileList:U,refresh:B,batchFileDelete:W,batchFileMove:re,selectFile:ne,isSelect:ue,clearSelect:fe,cancelSelete:De,selectAll:me,handleFileRename:pe}=Ft(r,y,b,p.pageSize),_e=async()=>{var V;await ee(),(V=w.value)==null||V.setCurrentKey(r.value),U()},ae=V=>{S.value=V,i.value=!0};return Z(d,async V=>{V&&_e()},{immediate:!0}),Z(r,()=>{N.name="",B()}),Z(R,V=>{if(h("change",V),V.length==x.lists.length&&V.length!==0){m.value=!1,c.value=!0;return}V.length>0?m.value=!0:(c.value=!1,m.value=!1)},{deep:!0}),vt(()=>{p.mode=="page"&&_e()}),A({clearSelect:fe}),(V,u)=>{const ve=dt,he=Ye,G=ut,Pe=qe,Te=Ke,$e=Ze,oe=Qe,C=Je,ge=rt,ye=Oe,Ce=Xe,ke=ct,Y=Ae,Fe=He,be=et,se=tt,we=it,M=lt,Le=nt,Ue=at,je=st,Be=ot;return Q((s(),f("div",Mt,[o("div",Nt,[o("div",Wt,[n(oe,null,{default:a(()=>[o("div",Gt,[n($e,{ref_key:"treeRef",ref:w,"node-key":"id",data:e(D),"empty-text":"''","highlight-current":!0,"expand-on-click-node":!1,"current-node-key":e(r),onNodeClick:e(te)},{default:a(({data:t})=>[o("div",Yt,[qt,o("span",Kt,[n(ve,{content:t.name},null,8,["content"])]),t.id>0?(s(),z(Te,{key:0,"hide-on-click":!1},{dropdown:a(()=>[n(Pe,null,{default:a(()=>[n(G,{onConfirm:k=>e(L)(k,t.id),size:"default",value:t.name,width:"400px",limit:20,"show-limit":"",teleported:""},{default:a(()=>[o("div",null,[n(he,null,{default:a(()=>[_(" 命名分组 ")]),_:1})])]),_:2},1032,["onConfirm","value"]),o("div",{onClick:k=>e(H)(t.id)},[n(he,null,{default:a(()=>[_("删除分组")]),_:1})],8,Qt)]),_:2},1024)]),default:a(()=>[Zt]),_:2},1024)):v("",!0)])]),_:1},8,["data","current-node-key","onNodeClick"])])]),_:1})]),o("div",Jt,[n(G,{onConfirm:e(j),size:"default",width:"400px",limit:20,"show-limit":"",teleported:""},{default:a(()=>[n(C,null,{default:a(()=>[_(" 添加分组 ")]),_:1})]),_:1},8,["onConfirm"])])]),o("div",Ot,[o("div",Xt,[o("div",Ht,[l.type=="image"?(s(),z(ge,{key:0,class:"mr-3",data:{cid:e(r)},type:l.type,"show-progress":!0,onChange:e(B)},{default:a(()=>[n(C,{type:"primary"},{default:a(()=>[_("本地上传")]),_:1})]),_:1},8,["data","type","onChange"])):v("",!0),l.type=="video"?(s(),z(ge,{key:1,class:"mr-3",data:{cid:e(r)},type:l.type,"show-progress":!0,onChange:e(B)},{default:a(()=>[n(C,{type:"primary"},{default:a(()=>[_("本地上传")]),_:1})]),_:1},8,["data","type","onChange"])):v("",!0),l.mode=="page"?(s(),z(C,{key:2,disabled:!e(R).length,onClick:u[0]||(u[0]=q(t=>e(W)(),["stop"]))},{default:a(()=>[_(" 删除 ")]),_:1},8,["disabled"])):v("",!0),l.mode=="page"?(s(),z(ke,{key:3,class:"ml-3",onConfirm:e(re),disabled:!e(R).length,title:"移动文件"},{trigger:a(()=>[n(C,{disabled:!e(R).length},{default:a(()=>[_("移动")]),_:1},8,["disabled"])]),default:a(()=>[o("div",null,[el,n(Ce,{modelValue:e(E),"onUpdate:modelValue":u[1]||(u[1]=t=>F(E)?E.value=t:null),placeholder:"请选择"},{default:a(()=>[(s(!0),f($,null,K(e(D),t=>(s(),f($,{key:t.id},[t.id!==""?(s(),z(ye,{key:0,label:t.name,value:t.id},null,8,["label","value"])):v("",!0)],64))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm","disabled"])):v("",!0)]),n(Fe,{class:"w-60",placeholder:"请输入名称",modelValue:e(N).name,"onUpdate:modelValue":u[2]||(u[2]=t=>e(N).name=t),onKeyup:ht(e(B),["enter"])},{append:a(()=>[n(C,{onClick:e(B)},{icon:a(()=>[n(Y,{name:"el-icon-Search"})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeyup"]),o("div",tl,[n(be,{content:"列表视图",placement:"top"},{default:a(()=>[o("div",{class:Se(["list-icon",{select:e(P)=="table"}]),onClick:u[3]||(u[3]=t=>P.value="table")},[n(Y,{name:"local-icon-list-2",size:18})],2)]),_:1}),n(be,{content:"平铺视图",placement:"top"},{default:a(()=>[o("div",{class:Se(["list-icon",{select:e(P)=="normal"}]),onClick:u[4]||(u[4]=t=>P.value="normal")},[n(Y,{name:"el-icon-Menu",size:18})],2)]),_:1})])]),l.mode=="page"?(s(),f("div",ll,[n(se,{disabled:!e(x).lists.length,modelValue:e(c),"onUpdate:modelValue":u[5]||(u[5]=t=>F(c)?c.value=t:null),onChange:e(me),indeterminate:e(m)},{default:a(()=>[_(" 当页全选 ")]),_:1},8,["disabled","modelValue","onChange","indeterminate"])])):v("",!0),o("div",nl,[e(x).lists.length?Q((s(),z(oe,{key:0},{default:a(()=>[o("ul",al,[(s(!0),f($,null,K(e(x).lists,t=>(s(),f("li",{class:"file-item-wrap",key:t.id,style:ze({width:l.fileSize})},[n(we,{onClose:k=>e(W)([t.id])},{default:a(()=>[n(de,{uri:t.uri,"file-size":l.fileSize,type:l.type,onClick:k=>e(ne)(t)},{default:a(()=>[e(ue)(t.id)?(s(),f("div",ol,[n(Y,{size:24,name:"el-icon-Check",color:"#fff"})])):v("",!0)]),_:2},1032,["uri","file-size","type","onClick"])]),_:2},1032,["onClose"]),n(ve,{class:"mt-1",content:t.name},null,8,["content"]),o("div",sl,[n(G,{onConfirm:k=>e(pe)(k,t.id),size:"default",value:t.name,width:"400px",limit:50,"show-limit":"",teleported:""},{default:a(()=>[n(C,{type:"primary",link:""},{default:a(()=>[_(" 重命名 ")]),_:1})]),_:2},1032,["onConfirm","value"]),n(C,{type:"primary",link:"",onClick:k=>ae(t.uri)},{default:a(()=>[_(" 查看 ")]),_:2},1032,["onClick"])])],4))),128))])]),_:1},512)),[[ce,e(P)=="normal"]]):v("",!0),Q(n(Ue,{ref_key:"tableRef",ref:le,class:"mt-4",data:e(x).lists,width:"100%",height:"100%",size:"large",onRowClick:e(ne)},{default:a(()=>[n(M,{width:"55"},{default:a(({row:t})=>[n(se,{modelValue:e(ue)(t.id),onChange:k=>e(ne)(t)},null,8,["modelValue","onChange"])]),_:1}),n(M,{label:"图片",width:"100"},{default:a(({row:t})=>[n(de,{uri:t.uri,"file-size":"50px",type:l.type},null,8,["uri","type"])]),_:1}),n(M,{label:"名称","min-width":"100","show-overflow-tooltip":""},{default:a(({row:t})=>[n(Le,{onClick:q(k=>ae(t.uri),["stop"]),underline:!1},{default:a(()=>[_(ie(t.name),1)]),_:2},1032,["onClick"])]),_:1}),n(M,{prop:"create_time",label:"上传时间","min-width":"100"}),n(M,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[o("div",il,[n(G,{onConfirm:k=>e(pe)(k,t.id),size:"default",value:t.name,width:"400px",limit:50,"show-limit":"",teleported:""},{default:a(()=>[n(C,{type:"primary",link:""},{default:a(()=>[_(" 重命名 ")]),_:1})]),_:2},1032,["onConfirm","value"])]),o("div",dl,[n(C,{type:"primary",link:"",onClick:q(k=>ae(t.uri),["stop"])},{default:a(()=>[_(" 查看 ")]),_:2},1032,["onClick"])]),o("div",cl,[n(C,{type:"primary",link:"",onClick:q(k=>e(W)([t.id]),["stop"])},{default:a(()=>[_(" 删除 ")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data","onRowClick"]),[[ce,e(P)=="table"]]),!e(x).loading&&!e(x).lists.length?(s(),f("div",rl," 暂无数据~ ")):v("",!0)]),o("div",ul,[o("div",fl,[l.mode=="page"?(s(),f($,{key:0},[o("span",ml,[n(se,{disabled:!e(x).lists.length,modelValue:e(c),"onUpdate:modelValue":u[6]||(u[6]=t=>F(c)?c.value=t:null),onChange:e(me),indeterminate:e(m)},{default:a(()=>[_(" 当页全选 ")]),_:1},8,["disabled","modelValue","onChange","indeterminate"])]),n(C,{disabled:!e(R).length,onClick:u[7]||(u[7]=t=>e(W)())},{default:a(()=>[_(" 删除 ")]),_:1},8,["disabled"]),n(ke,{class:"ml-3 inline",onConfirm:e(re),disabled:!e(R).length,title:"移动文件"},{trigger:a(()=>[n(C,{disabled:!e(R).length},{default:a(()=>[_("移动")]),_:1},8,["disabled"])]),default:a(()=>[o("div",null,[pl,n(Ce,{modelValue:e(E),"onUpdate:modelValue":u[8]||(u[8]=t=>F(E)?E.value=t:null),placeholder:"请选择"},{default:a(()=>[(s(!0),f($,null,K(e(D),t=>(s(),f($,{key:t.id},[t.id!==""?(s(),z(ye,{key:0,label:t.name,value:t.id},null,8,["label","value"])):v("",!0)],64))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm","disabled"])],64)):v("",!0)]),n(je,{modelValue:e(x),"onUpdate:modelValue":u[9]||(u[9]=t=>F(x)?x.value=t:null),onChange:e(U),layout:"total, prev, pager, next, jumper"},null,8,["modelValue","onChange"])])]),l.mode=="picker"?(s(),f("div",_l,[o("div",vl,[o("div",hl,[_(" 已选择 "+ie(e(R).length)+" ",1),e(b)?(s(),f("span",gl,"/"+ie(e(b)),1)):v("",!0)]),n(C,{type:"primary",link:"",onClick:e(fe)},{default:a(()=>[_("清空")]),_:1},8,["onClick"])]),o("div",yl,[n(oe,{class:"ls-scrollbar"},{default:a(()=>[o("ul",Cl,[(s(!0),f($,null,K(e(R),t=>(s(),f("li",{class:"mb-4",key:t.id},[o("div",kl,[n(we,{onClose:k=>e(De)(t.id)},{default:a(()=>[n(de,{uri:t.uri,"file-size":"100px",type:l.type},null,8,["uri","type"])]),_:2},1032,["onClose"])])]))),128))])]),_:1})])])):v("",!0),n(St,{modelValue:e(i),"onUpdate:modelValue":u[10]||(u[10]=t=>F(i)?i.value=t:null),url:e(S),type:l.type},null,8,["modelValue","url","type"])])),[[Be,e(x).loading]])}}});const Tl=Ie(bl,[["__scopeId","data-v-51a98951"]]);export{de as F,Tl as _,St as a};
