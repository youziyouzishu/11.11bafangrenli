import{T as G,E as J}from"./@wangeditor-6af644b9.js";import{F as K,_ as R,a as T}from"./index-4f4d97b3.js";import{P as A}from"./index-943d816c.js";import{E as Q}from"./element-plus-69d92160.js";import{u as X,b as Y,e as S}from"./index-90bac5cf.js";import{_ as Z}from"./index-8d613ba7.js";import{D as x}from"./vuedraggable-93e8938c.js";import{d as D,r as n,ba as ee,b as V,b7 as le,w as oe,b1 as z,aq as I,o as F,c as L,M as i,I as ae,aR as b,a as d,aW as $,ae as B,L as te,aT as se,ap as ie,ag as N,aP as ne,ak as de,aj as re,b5 as E,b4 as ue,a_ as _,b0 as pe}from"./@vue-a164be7a.js";import{d as me}from"./@vueuse-ebd2cc93.js";import{_ as fe}from"./@tencentcloud-7fc831ec.js";const ce=D({components:{Popup:A,Draggable:x,FileItem:K,Material:R,Preview:T},props:{modelValue:{type:[String,Array],default:()=>[]},type:{type:String,default:"image"},size:{type:String,default:"100px"},fileSize:{type:String,default:"100px"},limit:{type:Number,default:1},disabled:{type:Boolean,default:!1},hiddenUpload:{type:Boolean,default:!1},uploadClass:{type:String,default:""},excludeDomain:{type:Boolean,default:!1}},emits:["change","update:modelValue"],setup(e,{emit:s}){const p=n(),y=n(),m=n(""),f=n(!1),t=n([]),r=n([]),u=n(!0),h=n(-1),{disabled:c,limit:v,modelValue:w}=ee(e),{getImageUrl:a}=X(),o=V(()=>{switch(e.type){case"image":return"图片";case"video":return"视频";default:return""}}),g=V(()=>e.limit-t.value.length>0),U=V(()=>u.value?v.value==-1?null:v.value-t.value.length:1),O=me(()=>{const l=r.value.map(C=>e.excludeDomain?C.url:C.uri);u.value?t.value=[...t.value,...l]:t.value.splice(h.value,1,l.shift()),P()},1e3,!1),j=l=>{var C;c.value||(l>=0?(u.value=!1,h.value=l):u.value=!0,(C=p.value)==null||C.open())},q=l=>{r.value=l},P=()=>{const l=v.value!=1?t.value:t.value[0]||"";s("update:modelValue",l),s("change",l),k()},H=l=>{t.value.splice(l,1),P()},W=l=>{m.value=l,f.value=!0},k=()=>{le(()=>{var l;e.hiddenUpload&&(t.value=[]),(l=y.value)==null||l.clearSelect()})};return oe(w,l=>{t.value=Array.isArray(l)?l:l==""?[]:[l]},{immediate:!0}),z("limit",e.limit),z("hiddenUpload",e.hiddenUpload),{popupRef:p,materialRef:y,fileList:t,tipsText:o,handleConfirm:O,meterialLimit:U,showUpload:g,showPopup:j,selectChange:q,deleteImg:H,previewUrl:m,showPreview:f,handlePreview:W,handleClose:k,getImageUrl:a}}});const M=e=>(de("data-v-4624db3d"),e=e(),re(),e),ve={class:"material-select"},he=["onClick"],ge={class:"operation-btns text-xs text-center"},_e=M(()=>d("span",null,"修改",-1)),ye=["onClick"],we=M(()=>d("span",null,"添加",-1)),Ce={class:"material-wrap"};function be(e,s,p,y,m,f){const t=I("file-item"),r=Z,u=I("draggable"),h=Y,c=R,v=Q,w=A,a=T;return F(),L("div",ve,[i(w,{ref:"popupRef",width:"830px","custom-class":"body-padding",title:`选择${e.tipsText}`,onConfirm:e.handleConfirm,onClose:e.handleClose},ae({default:b(()=>[i(v,null,{default:b(()=>[d("div",Ce,[i(c,{ref:"materialRef",type:e.type,"file-size":e.fileSize,limit:e.meterialLimit,onChange:e.selectChange},null,8,["type","file-size","limit","onChange"])])]),_:1})]),_:2},[e.hiddenUpload?void 0:{name:"trigger",fn:b(()=>[d("div",{class:"material-select__trigger clearfix",onClick:s[2]||(s[2]=$(()=>{},["stop"]))},[i(u,{class:"draggable",modelValue:e.fileList,"onUpdate:modelValue":s[0]||(s[0]=o=>e.fileList=o),animation:"300","item-key":"id"},{item:b(({element:o,index:g})=>[d("div",{class:B(["material-preview",{"is-disabled":e.disabled,"is-one":e.limit==1}]),onClick:U=>e.showPopup(g)},[i(r,{onClose:U=>e.deleteImg(g)},{default:b(()=>[i(t,{uri:e.excludeDomain?e.getImageUrl(o):o,"file-size":e.size,type:e.type},null,8,["uri","file-size","type"])]),_:2},1032,["onClose"]),d("div",ge,[_e,te(" | "),d("span",{onClick:$(U=>e.handlePreview(o),["stop"])},"查看",8,ye)])],10,he)]),_:1},8,["modelValue"]),se(d("div",{class:B(["material-upload",{"is-disabled":e.disabled,"is-one":e.limit==1,[e.uploadClass]:!0}]),onClick:s[1]||(s[1]=o=>e.showPopup(-1))},[ie(e.$slots,"upload",{},()=>[d("div",{class:"upload-btn",style:N({width:e.size,height:e.size})},[i(h,{size:25,name:"el-icon-Plus"}),we],4)],!0)],2),[[ne,e.showUpload]])])]),key:"0"}]),1032,["title","onConfirm","onClose"]),i(a,{modelValue:e.showPreview,"onUpdate:modelValue":s[3]||(s[3]=o=>e.showPreview=o),url:e.previewUrl,type:e.type},null,8,["modelValue","url","type"])])}const Ve=fe(ce,[["render",be],["__scopeId","data-v-4624db3d"]]),Te=D({__name:"index",props:{modelValue:{default:""},mode:{default:"default"},height:{default:"100%"},width:{default:"auto"},toolbarConfig:{default:()=>({})}},emits:["update:modelValue"],setup(e,{emit:s}){const p=e,y=s,m=E(),f=E(),t=n("");let r;const u={MENU_CONF:{uploadImage:{customBrowseAndUpload(a){var o;t.value="image",(o=f.value)==null||o.showPopup(-1),r=a}},uploadVideo:{customBrowseAndUpload(a){var o;t.value="video",(o=f.value)==null||o.showPopup(-1),r=a}}}},h=V(()=>({height:S(p.height),width:S(p.width)})),c=V({get(){return p.modelValue},set(a){y("update:modelValue",a)}}),v=a=>{a.forEach(o=>{r(o)})};ue(()=>{const a=m.value;a!=null&&a.destroy()});const w=a=>{m.value=a};return(a,o)=>(F(),L("div",{class:"border border-br flex flex-col",style:N(_(h))},[i(_(G),{class:"border-b border-br",editor:_(m),defaultConfig:a.toolbarConfig,mode:a.mode},null,8,["editor","defaultConfig","mode"]),i(_(J),{class:"overflow-y-auto flex-1",modelValue:_(c),"onUpdate:modelValue":o[0]||(o[0]=g=>pe(c)?c.value=g:null),defaultConfig:u,mode:a.mode,onOnCreated:w},null,8,["modelValue","mode"]),i(Ve,{ref_key:"materialPickerRef",ref:f,type:_(t),limit:-1,"hidden-upload":"",onChange:v},null,8,["type"])],4))}});export{Te as _};
