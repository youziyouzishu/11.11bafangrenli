import{W as U,X as _,D as P}from"./element-plus-69d92160.js";import{a as V,i as p,R as S,f as m}from"./index-90bac5cf.js";import{d as A,b5 as L,r as f,b as k,bh as D,o as d,c as g,M as C,aR as $,ap as N,x as j,a as h,F as I,ao as q,aB as M,y as O}from"./@vue-a164be7a.js";import{_ as W}from"./@tencentcloud-7fc831ec.js";const X=A({components:{},props:{type:{type:String,default:"image"},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},showProgress:{type:Boolean,default:!1}},emits:["change","error","success"],setup(e,{emit:a}){const v=V(),n=L(),E=f(`${p.baseUrl}${p.urlPrefix}/upload/${e.type}`),b=k(()=>({token:v.token,version:p.version})),o=f(!1),c=f([]),i=(s,l,r)=>{o.value=!0,c.value=D(r)},t=(s,l,r)=>{var y;r.every(R=>R.status=="success")&&((y=n.value)==null||y.clearFiles(),o.value=!1),a("change",l),s.code==S.SUCCESS&&a("success",s),s.code==S.FAIL&&s.msg&&m.msgError(s.msg)},u=(s,l)=>{var r;m.msgError(`${l.name}文件上传失败`),(r=n.value)==null||r.abort(l),o.value=!1,a("change",l),a("error",l)},w=()=>{m.msgError(`超出上传上限${e.limit}，请重新上传`)},B=()=>{var s;(s=n.value)==null||s.clearFiles(),o.value=!1},F=k(()=>{switch(e.type){case"image":return".jpg,.png,.gif,.jpeg";case"video":return".wmv,.avi,.mpg,.mpeg,.3gp,.mov,.mp4,.flv,.rmvb,.mkv";case"doc":return".doc,.docx,.pdf";default:return"*"}});return{uploadRefs:n,action:E,headers:b,visible:o,fileList:c,getAccept:F,handleProgress:i,handleSuccess:t,handleError:u,handleExceed:w,handleClose:B}}}),z={class:"upload"},G={class:"file-list p-4"},H={class:"flex-1"};function J(e,a,v,n,E,b){const o=U,c=_,i=P;return d(),g("div",z,[C(o,{ref:"uploadRefs",action:e.action,multiple:e.multiple,limit:e.limit,"show-file-list":!1,headers:e.headers,data:e.data,"on-progress":e.handleProgress,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,"on-error":e.handleError,accept:e.getAccept},{default:$(()=>[N(e.$slots,"default")]),_:3},8,["action","multiple","limit","headers","data","on-progress","on-success","on-exceed","on-error","accept"]),e.showProgress&&e.fileList.length?(d(),j(i,{key:0,modelValue:e.visible,"onUpdate:modelValue":a[0]||(a[0]=t=>e.visible=t),title:"上传进度","close-on-click-modal":!1,width:"500px",modal:!1,onClose:e.handleClose},{default:$(()=>[h("div",G,[(d(!0),g(I,null,q(e.fileList,(t,u)=>(d(),g("div",{key:u,class:"mb-5"},[h("div",null,M(t.name),1),h("div",H,[C(c,{percentage:parseInt(t.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue","onClose"])):O("",!0)])}const x=W(X,[["render",J]]);export{x as U};
