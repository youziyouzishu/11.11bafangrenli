import{d as ue,r as b,b6 as pe,aZ as ge,a$ as de,o as m,c as u,a as k,ag as fe,a_ as a,F as he,ao as ve,M as p,ae as M,aW as I,aT as we,aP as ye,y as T,aB as N}from"./@vue-a164be7a.js";import"./adapter-vue-24f22062.js";import{z as _,w as be,i as g,_ as ke}from"./@tencentcloud-7fc831ec.js";import d from"./Icon-2c0593f3.js";import{c as Ie}from"./icon-close-7ee462f2.js";import{_ as Te}from"./image-item.vue_vue_type_style_index_0_lang-58c86db8.js";import{T as L}from"./index-cfdb213d.js";import{c as _e,a as f,d as W}from"./env-a593fd1d.js";import{T as R}from"./index-e4ac2ab7.js";import"./tim-upload-plugin-4412696f.js";import"./tim-profanity-filter-plugin-a7e08ee8.js";import"./vue-84471dcb.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-6995d964.js";import"./trtc-sdk-v5-5ba82a9e.js";import"./pinia-ec219911.js";import"./mitt-f7ef348c.js";import"./interactjs-0d94d9f4.js";import"./rtc-detect-b2f0fa0a.js";import"./tuicall-engine-webrtc-9ec0a575.js";const Z="/admin/assets/icon-arrow-left-af0c0bb9.svg",Le="/admin/assets/zoom-in-c967ceef.svg",Re="/admin/assets/zoom-out-862aabb4.svg",Xe="/admin/assets/rotate-left-6ff9e83b.svg",xe="/admin/assets/rotate-right-161115e3.svg",Ee="/admin/assets/download-a9b7471d.svg",Ye={class:"image-counter"},Ce=ue({__name:"index",props:{imageList:{default:()=>[]},currentImage:{}},emits:["close"],setup(B,{emit:$}){const h=B,Y=new Map([[1,"jpg"],[2,"gif"],[3,"png"],[4,"bmp"]]),V=$,r=b(1),X=b(0),D=b(.1),l=b(0),j=b(),H=b();let F=0;const n={};let C=!1,x=!1,w=null;pe(()=>{l.value=h.imageList.findIndex(e=>{var t;return e.ID===((t=h==null?void 0:h.currentImage)==null?void 0:t.ID)})});const y=e=>typeof e=="number"&&isFinite(e),K=e=>{e.preventDefault(),ee(e),te(e)},q=e=>{e.preventDefault(),C=!0,e.touches&&e.touches.length===2&&(x=!0,oe(e))},G=e=>{var s;e.preventDefault(),e.stopPropagation();let t=0,o=0;if(x){w||(x=!1,delete n.pageX2,delete n.pageY2,w=setTimeout(()=>{w=null},200));return}if(w===null){switch(C){case!0:t=(s=e==null?void 0:e.changedTouches[0])==null?void 0:s.pageX,o=t-F,o>100?A():o<-100&&O();break;case!1:S();break}w=setTimeout(()=>{w=null},200)}},J=()=>{x=!1,delete n.pageX1,delete n.pageY1},Q=e=>{if(e.preventDefault(),Math.abs(e.deltaX)!==0&&Math.abs(e.deltaY)!==0)return;let t=r.value;t+=e.deltaY*(e.ctrlKey?-.01:.002),t=Math.min(Math.max(.125,t),4),r.value=t},ee=e=>{var t;F=(t=e==null?void 0:e.changedTouches[0])==null?void 0:t.pageX,C=!1},te=e=>{const t=e==null?void 0:e.touches[0],o=e==null?void 0:e.touches[1];n.pageX1=t==null?void 0:t.pageX,n.pageY1=t==null?void 0:t.pageY,o&&(n.pageX2=o==null?void 0:o.pageX,n.pageY2=o==null?void 0:o.pageY)},oe=e=>{const t=e==null?void 0:e.touches[0],o=e==null?void 0:e.touches[1];o&&(y(n.pageX2)||(n.pageX2=o.pageX),y(n.pageY2)||(n.pageY2=o.pageY));const s=(i,v,E,me)=>Math.hypot(E-i,me-v);if(!y(n.pageX1)||!y(n.pageY1)||!y(n.pageX2)||!y(n.pageY2))return;const c=s(t.pageX,t.pageY,o.pageX,o.pageY)/s(n.pageX1,n.pageY1,n.pageX2,n.pageY2);r.value=Math.min(Math.max(.5,r.value*c),4)};ge(()=>{document!=null&&document.addEventListener&&(document==null||document.addEventListener("keydown",P))});const P=e=>{e.preventDefault(),(e==null?void 0:e.keyCode)===27&&S()},ae=()=>{r.value+=.1},ne=()=>{r.value=r.value-.1>D.value?r.value-.1:D.value},S=()=>{V("close")},se=()=>{X.value-=90},ie=()=>{X.value+=90},O=()=>{l.value<h.imageList.length-1&&l.value++,U()},A=()=>{l.value>0&&l.value--,U()},U=()=>{r.value=1,X.value=0},le=e=>{var t,o,s,c;return f?(o=(t=e==null?void 0:e.payload)==null?void 0:t.imageInfoArray[0])==null?void 0:o.url:(c=(s=e==null?void 0:e.payload)==null?void 0:s.imageInfoArray[2])==null?void 0:c.url},ce=()=>{var o,s;const e=h.imageList[l.value],t=(s=(o=e==null?void 0:e.payload)==null?void 0:o.imageInfoArray[0])==null?void 0:s.url;if(!t){L({message:_.t("component.图片 url 不存在"),type:R.ERROR});return}switch(be()){case"wechat":g.getSetting({success:c=>{c!=null&&c.authSetting["scope.writePhotosAlbum"]?z(t):g.authorize({scope:"scope.writePhotosAlbum",success(){z(t)},fail(){g.showModal({title:"您已拒绝获取相册权限",content:"是否进入权限管理，调整授权？",success:i=>{if(i.confirm)g.openSetting({success:v=>{console.log(v.authSetting)}});else if(i.cancel)return L({message:_.t("component.已取消"),type:R.ERROR})}})}})},fail:()=>{L({message:_.t("component.获取权限失败"),type:R.ERROR})}});break;case"app":z(t);break;default:re(t);break}},z=e=>{g.showLoading({title:"大图提取中"}),g.downloadFile({url:e,success:function(t){g.hideLoading(),g.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:()=>{L({message:_.t("component.已保存至相册"),type:R.SUCCESS})}})},fail:function(){g.hideLoading(),L({message:_.t("component.图片下载失败"),type:R.ERROR})}})},re=e=>{var c;const t={mode:"cors",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})},o=h.imageList[l.value],s=(c=o==null?void 0:o.payload)==null?void 0:c.imageFormat;if(!Y.has(s)){L({message:_.t("component.暂不支持下载此类型图片"),type:R.ERROR});return}if(window.fetch)fetch(e,t).then(i=>i.blob()).then(i=>{const v=document.createElement("a"),E=window.URL.createObjectURL(i);v.href=E,v.download=E+"."+Y.get(s),v.click()});else{const i=document.createElement("a");i.href=e,i.target="_blank",i.download=e+"."+Y.get(s),i.click()}};return de(()=>{document!=null&&document.removeEventListener&&(document==null||document.removeEventListener("keydown",P))}),(e,t)=>(m(),u("div",{class:M(["image-previewer",[a(W)&&"image-previewer-h5"]])},[k("div",{ref_key:"image",ref:j,class:"image-wrapper",onTouchstart:I(K,["stop"]),onTouchmove:I(q,["stop"]),onTouchend:I(G,["stop"]),onTouchcancel:I(J,["stop"]),onWheel:I(Q,["stop"])},[k("ul",{ref_key:"ulRef",ref:H,class:"image-list",style:fe({width:`${e.imageList.length*100}%`,transform:`translateX(-${a(l)*100/e.imageList.length}%)`,transition:"0.5s"})},[(m(!0),u(he,null,ve(e.imageList,(o,s)=>(m(),u("li",{key:s,class:"image-item"},[p(Te,{zoom:a(r),rotate:a(X),src:le(o),messageItem:o,class:M([a(_e)?"image-item":""])},null,8,["zoom","rotate","src","messageItem","class"])]))),128))],4)],544),we(k("div",{class:"icon icon-close",onClick:S},[p(d,{file:a(Ie),width:"16px",height:"16px"},null,8,["file"])],512),[[ye,a(f)]]),a(f)&&a(l)>0?(m(),u("div",{key:0,class:"image-button image-button-left",onClick:A},[p(d,{file:a(Z)},null,8,["file"])])):T("",!0),a(f)&&a(l)<e.imageList.length-1?(m(),u("div",{key:1,class:"image-button image-button-right",onClick:O},[p(d,{file:a(Z)},null,8,["file"])])):T("",!0),k("div",{class:M(["actions-bar",a(W)&&"actions-bar-h5"])},[a(f)?(m(),u("div",{key:0,class:"icon-zoom-in",onClick:ae},[p(d,{file:a(Le),width:"27px",height:"27px"},null,8,["file"])])):T("",!0),a(f)?(m(),u("div",{key:1,class:"icon-zoom-out",onClick:ne},[p(d,{file:a(Re),width:"27px",height:"27px"},null,8,["file"])])):T("",!0),a(f)?(m(),u("div",{key:2,class:"icon-refresh-left",onClick:se},[p(d,{file:a(Xe),width:"27px",height:"27px"},null,8,["file"])])):T("",!0),a(f)?(m(),u("div",{key:3,class:"icon-refresh-right",onClick:ie},[p(d,{file:a(xe),width:"27px",height:"27px"},null,8,["file"])])):T("",!0),k("span",Ye,N(a(l)+1)+" / "+N(e.imageList.length),1)],2),k("div",{class:"save",onClick:I(ce,["stop","prevent"])},[p(d,{file:a(Ee),width:"20px",height:"20px"},null,8,["file"])])],2))}});const Je=ke(Ce,[["__scopeId","data-v-97c61def"]]);export{Je as default};
