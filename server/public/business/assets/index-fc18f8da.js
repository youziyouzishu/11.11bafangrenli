import"./adapter-vue-20243c9c.js";import{q as f,o as T,z as k,J as Ce,i as ce,_ as ke}from"./@tencentcloud-25a17c42.js";import{S as L,e as De,s as Me,d as we,g as ve}from"./index-fed2cc2c.js";import Ue from"./index-62e29204.js";import he from"./index-e5a643d7.js";import{s as K,a as Y}from"./search-type-list-06b12619.js";import b from"./Icon-fec85db6.js";import{s as pe}from"./search-8a2a0342.js";import{e as xe}from"./right-icon-312a665a.js";import{e as Pe}from"./enableSampleTaskStatus-86998722.js";import{a as w,c as de}from"./env-6b0ecdb8.js";import"./type-96adc8a0.js";import{d as Re,r as v,b as Ee,aU as He,aW as Ne,w as Be,aV as t,o,t as q,a9 as g,c as i,a as u,F as x,aj as P,aw as y,u as _,G as B,af as $e,ae as Ve}from"./@vue-25170201.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./message-abstract-text-e294c4bd.js";import"./index-8f711959.js";import"./index-7638d9aa.js";import"./element-plus-64da2267.js";import"./lodash-es-fbce1780.js";import"./async-validator-dee29e8b.js";import"./@element-plus-9559a6ac.js";import"./dayjs-346d7cd4.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@vueuse-944ef3f4.js";import"./lodash-2cc29f39.js";import"./axios-67477f72.js";import"./vue-router-f7517f62.js";import"./css-color-function-7acc3e97.js";import"./color-9254db0b.js";import"./clone-db6b0f3b.js";import"./color-convert-946e453a.js";import"./color-name-b7949e8c.js";import"./color-string-6fa48439.js";import"./balanced-match-51764fed.js";import"./ms-f6814399.js";import"./nprogress-ccaead9e.js";import"./@tiptap-008a465d.js";import"./prosemirror-state-c544e594.js";import"./prosemirror-model-8b0495eb.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-fc1f2a72.js";import"./prosemirror-view-ef3f9f96.js";import"./prosemirror-keymap-776f822d.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-5c2a1a07.js";import"./prosemirror-schema-list-1c96ec4d.js";import"./vue-clipboard3-f5f9feb9.js";import"./clipboard-3d849c41.js";import"./echarts-d6620a89.js";import"./zrender-9797a04d.js";import"./tslib-54e39b60.js";import"./highlight.js-1b502259.js";import"./@highlightjs-7a15facb.js";import"./path-to-regexp-767716ea.js";import"./constant-bad60a54.js";import"./message-abstract-file-f391c9eb.js";import"./message-abstract-custom-1a52be48.js";import"./type-check-5e73d261.js";import"./star-light-46b224d3.js";import"./message-abstract-image-0e6a77c1.js";import"./message-abstract-video-36f588fb.js";import"./video-play-6934d780.js";import"./index-ebb29dde.js";import"./index-9521edcb.js";import"./index-4fed586a.js";const me=D=>($e("data-v-ba604638"),D=D(),Ve(),D),ze={key:0,class:"tui-search-result-main"},Fe={class:"tui-search-result-list"},Ke={key:0,class:"header"},Ye={class:"list"},qe=["onClick"],Ae={class:"more-text"},Ge={key:1,class:"tui-search-message-header"},Je={class:"header-content"},We={class:"header-content-count normal"},Qe={class:"header-content-keyword"},Xe=me(()=>u("span",{class:"normal"},'"',-1)),Ze={class:"highlight"},Le=me(()=>u("span",{class:"normal"},'"',-1)),be={class:"header-content-type normal"},Oe={key:2,class:"tui-search-message-list"},je={class:g(["list-group-date"])},ea={class:"more-text"},aa=Re({__name:"index",props:{searchType:{type:String,default:"global",validator(D){return["global","conversation"].includes(D)}}},setup(D){var re,le;const r=D,h=v([]),$=v((re=K[r.searchType])==null?void 0:re.value),A=v(0),G=v(0),ye=v("and"),n=v((le=K[r.searchType])==null?void 0:le.key),c=v({}),p=v([]),fe=v(0),S=v(""),M=v(),m=v([]),J=v(),V=v([]),U=v(!1),R=v(!1),E=v(!1),Te=Ee(()=>{var e,s,a;return R.value?!1:r.searchType==="global"?!(!((e=h==null?void 0:h.value)!=null&&e.length)||(s=Object==null?void 0:Object.keys(c.value))!=null&&s.length):!((a=m==null?void 0:m.value)!=null&&a.length)});function O(e){r.searchType==="conversation"&&(S.value=e)}function j(e){(e==null?void 0:e.searchType)===(r==null?void 0:r.searchType)&&(h.value=e!=null&&e.value?e.value.trim().split(/\s+/):[])}function ee(e){var s,a,l,d;(e==null?void 0:e.searchType)===(r==null?void 0:r.searchType)&&(n.value=((s=e==null?void 0:e.value)==null?void 0:s.key)||((a=K[r.searchType])==null?void 0:a.key),$.value=((l=e==null?void 0:e.value)==null?void 0:l.value)||((d=K[r.searchType])==null?void 0:d.value))}function ae(e){var s,a,l,d;(e==null?void 0:e.searchType)===(r==null?void 0:r.searchType)&&(A.value=(a=(s=e==null?void 0:e.value)==null?void 0:s.value)==null?void 0:a.timePosition,G.value=(d=(l=e==null?void 0:e.value)==null?void 0:l.value)==null?void 0:d.timePeriod)}He(()=>{f.watch(T.CONV,{currentConversationID:O}),f.watch(T.SEARCH,{currentSearchInputValue:j,currentSearchMessageType:ee,currentSearchMessageTime:ae})}),Ne(()=>{f.unwatch(T.CONV,{currentConversationID:O}),f.unwatch(T.SEARCH,{currentSearchInputValue:j,currentSearchMessageType:ee,currentSearchMessageTime:ae})});const z=e=>{var s;Me({keywordList:(s=h==null?void 0:h.value)!=null&&s.length?h.value:void 0,messageTypeList:typeof $.value=="string"?[$.value]:$.value,timePosition:A.value,timePeriod:G.value,conversationID:(e==null?void 0:e.conversationID)||void 0,cursor:(e==null?void 0:e.cursor)||void 0,keywordListMatchType:ye.value}).then(a=>{var l,d,I,H,N,C,oe,ne,ie,ue;if(Pe("searchCloudMessage"),e!=null&&e.conversationID)M.value=a==null?void 0:a.data,e!=null&&e.cursor?m.value=[...m.value,...(oe=(C=a==null?void 0:a.data)==null?void 0:C.searchResultList[0])==null?void 0:oe.messageList]:m.value=(ie=(ne=a==null?void 0:a.data)==null?void 0:ne.searchResultList[0])==null?void 0:ie.messageList,J.value=(ue=a==null?void 0:a.data)==null?void 0:ue.totalCount,(r==null?void 0:r.searchType)==="conversation"&&(n.value==="fileMessage"||n.value==="imageMessage")?V.value=Ie(m.value):V.value=[];else{e!=null&&e.cursor?p.value=[...p.value,...a.data.searchResultList]:p.value=(l=a==null?void 0:a.data)==null?void 0:l.searchResultList,fe.value=(d=a==null?void 0:a.data)==null?void 0:d.totalCount;const F=n.value==="all"?"allMessage":n.value;(I=p==null?void 0:p.value)!=null&&I.length&&n.value!=="contact"&&n.value!=="group"?c.value=Object.assign({},c.value,{[F]:{key:F,label:Y[F].label,list:n.value==="all"?(H=p==null?void 0:p.value)==null?void 0:H.slice(0,3):p==null?void 0:p.value,cursor:((N=a==null?void 0:a.data)==null?void 0:N.cursor)||null}}):c==null||delete c.value[F]}R.value=!1,E.value=!1})},te=we(z,500),W=()=>{c.value={},M.value={},m.value=[],V.value=[]};Be(()=>[h.value,n.value,A.value,G.value],(e,s)=>{var a,l,d;if(e!==s){if(!((a=h==null?void 0:h.value)!=null&&a.length)&&(r==null?void 0:r.searchType)==="global"){W();return}if(R.value=!0,r.searchType==="conversation")W(),z({conversationID:S.value});else{if(s&&s[1]==="all"&&e&&e[1]==="allMessage"){(l=c==null?void 0:c.value.allMessage)!=null&&l.list&&(c.value.allMessage.list=p==null?void 0:p.value),(d=Object==null?void 0:Object.keys(c==null?void 0:c.value))==null||d.forEach(I=>{I!=="allMessage"&&(c==null||delete c.value[I])}),R.value=!1;return}else U.value=!1,W();te()}}},{immediate:!0});const ge=e=>{n.value==="all"?f.update(T.SEARCH,"currentSearchMessageType",{value:Y[e.key],searchType:r.searchType}):z({cursor:(e==null?void 0:e.cursor)||void 0})},Se=()=>{var e;z({cursor:(e=M==null?void 0:M.value)==null?void 0:e.cursor,conversationID:S==null?void 0:S.value})},Q=(e,s,a)=>{var l;U.value=e,s&&f.update(T.SEARCH,"currentSearchMessageType",{value:Y[s],searchType:r.searchType}),S.value=((l=a==null?void 0:a.conversation)==null?void 0:l.conversationID)||"",J.value=a==null?void 0:a.messageCount,a&&(E.value=!0,te({conversationID:S.value}))},_e=e=>{var s;return S.value===((s=e==null?void 0:e.conversation)==null?void 0:s.conversationID)?["list-item","list-item-selected"]:["list-item"]},se=()=>r.searchType==="conversation"&&n.value==="fileMessage"?"file":r.searchType==="conversation"&&n.value==="imageMessage"?"image":w?"bubble":"info",Ie=e=>{var d,I,H,N;const s=[];if(e!=null&&e.length){if((e==null?void 0:e.length)===1)return s.push({date:ve((d=e[0])==null?void 0:d.time),list:e}),s}else return s;let a="",l="";for(let C=0;C<(e==null?void 0:e.length);C++)l=ve((I=e[C])==null?void 0:I.time),a!==l?s.push({date:l,list:[e[C]]}):(N=(H=s[(s==null?void 0:s.length)-1])==null?void 0:H.list)==null||N.push(e[C]),a=l;return s},X=e=>{var s;r.searchType==="global"?(f.update(T.SEARCH,"currentSearchingStatus",{isSearching:!1,searchType:r.searchType}),Ce.switchConversation(e==null?void 0:e.conversationID).then(()=>{var a;f.update(T.CHAT,"messageSource",e),de&&((a=ce)==null||a.navigateTo({url:"/TUIKit/components/TUIChat/index"}))})):r.searchType==="conversation"&&(f.update(T.SEARCH,"isShowInConversationSearch",!1),f.update(T.CHAT,"messageSource",e),de&&((s=ce)==null||s.navigateBack()))},Z=e=>`${n}-${e}`;return(e,s)=>t(R)?(o(),q(he,{key:0,class:g(["search-result-loading",!t(w)&&"search-result-loading-h5"])},null,8,["class"])):t(Te)?(o(),q(Ue,{key:1,class:g(["search-result-default",!t(w)&&"search-result-default-h5"])},null,8,["class"])):(o(),i("div",{key:2,class:g(["tui-search-result",!t(w)&&"tui-search-result-h5",t(w)&&t(U)&&"tui-search-result-with-border"])},[r.searchType!=="conversation"&&(t(w)||!t(U))?(o(),i("div",ze,[u("div",Fe,[(o(!0),i(x,null,P(t(c),a=>(o(),i("div",{key:a.key,class:"tui-search-result-list-item"},[r.searchType==="global"?(o(),i("div",Ke,y(t(k).t(`TUISearch.${a.label}`)),1)):_("",!0),u("div",Ye,[(o(!0),i(x,null,P(a.list,l=>(o(),i("div",{key:l.conversation.conversationID,class:g([_e(l)])},[a.key==="contact"||a.key==="group"||l.conversation?(o(),q(L,{key:0,listItem:l,type:a.key,displayType:"info",keywordList:t(h),onShowResultDetail:Q,onNavigateToChatPosition:X},null,8,["listItem","type","keywordList"])):_("",!0)],2))),128))]),t(n)==="all"||a.cursor?(o(),i("div",{key:1,class:"more",onClick:l=>ge(a)},[B(b,{class:"more-icon",file:t(pe),width:"12px",height:"12px"},null,8,["file"]),u("div",Ae,[u("span",null,y(t(k).t("TUISearch.查看更多")),1),u("span",null,y(t(k).t(`TUISearch.${a.label}`)),1)])],8,qe)):_("",!0)]))),128))])])):_("",!0),t(U)||r.searchType==="conversation"?(o(),i("div",{key:1,class:g(["tui-search-result-detail",r.searchType==="conversation"&&"tui-search-result-in-conversation"])},[t(E)?(o(),q(he,{key:0,class:g(["search-result-loading",!t(w)&&"search-result-loading-h5"])},null,8,["class"])):_("",!0),!t(E)&&t(U)&&r.searchType!=="conversation"?(o(),i("div",Ge,[u("div",Je,[u("div",We,[u("span",null,y(t(J)),1),u("span",null,y(t(k).t("TUISearch.条与")),1)]),u("div",Qe,[(o(!0),i(x,null,P(t(h),(a,l)=>(o(),i("span",{key:l},[Xe,u("span",Ze,y(a),1),Le]))),128))]),u("div",be,[u("span",null,y(t(k).t("TUISearch.相关的")),1),u("span",null,y(t(k).t(`TUISearch.${t(n)==="allMessage"?"结果":t(Y)[t(n)].label}`)),1)])]),u("div",{class:"header-enter",onClick:s[0]||(s[0]=a=>t(De)({conversationID:t(S)}))},[u("span",null,y(t(k).t("TUISearch.进入聊天")),1),B(b,{class:"enter-icon",file:t(xe),width:"14px",height:"14px"},null,8,["file"])])])):_("",!0),!t(E)&&t(m)&&t(m)[0]?(o(),i("div",Oe,[r.searchType==="global"||t(n)!=="imageMessage"&&t(n)!=="fileMessage"?(o(!0),i(x,{key:0},P(t(m),a=>(o(),i("div",{key:Z(a.ID),class:g(["list-item"])},[B(L,{listItem:a,listItemContent:a.getMessageContent(),type:t(n),displayType:se(),keywordList:t(h),onShowResultDetail:Q,onNavigateToChatPosition:X},null,8,["listItem","listItemContent","type","displayType","keywordList"])]))),128)):(o(!0),i(x,{key:1},P(t(V),a=>(o(),i("div",{key:Z(a.date),class:g(["list-group",t(n)==="fileMessage"?"list-group-file":"list-group-image"])},[u("div",je,y(a.date),1),(o(!0),i(x,null,P(a.list,l=>(o(),i("div",{key:Z(l.ID),class:g(["list-group-item"])},[B(L,{listItem:l,listItemContent:l.getMessageContent(),type:t(n),displayType:se(),keywordList:t(h),onShowResultDetail:Q,onNavigateToChatPosition:X},null,8,["listItem","listItemContent","type","displayType","keywordList"])]))),128))],2))),128)),t(M)&&t(M).cursor?(o(),i("div",{key:2,class:"more",onClick:Se},[B(b,{class:"more-icon",file:t(pe),width:"12px",height:"12px"},null,8,["file"]),u("div",ea,y(t(k).t("TUISearch.查看更多历史记录")),1)])):_("",!0)])):_("",!0)],2)):_("",!0)],2))}});const kt=ke(aa,[["__scopeId","data-v-ba604638"]]);export{kt as default};
