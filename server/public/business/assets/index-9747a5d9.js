import{S as Ee,L as De,M as Re,B as Pe,x as Ue,C as Be,y as Se,t as $e,v as Ne,H as Le,a1 as Ae,I as Fe,J as Ie}from"./element-plus-64da2267.js";import{_ as Oe}from"./index.vue_vue_type_script_setup_true_lang-abbb91f8.js";import{w as j,n as we}from"./index-7638d9aa.js";import{u as Ge}from"./usePaging-8178f38d.js";import{u as Me}from"./useDictOptions-8a3829c8.js";import{a as qe,b as We,f as ze,g as He,h as Je}from"./project_tasks_audit-3342f08f.js";import"./lodash-2cc29f39.js";import{_ as Xe}from"./edit.vue_vue_type_script_setup_true_name_projectTasksAuditEdit_lang-6ef3fd42.js";import Ze from"./contract-038ed320.js";import{d as X,e as Ke}from"./e_contract-4d8b6690.js";import{a as Qe}from"./project_tasks-5f07ee3a.js";import Ye from"./AuditLogDialog-86fd411d.js";import{P as et}from"./auth-29ea37c6.js";import{u as tt,a as at}from"./vue-router-f7517f62.js";import{d as ee,b0 as Z,r as f,aZ as lt,al as ot,am as st,o as s,t as n,aM as a,G as l,aO as h,aV as u,c as C,F as E,aj as D,E as d,a as K,aw as Q,u as c,aX as nt,b2 as Y}from"./@vue-25170201.js";import{_ as it}from"./@tencentcloud-25a17c42.js";import"./lodash-es-fbce1780.js";import"./async-validator-dee29e8b.js";import"./@element-plus-9559a6ac.js";import"./dayjs-346d7cd4.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@vueuse-944ef3f4.js";import"./axios-67477f72.js";import"./pinia-1182f1fa.js";import"./css-color-function-7acc3e97.js";import"./color-9254db0b.js";import"./clone-db6b0f3b.js";import"./color-convert-946e453a.js";import"./color-name-b7949e8c.js";import"./color-string-6fa48439.js";import"./balanced-match-51764fed.js";import"./ms-f6814399.js";import"./nprogress-ccaead9e.js";import"./@tiptap-008a465d.js";import"./prosemirror-state-c544e594.js";import"./prosemirror-model-8b0495eb.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-fc1f2a72.js";import"./prosemirror-view-ef3f9f96.js";import"./prosemirror-keymap-776f822d.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-5c2a1a07.js";import"./prosemirror-schema-list-1c96ec4d.js";import"./vue-clipboard3-f5f9feb9.js";import"./clipboard-3d849c41.js";import"./echarts-d6620a89.js";import"./zrender-9797a04d.js";import"./tslib-54e39b60.js";import"./highlight.js-1b502259.js";import"./@highlightjs-7a15facb.js";import"./path-to-regexp-767716ea.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./index-e34f0d65.js";import"./index-a5ff619c.js";import"./project_tasks_audit_logs-2125b45a.js";const rt={class:"mt-4"},ut={key:0},ct={key:1},pt={class:"flex mt-4 justify-end"},dt=ee({name:"projectTasksAuditLists"}),mt=ee({...dt,setup(_t){const te=Z(),U=Z(),B=f(!1),F=f(!1),S=tt();at();const v=f(S.query.type),ae=[{label:"全部",value:null},{label:"待审核",value:0},{label:"待签署",value:1},{label:"完成",value:2},{label:"拒绝",value:3}],I=[{label:"待到岗",value:1},{label:"已到岗",value:2},{label:"流失",value:3},{label:"离职",value:4}],$={2:"招聘专员",3:"驻场经理",4:"入职员工"},_=lt({project_id:S.query.project_id,user_id:"",type:S.query.type,status:"",work_status:"",remarks:""}),le=f([]),oe=o=>{le.value=o.map(({id:t})=>t)},se=o=>{},O=f({lists:[]});(async()=>{O.value=await Qe()})();const N=f([]),ne=async()=>{N.value=await qe()},ie=(o,t)=>{console.log("ClientNames.value before filtering: ",N.value);const i=N.value.filter(p=>(console.log(p.project_id,o,p.type,t),p.project_id==o&&p.type==t)).map(p=>({user_id:p.user_id,psn_name:p.psn_name}));return console.log("Filtered data: ",i),i};ne();const re=o=>{g.lists=[],_.type=o.paneName,y()},{dictData:w}=Me(""),{pager:g,getLists:y,resetParams:ue,resetPage:ce}=Ge({fetchFun:Je,params:_}),pe=async o=>{await _e(o.id,o.work_status)},de=async o=>{await fe(o.id,o.onsite_user_id)},me=async o=>{let t=await j.prompt("请输入拒绝内容","提示",{confirmButtonText:"拒绝",cancelButtonText:"取消",inputErrorMessage:"拒绝理由不正确"});await We({id:o,remarks:t.value,status:3}),y()},_e=async(o,t)=>{let i;(t==3||t==4)&&(i=await j.prompt("请输入备注说明","提示",{confirmButtonText:"保存",cancelButtonText:"取消",inputErrorMessage:"备注不正确"})),await ze({id:o,remarks:i==null?void 0:i.value,work_status:t}),y()},fe=async(o,t)=>{let i;i=await j.prompt("请输入变更驻场说明","提示",{confirmButtonText:"保存",cancelButtonText:"取消",inputErrorMessage:"备注不正确"}),await He({id:o,remarks:i==null?void 0:i.value,onsite_user_id:t}),y()},ve=async o=>{var t,i;F.value=!0,await Y(),(t=U.value)==null||t.open(o.type),(i=U.value)==null||i.setFormData(o)},ke=async o=>{await j.confirm("去签署合同？");const t=await X({id:o});window.open(t.data.url,"_blank")},be=async o=>{await j.confirm("支付宝扫码后查阅合同");const t=await X({id:o});window.open(t.data.url,"_blank")},ye=async o=>{const t=await Ke({id:o});window.open(t.data.files[0].downloadUrl,"_blank")},G=f(0),M=f(!1),q=f(),Ce=async o=>{var t;console.log(o),G.value=o,M.value=!0,await Y(),(t=q.value)==null||t.open()},ge=()=>{};return y(),(o,t)=>{const i=Ee,p=De,T=Re,R=Pe,k=Ue,he=Be,W=Se,L=$e,Te=Ne,m=Le,A=ot("router-link"),z=we,P=Ae,Ve=Fe,xe=Oe,V=st("perms"),je=Ie;return s(),n(et,null,{default:a(()=>[l(i,{type:"error",class:"mb-3",title:"注意： 合同签署成功，自动扣扣款合同费用每份 1.00 元。 余不足 100.00 元时，无法发起合同签署流程。",closable:!1,"show-icon":""}),h((s(),n(W,{class:"!border-none mt-2",shadow:"never"},{default:a(()=>[l(W,{class:"!border-none mr-20",shadow:"never"},{default:a(()=>[l(he,{class:"ml-[-16px]",model:u(_),inline:""},{default:a(()=>[l(R,{label:"",prop:"project_id"},{default:a(()=>[l(T,{"collapse-tags":"",class:"w-[280px]",modelValue:u(_).project_id,"onUpdate:modelValue":t[0]||(t[0]=e=>u(_).project_id=e),clearable:"",onChange:se,placeholder:"筛选项目"},{default:a(()=>[l(p,{label:"不限",value:""}),(s(!0),C(E,null,D(O.value.lists,(e,r)=>(s(),n(p,{key:e.id,label:e==null?void 0:e.project_name,value:String(e.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(R,{label:"",prop:"project_id"},{default:a(()=>[l(T,{modelValue:u(_).status,"onUpdate:modelValue":t[1]||(t[1]=e=>u(_).status=e),class:"w-[140px]",placeholder:"筛选状态"},{default:a(()=>[(s(),C(E,null,D(ae,e=>l(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(R,{label:"",prop:"project_id"},{default:a(()=>[l(T,{modelValue:u(_).work_status,"onUpdate:modelValue":t[2]||(t[2]=e=>u(_).work_status=e),class:"w-[160px]",placeholder:"筛选工作状态"},{default:a(()=>[(s(),C(E,null,D(I,e=>l(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(R,null,{default:a(()=>[l(k,{type:"primary",onClick:u(ce)},{default:a(()=>[d("查询")]),_:1},8,["onClick"]),l(k,{onClick:u(ue)},{default:a(()=>[d("重置")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),l(Te,{class:"mt-[-20px]",modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=e=>v.value=e),onTabClick:re},{default:a(()=>[l(L,{label:"招聘专员",name:"2"}),l(L,{label:"驻场经理",name:"3"}),l(L,{label:"入职员工",name:"4"})]),_:1},8,["modelValue"]),K("div",rt,[l(Ve,{data:u(g).lists,onSelectionChange:oe},{default:a(()=>[l(m,{label:"项目名称",prop:"projectinfo.project_name","show-overflow-tooltip":"",fixed:"left"}),l(m,{label:$[v.value],prop:"userinfo.psn_name","show-overflow-tooltip":"",fixed:"left"},{default:a(({row:e})=>[l(A,{to:"/im?conversationId=C2Ccl_"+(e==null?void 0:e.user_sn),class:"link"},{default:a(()=>[d(Q(e.userinfo.psn_name),1)]),_:2},1032,["to"])]),_:1},8,["label"]),v.value=="4"?(s(),n(m,{key:0,label:$[2],prop:"recruit_name",width:"90","show-overflow-tooltip":""},{default:a(({row:e})=>[e!=null&&e.recruit_sn?(s(),n(A,{key:0,to:"/im?conversationId=C2Ccl_"+(e==null?void 0:e.recruit_sn),class:"link"},{default:a(()=>[l(z,{name:"el-icon-Avatar",size:15})]),_:2},1032,["to"])):c("",!0),d(" "+Q(e.recruit_name),1)]),_:1},8,["label"])):c("",!0),v.value=="4"?(s(),n(m,{key:1,label:$[3],prop:"onsite_name",width:"140","show-overflow-tooltip":""},{default:a(({row:e})=>[e!=null&&e.onsite_sn?(s(),n(A,{key:0,to:"/im?conversationId=C2Ccl_"+(e==null?void 0:e.onsite_sn),class:"link"},{default:a(()=>[l(z,{name:"el-icon-Avatar",size:15})]),_:2},1032,["to"])):c("",!0),l(T,{modelValue:e.onsite_user_id,"onUpdate:modelValue":r=>e.onsite_user_id=r,class:"w-[90px]",placeholder:"变更驻场",onChange:r=>de(e)},{default:a(()=>[(s(!0),C(E,null,D(ie(e.project_id,3),r=>{var b;return s(),n(p,{key:r.user_id,label:r.psn_name,value:r.user_id,disabled:e.status!=2||((b=e==null?void 0:e.contractinfo)==null?void 0:b.status)!=2},null,8,["label","value","disabled"])}),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"])):c("",!0),v.value!="4"?(s(),n(m,{key:2,label:"电话",prop:"userinfo.psn_mobile","show-overflow-tooltip":""})):c("",!0),l(m,{label:"审核状态",prop:"status",width:"105","show-overflow-tooltip":""},{default:a(({row:e})=>[e.status==0?(s(),n(P,{key:0},{default:a(()=>[d("待审核")]),_:1})):c("",!0),e.status==1?(s(),n(P,{key:1},{default:a(()=>[d("待签署")]),_:1})):e.status==2?(s(),n(P,{key:2,type:"success"},{default:a(()=>[d("完成")]),_:1})):e.status==3?(s(),n(P,{key:3,type:"danger"},{default:a(()=>[d("拒绝")]),_:1})):c("",!0)]),_:1}),v.value=="4"?(s(),n(m,{key:3,width:"120",label:"工作状态",prop:"work_status","show-overflow-tooltip":""},{default:a(({row:e})=>[l(T,{modelValue:e.work_status,"onUpdate:modelValue":r=>e.work_status=r,class:"w-[90px]",placeholder:"筛选工作状态",onChange:r=>pe(e)},{default:a(()=>[(s(),C(E,null,D(I,r=>{var b;return l(p,{key:r.value,label:r.label,value:r.value,disabled:e.status!=2||((b=e==null?void 0:e.contractinfo)==null?void 0:b.status)!=2},null,8,["label","value","disabled"])}),64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):c("",!0),l(m,{label:"备注说明",prop:"remarks","show-overflow-tooltip":""}),l(m,{label:"申请时间",prop:"create_time",width:"200px","show-overflow-tooltip":""}),l(m,{label:"审核时间",prop:"update_time",width:"200px","show-overflow-tooltip":""}),l(m,{label:"操作",width:"130",fixed:"left"},{default:a(({row:e})=>{var r,b,H,J;return[e.contractinfo==null?(s(),C("div",ut,[h((s(),n(k,{disabled:e.status>1,type:"primary",link:"",onClick:x=>ve(e)},{default:a(()=>[d(" 发起 ")]),_:2},1032,["disabled","onClick"])),[[V,["project_tasks_audit/audited"]]]),h((s(),n(k,{disabled:e.status>1,type:"danger",link:"",onClick:x=>me(e.id)},{default:a(()=>[d(" 拒绝 ")]),_:2},1032,["disabled","onClick"])),[[V,["project_tasks_audit/audited"]]])])):c("",!0),(e==null?void 0:e.contractinfo)!=null?(s(),C("div",ct,[((r=e.contractinfo)==null?void 0:r.status)==0||((b=e==null?void 0:e.contractinfo)==null?void 0:b.status)==1?h((s(),n(k,{key:0,type:"danger",link:"",onClick:x=>ke(e.contractinfo.id)},{default:a(()=>[d(" 签署 ")]),_:2},1032,["onClick"])),[[V,["e_contract/delete"]]]):c("",!0),((H=e==null?void 0:e.contractinfo)==null?void 0:H.status)==2?h((s(),n(k,{key:1,type:"success",link:"",onClick:x=>be(e.contractinfo.id)},{default:a(()=>[d(" 查看 ")]),_:2},1032,["onClick"])),[[V,["e_contract/delete"]]]):c("",!0),((J=e==null?void 0:e.contractinfo)==null?void 0:J.status)==2?h((s(),n(k,{key:2,type:"success",link:"",onClick:x=>ye(e.contractinfo.id)},{default:a(()=>[d(" 下载 ")]),_:2},1032,["onClick"])),[[V,["e_contract/delete"]]]):c("",!0)])):c("",!0),l(k,{type:"primary",link:"",onClick:x=>Ce(e.id)},{default:a(()=>[d(" 审计日志 ")]),_:2},1032,["onClick"])]}),_:1})]),_:1},8,["data"])]),K("div",pt,[l(xe,{modelValue:u(g),"onUpdate:modelValue":t[4]||(t[4]=e=>nt(g)?g.value=e:null),onChange:u(y)},null,8,["modelValue","onChange"])])]),_:1})),[[je,u(g).loading]]),l(Ye,{activeTab:v.value,ref_key:"formDrawerRef",ref:q,title:"审核日志",formData:o.formData,formRules:o.formRules,auditId:G.value,visible:M.value,popupTitle:"审计日志",onClose:ge},null,8,["activeTab","formData","formRules","auditId","visible"]),B.value?(s(),n(Xe,{key:0,ref_key:"editRef",ref:te,"dict-data":u(w),onSuccess:u(y),onClose:t[5]||(t[5]=e=>B.value=!1)},null,8,["dict-data","onSuccess"])):c("",!0),F.value?(s(),n(Ze,{key:1,ref_key:"contractRef",ref:U,"dict-data":u(w),onClose:t[6]||(t[6]=e=>B.value=!1)},null,8,["dict-data"])):c("",!0)]),_:1})}}});const Ea=it(mt,[["__scopeId","data-v-22a7ce1a"]]);export{Ea as default};
