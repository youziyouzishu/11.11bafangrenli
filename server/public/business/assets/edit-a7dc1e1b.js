import{_ as ne}from"./index-89569703.js";import{T as de,y as ue,A as me,B as re,t as se,H as pe,D as ie,L as _e,M as ce,I as be,O as fe,P as Ve,_ as ve,x as ye,v as ke,C as ge}from"./element-plus-64da2267.js";import{_ as we}from"./index.vue_vue_type_script_setup_true_lang-2b3723ec.js";import{w as S,n as Ue}from"./index-7638d9aa.js";import{t as Ee,g as he}from"./code-cf8f43d7.js";import{a as qe}from"./useDictOptions-8a3829c8.js";import{d as De}from"./dict-58220cb0.js";import{m as $e}from"./menu-b06496af.js";import{_ as xe}from"./relations-add.vue_vue_type_script_setup_true_lang-3d963544.js";import{l as j}from"./lodash-2cc29f39.js";import{u as Re,a as Ce}from"./vue-router-f7517f62.js";import{d as M,r as L,aZ as z,b0 as G,o as i,c as y,G as e,aM as a,aV as n,aX as Ie,a as u,F as g,aj as U,t as k,E as c,u as I,b2 as Te,bb as H,w as Be}from"./@vue-25170201.js";import"./@tencentcloud-25a17c42.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./lodash-es-fbce1780.js";import"./async-validator-dee29e8b.js";import"./@element-plus-9559a6ac.js";import"./dayjs-346d7cd4.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@vueuse-944ef3f4.js";import"./axios-67477f72.js";import"./css-color-function-7acc3e97.js";import"./color-9254db0b.js";import"./clone-db6b0f3b.js";import"./color-convert-946e453a.js";import"./color-name-b7949e8c.js";import"./color-string-6fa48439.js";import"./balanced-match-51764fed.js";import"./ms-f6814399.js";import"./nprogress-ccaead9e.js";import"./@tiptap-008a465d.js";import"./prosemirror-state-c544e594.js";import"./prosemirror-model-8b0495eb.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-fc1f2a72.js";import"./prosemirror-view-ef3f9f96.js";import"./prosemirror-keymap-776f822d.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-5c2a1a07.js";import"./prosemirror-schema-list-1c96ec4d.js";import"./vue-clipboard3-f5f9feb9.js";import"./clipboard-3d849c41.js";import"./echarts-d6620a89.js";import"./zrender-9797a04d.js";import"./tslib-54e39b60.js";import"./highlight.js-1b502259.js";import"./@highlightjs-7a15facb.js";import"./path-to-regexp-767716ea.js";import"./index-e34f0d65.js";const Ne={class:"code-edit"},Pe={class:"w-80"},Ae={class:"w-80"},Fe={class:"w-80"},Oe={class:"w-80"},Se=u("div",{class:"form-tips"},"指定树表的主要ID，一般为主键",-1),je=u("div",{class:"form-tips"},"指定树表的父ID，比如：parent_id",-1),Le={class:"w-80"},ze=u("div",{class:"form-tips"},[u("div",null," 例：填写test,生成文件描述为test控制器(test逻辑/test模型) ")],-1),Ge={class:"w-80"},He=u("div",{class:"form-tips"},"生成文件所在模块",-1),Me={class:"w-80"},Ke=u("div",{class:"form-tips"},[u("div",null," 例：填写test,则在app/模块名/controller/test下生成控制器 ")],-1),We={class:"w-80"},Xe=u("div",{class:"form-tips"}," 自动构建：自动执行生成菜单sql。手动添加：自行添加菜单。 ",-1),Ze={class:"mt-4"},Je=M({name:"tableEdit"}),na=M({...Je,setup(Qe){const K=Re(),W=Ce(),D=L("column"),$=L(!1),T=[{name:"一对一",value:"has_one"},{name:"一对多",value:"has_many"}],o=z({id:"",table_name:"",table_comment:"",author:"",remark:"",template_type:0,generate_type:0,module_name:"",class_dir:"",class_comment:"",table_column:[],menu:{pid:0,name:"",type:0},tree:{tree_id:0,tree_pid:0,tree_name:0},delete:{name:"",type:0},relations:[]});let x=0;const B=G(),R=G(),N=z({table_name:[{required:!0,message:"请输入表名称"}],table_comment:[{required:!0,message:"请输入表描述"}],module_name:[{required:!0,message:"请输入模块名"}],generate_type:[{required:!0,trigger:"change"}],template_type:[{required:!0,trigger:"change"}],"menu.pid":[{required:!0,message:"请选择父级菜单"}],"menu.name":[{required:!0,message:"请输入菜单名称"}],"delete.type":[{required:!0,trigger:"change"}],"delete.name":[{required:!0,message:"请选择删除字段"}]}),P=async(p,t,V)=>{var b,_;$.value=!0,await Te(),t&&V!==void 0&&((b=R.value)==null||b.setFormData(t),x=V),(_=R.value)==null||_.open(p)},X=p=>{const t=j.cloneDeep(H(p));o.relations.push(t)},Z=async p=>{const t=j.cloneDeep(H(p));console.log(x),o.relations.splice(x,1,t)},J=p=>{o.relations.splice(p,1)},Q=async()=>{const p=await Ee({id:K.query.id});Object.keys(o).forEach(t=>{o[t]=p[t]}),Be(()=>o.generate_type,t=>{t==1&&S.confirm("生成到模块方式如遇同名文件会覆盖旧文件，确定要选择此方式吗？").catch(()=>{o.generate_type=0})})},{optionsData:A}=qe({dict_type:{api:De},menu:{api:$e,transformData(p){const t={id:0,name:"顶级",children:[]};return t.children=p,[t]}}}),Y=async()=>{var p,t;try{await((p=B.value)==null?void 0:p.validate()),await he(o),W.back()}catch(V){for(const b in V)Object.keys(N).includes(b)&&S.msgError((t=V[b][0])==null?void 0:t.message)}};return Q(),(p,t)=>{const V=de,b=ue,_=me,r=re,E=se,s=pe,w=ie,m=_e,v=ce,F=be,f=fe,h=Ve,ee=ve,le=Ue,q=ye,O=we,ae=ke,te=ge,oe=ne;return i(),y("div",Ne,[e(b,{class:"!border-none",shadow:"never"},{default:a(()=>[e(V,{content:"编辑数据表",onBack:t[0]||(t[0]=l=>p.$router.back())})]),_:1}),e(b,{class:"mt-4 !border-none",shadow:"never"},{default:a(()=>[e(te,{ref_key:"formRef",ref:B,class:"ls-form",model:n(o),"label-width":"100px",rules:n(N)},{default:a(()=>[e(ae,{modelValue:n(D),"onUpdate:modelValue":t[20]||(t[20]=l=>Ie(D)?D.value=l:null)},{default:a(()=>[e(E,{label:"基础信息",name:"base"},{default:a(()=>[e(r,{label:"表名称",prop:"table_name"},{default:a(()=>[u("div",Pe,[e(_,{modelValue:n(o).table_name,"onUpdate:modelValue":t[1]||(t[1]=l=>n(o).table_name=l),placeholder:"请输入表名称",clearable:""},null,8,["modelValue"])])]),_:1}),e(r,{label:"表描述",prop:"table_comment"},{default:a(()=>[u("div",Ae,[e(_,{modelValue:n(o).table_comment,"onUpdate:modelValue":t[2]||(t[2]=l=>n(o).table_comment=l),placeholder:"请输入表描述",clearable:""},null,8,["modelValue"])])]),_:1}),e(r,{label:"作者"},{default:a(()=>[u("div",Fe,[e(_,{modelValue:n(o).author,"onUpdate:modelValue":t[3]||(t[3]=l=>n(o).author=l),clearable:""},null,8,["modelValue"])])]),_:1}),e(r,{label:"备注"},{default:a(()=>[u("div",Oe,[e(_,{modelValue:n(o).remark,"onUpdate:modelValue":t[4]||(t[4]=l=>n(o).remark=l),class:"w-full",type:"textarea",autosize:{minRows:4,maxRows:4},maxlength:"200","show-word-limit":"",clearable:""},null,8,["modelValue"])])]),_:1})]),_:1}),e(E,{label:"字段管理",name:"column"},{default:a(()=>[e(F,{data:n(o).table_column},{default:a(()=>[e(s,{label:"字段列名",prop:"column_name"}),e(s,{label:"字段描述",prop:"column_comment","min-width":"120"},{default:a(({row:l})=>[e(_,{modelValue:l.column_comment,"onUpdate:modelValue":d=>l.column_comment=d,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"物理类型",prop:"column_type"}),e(s,{label:"必填",width:"80"},{default:a(({row:l})=>[e(w,{modelValue:l.is_required,"onUpdate:modelValue":d=>l.is_required=d,"true-label":1,"false-label":0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"插入",width:"80"},{default:a(({row:l})=>[e(w,{modelValue:l.is_insert,"onUpdate:modelValue":d=>l.is_insert=d,"true-label":1,"false-label":0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"编辑",width:"80"},{default:a(({row:l})=>[e(w,{modelValue:l.is_update,"onUpdate:modelValue":d=>l.is_update=d,"true-label":1,"false-label":0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"列表",width:"80"},{default:a(({row:l})=>[e(w,{modelValue:l.is_lists,"onUpdate:modelValue":d=>l.is_lists=d,"true-label":1,"false-label":0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"查询",width:"80"},{default:a(({row:l})=>[e(w,{modelValue:l.is_query,"onUpdate:modelValue":d=>l.is_query=d,"true-label":1,"false-label":0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"查询方式"},{default:a(({row:l})=>[e(v,{modelValue:l.query_type,"onUpdate:modelValue":d=>l.query_type=d},{default:a(()=>[e(m,{label:"=",value:"="}),e(m,{label:"!=",value:"!="}),e(m,{label:">",value:">"}),e(m,{label:">=",value:">="}),e(m,{label:"<",value:"<"}),e(m,{label:"<=",value:"<="}),e(m,{label:"LIKE",value:"like"}),e(m,{label:"BETWEEN",value:"between"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"显示类型","min-width":"120"},{default:a(({row:l})=>[e(v,{modelValue:l.view_type,"onUpdate:modelValue":d=>l.view_type=d},{default:a(()=>[e(m,{label:"文本框",value:"input"}),e(m,{label:"文本域",value:"textarea"}),e(m,{label:"下拉框",value:"select"}),e(m,{label:"单选框",value:"radio"}),e(m,{label:"复选框",value:"checkbox"}),e(m,{label:"日期控件",value:"datetime"}),e(m,{label:"图片选择控件",value:"imageSelect"}),e(m,{label:"富文本控件",value:"editor"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"字典类型","min-width":"120"},{default:a(({row:l})=>[e(v,{modelValue:l.dict_type,"onUpdate:modelValue":d=>l.dict_type=d,clearable:"",disabled:!(l.view_type=="select"||l.view_type=="radio"||l.view_type=="checkbox"),placeholder:"字典类型"},{default:a(()=>[(i(!0),y(g,null,U(n(A).dict_type,(d,C)=>(i(),k(m,{key:C,label:d.name,value:d.type,disabled:!d.status},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:1})]),_:1},8,["data"])]),_:1}),e(E,{label:"生成配置",name:"config"},{default:a(()=>[e(r,{label:"模板类型",prop:"template_type"},{default:a(()=>[e(h,{modelValue:n(o).template_type,"onUpdate:modelValue":t[5]||(t[5]=l=>n(o).template_type=l)},{default:a(()=>[e(f,{label:0},{default:a(()=>[c("单表（curd）")]),_:1}),e(f,{label:1},{default:a(()=>[c("树表（curd）")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"删除类型",prop:"delete.type"},{default:a(()=>[e(h,{modelValue:n(o).delete.type,"onUpdate:modelValue":t[6]||(t[6]=l=>n(o).delete.type=l)},{default:a(()=>[e(f,{label:0},{default:a(()=>[c("物理删除")]),_:1}),e(f,{label:1},{default:a(()=>[c("软删除")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(o).delete.type==1?(i(),k(r,{key:0,label:"删除字段",prop:"delete.name"},{default:a(()=>[e(v,{class:"w-80",modelValue:n(o).delete.name,"onUpdate:modelValue":t[7]||(t[7]=l=>n(o).delete.name=l),clearable:""},{default:a(()=>[(i(!0),y(g,null,U(n(o).table_column,l=>(i(),k(m,{key:l.id,value:l.column_name,label:`${l.column_name}：${l.column_comment}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):I("",!0),n(o).template_type==1?(i(),y(g,{key:1},[e(r,{label:"树表ID",prop:"treePrimary"},{default:a(()=>[u("div",null,[e(v,{class:"w-80",modelValue:n(o).tree.tree_id,"onUpdate:modelValue":t[8]||(t[8]=l=>n(o).tree.tree_id=l),clearable:""},{default:a(()=>[(i(!0),y(g,null,U(n(o).table_column,l=>(i(),k(m,{key:l.id,value:l.column_name,label:`${l.column_name}：${l.column_comment}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),Se])]),_:1}),e(r,{label:"树表父ID",prop:"treeParent"},{default:a(()=>[u("div",null,[e(v,{class:"w-80",modelValue:n(o).tree.tree_pid,"onUpdate:modelValue":t[9]||(t[9]=l=>n(o).tree.tree_pid=l),clearable:""},{default:a(()=>[(i(!0),y(g,null,U(n(o).table_column,l=>(i(),k(m,{key:l.id,value:l.column_name,label:`${l.column_name}：${l.column_comment}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),je])]),_:1}),e(r,{label:"树名称",prop:"treeName"},{default:a(()=>[e(v,{class:"w-80",modelValue:n(o).tree.tree_name,"onUpdate:modelValue":t[10]||(t[10]=l=>n(o).tree.tree_name=l),clearable:""},{default:a(()=>[(i(!0),y(g,null,U(n(o).table_column,l=>(i(),k(m,{key:l.id,value:l.column_name,label:`${l.column_name}：${l.column_comment}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})],64)):I("",!0),e(r,{label:"类描述"},{default:a(()=>[u("div",Le,[u("div",null,[e(_,{modelValue:n(o).class_comment,"onUpdate:modelValue":t[11]||(t[11]=l=>n(o).class_comment=l),placeholder:"请输入文件描述",clearable:""},null,8,["modelValue"])]),ze])]),_:1}),e(r,{label:"生成方式",prop:"generate_type"},{default:a(()=>[e(h,{modelValue:n(o).generate_type,"onUpdate:modelValue":t[12]||(t[12]=l=>n(o).generate_type=l)},{default:a(()=>[e(f,{label:0},{default:a(()=>[c("压缩包下载")]),_:1}),e(f,{label:1},{default:a(()=>[c("生成到模块")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"模块名",prop:"module_name"},{default:a(()=>[u("div",Ge,[e(_,{modelValue:n(o).module_name,"onUpdate:modelValue":t[13]||(t[13]=l=>n(o).module_name=l),placeholder:"请输入模块名",clearable:""},null,8,["modelValue"]),He])]),_:1}),e(r,{label:"类目录"},{default:a(()=>[u("div",Me,[u("div",null,[e(_,{modelValue:n(o).class_dir,"onUpdate:modelValue":t[14]||(t[14]=l=>n(o).class_dir=l),placeholder:"请输入文件所在目录",clearable:""},null,8,["modelValue"])]),Ke])]),_:1}),e(r,{label:"父级菜单",prop:"menu.pid"},{default:a(()=>[e(ee,{class:"w-80",modelValue:n(o).menu.pid,"onUpdate:modelValue":t[15]||(t[15]=l=>n(o).menu.pid=l),data:n(A).menu,clearable:"","node-key":"id",props:{label:"name"},"default-expand-all":"",placeholder:"请选择父级菜单","check-strictly":""},null,8,["modelValue","data"])]),_:1}),e(r,{label:"菜单名称",prop:"menu.name"},{default:a(()=>[u("div",We,[e(_,{modelValue:n(o).menu.name,"onUpdate:modelValue":t[16]||(t[16]=l=>n(o).menu.name=l),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])])]),_:1}),e(r,{label:"菜单构建",prop:"menu.type",required:""},{default:a(()=>[u("div",null,[e(h,{modelValue:n(o).menu.type,"onUpdate:modelValue":t[17]||(t[17]=l=>n(o).menu.type=l)},{default:a(()=>[e(f,{label:1},{default:a(()=>[c("自动构建")]),_:1}),e(f,{label:0},{default:a(()=>[c("手动添加")]),_:1})]),_:1},8,["modelValue"]),Xe])]),_:1})]),_:1}),e(E,{label:"关联配置",name:"relations"},{default:a(()=>[e(q,{type:"primary",onClick:t[18]||(t[18]=l=>P("add"))},{icon:a(()=>[e(le,{name:"el-icon-Plus"})]),default:a(()=>[c(" 新增关联 ")]),_:1}),u("div",Ze,[e(F,{data:n(o).relations,size:"mini"},{default:a(()=>[e(s,{prop:"type",label:"关联类型"},{default:a(({row:l})=>[e(O,{value:l.type,options:T},null,8,["value"])]),_:1}),e(s,{prop:"name",label:"关联名称"}),e(s,{prop:"model",label:"关联模型"}),e(s,{prop:"local_key",label:"关联键"},{default:a(({row:l})=>[e(O,{value:l.local_key,options:n(o).table_column,config:{label:"column_comment",value:"column_name"}},null,8,["value","options"])]),_:1}),e(s,{prop:"foreign_key",label:"外键"}),e(s,{label:"操作"},{default:a(({row:l,$index:d})=>[e(q,{link:"",type:"primary",onClick:C=>P("edit",l,d)},{default:a(()=>[c(" 编辑 ")]),_:2},1032,["onClick"]),e(q,{link:"",type:"danger",onClick:C=>J(d)},{default:a(()=>[c(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),n($)?(i(),k(xe,{key:0,column:n(o).table_column,types:T,ref_key:"editRef",ref:R,onAdd:X,onEdit:Z,onClose:t[19]||(t[19]=l=>$.value=!1)},null,8,["column"])):I("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model","rules"])]),_:1}),e(oe,null,{default:a(()=>[e(q,{type:"primary",onClick:Y},{default:a(()=>[c("保存")]),_:1})]),_:1})])}}});export{na as default};
