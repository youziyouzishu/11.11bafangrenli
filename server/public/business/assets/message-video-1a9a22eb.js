import{d as $,r as p,b1 as z,b2 as A,b as M,w as N,o as m,c as v,a as g,aV as a,a9 as f,G as R,aR as C,u as j}from"./@vue-25170201.js";import"./adapter-vue-20243c9c.js";import{_ as q}from"./@tencentcloud-25a17c42.js";import{h as D}from"./utils-601596c6.js";import G from"./Icon-fec85db6.js";import{c as O}from"./icon-close-aa3d72bb.js";import{a as d}from"./env-6b0ecdb8.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";const T={class:"message-video"},F=["src"],J=["src","poster"],K=["src","poster"],Q={key:0,class:"dialog-video"},X=["src"],_="https://web.sdk.qcloud.com/im/assets/images/transparent.png",Y=$({__name:"message-video",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},emits:["uploading"],setup(P,{emit:H}){const t=P,b=H,y=p(!1),h=p(""),U=p(0),V=p(0),c=p(),r=p();z(async()=>{t.content&&(h.value=await L(t.content,t.messageItem),A(async()=>{var o,n,l,u,B;const s=((o=document.getElementById("messageScrollList"))==null?void 0:o.clientWidth)||0,e=d?300:Math.min(s-172,300);let i;if(t.messageItem.status==="success"){let{snapshotWidth:k=0,snapshotHeight:x=0}=t.content;const{snapshotUrl:S}=t.content;if(k===0||x===0)return;S===_&&(k=U.value,x=V.value),i=D(k,x,e,e),(n=c==null?void 0:c.value)!=null&&n.style&&(c.value.style.width=`${i.width}px`),(l=c==null?void 0:c.value)!=null&&l.style&&(c.value.style.height=`${i.height}px`),d&&((u=r==null?void 0:r.value)!=null&&u.style&&(r.value.style.width=`${i.width}px`),(B=r==null?void 0:r.value)!=null&&B.style&&(r.value.style.height=`${i.height}px`))}else b("uploading")}))});const W=M(()=>{const{snapshotWidth:s=0,snapshotHeight:e=0}=t.messageItem.payload;return s>=e});N(()=>t.messageItem.status,(s,e)=>{s==="success"&&e!=="success"&&b("uploading")});function w(){t.messageItem.progress>0&&t.messageItem.progress<1||(y.value=!y.value)}function E(s){return new Promise(e=>{let i="";const o=document.createElement("video");o.setAttribute("crossOrigin","anonymous"),o.setAttribute("src",s),o.setAttribute("preload","auto"),o.addEventListener("loadeddata",function(){const n=document.createElement("canvas"),l=o.videoWidth,u=o.videoHeight;n.width=l,n.height=u,n.getContext("2d").drawImage(o,0,0,l,u),i=n.toDataURL("image/jpeg"),U.value=l,V.value=u,e(i)},{once:!0})})}async function L(s,e){var i,o,n,l;return e?e.status!=="success"?await E(s.url):s.snapshotUrl!==_&&s.snapshotUrl||((i=e==null?void 0:e.payload)==null?void 0:i.snapshotUrl)!==_&&((o=e==null?void 0:e.payload)==null?void 0:o.snapshotUrl)||((n=e.payload)==null?void 0:n.thumbUrl)!==_&&((l=e==null?void 0:e.payload)==null?void 0:l.thumbUrl)||await E(s.url):""}return(s,e)=>(m(),v("div",T,[g("div",{ref_key:"skeleton",ref:c,class:f(["message-video-box",[(!t.messageItem.progress||t.messageItem.progress===1)&&!a(d)&&"message-video-cover"]]),onClick:w},[t.messageItem.progress>0&&t.messageItem.progress<1&&a(h)||!a(d)&&a(h)?(m(),v("img",{key:0,class:f(["message-img",[a(W)?"is-width":"is-height"]]),src:a(h)},null,10,F)):a(d)?(m(),v("video",{key:2,ref_key:"videoRef",ref:r,class:"message-img video-web",src:t.content.url,controls:"",preload:"metadata",poster:a(h)},null,8,K)):(m(),v("video",{key:1,ref_key:"videoRef",ref:r,class:"message-img video-h5-uploading",src:t.content.url+"#t=0.1",poster:t.content.url,preload:"auto",muted:""},null,8,J))],2),a(y)&&!a(d)?(m(),v("div",Q,[g("div",{class:"dialog-video-close",onClick:C(w,["stop"])},[R(G,{file:a(O)},null,8,["file"])]),g("div",{class:f(["dialog-video-box",[a(d)?"":"dialog-video-h5"]]),onClick:C(w,["self"])},[g("video",{class:f([a(W)?"is-width":"is-height"]),src:t.content.url,controls:"",autoplay:""},null,10,X)],2)])):j("",!0)]))}});const ve=q(Y,[["__scopeId","data-v-ed12656c"]]);export{ve as default};
