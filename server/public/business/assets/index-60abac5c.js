import{q as y,o as c,B as I,X as d,z as B,_ as R}from"./@tencentcloud-25a17c42.js";import"./adapter-vue-20243c9c.js";import w from"./message-input-editor-45bc727d.js";import v from"./index-66323cb1.js";import D from"./message-input-button-5fd873ac.js";import U from"./index-d1c59c82.js";import{T as G}from"./index-ebb29dde.js";import{i as N}from"./utils-601596c6.js";import{e as V}from"./enableSampleTaskStatus-86998722.js";import{O as A}from"./index-784fd949.js";import{T as H}from"./index-9521edcb.js";import{a as L}from"./index-8f711959.js";import{a as Y,i as q}from"./env-6b0ecdb8.js";import{d as C,r as E,o as h,c as j,a as z,G as S,t as P,u as O,a9 as X,aV as F}from"./@vue-25170201.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./@tiptap-008a465d.js";import"./prosemirror-state-c544e594.js";import"./prosemirror-model-8b0495eb.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-fc1f2a72.js";import"./prosemirror-view-ef3f9f96.js";import"./prosemirror-keymap-776f822d.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-5c2a1a07.js";import"./prosemirror-schema-list-1c96ec4d.js";import"./type-check-5e73d261.js";import"./index-28e12cb3.js";import"./config-58aee8b5.js";import"./Icon-fec85db6.js";import"./icon-close-aa3d72bb.js";import"./index-7638d9aa.js";import"./element-plus-64da2267.js";import"./lodash-es-fbce1780.js";import"./async-validator-dee29e8b.js";import"./@element-plus-9559a6ac.js";import"./dayjs-346d7cd4.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@vueuse-944ef3f4.js";import"./lodash-2cc29f39.js";import"./axios-67477f72.js";import"./vue-router-f7517f62.js";import"./css-color-function-7acc3e97.js";import"./color-9254db0b.js";import"./clone-db6b0f3b.js";import"./color-convert-946e453a.js";import"./color-name-b7949e8c.js";import"./color-string-6fa48439.js";import"./balanced-match-51764fed.js";import"./ms-f6814399.js";import"./nprogress-ccaead9e.js";import"./vue-clipboard3-f5f9feb9.js";import"./clipboard-3d849c41.js";import"./echarts-d6620a89.js";import"./zrender-9797a04d.js";import"./tslib-54e39b60.js";import"./highlight.js-1b502259.js";import"./@highlightjs-7a15facb.js";import"./path-to-regexp-767716ea.js";import"./constant-bad60a54.js";const k=new Map([[3123,"文本包含本地审核拦截词"],[4004,"图片消息失败,无效的图片格式"],[4005,"文件消息失败,禁止发送违规封禁的文件"],[7004,"文件不存在,请检查文件路径是否正确"],[7005,"文件大小超出了限制,如果上传文件,最大限制是100MB"],[8001,"消息长度超出限制,消息长度不要超过12K"],[80001,"消息或者资料中文本存在敏感内容,发送失败"],[80004,"消息中图片存在敏感内容,发送失败"]]),J=async(n,o)=>{y.getData(c.CHAT,"messageSource")&&y.update(c.CHAT,"messageSource",void 0),n==null||n.forEach(async p=>{var i,T,a,u,f,M,_;try{const e={to:((i=o==null?void 0:o.groupProfile)==null?void 0:i.groupID)||((T=o==null?void 0:o.userProfile)==null?void 0:T.userID),conversationType:o==null?void 0:o.type,payload:{},needReadReceipt:N()};let g;const r={offlinePushInfo:{}},m={conversation:o,payload:p.payload,messageType:""};switch(p==null?void 0:p.type){case"text":if(g=JSON.parse(JSON.stringify((a=p.payload)==null?void 0:a.text)),!g)break;e.payload={text:g},m.messageType=I.TYPES.MSG_TEXT,r.offlinePushInfo=A.create(m),(u=p.payload)!=null&&u.atUserList?(e.payload.atUserList=p.payload.atUserList,await d.sendTextAtMessage(e,r)):await d.sendTextMessage(e,r);break;case"image":e.payload={file:(f=p.payload)==null?void 0:f.file},m.messageType=I.TYPES.MSG_IMAGE,r.offlinePushInfo=A.create(m),await d.sendImageMessage(e,r);break;case"video":e.payload={file:(M=p.payload)==null?void 0:M.file},m.messageType=I.TYPES.MSG_VIDEO,r.offlinePushInfo=A.create(m),await d.sendVideoMessage(e,r);break;case"file":e.payload={file:(_=p.payload)==null?void 0:_.file},m.messageType=I.TYPES.MSG_FILE,r.offlinePushInfo=A.create(m),await d.sendFileMessage(e,r);break;default:break}V("sendMessage")}catch(e){G({message:k.get(e==null?void 0:e.code)?B.t(`TUIChat.${k.get(e.code)}`):e==null?void 0:e.message,type:H.ERROR}),y.getData(c.CHAT,"quoteMessage")&&y.update(c.CHAT,"quoteMessage",{})}})},K=(n,o)=>{!n&&!o?d.enterTypingState():d.leaveTypingState()},Q={class:"message-input-wrapper"},W=C({__name:"index",props:{placeholder:{type:String,default:"this is placeholder"},isMuted:{type:Boolean,default:!0},muteText:{type:String,default:""},enableInput:{type:Boolean,default:!0},enableAt:{type:Boolean,default:!0},enableDragUpload:{type:Boolean,default:!0},enableTyping:{type:Boolean,default:!0}},emits:["sendMessage","resetReplyOrReference","onTyping"],setup(n,{expose:o,emit:p}){const i=n,T=p,a=E(),u=E(),f=E();y.watch(c.CONV,{currentConversation:t=>{f.value=t}});const M=(t,s)=>{K(t,s)},_=t=>{var s;(s=u.value)==null||s.toggleAtList(t)},e=async()=>{var l,x;const t=(l=a.value)==null?void 0:l.getEditorContent();if(!t||!f.value)return;const s=t.map(b=>(b.type==="text"&&(b.payload.text=L(b.payload.text)),b));await J(s,f.value),T("sendMessage"),(x=a.value)==null||x.resetEditor()},g=t=>{var s;(s=a.value)==null||s.addEmoji(t)},r=()=>{var t;q&&((t=a.value)==null||t.blur())},m=t=>{var s,l;(s=a==null?void 0:a.value)!=null&&s.insertAt&&((l=a==null?void 0:a.value)==null||l.insertAt(t))};return o({insertEmoji:g,reEdit:t=>{var s,l;(s=a.value)==null||s.resetEditor(),(l=a.value)==null||l.setEditorContent(t)}}),(t,s)=>(h(),j("div",Q,[z("div",{class:X(["message-input-container",!F(Y)&&"message-input-container-h5"])},[S(w,{ref_key:"editor",ref:a,placeholder:i.placeholder,isMuted:i.isMuted,muteText:i.muteText,enableInput:i.enableInput,enableAt:i.enableAt,enableTyping:i.enableTyping,enableDragUpload:i.enableDragUpload,onSendMessage:e,onOnTyping:M,onOnAt:_},null,8,["placeholder","isMuted","muteText","enableInput","enableAt","enableTyping","enableDragUpload"]),i.isMuted?O("",!0):(h(),P(D,{key:0,onSendMessage:e})),i.enableAt?(h(),P(v,{key:1,ref_key:"messageInputAtRef",ref:u,onInsertAt:m,onOnAtListOpen:r},null,512)):O("",!0)],2),S(U)]))}});const yt=R(W,[["__scopeId","data-v-c94b6a0a"]]);export{yt as default};
