import{A as M,B as O,_ as P,L as T,M as G,R as Z,C as z}from"./element-plus-64da2267.js";import{P as H}from"./index-e34f0d65.js";import{a as J}from"./useDictOptions-8a3829c8.js";import{a as K,b as Q,c as W}from"./admin-d45d6653.js";import{r as X}from"./role-f64bc859.js";import{e as Y}from"./post-0fc976c9.js";import{d as $}from"./department-32afda89.js";import{d as ee,b0 as E,r as le,b as ae,aZ as j,al as oe,o as i,c as v,G as t,aM as r,aV as a,a as u,F as U,aj as C,t as p,u as R}from"./@vue-25170201.js";const te={class:"edit-popup"},re=u("div",{class:"form-tips"},"建议尺寸：100*100px，支持jpg，jpeg，png格式",-1),se=u("div",{class:"form-tips"},"允许多人同时在线登录",-1),be=ee({__name:"edit",emits:["success","close"],setup(de,{expose:q,emit:A}){const w=A,g=E(),m=E(),c=le("add"),B=ae(()=>c.value=="edit"?"编辑管理员":"新增管理员"),l=j({id:"",account:"",name:"",dept_id:[],jobs_id:[],role_id:[],avatar:"",password:"",password_confirm:"",disable:0,multipoint_login:1,root:0}),y=(n,e,s)=>{l.password&&(e||s(new Error("请再次输入密码")),e!==l.password&&s(new Error("两次输入密码不一致!"))),s()},f=j({account:[{required:!0,message:"请输入账号",trigger:["blur"]}],name:[{required:!0,message:"请输入名称",trigger:["blur"]}],role_id:[{type:"array",required:!1,message:"请选择角色",trigger:["blur"]}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],password_confirm:[{required:!0,message:"请输入确认密码",trigger:["blur"]},{validator:y,trigger:"blur"}]}),{optionsData:_}=J({role:{api:X},jobs:{api:Y},dept:{api:$}}),D=async()=>{var n,e;await((n=g.value)==null?void 0:n.validate()),c.value=="edit"?await K(l):await Q(l),(e=m.value)==null||e.close(),w("success")},F=(n="add")=>{var e;c.value=n,(e=m.value)==null||e.open()},S=async n=>{f.password=[],f.password_confirm=[{validator:y,trigger:"blur"}];const e=await W({id:n.id});for(const s in l)e[s]!=null&&e[s]!=null&&(l[s]=e[s])},N=()=>{w("close")};return q({open:F,setFormData:S}),(n,e)=>{const s=M,d=O,h=oe("material-picker"),I=P,b=T,k=G,x=Z,L=z;return i(),v("div",te,[t(H,{ref_key:"popupRef",ref:m,title:a(B),async:!0,width:"550px",onConfirm:D,onClose:N},{default:r(()=>[t(L,{ref_key:"formRef",ref:g,model:a(l),"label-width":"84px",rules:a(f)},{default:r(()=>[t(d,{label:"账号",prop:"account"},{default:r(()=>[t(s,{modelValue:a(l).account,"onUpdate:modelValue":e[0]||(e[0]=o=>a(l).account=o),disabled:a(l).root==1,placeholder:"请输入账号",clearable:""},null,8,["modelValue","disabled"])]),_:1}),t(d,{label:"头像"},{default:r(()=>[u("div",null,[u("div",null,[t(h,{modelValue:a(l).avatar,"onUpdate:modelValue":e[1]||(e[1]=o=>a(l).avatar=o),limit:1},null,8,["modelValue"])]),re])]),_:1}),t(d,{label:"名称",prop:"name"},{default:r(()=>[t(s,{modelValue:a(l).name,"onUpdate:modelValue":e[2]||(e[2]=o=>a(l).name=o),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"归属部门",prop:"dept_id"},{default:r(()=>[t(I,{class:"flex-1",modelValue:a(l).dept_id,"onUpdate:modelValue":e[3]||(e[3]=o=>a(l).dept_id=o),data:a(_).dept,clearable:"",multiple:"","node-key":"id",props:{value:"id",label:"name",disabled(o){return o.status!==1}},"check-strictly":"","default-expand-all":!0,placeholder:"请选择上级部门"},null,8,["modelValue","data","props"])]),_:1}),t(d,{label:"岗位",prop:"jobs_id"},{default:r(()=>[t(k,{class:"flex-1",modelValue:a(l).jobs_id,"onUpdate:modelValue":e[4]||(e[4]=o=>a(l).jobs_id=o),clearable:"",multiple:"",placeholder:"请选择岗位"},{default:r(()=>[(i(!0),v(U,null,C(a(_).jobs,(o,V)=>(i(),p(b,{key:V,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"角色",prop:"role_id"},{default:r(()=>[t(k,{modelValue:a(l).role_id,"onUpdate:modelValue":e[5]||(e[5]=o=>a(l).role_id=o),disabled:a(l).root==1,class:"flex-1",multiple:"",placeholder:"请选择角色",clearable:""},{default:r(()=>[a(l).root==1?(i(),p(b,{key:0,label:"系统管理员",value:0})):R("",!0),(i(!0),v(U,null,C(a(_).role,(o,V)=>(i(),p(b,{key:V,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(d,{label:"密码",prop:"password"},{default:r(()=>[t(s,{modelValue:a(l).password,"onUpdate:modelValue":e[6]||(e[6]=o=>a(l).password=o),"show-password":"",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(d,{label:"确认密码",prop:"password_confirm"},{default:r(()=>[t(s,{modelValue:a(l).password_confirm,"onUpdate:modelValue":e[7]||(e[7]=o=>a(l).password_confirm=o),"show-password":"",clearable:"",placeholder:"请输入确认密码"},null,8,["modelValue"])]),_:1}),a(l).root!=1?(i(),p(d,{key:0,label:"管理员状态"},{default:r(()=>[t(x,{modelValue:a(l).disable,"onUpdate:modelValue":e[8]||(e[8]=o=>a(l).disable=o),"active-value":0,"inactive-value":1},null,8,["modelValue"])]),_:1})):R("",!0),t(d,{label:"多处登录"},{default:r(()=>[u("div",null,[t(x,{modelValue:a(l).multipoint_login,"onUpdate:modelValue":e[9]||(e[9]=o=>a(l).multipoint_login=o),"active-value":1,"inactive-value":0},null,8,["modelValue"]),se])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])])}}});export{be as _};
