import"./adapter-vue-20243c9c.js";import{q as v,o as C,h as G,C as $,z as j,B as J,i as W,J as X,_ as Q}from"./@tencentcloud-25a17c42.js";import Y from"./Icon-fec85db6.js";import K from"./index-15293322.js";import Z from"./index-aacb21ef.js";import{c as k,a as x,d as ee,i as te}from"./env-6b0ecdb8.js";import{d as se,r as o,aU as ne,aW as oe,o as i,c as u,aV as s,t as N,u as l,F as ie,aj as ae,a9 as I,a,G as re,aw as d}from"./@vue-25170201.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./constant-bad60a54.js";import"./index-3a577aae.js";import"./index-11528969.js";const ce="/business/assets/mute-94c8513a.svg",ue=["id"],le=["onClick","onLongpress","onContextmenu"],de={class:"left"},me={key:1,class:"num"},pe={key:2,class:"num-notify"},_e={class:"content"},fe={class:"content-header"},ve={class:"content-header-label"},Ce={class:"name"},he={class:"middle-box"},ge={key:0,class:"middle-box-draft"},ye={key:1,class:"middle-box-at"},Se={class:"middle-box-content"},De={class:"content-footer"},Le={class:"time"},be=se({__name:"index",emits:["handleSwitchConversation","getPassingRef"],setup(ke,{expose:V,emit:T}){const M=T,p=o(),h=o(),z=o(),_=o(!1),g=o([]),y=o(),f=o(),S=o({top:0,left:void 0,conversationHeight:void 0}),O=o(!1),m=o();let D=null;ne(()=>{v.watch(C.CONV,{currentConversationID:A,conversationList:U,currentConversation:w}),v.watch(C.USER,{displayOnlineStatus:R,userStatusList:B}),!k&&G&&!x&&F()}),oe(()=>{v.unwatch(C.CONV,{currentConversationID:A,conversationList:U,currentConversation:w}),v.unwatch(C.USER,{displayOnlineStatus:R,userStatusList:B})});const H=t=>O.value&&t.type===J.TYPES.CONV_C2C,L=(t,r,e,n)=>{n&&(t.preventDefault(),k)||(p.value=r,D=Date.now(),q(t,e))},P=()=>{D&&Date.now()-D>300&&(p.value=void 0,_.value=!1)},q=(t,r)=>{var e,n;if(k)typeof y.value>"u"&&M("getPassingRef",y),((e=W)==null?void 0:e.createSelectorQuery().in(y.value)).select(`#convlistitem-${r}`).boundingClientRect(b=>{b&&(S.value={top:b.bottom+(te?44:0),left:t.touches[0].pageX,conversationHeight:b.height},_.value=!0)}).exec();else{const c=((n=t.currentTarget||t.target)==null?void 0:n.getBoundingClientRect())||{};c&&(S.value={top:c.bottom,left:x?t.clientX:void 0,conversationHeight:c.height}),_.value=!0}},E=t=>{M("handleSwitchConversation",t),X.switchConversation(t)};function F(){f.value&&$({element:f.value,onLongPress:(t,r)=>{const e=Array.from(f.value.children).indexOf(r);L(t,g.value[e],e)},options:{eventDelegation:{subSelector:".tui-conversation-content"}}})}function w(t){p.value=t}function U(t){g.value=t}function A(t){h.value=t}function R(t){O.value=t}function B(t){t.size!==0&&(m.value=[...t.entries()].reduce((r,[e,n])=>(r[e]=n,r),{}))}return V({closeChildren:P}),(t,r)=>(i(),u("div",{ref_key:"conversationListInnerDomRef",ref:f,class:"tui-conversation-list"},[s(_)?(i(),N(Z,{key:0,selectedConversation:s(p),actionsMenuPosition:s(S),selectedConversationDomRect:s(z),onCloseConversationActionMenu:P},null,8,["selectedConversation","actionsMenuPosition","selectedConversationDomRect"])):l("",!0),(i(!0),u(ie,null,ae(s(g),(e,n)=>(i(),u("div",{id:`convlistitem-${n}`,key:n,class:I(["tui-conversation-content",s(ee)&&"tui-conversation-content-h5 disable-select"])},[a("div",{class:I([s(x)&&"isPC","tui-conversation-item",s(h)===e.conversationID&&"tui-conversation-item-selected",e.isPinned&&"tui-conversation-item-pinned"]),onClick:c=>E(e.conversationID),onLongpress:c=>L(c,e,n),onContextmenu:c=>L(c,e,n,!0)},[a("aside",de,[re(K,{useSkeletonAnimation:"",url:e.getAvatar(),size:"30px"},null,8,["url"]),s(m)&&H(e)?(i(),u("div",{key:0,class:I(["online-status",Object.keys(s(m)).length>0&&Object.keys(s(m)).includes(e.userProfile.userID)&&s(m)[e.userProfile.userID].statusType===1?"online-status-online":"online-status-offline"])},null,2)):l("",!0),e.unreadCount>0&&!e.isMuted?(i(),u("span",me,d(e.unreadCount>99?"99+":e.unreadCount),1)):l("",!0),e.unreadCount>0&&e.isMuted?(i(),u("span",pe)):l("",!0)]),a("div",_e,[a("div",fe,[a("label",ve,[a("p",Ce,d(e.getShowName()),1)]),a("div",he,[e.draftText&&e.conversationID!==s(h)?(i(),u("span",ge,d(s(j).t("TUIChat.[草稿]")),1)):e.type==="GROUP"&&e.groupAtInfoList&&e.groupAtInfoList.length>0?(i(),u("span",ye,d(e.getGroupAtInfo()),1)):l("",!0),a("div",Se,d(e.getLastMessage("text")),1)])]),a("div",De,[a("span",Le,d(e.getLastMessage("time")),1),e.isMuted?(i(),N(Y,{key:0,file:s(ce)},null,8,["file"])):l("",!0)])])],42,le)],10,ue))),128))],512))}});const je=Q(be,[["__scopeId","data-v-d3b64486"]]);export{je as default};
