var W=Object.defineProperty;var Z=(m,t,o)=>t in m?W(m,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[t]=o;var N=(m,t,o)=>(Z(m,typeof t!="symbol"?t+"":t,o),o);import{d as V,aZ as Q,b7 as tt,b1 as ot,aU as J,w as it,b2 as et,o as I,c as b,ak as nt,r as T,al as st,t as L,aM as g,a as v,aV as e,a9 as K,aO as S,G as c,aK as U,aX as x,u as F}from"./@vue-25170201.js";import{u as at,l as rt,i as G,c as A,e as k,f as Y,g as z,h as X,j as P}from"./index-7638d9aa.js";import{_ as j,B as ct,z as l,J as M,q as B,o as q}from"./@tencentcloud-25a17c42.js";import lt from"./NavBar-a9edd78d.js";import O from"./Profile-dddbbce1.js";import pt from"./ChatDefaultContent-9aef0fa9.js";import"./lodash-2cc29f39.js";import"./element-plus-64da2267.js";import{P as ut}from"./auth-29ea37c6.js";import{u as dt,a as ft}from"./vue-router-f7517f62.js";import"./@vueuse-944ef3f4.js";import"./axios-67477f72.js";import"./pinia-1182f1fa.js";import"./css-color-function-7acc3e97.js";import"./color-9254db0b.js";import"./clone-db6b0f3b.js";import"./color-convert-946e453a.js";import"./color-name-b7949e8c.js";import"./color-string-6fa48439.js";import"./balanced-match-51764fed.js";import"./ms-f6814399.js";import"./@element-plus-9559a6ac.js";import"./nprogress-ccaead9e.js";import"./@tiptap-008a465d.js";import"./prosemirror-state-c544e594.js";import"./prosemirror-model-8b0495eb.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-fc1f2a72.js";import"./prosemirror-view-ef3f9f96.js";import"./prosemirror-keymap-776f822d.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-5c2a1a07.js";import"./prosemirror-schema-list-1c96ec4d.js";import"./dayjs-346d7cd4.js";import"./vue-clipboard3-f5f9feb9.js";import"./clipboard-3d849c41.js";import"./echarts-d6620a89.js";import"./zrender-9797a04d.js";import"./tslib-54e39b60.js";import"./highlight.js-1b502259.js";import"./@highlightjs-7a15facb.js";import"./path-to-regexp-767716ea.js";import"./lodash-es-fbce1780.js";import"./async-validator-dee29e8b.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./normalize-wheel-es-ed76fb12.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./adapter-vue-20243c9c.js";import"./Icon-fec85db6.js";import"./env-6b0ecdb8.js";import"./index-15293322.js";import"./About-86c8435c.js";import"./back-51a4f00d.js";import"./link-e8efd864.js";import"./qs-47c740e6.js";import"./side-channel-5af5dc16.js";import"./get-intrinsic-88feedc6.js";import"./es-errors-82fd953f.js";import"./has-symbols-e8f3ca0e.js";import"./has-proto-1353c55e.js";import"./function-bind-61637ca6.js";import"./hasown-bc561cf0.js";import"./call-bind-9ec8ebd8.js";import"./set-function-length-ecd19468.js";import"./define-data-property-d38573ea.js";import"./es-define-property-cfa03815.js";import"./gopd-4c4454f6.js";import"./has-property-descriptors-68e2873e.js";import"./object-inspect-7afb2433.js";import"./EditProfile-05c554a4.js";import"./index-ebb29dde.js";import"./index-9521edcb.js";import"./EditProfilePopup.vue_vue_type_script_setup_true_lang-a9f56478.js";import"./index-28e12cb3.js";import"./index-c86991f7.js";import"./date-picker-panel-245cd44c.js";import"./date-table-21a73c34.js";import"./right-icon-312a665a.js";import"./enableSampleTaskStatus-86998722.js";const ht=V({__name:"index",props:{show:{type:Boolean,default:()=>!1},domClassName:{type:String,default:""}},setup(m,{expose:t}){const o=m,i=Q({show:!1,domClassName:"",startPosition:{left:"",top:"",cssText:""}}),s=tt();ot(()=>{i.show=o.show,i.domClassName=o.domClassName}),J(()=>{let d=!1,n=document==null?void 0:document.getElementsByClassName(o.domClassName)[0];it(()=>i.show,(C,_)=>{i.show=C,C!==_&&i.show===!0&&et(()=>{var w,h,r;n=document==null?void 0:document.getElementsByClassName(o.domClassName)[0],n&&(n.style.left=(w=i.startPosition)==null?void 0:w.left,n.style.top=(h=i.startPosition)==null?void 0:h.top,n.style.cssText=(r=i.startPosition)==null?void 0:r.cssText,n.addEventListener("mousedown",f))})});const f=C=>{d=!0;const _=C.clientX-n.offsetLeft,w=C.clientY-n.offsetTop,h=r=>{r.preventDefault(),d&&(n.style.left=`${r.clientX-_}px`,n.style.top=`${r.clientY-w}px`)};document.addEventListener("mousemove",a(h,20),!1),document.addEventListener("mouseup",()=>{d=!1,document.removeEventListener("mousemove",h)})}});function a(d,n){let f=0;return function(...C){const _=+new Date;_-f>n&&(f=_,d.apply(s,C))}}return t({positionReset:()=>{var n,f,C;const d=document==null?void 0:document.getElementsByClassName(o.domClassName)[0];i.startPosition={left:"",top:"",cssText:""},d&&(d.style.left=(n=i.startPosition)==null?void 0:n.left,d.style.top=(f=i.startPosition)==null?void 0:f.top,d.style.cssText=(C=i.startPosition)==null?void 0:C.cssText)}}),(d,n)=>(I(),b("div",null,[nt(d.$slots,"default",{},void 0,!0)]))}});const mt=j(ht,[["__scopeId","data-v-6a8abba2"]]);function D(m="{}"){try{return JSON.parse(m)}catch{return{}}}function $(m){var o;const{businessID:t}=D((o=m.payload)==null?void 0:o.data);return t==="user_typing_status"}const u=ct.TYPES,E=class E{constructor(t){N(this,"showPreviews",!0);N(this,"allowNotifications",!0);N(this,"notificationTitle",l.t("TUIChat.腾讯云 IM"));N(this,"notificationIcon","https://web.sdk.qcloud.com/im/demo/latest/faviconnew.png");this.setConfiguration(t)}static getInstance(t){return this.instance||(this.instance=new E(t)),this.instance}async notify(t){const o=await this.requestNotificationPermission();!this.allowNotifications||!o||!this.isMessageNeedNotification(t)||await this.handleNotification(t)}async handleNotification(t){let o={badge:this.notificationIcon,icon:this.notificationIcon,body:"",requireInteraction:!1};const i=this.getNotificationType(t);let s,a;switch(i){case"call":({content:s,callEnd:a}=this.getCallNotificationInfo(t)),o={...o,body:s,requireInteraction:!a};break;case"chat":o={...o,body:await this.getChatNotificationContent(t),requireInteraction:!1};break}const p=new Notification(this.notificationTitle,o);p.onclick=async()=>{var d;if(window.focus(),!(!t||!t.conversationID)){if((t==null?void 0:t.conversationType)===u.CONV_C2C||(t==null?void 0:t.conversationType)===u.CONV_GROUP){const n=await M.getConversationProfile(t.conversationID),{conversationID:f}=((d=n==null?void 0:n.data)==null?void 0:d.conversation)||{};f&&M.switchConversation(f)}p.close()}}}setNotificationConfiguration(t){this.setConfiguration(t)}checkNotificationAbility(){return!!(window&&"Notification"in window)}async requestNotificationPermission(){if(!this.checkNotificationAbility())return console.error("The browser does not support notifications."),!1;if(window.Notification.permission==="granted")return!0;try{if(await Notification.requestPermission()==="granted")return!0}catch{return!1}return!1}checkPageFocus(){return document.hasFocus()}setConfiguration(t){t&&(t.allowNotifications!==void 0&&(this.allowNotifications=t.allowNotifications),t.showPreviews!==void 0&&(this.showPreviews=t.showPreviews),t.notificationTitle!==void 0&&(this.notificationTitle=t.notificationTitle),t.notificationIcon!==void 0&&(this.notificationIcon=t.notificationIcon))}isMessageNeedNotification(t){if(!t||!t.ID||!t.type||t.isRevoked||t.isDeleted||$!=null&&$(t)||t.type===u.MSG_GRP_TIP||t.type===u.MSG_GRP_SYS_NOTICE)return!1;const o=B.getData(q.CONV,"currentConversationID");return!(this.checkPageFocus()&&(t==null?void 0:t.conversationID)===o)}getNotificationType(t){var o;if(t.type===u.MSG_CUSTOM){const{businessID:i}=D((o=t.payload)==null?void 0:o.data);if(i===1||i==="av_call")return"call"}return"chat"}async getChatNotificationContent(t){let o="";if(!t||!t.ID||!t.type)return o;if(this.showPreviews)o=await this.getChatNotificationContentTitle(t),o+=this.getChatNotificationContentText(t);else{const i=B.getData(q.CONV,"totalUnreadCount");o=`${l.t("TUIChat.您有")} ${i} ${l.t("TUIChat.条新消息")}`}return o}async getChatNotificationContentTitle(t){var a,p;let o="",i,s;switch(t.conversationType){case u.CONV_C2C:o=(t.nick||t.from)+": ";break;case u.CONV_GROUP:i=await M.getConversationProfile(t.conversationID),s=(a=i==null?void 0:i.data)==null?void 0:a.conversation,o=((p=s==null?void 0:s.groupProfile)==null?void 0:p.name)||t.conversationID,o+=": ";break;case u.CONV_SYSTEM:o=`${l.t("TUIChat.系统消息")}: `;break}return o}getChatNotificationContentText(t){var i;let o="";switch(t.type){case u.MSG_TEXT:o+=(i=t==null?void 0:t.payload)==null?void 0:i.text;break;case u.MSG_CUSTOM:o+=l.t("TUIChat.自定义");break;case u.MSG_IMAGE:o+=l.t("TUIChat.图片");break;case u.MSG_AUDIO:o+=l.t("TUIChat.语音");break;case u.MSG_VIDEO:o+=l.t("TUIChat.视频");break;case u.MSG_FILE:o+=l.t("TUIChat.文件");break;case u.MSG_FACE:o+=l.t("TUIChat.表情");break;case u.MSG_MERGER:o+=l.t("TUIChat.聊天记录");break;case u.MSG_LOCATION:o+=l.t("TUIChat.位置");break}return o}getCallNotificationInfo(t){var s;let o="",i=!1;try{if(t.type!==u.MSG_CUSTOM||!((s=t.payload)!=null&&s.data))throw new Error;const a=D(t.payload.data),p=D(a.data);if(a.businessID!==1)throw new Error;switch(a.actionType){case 1:(a.groupID&&a.timeout>0||!a.call_end&&!a.groupID&&!(p!=null&&p.data&&((p==null?void 0:p.data.cmd)==="switchToAudio"||(p==null?void 0:p.data.cmd)==="switchToVideo")))&&(i=!1,o=this.showPreviews?`${a.inviter} ${l.t("TUIChat.发起通话")}`:`${l.t("TUIChat.发起通话")}`);break;case 2:i=!0,o=this.showPreviews?`${a.inviter} ${l.t("TUIChat.取消通话")}`:`${l.t("TUIChat.取消通话")}`;break;default:throw new Error}}catch(a){console.warn(a)}return{content:o,callEnd:i}}};N(E,"instance",null);let R=E;R.getInstance();const vt=["id"],Ct={class:"home-menu"},wt={class:"home-main"},_t={class:"home-TUIKit"},yt={key:0,class:"home-TUIKit-navbar"},Tt={key:1,class:"home-TUIKit-main"},It={class:"home-TUIKit-main"},Nt={class:"home-conversation"},St={class:"home-chat"},Ut={class:"home-TUIKit-main"},bt={key:2,class:"home-TUIKit-main"},gt={key:0,class:"home-TUIKit-main"},kt={class:"home-TUIKit-main"},Pt={class:"home-TUIKit-main"},Mt={class:"home-TUIKit-main"},Dt=V({name:"userSetting"}),Et=V({...Dt,props:{language:{default:"zh"}},emits:["changeLanguage","handleSwitchConversation"],setup(m,{emit:t}){T(m.language);const i=T(!1),s=T("message"),a=T(""),p=T(!1);T(!1);const d=T(),n=T(!1);at();const f=dt(),C=ft();B.watch(q.CONV,{currentConversationID:h=>{a.value=h}});function _(h){i.value=h}J(()=>{l.provideLanguages(rt),l.useI18n(),l.changeLanguage("zh"),w()});function w(h){h=f.query.conversationId,f.query.conversationId&&M.switchConversation(h).then(()=>{console.log("Switched conversation successfully"),console.log(f.query.conversationId)}).catch(r=>{console.error("Failed to switch conversation:",r)}),C.push({query:{...f.query,conversationId:h}})}return(h,r)=>{const H=st("Menu");return I(),L(ut,null,{default:g(()=>[v("button",{onClick:w},"切换聊天"),v("div",{id:e(G)?"preloadedImages":"",class:K(["home",e(A)&&"home-h5"])},[S(v("div",Ct,[c(H,{onCloseMenu:r[0]||(r[0]=y=>_(!1))})],512),[[U,e(i)]]),v("div",{class:K(["home-container",e(i)&&"menu-expand"])},[v("div",wt,[v("div",_t,[e(G)||!e(a)?(I(),b("div",yt,[c(lt,{currentNavBar:e(s),"onUpdate:currentNavBar":r[2]||(r[2]=y=>x(s)?s.value=y:null),isSettingShow:e(n),"onUpdate:isSettingShow":r[3]||(r[3]=y=>x(n)?n.value=y:null)},{profile:g(()=>[c(O,{"display-type":"profile"})]),setting:g(()=>[c(O,{showSetting:e(n),"onUpdate:showSetting":r[1]||(r[1]=y=>x(n)?n.value=y:null),"display-type":"setting"},null,8,["showSetting"])]),_:1},8,["currentNavBar","isSettingShow"])])):F("",!0),e(G)?(I(),b("div",Tt,[S(v("div",It,[v("div",Nt,[c(e(k),{searchType:"global"}),c(e(Y),{onSelectConversation:w})]),v("div",St,[c(e(z),null,{default:g(()=>[c(pt)]),_:1}),c(e(X),{class:"chat-aside"}),c(e(k),{class:"chat-aside",searchType:"conversation"})]),c(e(P),{"display-type":"selectFriend"})],512),[[U,e(s)==="message"]]),S(v("div",Ut,[c(e(P),{"display-type":"contactList",onSwitchConversation:r[4]||(r[4]=y=>s.value="message")})],512),[[U,e(s)==="relation"]])])):e(A)?(I(),b("div",bt,[e(a)?(I(),L(e(z),{key:1})):(I(),b("div",gt,[S(v("div",kt,[c(e(k),{searchType:"global"}),c(e(Y),{onSelectConversation:w}),c(e(P),{"display-type":"selectFriend"})],512),[[U,e(s)==="message"]]),S(v("div",Pt,[c(e(P),{"display-type":"contactList",onSwitchConversation:r[5]||(r[5]=y=>s.value="message")})],512),[[U,e(s)==="relation"]]),S(v("div",Mt,[c(O,{"display-type":"all"})],512),[[U,e(s)==="profile"]])])),c(e(X),{class:"chat-popup"}),c(e(k),{class:"chat-popup",searchType:"conversation"})])):F("",!0),c(e(mt),{ref_key:"dragRef",ref:d,show:e(p),domClassName:"callkit-drag-container"},null,8,["show"])])])],2)],10,vt)]),_:1})}}});const mi=j(Et,[["__scopeId","data-v-019d7f22"]]);export{mi as default};
