import{P as $,a as B,S as R,E as _t,T as O,N as Tt}from"./prosemirror-state-c544e594.js";import{E as Kt,D as At,a as Ct}from"./prosemirror-view-ef3f9f96.js";import{k as Wt}from"./prosemirror-keymap-776f822d.js";import{D as Vt,F as W,S as qt,a as Ut,b as Jt}from"./prosemirror-model-8b0495eb.js";import{l as Gt,c as V,R as Qt,a as Xt,b as Pt}from"./prosemirror-transform-fc1f2a72.js";import{c as Yt,d as Zt,e as te,j as ee,a as ne,b as re,f as se,l as oe,g as ie,n as ae,s as ce,h as le,i as de,k as ue,m as fe,o as bt,w as pe}from"./prosemirror-commands-5c2a1a07.js";import{l as me,s as he,w as ge}from"./prosemirror-schema-list-1c96ec4d.js";function Q(n){const{state:t,transaction:e}=n;let{selection:r}=e,{doc:s}=e,{storedMarks:o}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),filterTransaction:t.filterTransaction,plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return r},get doc(){return s},get tr(){return r=e.selection,s=e.doc,o=e.storedMarks,e}}}class X{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:r}=this,{view:s}=e,{tr:o}=r,i=this.buildProps(o);return Object.fromEntries(Object.entries(t).map(([a,c])=>[a,(...d)=>{const f=c(...d)(i);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(o),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:r,editor:s,state:o}=this,{view:i}=s,a=[],c=!!t,l=t||o.tr,d=()=>(!c&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),a.every(u=>u===!0)),f={...Object.fromEntries(Object.entries(r).map(([u,p])=>[u,(...m)=>{const h=this.buildProps(l,e),b=p(...m)(h);return a.push(b),f}])),run:d};return f}createCan(t){const{rawCommands:e,state:r}=this,s=!1,o=t||r.tr,i=this.buildProps(o,s);return{...Object.fromEntries(Object.entries(e).map(([c,l])=>[c,(...d)=>l(...d)({...i,dispatch:void 0})])),chain:()=>this.createChain(o,s)}}buildProps(t,e=!0){const{rawCommands:r,editor:s,state:o}=this,{view:i}=s;o.storedMarks&&t.setStoredMarks(o.storedMarks);const a={tr:t,editor:s,view:i,state:Q({state:o,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(r).map(([c,l])=>[c,(...d)=>l(...d)(a)]))}};return a}}class ye{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const r=this.callbacks[t];return r&&r.forEach(s=>s.apply(this,e)),this}off(t,e){const r=this.callbacks[t];return r&&(e?this.callbacks[t]=r.filter(s=>s!==e):delete this.callbacks[t]),this}removeAllListeners(){this.callbacks={}}}function y(n,t,e){return n.config[t]===void 0&&n.parent?y(n.parent,t,e):typeof n.config[t]=="function"?n.config[t].bind({...e,parent:n.parent?y(n.parent,t,e):null}):n.config[t]}function Y(n){const t=n.filter(s=>s.type==="extension"),e=n.filter(s=>s.type==="node"),r=n.filter(s=>s.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:r}}function Ot(n){const t=[],{nodeExtensions:e,markExtensions:r}=Y(n),s=[...e,...r],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage},c=y(i,"addGlobalAttributes",a);if(!c)return;c().forEach(d=>{d.types.forEach(f=>{Object.entries(d.attributes).forEach(([u,p])=>{t.push({type:f,name:u,attribute:{...o,...p}})})})})}),s.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage},c=y(i,"addAttributes",a);if(!c)return;const l=c();Object.entries(l).forEach(([d,f])=>{const u={...o,...f};f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete u.default,t.push({type:i.name,name:d,attribute:u})})}),t}function E(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}function Z(...n){return n.filter(t=>!!t).reduce((t,e)=>{const r={...t};return Object.entries(e).forEach(([s,o])=>{if(!r[s]){r[s]=o;return}s==="class"?r[s]=[r[s],o].join(" "):s==="style"?r[s]=[r[s],o].join("; "):r[s]=o}),r},{})}function lt(n,t){return t.filter(e=>e.attribute.rendered).map(e=>e.attribute.renderHTML?e.attribute.renderHTML(n.attrs)||{}:{[e.name]:n.attrs[e.name]}).reduce((e,r)=>Z(e,r),{})}function $t(n){return typeof n=="function"}function v(n,t=void 0,...e){return $t(n)?t?n.bind(t)(...e):n(...e):n}function be(n={}){return Object.keys(n).length===0&&n.constructor===Object}function ve(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function vt(n,t){return n.style?n:{...n,getAttrs:e=>{const r=n.getAttrs?n.getAttrs(e):n.attrs;if(r===!1)return!1;const s=t.reduce((o,i)=>{const a=i.attribute.parseHTML?i.attribute.parseHTML(e):ve(e.getAttribute(i.name));return a==null?o:{...o,[i.name]:a}},{});return{...r,...s}}}}function wt(n){return Object.fromEntries(Object.entries(n).filter(([t,e])=>t==="attrs"&&be(e)?!1:e!=null))}function we(n){var t;const e=Ot(n),{nodeExtensions:r,markExtensions:s}=Y(n),o=(t=r.find(c=>y(c,"topNode")))===null||t===void 0?void 0:t.name,i=Object.fromEntries(r.map(c=>{const l=e.filter(h=>h.type===c.name),d={name:c.name,options:c.options,storage:c.storage},f=n.reduce((h,b)=>{const w=y(b,"extendNodeSchema",d);return{...h,...w?w(c):{}}},{}),u=wt({...f,content:v(y(c,"content",d)),marks:v(y(c,"marks",d)),group:v(y(c,"group",d)),inline:v(y(c,"inline",d)),atom:v(y(c,"atom",d)),selectable:v(y(c,"selectable",d)),draggable:v(y(c,"draggable",d)),code:v(y(c,"code",d)),defining:v(y(c,"defining",d)),isolating:v(y(c,"isolating",d)),attrs:Object.fromEntries(l.map(h=>{var b;return[h.name,{default:(b=h==null?void 0:h.attribute)===null||b===void 0?void 0:b.default}]}))}),p=v(y(c,"parseHTML",d));p&&(u.parseDOM=p.map(h=>vt(h,l)));const g=y(c,"renderHTML",d);g&&(u.toDOM=h=>g({node:h,HTMLAttributes:lt(h,l)}));const m=y(c,"renderText",d);return m&&(u.toText=m),[c.name,u]})),a=Object.fromEntries(s.map(c=>{const l=e.filter(m=>m.type===c.name),d={name:c.name,options:c.options,storage:c.storage},f=n.reduce((m,h)=>{const b=y(h,"extendMarkSchema",d);return{...m,...b?b(c):{}}},{}),u=wt({...f,inclusive:v(y(c,"inclusive",d)),excludes:v(y(c,"excludes",d)),group:v(y(c,"group",d)),spanning:v(y(c,"spanning",d)),code:v(y(c,"code",d)),attrs:Object.fromEntries(l.map(m=>{var h;return[m.name,{default:(h=m==null?void 0:m.attribute)===null||h===void 0?void 0:h.default}]}))}),p=v(y(c,"parseHTML",d));p&&(u.parseDOM=p.map(m=>vt(m,l)));const g=y(c,"renderHTML",d);return g&&(u.toDOM=m=>g({mark:m,HTMLAttributes:lt(m,l)})),[c.name,u]}));return new Ut({topNode:o,nodes:i,marks:a})}function st(n,t){return t.nodes[n]||t.marks[n]||null}function kt(n,t){return Array.isArray(t)?t.some(e=>(typeof e=="string"?e:e.name)===n.name):t}const ke=(n,t=500)=>{let e="";const r=n.parentOffset;return n.parent.nodesBetween(Math.max(0,r-t),r,(s,o,i,a)=>{var c,l;const d=((l=(c=s.type.spec).toText)===null||l===void 0?void 0:l.call(c,{node:s,pos:o,parent:i,index:a}))||s.textContent||"%leaf%";e+=d.slice(0,Math.max(0,r-o))}),e};function ft(n){return Object.prototype.toString.call(n)==="[object RegExp]"}class Me{constructor(t){this.find=t.find,this.handler=t.handler}}const Se=(n,t)=>{if(ft(t))return t.exec(n);const e=t(n);if(!e)return null;const r=[e.text];return r.index=e.index,r.input=n,r.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(e.replaceWith)),r};function ot(n){var t;const{editor:e,from:r,to:s,text:o,rules:i,plugin:a}=n,{view:c}=e;if(c.composing)return!1;const l=c.state.doc.resolve(r);if(l.parent.type.spec.code||!((t=l.nodeBefore||l.nodeAfter)===null||t===void 0)&&t.marks.find(u=>u.type.spec.code))return!1;let d=!1;const f=ke(l)+o;return i.forEach(u=>{if(d)return;const p=Se(f,u.find);if(!p)return;const g=c.state.tr,m=Q({state:c.state,transaction:g}),h={from:r-(p[0].length-o.length),to:s},{commands:b,chain:w,can:S}=new X({editor:e,state:m});u.handler({state:m,range:h,match:p,commands:b,chain:w,can:S})===null||!g.steps.length||(g.setMeta(a,{transform:g,from:r,to:s,text:o}),c.dispatch(g),d=!0)}),d}function xe(n){const{editor:t,rules:e}=n,r=new $({state:{init(){return null},apply(s,o){const i=s.getMeta(r);return i||(s.selectionSet||s.docChanged?null:o)}},props:{handleTextInput(s,o,i,a){return ot({editor:t,from:o,to:i,text:a,rules:e,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:o}=s.state.selection;o&&ot({editor:t,from:o.pos,to:o.pos,text:"",rules:e,plugin:r})}),!1)},handleKeyDown(s,o){if(o.key!=="Enter")return!1;const{$cursor:i}=s.state.selection;return i?ot({editor:t,from:i.pos,to:i.pos,text:`
`,rules:e,plugin:r}):!1}},isInputRules:!0});return r}function Ee(n){return typeof n=="number"}const Te=(n,t)=>{if(ft(t))return[...n.matchAll(t)];const e=t(n);return e?e.map(r=>{const s=[r.text];return s.index=r.index,s.input=n,s.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(r.replaceWith)),s}):[]};function Ae(n){const{editor:t,state:e,from:r,to:s,rule:o}=n,{commands:i,chain:a,can:c}=new X({editor:t,state:e}),l=[];return e.doc.nodesBetween(r,s,(f,u)=>{if(!f.isTextblock||f.type.spec.code)return;const p=Math.max(r,u),g=Math.min(s,u+f.content.size),m=f.textBetween(p-u,g-u,void 0,"ï¿¼");Te(m,o.find).forEach(b=>{if(b.index===void 0)return;const w=p+b.index+1,S=w+b[0].length,M={from:e.tr.mapping.map(w),to:e.tr.mapping.map(S)},x=o.handler({state:e,range:M,match:b,commands:i,chain:a,can:c});l.push(x)})}),l.every(f=>f!==null)}function Ce(n){const{editor:t,rules:e}=n;let r=null,s=!1,o=!1;return e.map(a=>new $({view(c){const l=d=>{var f;r=!((f=c.dom.parentElement)===null||f===void 0)&&f.contains(d.target)?c.dom.parentElement:null};return window.addEventListener("dragstart",l),{destroy(){window.removeEventListener("dragstart",l)}}},props:{handleDOMEvents:{drop:c=>(o=r===c.dom.parentElement,!1),paste:(c,l)=>{var d;const f=(d=l.clipboardData)===null||d===void 0?void 0:d.getData("text/html");return s=!!(f!=null&&f.includes("data-pm-slice")),!1}}},appendTransaction:(c,l,d)=>{const f=c[0],u=f.getMeta("uiEvent")==="paste"&&!s,p=f.getMeta("uiEvent")==="drop"&&!o;if(!u&&!p)return;const g=l.doc.content.findDiffStart(d.doc.content),m=l.doc.content.findDiffEnd(d.doc.content);if(!Ee(g)||!m||g===m.b)return;const h=d.tr,b=Q({state:d,transaction:h});if(!(!Ae({editor:t,state:b,from:Math.max(g-1,0),to:m.b-1,rule:a})||!h.steps.length))return h}}))}function Pe(n){const t=n.filter((e,r)=>n.indexOf(e)!==r);return[...new Set(t)]}class F{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=F.resolve(t),this.schema=we(this.extensions),this.extensions.forEach(r=>{var s;this.editor.extensionStorage[r.name]=r.storage;const o={name:r.name,options:r.options,storage:r.storage,editor:this.editor,type:st(r.name,this.schema)};r.type==="mark"&&(!((s=v(y(r,"keepOnSplit",o)))!==null&&s!==void 0)||s)&&this.splittableMarks.push(r.name);const i=y(r,"onBeforeCreate",o);i&&this.editor.on("beforeCreate",i);const a=y(r,"onCreate",o);a&&this.editor.on("create",a);const c=y(r,"onUpdate",o);c&&this.editor.on("update",c);const l=y(r,"onSelectionUpdate",o);l&&this.editor.on("selectionUpdate",l);const d=y(r,"onTransaction",o);d&&this.editor.on("transaction",d);const f=y(r,"onFocus",o);f&&this.editor.on("focus",f);const u=y(r,"onBlur",o);u&&this.editor.on("blur",u);const p=y(r,"onDestroy",o);p&&this.editor.on("destroy",p)})}static resolve(t){const e=F.sort(F.flatten(t)),r=Pe(e.map(s=>s.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),e}static flatten(t){return t.map(e=>{const r={name:e.name,options:e.options,storage:e.storage},s=y(e,"addExtensions",r);return s?[e,...this.flatten(s())]:e}).flat(10)}static sort(t){return t.sort((r,s)=>{const o=y(r,"priority")||100,i=y(s,"priority")||100;return o>i?-1:o<i?1:0})}get commands(){return this.extensions.reduce((t,e)=>{const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:st(e.name,this.schema)},s=y(e,"addCommands",r);return s?{...t,...s()}:t},{})}get plugins(){const{editor:t}=this,e=F.sort([...this.extensions].reverse()),r=[],s=[],o=e.map(i=>{const a={name:i.name,options:i.options,storage:i.storage,editor:t,type:st(i.name,this.schema)},c=[],l=y(i,"addKeyboardShortcuts",a);let d={};if(i.type==="mark"&&i.config.exitable&&(d.ArrowRight=()=>G.handleExit({editor:t,mark:i})),l){const m=Object.fromEntries(Object.entries(l()).map(([h,b])=>[h,()=>b({editor:t})]));d={...d,...m}}const f=Wt(d);c.push(f);const u=y(i,"addInputRules",a);kt(i,t.options.enableInputRules)&&u&&r.push(...u());const p=y(i,"addPasteRules",a);kt(i,t.options.enablePasteRules)&&p&&s.push(...p());const g=y(i,"addProseMirrorPlugins",a);if(g){const m=g();c.push(...m)}return c}).flat();return[xe({editor:t,rules:r}),...Ce({editor:t,rules:s}),...o]}get attributes(){return Ot(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Y(this.extensions);return Object.fromEntries(e.filter(r=>!!y(r,"addNodeView")).map(r=>{const s=this.attributes.filter(c=>c.type===r.name),o={name:r.name,options:r.options,storage:r.storage,editor:t,type:E(r.name,this.schema)},i=y(r,"addNodeView",o);if(!i)return[];const a=(c,l,d,f)=>{const u=lt(c,s);return i()({editor:t,node:c,getPos:d,decorations:f,HTMLAttributes:u,extension:r})};return[r.name,a]}))}}function Oe(n){return Object.prototype.toString.call(n).slice(8,-1)}function it(n){return Oe(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function tt(n,t){const e={...n};return it(n)&&it(t)&&Object.keys(t).forEach(r=>{it(t[r])?r in n?e[r]=tt(n[r],t[r]):Object.assign(e,{[r]:t[r]}):Object.assign(e,{[r]:t[r]})}),e}class P{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=v(y(this,"addOptions",{name:this.name}))),this.storage=v(y(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new P(t)}configure(t={}){const e=this.extend();return e.options=tt(this.options,t),e.storage=v(y(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new P(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=v(y(e,"addOptions",{name:e.name})),e.storage=v(y(e,"addStorage",{name:e.name,options:e.options})),e}}function Nt(n,t,e){const{from:r,to:s}=t,{blockSeparator:o=`

`,textSerializers:i={}}=e||{};let a="",c=!0;return n.nodesBetween(r,s,(l,d,f,u)=>{var p;const g=i==null?void 0:i[l.type.name];g?(l.isBlock&&!c&&(a+=o,c=!0),f&&(a+=g({node:l,pos:d,parent:f,index:u,range:t}))):l.isText?(a+=(p=l==null?void 0:l.text)===null||p===void 0?void 0:p.slice(Math.max(r,d)-d,s-d),c=!1):l.isBlock&&!c&&(a+=o,c=!0)}),a}function Bt(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}const $e=P.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new $({key:new B("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:t,schema:e}=n,{doc:r,selection:s}=t,{ranges:o}=s,i=Math.min(...o.map(d=>d.$from.pos)),a=Math.max(...o.map(d=>d.$to.pos)),c=Bt(e);return Nt(r,{from:i,to:a},{textSerializers:c})}}})]}}),Ne=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var e;n.isDestroyed||(t.dom.blur(),(e=window==null?void 0:window.getSelection())===null||e===void 0||e.removeAllRanges())}),!0),Be=(n=!1)=>({commands:t})=>t.setContent("",n),Ie=()=>({state:n,tr:t,dispatch:e})=>{const{selection:r}=t,{ranges:s}=r;return e&&s.forEach(({$from:o,$to:i})=>{n.doc.nodesBetween(o.pos,i.pos,(a,c)=>{if(a.type.isText)return;const{doc:l,mapping:d}=t,f=l.resolve(d.map(c)),u=l.resolve(d.map(c+a.nodeSize)),p=f.blockRange(u);if(!p)return;const g=Gt(p);if(a.type.isTextblock){const{defaultType:m}=f.parent.contentMatchAt(f.index());t.setNodeMarkup(p.start,m)}(g||g===0)&&t.lift(p,g)})}),!0},Le=n=>t=>n(t),je=()=>({state:n,dispatch:t})=>Yt(n,t),Fe=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,r=e.$anchor.node();if(r.content.size>0)return!1;const s=n.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===r.type){if(t){const a=s.before(o),c=s.after(o);n.delete(a,c).scrollIntoView()}return!0}return!1},Re=n=>({tr:t,state:e,dispatch:r})=>{const s=E(n,e.schema),o=t.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===s){if(r){const c=o.before(i),l=o.after(i);t.delete(c,l).scrollIntoView()}return!0}return!1},De=n=>({tr:t,dispatch:e})=>{const{from:r,to:s}=n;return e&&t.delete(r,s),!0},He=()=>({state:n,dispatch:t})=>Zt(n,t),ze=()=>({commands:n})=>n.keyboardShortcut("Enter"),_e=()=>({state:n,dispatch:t})=>te(n,t);function U(n,t,e={strict:!0}){const r=Object.keys(t);return r.length?r.every(s=>e.strict?t[s]===n[s]:ft(t[s])?t[s].test(n[s]):t[s]===n[s]):!0}function dt(n,t,e={}){return n.find(r=>r.type===t&&U(r.attrs,e))}function Ke(n,t,e={}){return!!dt(n,t,e)}function It(n,t,e={}){if(!n||!t)return;let r=n.parent.childAfter(n.parentOffset);if(n.parentOffset===r.offset&&r.offset!==0&&(r=n.parent.childBefore(n.parentOffset)),!r.node)return;const s=dt([...r.node.marks],t,e);if(!s)return;let o=r.index,i=n.start()+r.offset,a=o+1,c=i+r.node.nodeSize;for(dt([...r.node.marks],t,e);o>0&&s.isInSet(n.parent.child(o-1).marks);)o-=1,i-=n.parent.child(o).nodeSize;for(;a<n.parent.childCount&&Ke([...n.parent.child(a).marks],t,e);)c+=n.parent.child(a).nodeSize,a+=1;return{from:i,to:c}}function I(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}const We=(n,t={})=>({tr:e,state:r,dispatch:s})=>{const o=I(n,r.schema),{doc:i,selection:a}=e,{$from:c,from:l,to:d}=a;if(s){const f=It(c,o,t);if(f&&f.from<=l&&f.to>=d){const u=O.create(i,f.from,f.to);e.setSelection(u)}}return!0},Ve=n=>t=>{const e=typeof n=="function"?n(t):n;for(let r=0;r<e.length;r+=1)if(e[r](t))return!0;return!1};function Lt(n){return n instanceof O}function L(n=0,t=0,e=0){return Math.min(Math.max(n,t),e)}function jt(n,t=null){if(!t)return null;const e=R.atStart(n),r=R.atEnd(n);if(t==="start"||t===!0)return e;if(t==="end")return r;const s=e.from,o=r.to;return t==="all"?O.create(n,L(0,s,o),L(n.content.size,s,o)):O.create(n,L(t,s,o),L(t,s,o))}function pt(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const qe=(n=null,t={})=>({editor:e,view:r,tr:s,dispatch:o})=>{t={scrollIntoView:!0,...t};const i=()=>{pt()&&r.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(r.focus(),t!=null&&t.scrollIntoView&&e.commands.scrollIntoView())})};if(r.hasFocus()&&n===null||n===!1)return!0;if(o&&n===null&&!Lt(e.state.selection))return i(),!0;const a=jt(s.doc,n)||e.state.selection,c=e.state.selection.eq(a);return o&&(c||s.setSelection(a),c&&s.storedMarks&&s.setStoredMarks(s.storedMarks),i()),!0},Ue=(n,t)=>e=>n.every((r,s)=>t(r,{...e,index:s})),Je=(n,t)=>({tr:e,commands:r})=>r.insertContentAt({from:e.selection.from,to:e.selection.to},n,t);function Mt(n){const t=`<body>${n}</body>`;return new window.DOMParser().parseFromString(t,"text/html").body}function J(n,t,e){if(e={slice:!0,parseOptions:{},...e},typeof n=="object"&&n!==null)try{return Array.isArray(n)&&n.length>0?W.fromArray(n.map(r=>t.nodeFromJSON(r))):t.nodeFromJSON(n)}catch(r){return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",r),J("",t,e)}if(typeof n=="string"){const r=Jt.fromSchema(t);return e.slice?r.parseSlice(Mt(n),e.parseOptions).content:r.parse(Mt(n),e.parseOptions)}return J("",t,e)}function Ge(n,t,e){const r=n.steps.length-1;if(r<t)return;const s=n.steps[r];if(!(s instanceof Qt||s instanceof Xt))return;const o=n.mapping.maps[r];let i=0;o.forEach((a,c,l,d)=>{i===0&&(i=d)}),n.setSelection(R.near(n.doc.resolve(i),e))}const Qe=n=>n.toString().startsWith("<"),Xe=(n,t,e)=>({tr:r,dispatch:s,editor:o})=>{if(s){e={parseOptions:{},updateSelection:!0,...e};const i=J(t,o.schema,{parseOptions:{preserveWhitespace:"full",...e.parseOptions}});if(i.toString()==="<>")return!0;let{from:a,to:c}=typeof n=="number"?{from:n,to:n}:n,l=!0,d=!0;if((Qe(i)?i:[i]).forEach(u=>{u.check(),l=l?u.isText&&u.marks.length===0:!1,d=d?u.isBlock:!1}),a===c&&d){const{parent:u}=r.doc.resolve(a);u.isTextblock&&!u.type.spec.code&&!u.childCount&&(a-=1,c+=1)}l?Array.isArray(t)?r.insertText(t.map(u=>u.text||"").join(""),a,c):typeof t=="object"&&t&&t.text?r.insertText(t.text,a,c):r.insertText(t,a,c):r.replaceWith(a,c,i),e.updateSelection&&Ge(r,r.steps.length-1,-1)}return!0},Ye=()=>({state:n,dispatch:t})=>ee(n,t),Ze=()=>({state:n,dispatch:t})=>ne(n,t),tn=()=>({state:n,dispatch:t})=>re(n,t),en=()=>({state:n,dispatch:t})=>se(n,t);function Ft(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function nn(n){const t=n.split(/-(?!$)/);let e=t[t.length-1];e==="Space"&&(e=" ");let r,s,o,i;for(let a=0;a<t.length-1;a+=1){const c=t[a];if(/^(cmd|meta|m)$/i.test(c))i=!0;else if(/^a(lt)?$/i.test(c))r=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))pt()||Ft()?i=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${c}`)}return r&&(e=`Alt-${e}`),s&&(e=`Ctrl-${e}`),i&&(e=`Meta-${e}`),o&&(e=`Shift-${e}`),e}const rn=n=>({editor:t,view:e,tr:r,dispatch:s})=>{const o=nn(n).split(/-(?!$)/),i=o.find(l=>!["Alt","Ctrl","Meta","Shift"].includes(l)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),c=t.captureTransaction(()=>{e.someProp("handleKeyDown",l=>l(e,a))});return c==null||c.steps.forEach(l=>{const d=l.map(r.mapping);d&&s&&r.maybeStep(d)}),!0};function _(n,t,e={}){const{from:r,to:s,empty:o}=n.selection,i=t?E(t,n.schema):null,a=[];n.doc.nodesBetween(r,s,(f,u)=>{if(f.isText)return;const p=Math.max(r,u),g=Math.min(s,u+f.nodeSize);a.push({node:f,from:p,to:g})});const c=s-r,l=a.filter(f=>i?i.name===f.node.type.name:!0).filter(f=>U(f.node.attrs,e,{strict:!1}));return o?!!l.length:l.reduce((f,u)=>f+u.to-u.from,0)>=c}const sn=(n,t={})=>({state:e,dispatch:r})=>{const s=E(n,e.schema);return _(e,s,t)?oe(e,r):!1},on=()=>({state:n,dispatch:t})=>ie(n,t),an=n=>({state:t,dispatch:e})=>{const r=E(n,t.schema);return me(r)(t,e)},cn=()=>({state:n,dispatch:t})=>ae(n,t);function et(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function St(n,t){const e=typeof t=="string"?[t]:t;return Object.keys(n).reduce((r,s)=>(e.includes(s)||(r[s]=n[s]),r),{})}const ln=(n,t)=>({tr:e,state:r,dispatch:s})=>{let o=null,i=null;const a=et(typeof n=="string"?n:n.name,r.schema);return a?(a==="node"&&(o=E(n,r.schema)),a==="mark"&&(i=I(n,r.schema)),s&&e.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(l,d)=>{o&&o===l.type&&e.setNodeMarkup(d,void 0,St(l.attrs,t)),i&&l.marks.length&&l.marks.forEach(f=>{i===f.type&&e.addMark(d,d+l.nodeSize,i.create(St(f.attrs,t)))})})}),!0):!1},dn=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),un=()=>({tr:n,commands:t})=>t.setTextSelection({from:0,to:n.doc.content.size}),fn=()=>({state:n,dispatch:t})=>ce(n,t),pn=()=>({state:n,dispatch:t})=>le(n,t),mn=()=>({state:n,dispatch:t})=>de(n,t),hn=()=>({state:n,dispatch:t})=>ue(n,t),gn=()=>({state:n,dispatch:t})=>fe(n,t);function Rt(n,t,e={}){return J(n,t,{slice:!1,parseOptions:e})}const yn=(n,t=!1,e={})=>({tr:r,editor:s,dispatch:o})=>{const{doc:i}=r,a=Rt(n,s.schema,e);return o&&r.replaceWith(0,i.content.size,a).setMeta("preventUpdate",!t),!0};function bn(n){for(let t=0;t<n.edgeCount;t+=1){const{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function vn(n,t){for(let e=n.depth;e>0;e-=1){const r=n.node(e);if(t(r))return{pos:e>0?n.before(e):0,start:n.start(e),depth:e,node:r}}}function mt(n){return t=>vn(t.$from,n)}function wn(n,t){const e=Vt.fromSchema(t).serializeFragment(n),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(e),s.innerHTML}function kn(n,t){const e={from:0,to:n.content.size};return Nt(n,e,t)}function Dt(n,t){const e=I(t,n.schema),{from:r,to:s,empty:o}=n.selection,i=[];o?(n.storedMarks&&i.push(...n.storedMarks),i.push(...n.selection.$head.marks())):n.doc.nodesBetween(r,s,c=>{i.push(...c.marks)});const a=i.find(c=>c.type.name===e.name);return a?{...a.attrs}:{}}function Mn(n,t){const e=E(t,n.schema),{from:r,to:s}=n.selection,o=[];n.doc.nodesBetween(r,s,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===e.name);return i?{...i.attrs}:{}}function Sn(n,t){const e=et(typeof t=="string"?t:t.name,n.schema);return e==="node"?Mn(n,t):e==="mark"?Dt(n,t):{}}function q(n,t,e){return Object.fromEntries(Object.entries(e).filter(([r])=>{const s=n.find(o=>o.type===t&&o.name===r);return s?s.attribute.keepOnSplit:!1}))}function ut(n,t,e={}){const{empty:r,ranges:s}=n.selection,o=t?I(t,n.schema):null;if(r)return!!(n.storedMarks||n.selection.$from.marks()).filter(f=>o?o.name===f.type.name:!0).find(f=>U(f.attrs,e,{strict:!1}));let i=0;const a=[];if(s.forEach(({$from:f,$to:u})=>{const p=f.pos,g=u.pos;n.doc.nodesBetween(p,g,(m,h)=>{if(!m.isText&&!m.marks.length)return;const b=Math.max(p,h),w=Math.min(g,h+m.nodeSize),S=w-b;i+=S,a.push(...m.marks.map(M=>({mark:M,from:b,to:w})))})}),i===0)return!1;const c=a.filter(f=>o?o.name===f.mark.type.name:!0).filter(f=>U(f.mark.attrs,e,{strict:!1})).reduce((f,u)=>f+u.to-u.from,0),l=a.filter(f=>o?f.mark.type!==o&&f.mark.type.excludes(o):!0).reduce((f,u)=>f+u.to-u.from,0);return(c>0?c+l:c)>=i}function xn(n,t,e={}){if(!t)return _(n,null,e)||ut(n,null,e);const r=et(t,n.schema);return r==="node"?_(n,t,e):r==="mark"?ut(n,t,e):!1}function xt(n,t){const{nodeExtensions:e}=Y(t),r=e.find(i=>i.name===n);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},o=v(y(r,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function En(n){var t;const e=(t=n.type.createAndFill())===null||t===void 0?void 0:t.toJSON(),r=n.toJSON();return JSON.stringify(e)===JSON.stringify(r)}function Tn(n,t,e){var r;const{selection:s}=t;let o=null;if(Lt(s)&&(o=s.$cursor),o){const a=(r=n.storedMarks)!==null&&r!==void 0?r:o.marks();return!!e.isInSet(a)||!a.some(c=>c.type.excludes(e))}const{ranges:i}=s;return i.some(({$from:a,$to:c})=>{let l=a.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(e):!1;return n.doc.nodesBetween(a.pos,c.pos,(d,f,u)=>{if(l)return!1;if(d.isInline){const p=!u||u.type.allowsMarkType(e),g=!!e.isInSet(d.marks)||!d.marks.some(m=>m.type.excludes(e));l=p&&g}return!l}),l})}const An=(n,t={})=>({tr:e,state:r,dispatch:s})=>{const{selection:o}=e,{empty:i,ranges:a}=o,c=I(n,r.schema);if(s)if(i){const l=Dt(r,c);e.addStoredMark(c.create({...l,...t}))}else a.forEach(l=>{const d=l.$from.pos,f=l.$to.pos;r.doc.nodesBetween(d,f,(u,p)=>{const g=Math.max(p,d),m=Math.min(p+u.nodeSize,f);u.marks.find(b=>b.type===c)?u.marks.forEach(b=>{c===b.type&&e.addMark(g,m,c.create({...b.attrs,...t}))}):e.addMark(g,m,c.create(t))})});return Tn(r,e,c)},Cn=(n,t)=>({tr:e})=>(e.setMeta(n,t),!0),Pn=(n,t={})=>({state:e,dispatch:r,chain:s})=>{const o=E(n,e.schema);return o.isTextblock?s().command(({commands:i})=>bt(o,t)(e)?!0:i.clearNodes()).command(({state:i})=>bt(o,t)(i,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},On=n=>({tr:t,dispatch:e})=>{if(e){const{doc:r}=t,s=L(n,0,r.content.size),o=Tt.create(r,s);t.setSelection(o)}return!0},$n=n=>({tr:t,dispatch:e})=>{if(e){const{doc:r}=t,{from:s,to:o}=typeof n=="number"?{from:n,to:n}:n,i=O.atStart(r).from,a=O.atEnd(r).to,c=L(s,i,a),l=L(o,i,a),d=O.create(r,c,l);t.setSelection(d)}return!0},Nn=n=>({state:t,dispatch:e})=>{const r=E(n,t.schema);return he(r)(t,e)};function Et(n,t){const e=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(e){const r=e.filter(s=>t==null?void 0:t.includes(s.type.name));n.tr.ensureMarks(r)}}const Bn=({keepMarks:n=!0}={})=>({tr:t,state:e,dispatch:r,editor:s})=>{const{selection:o,doc:i}=t,{$from:a,$to:c}=o,l=s.extensionManager.attributes,d=q(l,a.node().type.name,a.node().attrs);if(o instanceof Tt&&o.node.isBlock)return!a.parentOffset||!V(i,a.pos)?!1:(r&&(n&&Et(e,s.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(r){const f=c.parentOffset===c.parent.content.size;o instanceof O&&t.deleteSelection();const u=a.depth===0?void 0:bn(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=f&&u?[{type:u,attrs:d}]:void 0,g=V(t.doc,t.mapping.map(a.pos),1,p);if(!p&&!g&&V(t.doc,t.mapping.map(a.pos),1,u?[{type:u}]:void 0)&&(g=!0,p=u?[{type:u,attrs:d}]:void 0),g&&(t.split(t.mapping.map(a.pos),1,p),u&&!f&&!a.parentOffset&&a.parent.type!==u)){const m=t.mapping.map(a.before()),h=t.doc.resolve(m);a.node(-1).canReplaceWith(h.index(),h.index()+1,u)&&t.setNodeMarkup(t.mapping.map(a.before()),u)}n&&Et(e,s.extensionManager.splittableMarks),t.scrollIntoView()}return!0},In=n=>({tr:t,state:e,dispatch:r,editor:s})=>{var o;const i=E(n,e.schema),{$from:a,$to:c}=e.selection,l=e.selection.node;if(l&&l.isBlock||a.depth<2||!a.sameParent(c))return!1;const d=a.node(-1);if(d.type!==i)return!1;const f=s.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==i||a.index(-2)!==a.node(-2).childCount-1)return!1;if(r){let h=W.empty;const b=a.index(-1)?1:a.index(-2)?2:3;for(let T=a.depth-b;T>=a.depth-3;T-=1)h=W.from(a.node(T).copy(h));const w=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,S=q(f,a.node().type.name,a.node().attrs),M=((o=i.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(S))||void 0;h=h.append(W.from(i.createAndFill(null,M)||void 0));const x=a.before(a.depth-(b-1));t.replace(x,a.after(-w),new qt(h,4-b,0));let A=-1;t.doc.nodesBetween(x,t.doc.content.size,(T,k)=>{if(A>-1)return!1;T.isTextblock&&T.content.size===0&&(A=k+1)}),A>-1&&t.setSelection(O.near(t.doc.resolve(A))),t.scrollIntoView()}return!0}const u=c.pos===a.end()?d.contentMatchAt(0).defaultType:null,p=q(f,d.type.name,d.attrs),g=q(f,a.node().type.name,a.node().attrs);t.delete(a.pos,c.pos);const m=u?[{type:i,attrs:p},{type:u,attrs:g}]:[{type:i,attrs:p}];if(!V(t.doc,a.pos,2))return!1;if(r){const{selection:h,storedMarks:b}=e,{splittableMarks:w}=s.extensionManager,S=b||h.$to.parentOffset&&h.$from.marks();if(t.split(a.pos,2,m).scrollIntoView(),!S||!r)return!0;const M=S.filter(x=>w.includes(x.type.name));t.ensureMarks(M)}return!0},at=(n,t)=>{const e=mt(i=>i.type===t)(n.selection);if(!e)return!0;const r=n.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(r===void 0)return!0;const s=n.doc.nodeAt(r);return e.node.type===(s==null?void 0:s.type)&&Pt(n.doc,e.pos)&&n.join(e.pos),!0},ct=(n,t)=>{const e=mt(i=>i.type===t)(n.selection);if(!e)return!0;const r=n.doc.resolve(e.start).after(e.depth);if(r===void 0)return!0;const s=n.doc.nodeAt(r);return e.node.type===(s==null?void 0:s.type)&&Pt(n.doc,r)&&n.join(r),!0},Ln=(n,t,e)=>({editor:r,tr:s,state:o,dispatch:i,chain:a,commands:c,can:l})=>{const{extensions:d,splittableMarks:f}=r.extensionManager,u=E(n,o.schema),p=E(t,o.schema),{selection:g,storedMarks:m}=o,{$from:h,$to:b}=g,w=h.blockRange(b),S=m||g.$to.parentOffset&&g.$from.marks();if(!w)return!1;const M=mt(x=>xt(x.type.name,d))(g);if(w.depth>=1&&M&&w.depth-M.depth<=1){if(M.node.type===u)return c.liftListItem(p);if(xt(M.node.type.name,d)&&u.validContent(M.node.content)&&i)return a().command(()=>(s.setNodeMarkup(M.pos,u),!0)).command(()=>at(s,u)).command(()=>ct(s,u)).run()}return!e||!S||!i?a().command(()=>l().wrapInList(u)?!0:c.clearNodes()).wrapInList(u).command(()=>at(s,u)).command(()=>ct(s,u)).run():a().command(()=>{const x=l().wrapInList(u),A=S.filter(T=>f.includes(T.type.name));return s.ensureMarks(A),x?!0:c.clearNodes()}).wrapInList(u).command(()=>at(s,u)).command(()=>ct(s,u)).run()},jn=(n,t={},e={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:o=!1}=e,i=I(n,r.schema);return ut(r,i,t)?s.unsetMark(i,{extendEmptyMarkRange:o}):s.setMark(i,t)},Fn=(n,t,e={})=>({state:r,commands:s})=>{const o=E(n,r.schema),i=E(t,r.schema);return _(r,o,e)?s.setNode(i):s.setNode(o,e)},Rn=(n,t={})=>({state:e,commands:r})=>{const s=E(n,e.schema);return _(e,s,t)?r.lift(s):r.wrapIn(s,t)},Dn=()=>({state:n,dispatch:t})=>{const e=n.plugins;for(let r=0;r<e.length;r+=1){const s=e[r];let o;if(s.spec.isInputRules&&(o=s.getState(n))){if(t){const i=n.tr,a=o.transform;for(let c=a.steps.length-1;c>=0;c-=1)i.step(a.steps[c].invert(a.docs[c]));if(o.text){const c=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,n.schema.text(o.text,c))}else i.delete(o.from,o.to)}return!0}}return!1},Hn=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,{empty:r,ranges:s}=e;return r||t&&s.forEach(o=>{n.removeMark(o.$from.pos,o.$to.pos)}),!0},zn=(n,t={})=>({tr:e,state:r,dispatch:s})=>{var o;const{extendEmptyMarkRange:i=!1}=t,{selection:a}=e,c=I(n,r.schema),{$from:l,empty:d,ranges:f}=a;if(!s)return!0;if(d&&i){let{from:u,to:p}=a;const g=(o=l.marks().find(h=>h.type===c))===null||o===void 0?void 0:o.attrs,m=It(l,c,g);m&&(u=m.from,p=m.to),e.removeMark(u,p,c)}else f.forEach(u=>{e.removeMark(u.$from.pos,u.$to.pos,c)});return e.removeStoredMark(c),!0},_n=(n,t={})=>({tr:e,state:r,dispatch:s})=>{let o=null,i=null;const a=et(typeof n=="string"?n:n.name,r.schema);return a?(a==="node"&&(o=E(n,r.schema)),a==="mark"&&(i=I(n,r.schema)),s&&e.selection.ranges.forEach(c=>{const l=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(l,d,(f,u)=>{o&&o===f.type&&e.setNodeMarkup(u,void 0,{...f.attrs,...t}),i&&f.marks.length&&f.marks.forEach(p=>{if(i===p.type){const g=Math.max(u,l),m=Math.min(u+f.nodeSize,d);e.addMark(g,m,i.create({...p.attrs,...t}))}})})}),!0):!1},Kn=(n,t={})=>({state:e,dispatch:r})=>{const s=E(n,e.schema);return pe(s,t)(e,r)},Wn=(n,t={})=>({state:e,dispatch:r})=>{const s=E(n,e.schema);return ge(s,t)(e,r)};var Vn=Object.freeze({__proto__:null,blur:Ne,clearContent:Be,clearNodes:Ie,command:Le,createParagraphNear:je,deleteCurrentNode:Fe,deleteNode:Re,deleteRange:De,deleteSelection:He,enter:ze,exitCode:_e,extendMarkRange:We,first:Ve,focus:qe,forEach:Ue,insertContent:Je,insertContentAt:Xe,joinUp:Ye,joinDown:Ze,joinBackward:tn,joinForward:en,keyboardShortcut:rn,lift:sn,liftEmptyBlock:on,liftListItem:an,newlineInCode:cn,resetAttributes:ln,scrollIntoView:dn,selectAll:un,selectNodeBackward:fn,selectNodeForward:pn,selectParentNode:mn,selectTextblockEnd:hn,selectTextblockStart:gn,setContent:yn,setMark:An,setMeta:Cn,setNode:Pn,setNodeSelection:On,setTextSelection:$n,sinkListItem:Nn,splitBlock:Bn,splitListItem:In,toggleList:Ln,toggleMark:jn,toggleNode:Fn,toggleWrap:Rn,undoInputRule:Dn,unsetAllMarks:Hn,unsetMark:zn,updateAttributes:_n,wrapIn:Kn,wrapInList:Wn});const qn=P.create({name:"commands",addCommands(){return{...Vn}}}),Un=P.create({name:"editable",addProseMirrorPlugins(){return[new $({key:new B("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Jn=P.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new $({key:new B("focusEvents"),props:{handleDOMEvents:{focus:(t,e)=>{n.isFocused=!0;const r=n.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(r),!1},blur:(t,e)=>{n.isFocused=!1;const r=n.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(r),!1}}}})]}}),Gn=P.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:c,doc:l}=a,{empty:d,$anchor:f}=c,{pos:u,parent:p}=f,g=R.atStart(l).from===u;return!d||!g||!p.type.isTextblock||p.textContent.length?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},o={...r,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return pt()||Ft()?o:s},addProseMirrorPlugins(){return[new $({key:new B("clearDocument"),appendTransaction:(n,t,e)=>{if(!(n.some(g=>g.docChanged)&&!t.doc.eq(e.doc)))return;const{empty:s,from:o,to:i}=t.selection,a=R.atStart(t.doc).from,c=R.atEnd(t.doc).to,l=o===a&&i===c,d=e.doc.textBetween(0,e.doc.content.size," "," ").length===0;if(s||!l||!d)return;const f=e.tr,u=Q({state:e,transaction:f}),{commands:p}=new X({editor:this.editor,state:u});if(p.clearNodes(),!!f.steps.length)return f}})]}}),Qn=P.create({name:"tabindex",addProseMirrorPlugins(){return[new $({key:new B("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var Xn=Object.freeze({__proto__:null,ClipboardTextSerializer:$e,Commands:qn,Editable:Un,FocusEvents:Jn,Keymap:Gn,Tabindex:Qn});const Yn=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function Zn(n,t){const e=document.querySelector("style[data-tiptap-style]");if(e!==null)return e;const r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.setAttribute("data-tiptap-style",""),r.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(r),r}class mr extends ye{constructor(t={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Zn(Yn,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,e){const r=$t(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],s=this.state.reconfigure({plugins:r});this.view.updateState(s)}unregisterPlugin(t){if(this.isDestroyed)return;const e=typeof t=="string"?`${t}$`:t.key,r=this.state.reconfigure({plugins:this.state.plugins.filter(s=>!s.key.startsWith(e))});this.view.updateState(r)}createExtensionManager(){const e=[...this.options.enableCoreExtensions?Object.values(Xn):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r==null?void 0:r.type));this.extensionManager=new F(e,this)}createCommandManager(){this.commandManager=new X({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const t=Rt(this.options.content,this.schema,this.options.parseOptions),e=jt(t,this.options.autofocus);this.view=new Kt(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:_t.create({doc:t,selection:e||void 0})});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(i=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(i)});return}const e=this.state.apply(t),r=!this.state.selection.eq(e.selection);this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t}),r&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=t.getMeta("focus"),o=t.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:t}),o&&this.emit("blur",{editor:this,event:o.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return Sn(this.state,t)}isActive(t,e){const r=typeof t=="string"?t:null,s=typeof t=="string"?e:t;return xn(this.state,r,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return wn(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:r={}}=t||{};return kn(this.state.doc,{blockSeparator:e,textSerializers:{...Bt(this.schema),...r}})}get isEmpty(){return En(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var t;return!(!((t=this.view)===null||t===void 0)&&t.docView)}}function tr(n){return new Me({find:n.find,handler:({state:t,range:e,match:r})=>{const s=v(n.getAttributes,void 0,r)||{},{tr:o}=t,i=e.from;let a=e.to;if(r[1]){const c=r[0].lastIndexOf(r[1]);let l=i+c;l>a?l=a:a=l+r[1].length;const d=r[0][r[0].length-1];o.insertText(d,i+r[0].length-1),o.replaceWith(l,a,n.type.create(s))}else r[0]&&o.replaceWith(i,a,n.type.create(s))}})}class G{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=v(y(this,"addOptions",{name:this.name}))),this.storage=v(y(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new G(t)}configure(t={}){const e=this.extend();return e.options=tt(this.options,t),e.storage=v(y(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new G(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=v(y(e,"addOptions",{name:e.name})),e.storage=v(y(e,"addStorage",{name:e.name,options:e.options})),e}static handleExit({editor:t,mark:e}){const{tr:r}=t.state,s=t.state.selection.$from;if(s.pos===s.end()){const i=s.marks();if(!!!i.find(l=>(l==null?void 0:l.type.name)===e.name))return!1;const c=i.find(l=>(l==null?void 0:l.type.name)===e.name);return c&&r.removeStoredMark(c),r.insertText(" ",s.pos),t.view.dispatch(r),!0}return!1}}class N{constructor(t={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=v(y(this,"addOptions",{name:this.name}))),this.storage=v(y(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new N(t)}configure(t={}){const e=this.extend();return e.options=tt(this.options,t),e.storage=v(y(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new N(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=v(y(e,"addOptions",{name:e.name})),e.storage=v(y(e,"addStorage",{name:e.name,options:e.options})),e}}function er(n){return n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}const hr=N.create({name:"doc",topNode:!0,content:"block+"}),gr=N.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",Z(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),yr=P.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something â¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new $({key:new B("placeholder"),props:{decorations:({doc:n,selection:t})=>{const e=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=t,s=[];if(!e)return null;const o=n.type.createAndFill(),i=(o==null?void 0:o.sameMarkup(n))&&o.content.findDiffStart(n.content)===null;return n.descendants((a,c)=>{const l=r>=c&&r<=c+a.nodeSize,d=!a.isLeaf&&!a.childCount;if((l||!this.options.showOnlyCurrent)&&d){const f=[this.options.emptyNodeClass];i&&f.push(this.options.emptyEditorClass);const u=At.node(c,c+a.nodeSize,{class:f.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:c,hasAnchor:l}):this.options.placeholder});s.push(u)}return this.options.includeChildren}),Ct.create(n,s)}}})]}}),br=N.create({name:"text",group:"inline"});function nr(n){var t;const{char:e,allowSpaces:r,allowedPrefixes:s,startOfLine:o,$position:i}=n,a=er(e),c=new RegExp(`\\s${a}$`),l=o?"^":"",d=r?new RegExp(`${l}${a}.*?(?=\\s${a}|$)`,"gm"):new RegExp(`${l}(?:^)?${a}[^\\s${a}]*`,"gm"),f=((t=i.nodeBefore)===null||t===void 0?void 0:t.isText)&&i.nodeBefore.text;if(!f)return null;const u=i.pos-f.length,p=Array.from(f.matchAll(d)).pop();if(!p||p.input===void 0||p.index===void 0)return null;const g=p.input.slice(Math.max(0,p.index-1),p.index),m=new RegExp(`^[${s==null?void 0:s.join("")}\0]?$`).test(g);if(s!==null&&!m)return null;const h=u+p.index;let b=h+p[0].length;return r&&c.test(f.slice(b-1,b+1))&&(p[0]+=" ",b+=1),h<i.pos&&b>=i.pos?{range:{from:h,to:b},query:p[0].slice(e.length),text:p[0]}:null}const rr=new B("suggestion");function sr({pluginKey:n=rr,editor:t,char:e="@",allowSpaces:r=!1,allowedPrefixes:s=[" "],startOfLine:o=!1,decorationTag:i="span",decorationClass:a="suggestion",command:c=()=>null,items:l=()=>[],render:d=()=>({}),allow:f=()=>!0}){let u;const p=d==null?void 0:d(),g=new $({key:n,view(){return{update:async(m,h)=>{var b,w,S,M,x,A,T;const k=(b=this.key)===null||b===void 0?void 0:b.getState(h),C=(w=this.key)===null||w===void 0?void 0:w.getState(m.state),D=k.active&&C.active&&k.range.from!==C.range.from,ht=!k.active&&C.active,gt=k.active&&!C.active,Ht=!ht&&!gt&&k.query!==C.query,H=ht||D,K=Ht&&!D,nt=gt||D;if(!H&&!K&&!nt)return;const j=nt&&!H?k:C,yt=m.dom.querySelector(`[data-decoration-id="${j.decorationId}"]`);u={editor:t,range:j.range,query:j.query,text:j.text,items:[],command:z=>{c({editor:t,range:j.range,props:z})},decorationNode:yt,clientRect:yt?()=>{var z;const{decorationId:zt}=(z=this.key)===null||z===void 0?void 0:z.getState(t.state),rt=m.dom.querySelector(`[data-decoration-id="${zt}"]`);return(rt==null?void 0:rt.getBoundingClientRect())||null}:null},H&&((S=p==null?void 0:p.onBeforeStart)===null||S===void 0||S.call(p,u)),K&&((M=p==null?void 0:p.onBeforeUpdate)===null||M===void 0||M.call(p,u)),(K||H)&&(u.items=await l({editor:t,query:j.query})),nt&&((x=p==null?void 0:p.onExit)===null||x===void 0||x.call(p,u)),K&&((A=p==null?void 0:p.onUpdate)===null||A===void 0||A.call(p,u)),H&&((T=p==null?void 0:p.onStart)===null||T===void 0||T.call(p,u))},destroy:()=>{var m;u&&((m=p==null?void 0:p.onExit)===null||m===void 0||m.call(p,u))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(m,h,b,w){const{isEditable:S}=t,{composing:M}=t.view,{selection:x}=m,{empty:A,from:T}=x,k={...h};if(k.composing=M,S&&(A||t.view.composing)){(T<h.range.from||T>h.range.to)&&!M&&!h.composing&&(k.active=!1);const C=nr({char:e,allowSpaces:r,allowedPrefixes:s,startOfLine:o,$position:x.$from}),D=`id_${Math.floor(Math.random()*4294967295)}`;C&&f({editor:t,state:w,range:C.range})?(k.active=!0,k.decorationId=h.decorationId?h.decorationId:D,k.range=C.range,k.query=C.query,k.text=C.text):k.active=!1}else k.active=!1;return k.active||(k.decorationId=null,k.range={from:0,to:0},k.query=null,k.text=null),k}},props:{handleKeyDown(m,h){var b;const{active:w,range:S}=g.getState(m.state);return w&&((b=p==null?void 0:p.onKeyDown)===null||b===void 0?void 0:b.call(p,{view:m,event:h,range:S}))||!1},decorations(m){const{active:h,range:b,decorationId:w}=g.getState(m);return h?Ct.create(m.doc,[At.inline(b.from,b.to,{nodeName:i,class:a,"data-decoration-id":w})]):null}}});return g}const or=new B("mention"),vr=N.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:n,node:t}){var e;return`${n.suggestion.char}${(e=t.attrs.label)!==null&&e!==void 0?e:t.attrs.id}`},suggestion:{char:"@",pluginKey:or,command:({editor:n,range:t,props:e})=>{var r,s;const o=n.view.state.selection.$to.nodeAfter;((r=o==null?void 0:o.text)===null||r===void 0?void 0:r.startsWith(" "))&&(t.to+=1),n.chain().focus().insertContentAt(t,[{type:this.name,attrs:e},{type:"text",text:" "}]).run(),(s=window.getSelection())===null||s===void 0||s.collapseToEnd()},allow:({state:n,range:t})=>{const e=n.doc.resolve(t.from),r=n.schema.nodes[this.name];return!!e.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:n=>n.getAttribute("data-id"),renderHTML:n=>n.id?{"data-id":n.id}:{}},label:{default:null,parseHTML:n=>n.getAttribute("data-label"),renderHTML:n=>n.label?{"data-label":n.label}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:n,HTMLAttributes:t}){return["span",Z({"data-type":this.name},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:n})]},renderText({node:n}){return this.options.renderLabel({options:this.options,node:n})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:n,state:t})=>{let e=!1;const{selection:r}=t,{empty:s,anchor:o}=r;return s?(t.doc.nodesBetween(o-1,o,(i,a)=>{if(i.type.name===this.name)return e=!0,n.insertText(this.options.suggestion.char||"",a,a+i.nodeSize),!1}),e):!1})}},addProseMirrorPlugins(){return[sr({editor:this.editor,...this.options.suggestion})]}}),ir=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,wr=N.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:n}){return["img",Z(this.options.HTMLAttributes,n)]},addCommands(){return{setImage:n=>({commands:t})=>t.insertContent({type:this.name,attrs:n})}},addInputRules(){return[tr({find:ir,type:this.type,getAttributes:n=>{const[,,t,e,r]=n;return{src:e,alt:t,title:r}}})]}});export{hr as D,mr as E,wr as I,vr as M,gr as P,br as T,yr as a};
