import{A as W,x as H,E as J,a as X,Y as ee,O as le,P as oe,B as te,_ as se,a2 as ae,Q as ne,C as ue}from"./element-plus-64da2267.js";import{a as de,b as ie,c as re,d as pe}from"./menu-b06496af.js";import{K as me,L as ce,n as fe,u as _e,M as ve,N as c,O as be,Q as Ve}from"./index-7638d9aa.js";import{P as ye}from"./index-e34f0d65.js";import{d as D,r as M,b0 as R,aZ as G,b as z,w as he,b2 as I,aU as ke,o as p,c as U,G as t,aM as s,aV as e,t as v,F as A,E as b,a as n,aR as q,aj as P,a9 as Ue,aw as ge,u as V}from"./@vue-25170201.js";import{u as we}from"./@vueuse-944ef3f4.js";const Ee={class:"icon-select"},Te={class:"flex justify-between"},xe=n("div",{class:"mb-3"},"请选择图标",-1),Ce=["onClick"],Ne={class:"h-[280px]"},Me={class:"flex flex-wrap"},Be={key:0,class:"flex items-center"},Oe=D({__name:"picker",props:{modelValue:{default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(j,{emit:B}){const g=B,w=M(0),E=[{name:"element图标",icons:me()},{name:"本地图标",icons:ce()}],h=R(),u=G({inputValue:"",popoverVisible:!1,popoverWidth:0,mouseoverSelect:!1,inputFocus:!1}),T=()=>{u.inputFocus=u.popoverVisible=!0},O=()=>{u.inputFocus=!1,u.popoverVisible=u.mouseoverSelect},C=i=>{u.mouseoverSelect=u.popoverVisible=!1,g("update:modelValue",i),g("change",i)},$=()=>{g("update:modelValue",""),g("change","")},o=z(()=>{var _;const i=((_=E[w.value])==null?void 0:_.icons)??[];if(!u.inputValue)return i;const r=u.inputValue.toLowerCase();return i.filter(k=>{if(k.toLowerCase().indexOf(r)!==-1)return k})}),S=()=>{I(()=>{var r;const i=(r=h.value)==null?void 0:r.$el.offsetWidth;u.popoverWidth=i<300?300:i})};return we(document.body,"click",()=>{u.popoverVisible=!!(u.inputFocus||u.mouseoverSelect)}),he(()=>u.popoverVisible,async i=>{var r,_;await I(),i?(r=h.value)==null||r.focus():(_=h.value)==null||_.blur()}),ke(()=>{S()}),(i,r)=>{const _=fe,k=H,N=J,F=X,L=ee;return p(),U("div",Ee,[t(L,{trigger:"contextmenu",visible:u.popoverVisible,"onUpdate:visible":r[3]||(r[3]=a=>u.popoverVisible=a),width:u.popoverWidth},{reference:s(()=>[t(e(W),{ref_key:"inputRef",ref:h,modelValue:u.inputValue,"onUpdate:modelValue":r[2]||(r[2]=a=>u.inputValue=a),modelModifiers:{trim:!0},placeholder:"搜索图标",autofocus:!1,disabled:i.disabled,onFocus:T,onBlur:O,clearable:""},{prepend:s(()=>[i.modelValue?(p(),U("div",Be,[t(F,{class:"flex-1 w-20",content:i.modelValue,placement:"top"},{default:s(()=>[(p(),v(_,{class:"mr-1",key:i.modelValue,name:i.modelValue,size:16},null,8,["name"]))]),_:1},8,["content"])])):(p(),U(A,{key:1},[b("无")],64))]),append:s(()=>[t(k,null,{default:s(()=>[t(_,{name:"el-icon-Close",size:18,onClick:$})]),_:1})]),_:1},8,["modelValue","disabled"])]),default:s(()=>[n("div",{onMouseover:r[0]||(r[0]=q(a=>u.mouseoverSelect=!0,["stop"])),onMouseout:r[1]||(r[1]=q(a=>u.mouseoverSelect=!1,["stop"]))},[n("div",null,[n("div",Te,[xe,n("div",null,[(p(),U(A,null,P(E,(a,l)=>n("span",{key:l,class:Ue(["cursor-pointer text-sm ml-2",{"text-primary":l==e(w)}]),onClick:m=>w.value=l},ge(a.name),11,Ce)),64))])]),n("div",Ne,[t(N,null,{default:s(()=>[n("div",Me,[(p(!0),U(A,null,P(o.value,a=>(p(),U("div",{key:a,class:"m-1"},[t(k,{onClick:l=>C(a)},{default:s(()=>[t(_,{name:a,size:18},null,8,["name"])]),_:2},1032,["onClick"])]))),128))])]),_:1})])])],32)]),_:1},8,["visible","width"])])}}}),$e={class:"edit-popup"},Se={class:"flex-1"},Fe=n("div",{class:"form-tips"}," 访问的路由地址，如：`user`，如外网地址需内链访问则以`http(s)://`开头 ",-1),Le={class:"flex-1"},Ae=n("div",{class:"form-tips"}," 访问的组件路径，如：`user/setting`，默认在`views`目录下 ",-1),Re={class:"flex-1"},Ie=n("div",{class:"form-tips"}," 访问详情页面，编辑页面时，菜单高亮显示，如`/consumer/lists` ",-1),qe={class:"flex-1"},Pe=n("div",{class:"form-tips"}," 将作为server端API验权使用，如`auth.admin/user`，请谨慎修改 ",-1),We={class:"flex-1"},De=n("div",{class:"form-tips"},' 访问路由的默认传递参数，如：`{"id": 1, "name": "admin"}`或`id=1&name=admin` ',-1),Ge=n("div",{class:"form-tips"},"选择缓存则会被`keep-alive`缓存",-1),ze=n("div",{class:"form-tips"}," 选择隐藏则路由将不会出现在侧边栏，但仍然可以访问 ",-1),je=n("div",{class:"form-tips"},"选择停用则路由将不会出现在侧边栏，也不能被访问",-1),Ke=n("div",{class:"form-tips"},"数值越大越排前",-1),el=D({__name:"edit",emits:["success","close"],setup(j,{expose:B,emit:g}){const w=_e(),E=g,h=R(),u=R(),T=M("add"),O=z(()=>T.value=="edit"?"编辑菜单":"新增菜单"),C=M(ve()),$=(a,l)=>{const m=a?C.value.filter(y=>y.toLowerCase().includes(a.toLowerCase())):C.value;l(m.map(y=>({value:y})))},o=G({id:"",pid:0,type:c.CATALOGUE,icon:"",name:"",sort:0,paths:"",perms:"",component:"",selected:"",params:"",is_cache:0,is_show:1,is_disable:0}),S={pid:[{required:!0,message:"请选择父级菜单",trigger:["blur","change"]}],name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],paths:[{required:!0,message:"请输入路由地址",trigger:"blur"}],component:[{required:!0,message:"请输入组件地址",trigger:"blur"}]},i=M([]),r=async()=>{const a=await de({page_type:0}),l={id:0,name:"顶级",children:[]};l.children=be(Ve(a.lists).filter(m=>m.type!=c.BUTTON)),i.value.push(l)},_=async()=>{var a,l;await((a=h.value)==null?void 0:a.validate()),T.value=="edit"?await ie(o):await re(o),(l=u.value)==null||l.close(),w.updateUserInfo(),E("success")},k=(a="add")=>{var l;T.value=a,(l=u.value)==null||l.open()},N=a=>{for(const l in o)a[l]!=null&&a[l]!=null&&(o[l]=a[l])},F=async a=>{const l=await pe({id:a.id});N(l)},L=()=>{E("close")};return r(),B({open:k,setFormData:N,getDetail:F}),(a,l)=>{const m=le,y=oe,f=te,K=se,x=W,Q=ae,Y=ne,Z=ue;return p(),U("div",$e,[t(ye,{ref_key:"popupRef",ref:u,title:e(O),async:!0,width:"550px",onConfirm:_,onClose:L},{default:s(()=>[t(Z,{ref_key:"formRef",ref:h,model:e(o),"label-width":"80px",rules:S},{default:s(()=>[t(f,{label:"菜单类型",prop:"type",required:""},{default:s(()=>[t(y,{modelValue:e(o).type,"onUpdate:modelValue":l[0]||(l[0]=d=>e(o).type=d)},{default:s(()=>[t(m,{label:e(c).CATALOGUE},{default:s(()=>[b("目录")]),_:1},8,["label"]),t(m,{label:e(c).MENU},{default:s(()=>[b("菜单")]),_:1},8,["label"]),t(m,{label:e(c).BUTTON},{default:s(()=>[b("按钮")]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"父级菜单",prop:"pid"},{default:s(()=>[t(K,{class:"flex-1",modelValue:e(o).pid,"onUpdate:modelValue":l[1]||(l[1]=d=>e(o).pid=d),data:e(i),clearable:"","node-key":"id",props:{label:"name"},"default-expand-all":!0,placeholder:"请选择父级菜单","check-strictly":""},null,8,["modelValue","data"])]),_:1}),t(f,{label:"菜单名称",prop:"name"},{default:s(()=>[t(x,{modelValue:e(o).name,"onUpdate:modelValue":l[2]||(l[2]=d=>e(o).name=d),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])]),_:1}),e(o).type!=e(c).BUTTON?(p(),v(f,{key:0,label:"菜单图标",prop:"icon"},{default:s(()=>[t(Oe,{class:"flex-1",modelValue:e(o).icon,"onUpdate:modelValue":l[3]||(l[3]=d=>e(o).icon=d)},null,8,["modelValue"])]),_:1})):V("",!0),e(o).type!=e(c).BUTTON?(p(),v(f,{key:1,label:"路由路径",prop:"paths"},{default:s(()=>[n("div",Se,[t(x,{modelValue:e(o).paths,"onUpdate:modelValue":l[4]||(l[4]=d=>e(o).paths=d),placeholder:"请输入路由路径",clearable:""},null,8,["modelValue"]),Fe])]),_:1})):V("",!0),e(o).type==e(c).MENU?(p(),v(f,{key:2,label:"组件路径",prop:"component"},{default:s(()=>[n("div",Le,[t(Q,{class:"w-full",modelValue:e(o).component,"onUpdate:modelValue":l[5]||(l[5]=d=>e(o).component=d),"fetch-suggestions":$,clearable:"",placeholder:"请输入组件路径"},null,8,["modelValue"]),Ae])]),_:1})):V("",!0),e(o).type==e(c).MENU?(p(),v(f,{key:3,label:"选中菜单",prop:"selected"},{default:s(()=>[n("div",Re,[t(x,{modelValue:e(o).selected,"onUpdate:modelValue":l[6]||(l[6]=d=>e(o).selected=d),placeholder:"请输入路由路径",clearable:""},null,8,["modelValue"]),Ie])]),_:1})):V("",!0),e(o).type!=e(c).CATALOGUE?(p(),v(f,{key:4,label:"权限字符",prop:"perms"},{default:s(()=>[n("div",qe,[t(x,{modelValue:e(o).perms,"onUpdate:modelValue":l[7]||(l[7]=d=>e(o).perms=d),placeholder:"请输入权限字符",clearable:""},null,8,["modelValue"]),Pe])]),_:1})):V("",!0),e(o).type==e(c).MENU?(p(),v(f,{key:5,label:"路由参数",prop:"params"},{default:s(()=>[n("div",null,[n("div",We,[t(x,{modelValue:e(o).params,"onUpdate:modelValue":l[8]||(l[8]=d=>e(o).params=d),placeholder:"请输入路由参数",clearable:""},null,8,["modelValue"])]),De])]),_:1})):V("",!0),e(o).type==e(c).MENU?(p(),v(f,{key:6,label:"是否缓存",prop:"is_cache",required:""},{default:s(()=>[n("div",null,[t(y,{modelValue:e(o).is_cache,"onUpdate:modelValue":l[9]||(l[9]=d=>e(o).is_cache=d)},{default:s(()=>[t(m,{label:1},{default:s(()=>[b("缓存")]),_:1}),t(m,{label:0},{default:s(()=>[b("不缓存")]),_:1})]),_:1},8,["modelValue"]),Ge])]),_:1})):V("",!0),e(o).type!=e(c).BUTTON?(p(),v(f,{key:7,label:"是否显示",prop:"is_show",required:""},{default:s(()=>[n("div",null,[t(y,{modelValue:e(o).is_show,"onUpdate:modelValue":l[10]||(l[10]=d=>e(o).is_show=d)},{default:s(()=>[t(m,{label:1},{default:s(()=>[b("显示")]),_:1}),t(m,{label:0},{default:s(()=>[b("隐藏")]),_:1})]),_:1},8,["modelValue"]),ze])]),_:1})):V("",!0),e(o).type!=e(c).BUTTON?(p(),v(f,{key:8,label:"菜单状态",prop:"is_disable",required:""},{default:s(()=>[n("div",null,[t(y,{modelValue:e(o).is_disable,"onUpdate:modelValue":l[11]||(l[11]=d=>e(o).is_disable=d)},{default:s(()=>[t(m,{label:0},{default:s(()=>[b("正常")]),_:1}),t(m,{label:1},{default:s(()=>[b("停用")]),_:1})]),_:1},8,["modelValue"]),je])]),_:1})):V("",!0),t(f,{label:"菜单排序",prop:"sort"},{default:s(()=>[n("div",null,[t(Y,{modelValue:e(o).sort,"onUpdate:modelValue":l[12]||(l[12]=d=>e(o).sort=d),min:0,max:9999},null,8,["modelValue"]),Ke])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])])}}});export{el as _};
