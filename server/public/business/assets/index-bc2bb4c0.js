import{d as me,r as y,b1 as pe,aU as ge,aW as fe,o as u,c as m,a as k,ab as de,aV as a,F as he,aj as ve,G as p,a9 as M,aR as I,aO as we,aK as be,u as R,aw as N}from"./@vue-25170201.js";import"./adapter-vue-20243c9c.js";import{z as T,w as ye,i as g,_ as ke}from"./@tencentcloud-25a17c42.js";import f from"./Icon-fec85db6.js";import{c as Ie}from"./icon-close-aa3d72bb.js";import{_ as Re}from"./image-item.vue_vue_type_style_index_0_lang-8f2a780f.js";import{T as _}from"./index-ebb29dde.js";import{c as Te,a as d,d as W}from"./env-6b0ecdb8.js";import{T as L}from"./index-9521edcb.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";const V="/business/assets/icon-arrow-left-af0c0bb9.svg",_e="/business/assets/zoom-in-c967ceef.svg",Le="/business/assets/zoom-out-862aabb4.svg",Xe="/business/assets/rotate-left-6ff9e83b.svg",xe="/business/assets/rotate-right-161115e3.svg",Ee="/business/assets/download-a9b7471d.svg",Ye={class:"image-counter"},Ce=me({__name:"index",props:{imageList:{default:()=>[]},currentImage:{}},emits:["close"],setup(Z,{emit:j}){const h=Z,Y=new Map([[1,"jpg"],[2,"gif"],[3,"png"],[4,"bmp"]]),B=j,r=y(1),X=y(0),D=y(.1),l=y(0),$=y(),K=y();let F=0;const s={};let C=!1,x=!1,w=null;pe(()=>{l.value=h.imageList.findIndex(e=>{var t;return e.ID===((t=h==null?void 0:h.currentImage)==null?void 0:t.ID)})});const b=e=>typeof e=="number"&&isFinite(e),G=e=>{e.preventDefault(),ee(e),te(e)},H=e=>{e.preventDefault(),C=!0,e.touches&&e.touches.length===2&&(x=!0,oe(e))},q=e=>{var n;e.preventDefault(),e.stopPropagation();let t=0,o=0;if(x){w||(x=!1,delete s.pageX2,delete s.pageY2,w=setTimeout(()=>{w=null},200));return}if(w===null){switch(C){case!0:t=(n=e==null?void 0:e.changedTouches[0])==null?void 0:n.pageX,o=t-F,o>100?A():o<-100&&P();break;case!1:S();break}w=setTimeout(()=>{w=null},200)}},J=()=>{x=!1,delete s.pageX1,delete s.pageY1},Q=e=>{if(e.preventDefault(),Math.abs(e.deltaX)!==0&&Math.abs(e.deltaY)!==0)return;let t=r.value;t+=e.deltaY*(e.ctrlKey?-.01:.002),t=Math.min(Math.max(.125,t),4),r.value=t},ee=e=>{var t;F=(t=e==null?void 0:e.changedTouches[0])==null?void 0:t.pageX,C=!1},te=e=>{const t=e==null?void 0:e.touches[0],o=e==null?void 0:e.touches[1];s.pageX1=t==null?void 0:t.pageX,s.pageY1=t==null?void 0:t.pageY,o&&(s.pageX2=o==null?void 0:o.pageX,s.pageY2=o==null?void 0:o.pageY)},oe=e=>{const t=e==null?void 0:e.touches[0],o=e==null?void 0:e.touches[1];o&&(b(s.pageX2)||(s.pageX2=o.pageX),b(s.pageY2)||(s.pageY2=o.pageY));const n=(i,v,E,ue)=>Math.hypot(E-i,ue-v);if(!b(s.pageX1)||!b(s.pageY1)||!b(s.pageX2)||!b(s.pageY2))return;const c=n(t.pageX,t.pageY,o.pageX,o.pageY)/n(s.pageX1,s.pageY1,s.pageX2,s.pageY2);r.value=Math.min(Math.max(.5,r.value*c),4)};ge(()=>{document!=null&&document.addEventListener&&(document==null||document.addEventListener("keydown",O))});const O=e=>{e.preventDefault(),(e==null?void 0:e.keyCode)===27&&S()},ae=()=>{r.value+=.1},se=()=>{r.value=r.value-.1>D.value?r.value-.1:D.value},S=()=>{B("close")},ne=()=>{X.value-=90},ie=()=>{X.value+=90},P=()=>{l.value<h.imageList.length-1&&l.value++,U()},A=()=>{l.value>0&&l.value--,U()},U=()=>{r.value=1,X.value=0},le=e=>{var t,o,n,c;return d?(o=(t=e==null?void 0:e.payload)==null?void 0:t.imageInfoArray[0])==null?void 0:o.url:(c=(n=e==null?void 0:e.payload)==null?void 0:n.imageInfoArray[2])==null?void 0:c.url},ce=()=>{var o,n;const e=h.imageList[l.value],t=(n=(o=e==null?void 0:e.payload)==null?void 0:o.imageInfoArray[0])==null?void 0:n.url;if(!t){_({message:T.t("component.图片 url 不存在"),type:L.ERROR});return}switch(ye()){case"wechat":g.getSetting({success:c=>{c!=null&&c.authSetting["scope.writePhotosAlbum"]?z(t):g.authorize({scope:"scope.writePhotosAlbum",success(){z(t)},fail(){g.showModal({title:"您已拒绝获取相册权限",content:"是否进入权限管理，调整授权？",success:i=>{if(i.confirm)g.openSetting({success:v=>{console.log(v.authSetting)}});else if(i.cancel)return _({message:T.t("component.已取消"),type:L.ERROR})}})}})},fail:()=>{_({message:T.t("component.获取权限失败"),type:L.ERROR})}});break;case"app":z(t);break;default:re(t);break}},z=e=>{g.showLoading({title:"大图提取中"}),g.downloadFile({url:e,success:function(t){g.hideLoading(),g.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:()=>{_({message:T.t("component.已保存至相册"),type:L.SUCCESS})}})},fail:function(){g.hideLoading(),_({message:T.t("component.图片下载失败"),type:L.ERROR})}})},re=e=>{var c;const t={mode:"cors",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})},o=h.imageList[l.value],n=(c=o==null?void 0:o.payload)==null?void 0:c.imageFormat;if(!Y.has(n)){_({message:T.t("component.暂不支持下载此类型图片"),type:L.ERROR});return}if(window.fetch)fetch(e,t).then(i=>i.blob()).then(i=>{const v=document.createElement("a"),E=window.URL.createObjectURL(i);v.href=E,v.download=E+"."+Y.get(n),v.click()});else{const i=document.createElement("a");i.href=e,i.target="_blank",i.download=e+"."+Y.get(n),i.click()}};return fe(()=>{document!=null&&document.removeEventListener&&(document==null||document.removeEventListener("keydown",O))}),(e,t)=>(u(),m("div",{class:M(["image-previewer",[a(W)&&"image-previewer-h5"]])},[k("div",{ref_key:"image",ref:$,class:"image-wrapper",onTouchstart:I(G,["stop"]),onTouchmove:I(H,["stop"]),onTouchend:I(q,["stop"]),onTouchcancel:I(J,["stop"]),onWheel:I(Q,["stop"])},[k("ul",{ref_key:"ulRef",ref:K,class:"image-list",style:de({width:`${e.imageList.length*100}%`,transform:`translateX(-${a(l)*100/e.imageList.length}%)`,transition:"0.5s"})},[(u(!0),m(he,null,ve(e.imageList,(o,n)=>(u(),m("li",{key:n,class:"image-item"},[p(Re,{zoom:a(r),rotate:a(X),src:le(o),messageItem:o,class:M([a(Te)?"image-item":""])},null,8,["zoom","rotate","src","messageItem","class"])]))),128))],4)],544),we(k("div",{class:"icon icon-close",onClick:S},[p(f,{file:a(Ie),width:"16px",height:"16px"},null,8,["file"])],512),[[be,a(d)]]),a(d)&&a(l)>0?(u(),m("div",{key:0,class:"image-button image-button-left",onClick:A},[p(f,{file:a(V)},null,8,["file"])])):R("",!0),a(d)&&a(l)<e.imageList.length-1?(u(),m("div",{key:1,class:"image-button image-button-right",onClick:P},[p(f,{file:a(V)},null,8,["file"])])):R("",!0),k("div",{class:M(["actions-bar",a(W)&&"actions-bar-h5"])},[a(d)?(u(),m("div",{key:0,class:"icon-zoom-in",onClick:ae},[p(f,{file:a(_e),width:"27px",height:"27px"},null,8,["file"])])):R("",!0),a(d)?(u(),m("div",{key:1,class:"icon-zoom-out",onClick:se},[p(f,{file:a(Le),width:"27px",height:"27px"},null,8,["file"])])):R("",!0),a(d)?(u(),m("div",{key:2,class:"icon-refresh-left",onClick:ne},[p(f,{file:a(Xe),width:"27px",height:"27px"},null,8,["file"])])):R("",!0),a(d)?(u(),m("div",{key:3,class:"icon-refresh-right",onClick:ie},[p(f,{file:a(xe),width:"27px",height:"27px"},null,8,["file"])])):R("",!0),k("span",Ye,N(a(l)+1)+" / "+N(e.imageList.length),1)],2),k("div",{class:"save",onClick:I(ce,["stop","prevent"])},[p(f,{file:a(Ee),width:"20px",height:"20px"},null,8,["file"])])],2))}});const qe=ke(Ce,[["__scopeId","data-v-97c61def"]]);export{qe as default};
