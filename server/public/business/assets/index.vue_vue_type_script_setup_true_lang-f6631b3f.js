import{x as C,B as F,O as k,P as N,A as q,C as D}from"./element-plus-64da2267.js";import{w as f}from"./index-7638d9aa.js";import{P as O}from"./index-e34f0d65.js";import{d as S,b0 as V,aZ as w,o as h,c as U,G as a,aM as l,E as _,a as c,aV as t,aw as m,t as M,u as P}from"./@vue-25170201.js";const j={class:"export-data"},G={class:"flex"},I=c("span",{class:"flex-none ml-2 mr-2"},"页，至",-1),H=S({__name:"index",props:{params:{type:Object,default:()=>({})},pageSize:{type:Number,default:25},fetchFun:{type:Function,required:!0}},setup(E){const g=V(),d=E,x=V(),o=w({page_type:0,page_start:1,page_end:200,file_name:""}),v={page_start:[{required:!0,message:"请输入起始页码"},{type:"number",message:"页码必须是整数"},{validator:(r,e,n)=>{if(e<=0)return n(new Error("页码必须大于0"));n()}}],page_end:[{required:!0,message:"请输入结束页码"},{type:"number",message:"页码必须是整数"},{validator:(r,e,n)=>{if(e<=0)return n(new Error("页码必须大于0"));n()}}]},u=w({count:0,sum_page:0,page_size:0,max_page:0,all_max_size:0}),y=async()=>{const r=await d.fetchFun({...d.params,page_size:d.pageSize,export:1});Object.assign(u,r),o.file_name=r.file_name,o.page_end=r.page_end,o.page_start=r.page_start},z=async()=>{var r,e;await((r=g.value)==null?void 0:r.validate()),f.loading("正在导出中...");try{await d.fetchFun({...d.params,...o,page_size:d.pageSize,export:2}),(e=x.value)==null||e.close(),f.closeLoading()}catch{f.closeLoading()}};return y(),(r,e)=>{const n=C,p=F,b=k,R=N,i=q,B=D;return h(),U("div",j,[a(O,{ref_key:"popupRef",ref:x,title:"导出设置",width:"500px","confirm-button-text":"确认导出",onConfirm:z,async:!0,onOpen:y},{trigger:l(()=>[a(n,null,{default:l(()=>[_("导出")]),_:1})]),default:l(()=>[c("div",null,[a(B,{ref_key:"formRef",ref:g,model:t(o),"label-width":"120px",rules:v},{default:l(()=>[a(p,{label:"数据量："},{default:l(()=>[_(" 预计导出"+m(t(u).count)+"条数据， 共"+m(t(u).sum_page)+"页，每页"+m(t(u).page_size)+"条数据 ",1)]),_:1}),a(p,{label:"导出限制："},{default:l(()=>[_(" 每次导出最大允许"+m(t(u).max_page)+"页，共"+m(t(u).all_max_size)+"条数据 ",1)]),_:1}),a(p,{prop:"page_type",label:"导出范围：",required:""},{default:l(()=>[a(R,{modelValue:t(o).page_type,"onUpdate:modelValue":e[0]||(e[0]=s=>t(o).page_type=s)},{default:l(()=>[a(b,{label:0},{default:l(()=>[_("全部导出")]),_:1}),a(b,{label:1},{default:l(()=>[_("分页导出")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(o).page_type==1?(h(),M(p,{key:0,label:"分页范围："},{default:l(()=>[c("div",G,[a(p,{prop:"page_start"},{default:l(()=>[a(i,{style:{width:"140px"},modelValue:t(o).page_start,"onUpdate:modelValue":e[1]||(e[1]=s=>t(o).page_start=s),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])]),_:1}),I,a(p,{prop:"page_end"},{default:l(()=>[a(i,{style:{width:"140px"},modelValue:t(o).page_end,"onUpdate:modelValue":e[2]||(e[2]=s=>t(o).page_end=s),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])]),_:1})])]),_:1})):P("",!0),a(p,{label:"导出文件名称：",prop:"file_name"},{default:l(()=>[a(i,{modelValue:t(o).file_name,"onUpdate:modelValue":e[3]||(e[3]=s=>t(o).file_name=s),placeholder:"请输入导出文件名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},512)])}}});export{H as _};
