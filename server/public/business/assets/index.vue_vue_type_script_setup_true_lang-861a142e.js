import"./adapter-vue-20243c9c.js";import{q as o,o as n,z as m,B as P,X as D}from"./@tencentcloud-25a17c42.js";import k from"./index-3a577aae.js";import v from"./index-fda4f051.js";import{T}from"./index-ebb29dde.js";import{c as E}from"./env-6b0ecdb8.js";import{i as b}from"./utils-601596c6.js";import{O as B}from"./index-784fd949.js";import{T as h}from"./index-9521edcb.js";import{d as y,r as F,aU as x,aW as G,o as N,t as V,aM as q,G as z,aV as l}from"./@vue-25170201.js";const W=y({__name:"index",emits:["toggleMultipleSelectMode"],setup(A,{emit:S}){const I=S;let f=[],i=!1;const d=F(!1),u=F();x(()=>{o.watch(n.CUSTOM,{singleForwardMessageID:c,multipleForwardMessageID:g})}),G(()=>{o.unwatch(n.CUSTOM,{singleForwardMessageID:c,multipleForwardMessageID:g}),M()});function c(e){typeof e<"u"&&(i=!1,f=[e],w())}function g(e){if(!e)return;i=!1;const{isMergeForward:s,messageIDList:r}=e||{};(r==null?void 0:r.length)>0?(i=s,f=r,w()):T({message:m.t("TUIChat.未选择消息"),type:h.ERROR})}function M(){o.update(n.CUSTOM,"singleForwardMessageID",void 0),o.update(n.CUSTOM,"multipleForwardMessageID",void 0)}function p(){M(),d.value=!1}function w(){_(),d.value=!0}function R(e){if((e==null?void 0:e.length)===0)return;const s=e.map(a=>o.getConversationModel(a.userID)),r=f.map(a=>o.getMessageModel(a)).sort((a,t)=>a.time-t.time),U=s.map(a=>{const t={conversation:a,messageType:P.TYPES.MSG_MERGER};return D.sendForwardMessage([a],r,{needMerge:i,offlinePushInfo:B.create(t),params:{needReadReceipt:b()}})});Promise.allSettled(U).then(a=>{for(const t of a){const{status:C}=t;if(C==="rejected"){const O=t.reason.code===80001?m.t("TUIChat.内容包含敏感词汇"):t.reason.message;T({message:O,type:h.ERROR});break}}}),p(),I("toggleMultipleSelectMode",!1)}function _(){const e=o.getData(n.CONV,"conversationList");u.value=e.map(s=>({userID:s.conversationID,nick:s.getShowName(),avatar:s.getAvatar()}))}return(e,s)=>(N(),V(k,{visible:l(d),useMask:!1},{default:q(()=>[z(v,{title:l(m).t("TUIChat.转发"),isSearch:!1,isCustomItem:!1,list:l(u),isHiddenBackIcon:l(E),onCancel:p,onSubmit:R},null,8,["title","list","isHiddenBackIcon"])]),_:1},8,["visible"]))}});export{W as _};
