import{l as y,r as C,b as I,j as z,c as N,a as h,f as P}from"./prosemirror-transform-fc1f2a72.js";import{F as k,S as x}from"./prosemirror-model-8b0495eb.js";import{N as s,S as A,A as W,T as B}from"./prosemirror-state-c544e594.js";const H=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function D(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("backward",t):r.parentOffset>0)?null:r}const K=(t,e,r)=>{let n=D(t,r);if(!n)return!1;let l=j(n);if(!l){let i=n.blockRange(),f=i&&y(i);return f==null?!1:(e&&e(t.tr.lift(i,f).scrollIntoView()),!0)}let o=l.nodeBefore;if(O(t,l,e,-1))return!0;if(n.parent.content.size==0&&(w(o,"end")||s.isSelectable(o)))for(let i=n.depth;;i--){let f=C(t.doc,n.before(i),n.after(i),x.empty);if(f&&f.slice.size<f.to-f.from){if(e){let c=t.tr.step(f);c.setSelection(w(o,"end")?A.findFrom(c.doc.resolve(c.mapping.map(l.pos,-1)),-1):s.create(c.doc,l.pos-o.nodeSize)),e(c.scrollIntoView())}return!0}if(i==1||n.node(i-1).childCount>1)break}return o.isAtom&&l.depth==n.depth-1?(e&&e(t.tr.delete(l.pos-o.nodeSize,l.pos).scrollIntoView()),!0):!1};function w(t,e,r=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(r&&n.childCount!=1)return!1}return!1}const L=(t,e,r)=>{let{$head:n,empty:l}=t.selection,o=n;if(!l)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):n.parentOffset>0)return!1;o=j(n)}let i=o&&o.nodeBefore;return!i||!s.isSelectable(i)?!1:(e&&e(t.tr.setSelection(s.create(t.doc,o.pos-i.nodeSize)).scrollIntoView()),!0)};function j(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function E(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)?null:r}const Q=(t,e,r)=>{let n=E(t,r);if(!n)return!1;let l=R(n);if(!l)return!1;let o=l.nodeAfter;if(O(t,l,e,1))return!0;if(n.parent.content.size==0&&(w(o,"start")||s.isSelectable(o))){let i=C(t.doc,n.before(),n.after(),x.empty);if(i&&i.slice.size<i.to-i.from){if(e){let f=t.tr.step(i);f.setSelection(w(o,"start")?A.findFrom(f.doc.resolve(f.mapping.map(l.pos)),1):s.create(f.doc,f.mapping.map(l.pos))),e(f.scrollIntoView())}return!0}}return o.isAtom&&l.depth==n.depth-1?(e&&e(t.tr.delete(l.pos,l.pos+o.nodeSize).scrollIntoView()),!0):!1},X=(t,e,r)=>{let{$head:n,empty:l}=t.selection,o=n;if(!l)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;o=R(n)}let i=o&&o.nodeAfter;return!i||!s.isSelectable(i)?!1:(e&&e(t.tr.setSelection(s.create(t.doc,o.pos)).scrollIntoView()),!0)};function R(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}const Y=(t,e)=>{let r=t.selection,n=r instanceof s,l;if(n){if(r.node.isTextblock||!I(t.doc,r.from))return!1;l=r.from}else if(l=z(t.doc,r.from,-1),l==null)return!1;if(e){let o=t.tr.join(l);n&&o.setSelection(s.create(o.doc,l-t.doc.resolve(l).nodeBefore.nodeSize)),e(o.scrollIntoView())}return!0},Z=(t,e)=>{let r=t.selection,n;if(r instanceof s){if(r.node.isTextblock||!I(t.doc,r.to))return!1;n=r.to}else if(n=z(t.doc,r.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},_=(t,e)=>{let{$from:r,$to:n}=t.selection,l=r.blockRange(n),o=l&&y(l);return o==null?!1:(e&&e(t.tr.lift(l,o).scrollIntoView()),!0)},$=(t,e)=>{let{$head:r,$anchor:n}=t.selection;return!r.parent.type.spec.code||!r.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function F(t){for(let e=0;e<t.edgeCount;e++){let{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}const ee=(t,e)=>{let{$head:r,$anchor:n}=t.selection;if(!r.parent.type.spec.code||!r.sameParent(n))return!1;let l=r.node(-1),o=r.indexAfter(-1),i=F(l.contentMatchAt(o));if(!i||!l.canReplaceWith(o,o,i))return!1;if(e){let f=r.after(),c=t.tr.replaceWith(f,f,i.createAndFill());c.setSelection(A.near(c.doc.resolve(f),1)),e(c.scrollIntoView())}return!0},te=(t,e)=>{let r=t.selection,{$from:n,$to:l}=r;if(r instanceof W||n.parent.inlineContent||l.parent.inlineContent)return!1;let o=F(l.parent.contentMatchAt(l.indexAfter()));if(!o||!o.isTextblock)return!1;if(e){let i=(!n.parentOffset&&l.index()<l.parent.childCount?n:l).pos,f=t.tr.insert(i,o.createAndFill());f.setSelection(B.create(f.doc,i+1)),e(f.scrollIntoView())}return!0},re=(t,e)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let o=r.before();if(N(t.doc,o))return e&&e(t.tr.split(o).scrollIntoView()),!0}let n=r.blockRange(),l=n&&y(n);return l==null?!1:(e&&e(t.tr.lift(n,l).scrollIntoView()),!0)},ne=(t,e)=>{let{$from:r,to:n}=t.selection,l,o=r.sharedDepth(n);return o==0?!1:(l=r.before(o),e&&e(t.tr.setSelection(s.create(t.doc,l))),!0)};function q(t,e,r){let n=e.nodeBefore,l=e.nodeAfter,o=e.index();return!n||!l||!n.type.compatibleContent(l.type)?!1:!n.content.size&&e.parent.canReplace(o-1,o)?(r&&r(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(o,o+1)||!(l.isTextblock||I(t.doc,e.pos))?!1:(r&&r(t.tr.clearIncompatible(e.pos,n.type,n.contentMatchAt(n.childCount)).join(e.pos).scrollIntoView()),!0)}function O(t,e,r,n){let l=e.nodeBefore,o=e.nodeAfter,i,f,c=l.type.spec.isolating||o.type.spec.isolating;if(!c&&q(t,e,r))return!0;let S=!c&&e.parent.canReplace(e.index(),e.index()+1);if(S&&(i=(f=l.contentMatchAt(l.childCount)).findWrapping(o.type))&&f.matchType(i[0]||o.type).validEnd){if(r){let a=e.pos+o.nodeSize,u=k.empty;for(let p=i.length-1;p>=0;p--)u=k.from(i[p].create(null,u));u=k.from(l.copy(u));let d=t.tr.step(new h(e.pos-1,a,e.pos,a,new x(u,1,0),i.length,!0)),g=a+2*i.length;I(d.doc,g)&&d.join(g),r(d.scrollIntoView())}return!0}let m=o.type.spec.isolating||n>0&&c?null:A.findFrom(e,1),b=m&&m.$from.blockRange(m.$to),T=b&&y(b);if(T!=null&&T>=e.depth)return r&&r(t.tr.lift(b,T).scrollIntoView()),!0;if(S&&w(o,"start",!0)&&w(l,"end")){let a=l,u=[];for(;u.push(a),!a.isTextblock;)a=a.lastChild;let d=o,g=1;for(;!d.isTextblock;d=d.firstChild)g++;if(a.canReplace(a.childCount,a.childCount,d.content)){if(r){let p=k.empty;for(let V=u.length-1;V>=0;V--)p=k.from(u[V].copy(p));let M=t.tr.step(new h(e.pos-u.length,e.pos+o.nodeSize,e.pos+g,e.pos+o.nodeSize-g,new x(p,u.length,0),0,!0));r(M.scrollIntoView())}return!0}}return!1}function v(t){return function(e,r){let n=e.selection,l=t<0?n.$from:n.$to,o=l.depth;for(;l.node(o).isInline;){if(!o)return!1;o--}return l.node(o).isTextblock?(r&&r(e.tr.setSelection(B.create(e.doc,t<0?l.start(o):l.end(o)))),!0):!1}}const oe=v(-1),le=v(1);function ie(t,e=null){return function(r,n){let{$from:l,$to:o}=r.selection,i=l.blockRange(o),f=i&&P(i,t,e);return f?(n&&n(r.tr.wrap(i,f).scrollIntoView()),!0):!1}}function fe(t,e=null){return function(r,n){let l=!1;for(let o=0;o<r.selection.ranges.length&&!l;o++){let{$from:{pos:i},$to:{pos:f}}=r.selection.ranges[o];r.doc.nodesBetween(i,f,(c,S)=>{if(l)return!1;if(!(!c.isTextblock||c.hasMarkup(t,e)))if(c.type==t)l=!0;else{let m=r.doc.resolve(S),b=m.index();l=m.parent.canReplaceWith(b,b+1,t)}})}if(!l)return!1;if(n){let o=r.tr;for(let i=0;i<r.selection.ranges.length;i++){let{$from:{pos:f},$to:{pos:c}}=r.selection.ranges[i];o.setBlockType(f,c,t,e)}n(o.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";export{Z as a,K as b,te as c,H as d,ee as e,Q as f,re as g,X as h,ne as i,Y as j,le as k,_ as l,oe as m,$ as n,fe as o,L as s,ie as w};
