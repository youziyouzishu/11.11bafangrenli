import"./adapter-vue-20243c9c.js";import{z as b,q as o,o as r,E as B,_ as H}from"./@tencentcloud-25a17c42.js";import U from"./Icon-fec85db6.js";import{J as V}from"./type-check-5e73d261.js";import{d as k,r as a,b as E,w as $,aU as j,aW as q,aV as g,o as z,c as J,G,a as R,aw as W,u as F}from"./@vue-25170201.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./env-6b0ecdb8.js";const K="/business/assets/double-arrow-a1a15b8b.svg",P={class:"scroll-button-text"},Q=k({__name:"index",emits:["scrollToLatestMessage"],setup(X,{expose:x,emit:y}){const M=y,p=a([]),d=a(""),u=a(0),c=a(0),l=a(!1),f=a(!1),i=a(!1),S=E(()=>c.value?`${c.value}${b.t("TUIChat.条新消息")}`:b.t("TUIChat.回到最新位置"));$(()=>[l.value,f.value],()=>{i.value=l.value||f.value,i.value||m()},{immediate:!0}),j(()=>{o.watch(r.CHAT,{messageList:v,newMessageList:_}),o.watch(r.CONV,{currentConversation:h})}),q(()=>{o.unwatch(r.CHAT,{messageList:v,newMessageList:_}),o.unwatch(r.CONV,{currentConversation:h})});function I(e){var t,s;return((s=V((t=e.payload)==null?void 0:t.data))==null?void 0:s.businessID)==="user_typing_status"}function v(e){var s,n;p.value=e||[];const t=(n=p.value)==null?void 0:n[((s=p.value)==null?void 0:s.length)-1];f.value=!!(t&&(t==null?void 0:t.time)<(u==null?void 0:u.value))}function _(e){Array.isArray(e)&&i.value&&e.forEach(t=>{t&&t.conversationID===d.value&&!t.isDeleted&&!t.isRevoked&&!I(t)&&(c.value+=1)})}function h(e){var t;(e==null?void 0:e.conversationID)!==d.value&&m(),d.value=(e==null?void 0:e.conversationID)||"",u.value=((t=e==null?void 0:e.lastMessage)==null?void 0:t.lastTime)||0}async function L(e){var t,s,n,C,w;if(e.target)try{const{height:T}=await B(`#${(t=e.target)==null?void 0:t.id}`,"messageList")||{},O=((s=e.target)==null?void 0:s.scrollHeight)||((n=e.detail)==null?void 0:n.scrollHeight),A=((C=e.target)==null?void 0:C.scrollTop)||((w=e.detail)==null?void 0:w.scrollTop)||0;if(O-A>2*T){l.value=!0;return}l.value=!1}catch{l.value=!1}}function D(){o.getData(r.CHAT,"messageSource")!==void 0&&o.update(r.CHAT,"messageSource",void 0)}function m(){c.value=0}function N(){D(),m(),M("scrollToLatestMessage")}return x({judgeScrollOverOneScreen:L,isScrollButtonVisible:i}),(e,t)=>g(i)?(z(),J("div",{key:0,class:"scroll-button",onClick:N},[G(U,{width:"10px",height:"10px",file:g(K)},null,8,["file"]),R("div",P,W(g(S)),1)])):F("",!0)}});const me=H(Q,[["__scopeId","data-v-f109caf6"]]);export{me as default};
