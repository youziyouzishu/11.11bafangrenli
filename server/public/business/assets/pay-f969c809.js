import{k as p,A as N,B as q,x as D,C as F,F as U}from"./element-plus-64da2267.js";import{r as $,a as I}from"./recharge-8f45704b.js";import{q as P}from"./index-7638d9aa.js";import{d as A,r as _,w as M,aZ as j,o as V,c as G,G as t,aM as a,a as i,E as f,t as O,u as R}from"./@vue-25170201.js";import{_ as T}from"./@tencentcloud-25a17c42.js";function W(c){return P.post({url:"/pay/prepay",data:c})}const Z={class:"payment-buttons"},z={class:"qr-code-container"},H=["src"],J={class:"dialog-footer"},K=A({__name:"pay",props:{dialogVisible:Boolean},emits:["update:dialogVisible"],setup(c,{emit:b}){const y=c,w=b,n=_(y.dialogVisible);M(()=>y.dialogVisible,o=>{n.value=o});const l=_({amount:""}),C=j({user_money:"",min_amount:0}),u=_(null),g=()=>{n.value=!1,w("update:dialogVisible",!1)},h=()=>{g()},k=async()=>{const o=await $();Object.assign(C,o)},x=async(o,e)=>{const r=await I({money:e});await W({order_id:r.order_id,from:r.from,pay_way:2})},v=async o=>{if(!l.value.amount||isNaN(Number(l.value.amount))){p.error("请输入有效的充值金额");return}try{const e=await x(o,l.value.amount);u.value=e.qrCodeUrl,p.success(`请使用${o==="wechat"?"微信":"支付宝"}扫码支付`)}catch(e){p.error(`支付失败：${e.message||e}`)}};return k(),(o,e)=>{const r=N,m=q,d=D,E=F,B=U;return V(),G("div",null,[t(B,{modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value=s),title:"充值",width:"400px",onClose:h},{footer:a(()=>[i("span",J,[t(d,{onClick:g},{default:a(()=>[f("取消")]),_:1})])]),default:a(()=>[t(E,{ref:"rechargeForm",model:l.value,class:"recharge-form"},{default:a(()=>[t(m,{label:"充值金额",prop:"amount",required:""},{default:a(()=>[t(r,{modelValue:l.value.amount,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.amount=s),placeholder:"请输入充值金额",type:"number"},null,8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[i("div",Z,[t(d,{type:"primary",onClick:e[1]||(e[1]=s=>v("wechat"))},{default:a(()=>[f("微信支付")]),_:1}),t(d,{type:"success",onClick:e[2]||(e[2]=s=>v("alipay"))},{default:a(()=>[f("银行转账")]),_:1})])]),_:1}),u.value?(V(),O(m,{key:0},{default:a(()=>[i("div",z,[i("img",{src:u.value,alt:"支付二维码"},null,8,H)])]),_:1})):R("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const ee=T(K,[["__scopeId","data-v-304a483e"]]);export{ee as P};
