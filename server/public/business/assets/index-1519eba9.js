var K=Object.defineProperty;var F=(n,e,t)=>e in n?K(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>(F(n,typeof e!="symbol"?e+"":e,t),t);import{f as X}from"./adapter-vue-20243c9c.js";import{R as d,r as i,q as C,o as E,X as y,z as S,i as D,J as H,Q as q,W as B,Z as P,O as W,_ as $}from"./@tencentcloud-25a17c42.js";import Y from"./index-f063767f.js";import{T as z}from"./config-58aee8b5.js";import J from"./index-037c1ed0.js";import{e as _}from"./constant-bad60a54.js";import{c as b,i as l}from"./env-6b0ecdb8.js";import{c as Q,a as Z}from"./index-1703443c.js";import{e as j}from"./enableSampleTaskStatus-86998722.js";import N from"./index-c2e7ca88.js";import w from"./index-4dda2eb7.js";import{T as tt}from"./index.vue_vue_type_script_setup_true_lang-b14718b0.js";import k from"./index-f55ebd7b.js";import{T as et}from"./server-4915c2f5.js";import{d as rt,r as R,aU as it,o as u,c as h,ak as ot,a as f,aV as r,F as st,aj as at,a9 as M,aw as G,u as v,G as I,aM as nt,t as pt}from"./@vue-25170201.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./index-044e1c2c.js";import"./Icon-fec85db6.js";import"./back-51a4f00d.js";import"./index-01bedd90.js";import"./lodash-2cc29f39.js";import"./index-4cff07d5.js";import"./index-15293322.js";import"./index-5255cd2a.js";import"./index-3a577aae.js";import"./close-dark-2378607d.js";import"./message-text-4132c1d0.js";import"./index-8f711959.js";import"./index-7638d9aa.js";import"./element-plus-64da2267.js";import"./lodash-es-fbce1780.js";import"./async-validator-dee29e8b.js";import"./@element-plus-9559a6ac.js";import"./dayjs-346d7cd4.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@vueuse-944ef3f4.js";import"./axios-67477f72.js";import"./vue-router-f7517f62.js";import"./css-color-function-7acc3e97.js";import"./color-9254db0b.js";import"./clone-db6b0f3b.js";import"./color-convert-946e453a.js";import"./color-name-b7949e8c.js";import"./color-string-6fa48439.js";import"./balanced-match-51764fed.js";import"./ms-f6814399.js";import"./nprogress-ccaead9e.js";import"./@tiptap-008a465d.js";import"./prosemirror-state-c544e594.js";import"./prosemirror-model-8b0495eb.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-fc1f2a72.js";import"./prosemirror-view-ef3f9f96.js";import"./prosemirror-keymap-776f822d.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-5c2a1a07.js";import"./prosemirror-schema-list-1c96ec4d.js";import"./vue-clipboard3-f5f9feb9.js";import"./clipboard-3d849c41.js";import"./echarts-d6620a89.js";import"./zrender-9797a04d.js";import"./tslib-54e39b60.js";import"./highlight.js-1b502259.js";import"./@highlightjs-7a15facb.js";import"./path-to-regexp-767716ea.js";import"./message-image-131f5c5d.js";import"./utils-601596c6.js";import"./message-audio-f41eece1.js";import"./index-e1b60aa5.js";import"./video-play-6934d780.js";import"./message-container-aeb74b8c.js";import"./message-file-babfc691.js";import"./files-37ebf78f.js";import"./message-face-0ee0d869.js";import"./message-custom-4c554336.js";import"./type-check-5e73d261.js";import"./star-light-46b224d3.js";import"./message-tip-146bc814.js";import"./message-bubble-c0cc7deb.js";import"./index-ae164957.js";import"./index-e044d709.js";import"./index-ebb29dde.js";import"./index-9521edcb.js";import"./index-84a33251.js";import"./translation-content-b8bad7bc.js";import"./index-7208319e.js";import"./convert-content-4209ee90.js";import"./index-79e54707.js";import"./message-location-9788ed03.js";import"./message-timestamp-54812030.js";import"./message-video-1a9a22eb.js";import"./icon-close-aa3d72bb.js";import"./index-397470ed.js";import"./message-revoked-1c7ffc30.js";import"./message-plugin-849aedd1.js";import"./message-plugin-layout-f8148c2d.js";import"./message-call-group-73eac480.js";import"./message-call-c2c-9034a137.js";import"./index-784fd949.js";import"./message-customer-service-49a2fb79.js";import"./message-room-default-d4932a61.js";import"./index-514ca0db.js";import"./index-e656c675.js";import"./index-05c3d16c.js";import"./index-11528969.js";import"./index-bc2bb4c0.js";import"./image-item.vue_vue_type_style_index_0_lang-8f2a780f.js";import"./index-60212fd7.js";import"./index-60abac5c.js";import"./message-input-editor-45bc727d.js";import"./index-66323cb1.js";import"./index-28e12cb3.js";import"./message-input-button-5fd873ac.js";import"./index-d1c59c82.js";import"./index-fa307e3d.js";import"./index.vue_vue_type_script_setup_true_lang-861a142e.js";import"./index-fda4f051.js";import"./selected-c03c92a6.js";import"./index-687de315.js";import"./index-584481a4.js";import"./emoji-picker-dialog-26347a6f.js";import"./index-e05e1787.js";import"./index-8a73edcd.js";import"./camera-uni-e149e9d8.js";import"./index-ccccbee1.js";import"./index-8ff81968.js";import"./index-c989cd73.js";import"./documentLink-a7b030c0.js";import"./index-b39069be.js";import"./index.vue_vue_type_script_setup_true_lang-f6def3a2.js";import"./index-bbec58a3.js";import"./index-aacb21ef.js";import"./index-150fabb1.js";import"./index-517c8d25.js";import"./search-8a2a0342.js";import"./input-close-4e859ba7.js";import"./type-96adc8a0.js";import"./index-abae49e6.js";import"./search-type-list-06b12619.js";import"./index-c86991f7.js";import"./date-picker-panel-245cd44c.js";import"./date-table-21a73c34.js";import"./down-icon-9d19ec5a.js";import"./index-fc18f8da.js";import"./index-fed2cc2c.js";import"./message-abstract-text-e294c4bd.js";import"./message-abstract-file-f391c9eb.js";import"./message-abstract-custom-1a52be48.js";import"./message-abstract-image-0e6a77c1.js";import"./message-abstract-video-36f588fb.js";import"./index-62e29204.js";import"./index-e5a643d7.js";import"./index-4fed586a.js";import"./right-icon-312a665a.js";import"./index-007289e5.js";import"./index-15f7133e.js";import"./index-929dc2e1.js";import"./index-d7431b6d.js";import"./index-c056fc46.js";import"./index-814cb23a.js";import"./edit-750d10dc.js";import"./index-25f7a7a8.js";import"./index.vue_vue_type_script_setup_true_lang-052aba16.js";import"./index-621ecde8.js";import"./index-67d3de44.js";import"./index-0b3d01d2.js";import"./index-3b0a6039.js";import"./manage-name-5cda10ca.js";import"./manage-notification-d6383ccc.js";import"./manage-member-67bb5072.js";import"./manage-profile-7180ad1b.js";import"./manage-admin-9d0cb3b9.js";import"./index-c47c2878.js";import"./index.vue_vue_type_script_setup_true_lang-93043a7e.js";class mt{constructor(){c(this,"currentConversationID","");c(this,"currentMessageList",[]);d.registerService(i.TUIChat.SERVICE.NAME,this),C.watch(E.CONV,{currentConversationID:e=>{this.currentConversationID=e}}),C.watch(E.CHAT,{messageList:e=>{this.currentMessageList=e}})}onCall(e,t,o){let a;switch(e){case i.TUIChat.SERVICE.METHOD.UPDATE_MESSAGE_LIST:if(a=t.message,(a==null?void 0:a.conversationID)===this.currentConversationID){const p=[...this.currentMessageList,a];C.update(E.CHAT,"messageList",p)}break;case i.TUIChat.SERVICE.METHOD.SEND_CUSTOM_MESSAGE:y.sendCustomMessage(t).then(p=>{o&&o(p)});break;case i.TUIChat.SERVICE.METHOD.SEND_TEXT_MESSAGE:y.sendTextMessage(t).then(p=>{o&&o(p)});break;case i.TUIChat.SERVICE.METHOD.SET_CHAT_TYPE:z.setChatType(t==null?void 0:t.chatType);break;case i.TUIChat.SERVICE.METHOD.CLOSE_MESSAGE_POP_MENU:C.update(E.CUSTOM,"isShowMessagePopMenu",!1);break}}}new mt;const T=class T{constructor(){c(this,"onCallParamsMap");c(this,"onCallCallbackMap");c(this,"constants");c(this,"hideConversationHeader",()=>{C.update(E.CUSTOM,"isShowConversationHeader",!1)});d.registerService(i.TUIConversation.SERVICE.NAME,this),d.registerExtension(i.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID,this),this.onCallParamsMap=new Map,this.onCallCallbackMap=new Map,this.constants=i}static getInstance(){return T.instance||(T.instance=new T),T.instance}getOnCallParams(e){return this.onCallParamsMap.get(e)}getOnCallCallback(e){return this.onCallCallbackMap.get(e)}onCall(e,t,o){switch(this.onCallParamsMap.set(e,t),this.onCallCallbackMap.set(e,o),e){case i.TUIConversation.SERVICE.METHOD.CREATE_CONVERSATION:this.createConversation(t);break;case i.TUIConversation.SERVICE.METHOD.HIDE_CONVERSATION_HEADER:this.hideConversationHeader();break}}onGetExtension(e){if(e===i.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID)return[{weight:100,icon:Q,text:S.t("TUIConversation.发起单聊"),data:{name:_.TYPEC2C},listener:{onClicked:this.createConversation.bind(this)}},{weight:100,icon:Z,text:S.t("TUIConversation.发起群聊"),data:{name:_.TYPEGROUP},listener:{onClicked:this.createConversation.bind(this)}}]}createConversation(e){d.callService({serviceName:i.TUIContact.SERVICE.NAME,method:i.TUIContact.SERVICE.METHOD.SELECT_FRIEND,params:{title:e.text,isRadio:e.data.name!==_.TYPEGROUP,isNeedSearch:!C.getData(E.APP,"isOfficial")},callback:async t=>{if(!t||t.length===0)return this.routerForward(null);if(e.data.name===_.TYPEGROUP)this.createGroup(t);else{const{userID:o}=t[0];await this.generateConversation(`C2C${o}`),this.routerForward(`C2C${o}`)}}})}createGroup(e){d.callService({serviceName:i.TUIGroup.SERVICE.NAME,method:i.TUIGroup.SERVICE.METHOD.CREATE_GROUP,params:{title:S.t("TUIConversation.发起群聊"),memberList:e},callback:async t=>{let o=null;if(t){const{groupID:a}=t;await this.generateConversation(`GROUP${a}`),o=`GROUP${a}`}this.routerForward(o)}})}async routerForward(e){var t,o;b&&(await((t=D)==null?void 0:t.reLaunch({url:"/TUIKit/components/TUIConversation/index"})),e&&((o=D)==null||o.navigateTo({url:"/TUIKit/components/TUIChat/index"})))}generateConversation(e){H.switchConversation(e).then(()=>{e.startsWith("GROUP")&&j("groupChat"),console.warn("打开会话成功")}).catch(t=>{console.warn("打开会话失败",t.code,t.msg)})}};c(T,"instance");let O=T;new O;class ct{constructor(){d.registerService(i.TUISearch.SERVICE.NAME,this),d.registerExtension(i.TUIChat.EXTENSION.INPUT_MORE.EXT_ID,this)}onCall(e,t){switch(e){case i.TUISearch.SERVICE.METHOD.SEARCH_GROUP:return this.searchGroup(t==null?void 0:t.groupID);case i.TUISearch.SERVICE.METHOD.SEARCH_USER:return this.searchUser(t==null?void 0:t.userID);case i.TUISearch.SERVICE.METHOD.SEARCH_FRIEND:return this.searchFriend(t==null?void 0:t.userID);case i.TUISearch.SERVICE.METHOD.SEARCH_GROUP_MEMBER:return this.searchGroupMember(t==null?void 0:t.groupID,t==null?void 0:t.userID)}}onGetExtension(e){if(e===i.TUIChat.EXTENSION.INPUT_MORE.EXT_ID){const t=[],o={weight:3e3,text:"搜索",icon:"https://web.sdk.qcloud.com/component/TUIKit/assets/message-search.svg",data:{name:"search"},listener:{onClicked:()=>{var a;C.update(E.SEARCH,"isShowInConversationSearch",!0),b&&((a=D)==null||a.navigateTo({url:"/TUIKit/components/TUISearch/index"}))}}};return t.push(o),t}}async searchFriend(e){return q.getFriendProfile({userIDList:[e]})}async searchUser(e){return B.getUserProfile({userIDList:[e]})}async searchGroup(e){return P.searchGroupByID(e)}async searchGroupMember(e,t){return P.getGroupMemberProfile({groupID:e,userIDList:[t]})}}new ct;tt.getInstance();et.getInstance();const lt={key:0,class:"TUIKit-navbar"},ut=["onClick"],Ct={class:"TUIKit-main-container"},Et={key:0,class:"TUIKit-main"},ht={key:0,class:"TUIKit-main-aside"},It={key:1,class:"TUIKit-main-main"},Tt={key:1,class:"TUIKit-main"},dt=rt({__name:"index",props:{SDKAppID:{type:Number,default:0,required:!1},userID:{type:String,default:"",required:!1},userSig:{type:String,default:"",required:!1},conversationID:{type:String,default:"",required:!1}},setup(n){const e=R(""),t=R("message"),o=R("zh"),a=[{id:"message",label:"消息"},{id:"contact",label:"通讯录"}],p=n;it(()=>{C.watch(E.CONV,{currentConversationID:s=>{e.value=s}}),A(),x(),L()});function A(){const{SDKAppID:s,userID:U,userSig:m,conversationID:g}=p;s&&U&&m&&W.login({SDKAppID:s,userID:U,userSig:m,useUploadPlugin:!0,framework:X}).then(()=>{(g.startsWith("C2C")||g.startsWith("GROUP"))&&H.switchConversation(g)}).catch(St=>{})}function V(s){return s===0||s>=2e7&&s<9e7||s>=172e7&&s<179e7}function x(){o.value=V(p.SDKAppID)?"en":"zh",S.changeLanguage(o.value)}function L(){if(l){const s=document.getElementsByTagName("body")[0].style;s.setProperty("--callLeft","0"),s.setProperty("--callTop","0"),s.setProperty("--callWidth","100%"),s.setProperty("--callHeight","100%")}}return(s,U)=>(u(),h("div",{key:r(o)},[ot(s.$slots,"default",{},()=>[f("div",{class:M(["TUIKit",r(l)&&"TUIKit-h5"])},[r(l)&&r(e)?v("",!0):(u(),h("div",lt,[(u(),h(st,null,at(a,m=>f("div",{key:m.id,class:M(["TUIKit-navbar-item",r(t)===m.id&&"TUIKit-navbar-item-active"]),onClick:g=>t.value=m.id},G(r(S).t(m.label)),11,ut)),64))])),f("div",Ct,[r(t)==="message"?(u(),h("div",Et,[r(l)&&r(e)?v("",!0):(u(),h("div",ht,[I(r(N),{searchType:"global"}),I(r(J))])),!r(l)||r(e)?(u(),h("div",It,[I(r(Y),null,{default:nt(()=>[f("h1",null,G(r(S).t("欢迎使用腾讯云即时通信IM")),1)]),_:1}),I(r(k),{class:M(r(l)?"chat-popup":"chat-aside")},null,8,["class"]),I(r(N),{class:M(r(l)?"chat-popup":"chat-aside"),searchType:"conversation"},null,8,["class"])])):v("",!0),r(l)&&!r(e)?(u(),pt(r(k),{key:2,class:"chat-popup"})):v("",!0),I(r(w),{displayType:"selectFriend"})])):r(t)==="contact"?(u(),h("div",Tt,[I(r(w),{displayType:"contactList",onSwitchConversation:U[0]||(U[0]=m=>t.value="message")})])):v("",!0)])],2)],!0)]))}});const qi=$(dt,[["__scopeId","data-v-a6876a06"]]);export{qi as default};
