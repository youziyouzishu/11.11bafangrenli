var Q=Object.defineProperty;var J=(f,s,r)=>s in f?Q(f,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[s]=r;var S=(f,s,r)=>(J(f,typeof s!="symbol"?s+"":s,r),r);import{z as u,B as C,q as d,o as g,i as Z,_ as ee}from"./@tencentcloud-25a17c42.js";import"./adapter-vue-20243c9c.js";import te from"./Icon-fec85db6.js";import{T as x}from"./index-ebb29dde.js";import{e as oe}from"./enableSampleTaskStatus-86998722.js";import{t as se}from"./index-8f711959.js";import{i as b,a as k,c as ne}from"./env-6b0ecdb8.js";import{T as ae}from"./config-58aee8b5.js";import{T as w}from"./index-9521edcb.js";import{d as ie,r as U,aU as re,aW as le,b1 as ce,b as ue,aV as y,o as h,c as M,ak as me,u as E,a as N,F as R,aj as de,G as pe,aw as ve,a9 as P}from"./@vue-25170201.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";import"./index-7638d9aa.js";import"./element-plus-64da2267.js";import"./lodash-es-fbce1780.js";import"./async-validator-dee29e8b.js";import"./@element-plus-9559a6ac.js";import"./dayjs-346d7cd4.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./normalize-wheel-es-ed76fb12.js";import"./@vueuse-944ef3f4.js";import"./lodash-2cc29f39.js";import"./axios-67477f72.js";import"./vue-router-f7517f62.js";import"./css-color-function-7acc3e97.js";import"./color-9254db0b.js";import"./clone-db6b0f3b.js";import"./color-convert-946e453a.js";import"./color-name-b7949e8c.js";import"./color-string-6fa48439.js";import"./balanced-match-51764fed.js";import"./ms-f6814399.js";import"./nprogress-ccaead9e.js";import"./@tiptap-008a465d.js";import"./prosemirror-state-c544e594.js";import"./prosemirror-model-8b0495eb.js";import"./orderedmap-1b52af60.js";import"./prosemirror-transform-fc1f2a72.js";import"./prosemirror-view-ef3f9f96.js";import"./prosemirror-keymap-776f822d.js";import"./w3c-keyname-a25e4cc1.js";import"./prosemirror-commands-5c2a1a07.js";import"./prosemirror-schema-list-1c96ec4d.js";import"./vue-clipboard3-f5f9feb9.js";import"./clipboard-3d849c41.js";import"./echarts-d6620a89.js";import"./zrender-9797a04d.js";import"./tslib-54e39b60.js";import"./highlight.js-1b502259.js";import"./@highlightjs-7a15facb.js";import"./path-to-regexp-767716ea.js";import"./constant-bad60a54.js";const fe="/business/assets/msg-del-8e1884b8.svg",G="/business/assets/msg-copy-91b797d7.svg",ge="/business/assets/msg-quote-6ed4649b.svg",Ie="/business/assets/msg-revoke-a0b46d31.svg",Te="/business/assets/msg-forward-b9d14da1.svg",ye="/business/assets/translate-a0cfa550.svg",Ce="/business/assets/multiple-select-63011d60.svg",he="/business/assets/convertText_zh-ea05cc29.svg",I=class I{constructor(){S(this,"savedSelection");this.savedSelection=null}static getInstance(){return I.instance||(I.instance=new I),I.instance}saveCurrentSelection(){const s=window.getSelection();b||!s||(this.savedSelection={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset})}restoreSelection(){const s=window.getSelection();if(b||!s||!this.savedSelection)return;const{anchorNode:r,anchorOffset:p,focusNode:o,focusOffset:n}=this.savedSelection;if(!r||!o)return;const a=document.createRange();(r===o?p<=n:r.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_FOLLOWING)?(a.setStart(r,p),a.setEnd(o,n)):(a.setStart(o,n),a.setEnd(r,p)),s.removeAllRanges(),s.addRange(a)}async copySelection(s){this.restoreSelection();const r=window.getSelection();if(b||!r||r.rangeCount===0){await this.copyTextOrHtml(s,"text");return}const o=r.getRangeAt(0).cloneContents(),n=document.createElement("div");n.appendChild(o);const a=n.innerHTML||s,l=n.innerHTML?"html":"text";await this.copyTextOrHtml(a,l),this.savedSelection=null}async copyTextOrHtml(s,r){const p=r==="html"?"text/html":"text/plain";if(navigator.clipboard)try{const n=new Blob([s],{type:p}),a=new ClipboardItem({[p]:n});await navigator.clipboard.write([a]);return}catch{}let o;if(r==="html"){o=document.createElement("div"),o.style.position="fixed",o.style.opacity="0",o.contentEditable="true",o.innerHTML=s,document.body.appendChild(o);const n=document.createRange();n.selectNodeContents(o);const a=window.getSelection();a==null||a.removeAllRanges(),a==null||a.addRange(n),o.focus()}else o=document.createElement("textarea"),o.value=s,o.style.position="fixed",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy")}catch(n){x({message:u.t("TUIChat.此机型暂不支持复制"),type:w.ERROR}),console.warn("use document.execCommand copy failed:",n)}finally{document.body.removeChild(o)}}};S(I,"instance");let D=I;const F=D.getInstance(),Me=["onClick","onMousedown"],xe={class:"list-item-text"},be=ie({__name:"index",props:{messageItem:{default:()=>({})},isMultipleSelectMode:{type:Boolean,default:!1}},emits:["toggleMultipleSelectMode"],setup(f,{expose:s,emit:r}){const p=r,o=f,n=ae.getFeatureConfig(),a=C.TYPES,l=U([{key:"open",text:u.t("TUIChat.打开"),iconUrl:G,renderCondition(){var t;return!n.DownloadFile||!e.value?!1:k&&(((t=e.value)==null?void 0:t.type)===a.MSG_FILE||e.value.type===a.MSG_VIDEO||e.value.type===a.MSG_IMAGE)},clickEvent:V},{key:"copy",text:u.t("TUIChat.复制"),iconUrl:G,renderCondition(){return!n.CopyMessage||!e.value?!1:e.value.type===a.MSG_TEXT},clickEvent:Y},{key:"revoke",text:u.t("TUIChat.撤回"),iconUrl:Ie,renderCondition(){return!n.RevokeMessage||!e.value?!1:e.value.flow==="out"&&e.value.status==="success"},clickEvent:B},{key:"delete",text:u.t("TUIChat.删除"),iconUrl:fe,renderCondition(){return!n.DeleteMessage||!e.value?!1:e.value.status==="success"},clickEvent:q},{key:"forward",text:u.t("TUIChat.转发"),iconUrl:Te,renderCondition(){return!n.ForwardMessage||!e.value?!1:e.value.status==="success"},clickEvent:W},{key:"quote",text:u.t("TUIChat.引用"),iconUrl:ge,renderCondition(){if(!n.QuoteMessage||!e.value)return!1;const t=d.getMessageModel(e.value.ID);return e.value.status==="success"&&!t.getSignalingInfo()},clickEvent:j},{key:"translate",text:u.t("TUIChat.翻译"),visible:!1,iconUrl:ye,renderCondition(){return!n.TranslateMessage||!e.value?!1:e.value.status==="success"&&e.value.type===a.MSG_TEXT},clickEvent:$},{key:"convert",text:u.t("TUIChat.转文字"),visible:!1,iconUrl:he,renderCondition(){return!n.VoiceToText||!e.value?!1:e.value.status==="success"&&e.value.type===a.MSG_AUDIO},clickEvent:X},{key:"multi-select",text:u.t("TUIChat.多选"),iconUrl:Ce,renderCondition(){return!n.MultiSelection||!e.value?!1:e.value.status==="success"},clickEvent:K}]),e=U(),_=U();re(()=>{d.watch(g.CHAT,{translateTextInfo:O,voiceToTextInfo:A})}),le(()=>{d.unwatch(g.CHAT,{translateTextInfo:O,voiceToTextInfo:A})}),ce(()=>{e.value=d.getMessageModel(o.messageItem.ID)});const H=ue(()=>{for(let t=0;t<l.value.length;++t)if(l.value[t].renderCondition())return!1;return!0});function L(t){l.value[t].clickEvent()}function V(){var c;let t="";switch((c=e.value)==null?void 0:c.type){case C.TYPES.MSG_FILE:t=e.value.payload.fileUrl;break;case C.TYPES.MSG_VIDEO:t=e.value.payload.remoteVideoUrl;break;case C.TYPES.MSG_IMAGE:t=e.value.payload.imageInfoArray[0].url;break}window==null||window.open(t,"_blank")}function B(){if(!e.value)return;d.getMessageModel(e.value.ID).revokeMessage().then(()=>{oe("revokeMessage")}).catch(c=>{if(c.code===20016){const i=u.t("TUIChat.已过撤回时限");x({message:i,type:w.ERROR})}})}function q(){if(!e.value)return;d.getMessageModel(e.value.ID).deleteMessage()}async function Y(){var t,c,i,m,v;ne?(i=Z)==null||i.setClipboardData({data:se((c=(t=e.value)==null?void 0:t.payload)==null?void 0:c.text)}):F.copySelection((v=(m=e.value)==null?void 0:m.payload)==null?void 0:v.text)}function z(t){t!=="copy"||b||F.saveCurrentSelection()}function W(){e.value&&d.update(g.CUSTOM,"singleForwardMessageID",e.value.ID)}function j(){e.value&&e.value.quoteMessage()}function $(){if(!d.getData(g.APP,"enabledTranslationPlugin")){x({message:u.t("TUIChat.请开通翻译功能"),type:w.WARNING});return}if(!e.value)return;const c=l.value.findIndex(i=>i.key==="translate");d.update(g.CHAT,"translateTextInfo",{conversationID:e.value.conversationID,messageID:e.value.ID,visible:!l.value[c].visible})}function X(){if(!d.getData(g.APP,"enabledVoiceToText")){x({message:u.t("TUIChat.请开通语音转文字功能")});return}if(!e.value)return;const c=l.value.findIndex(i=>i.key==="convert");d.update(g.CHAT,"voiceToTextInfo",{conversationID:e.value.conversationID,messageID:e.value.ID,visible:!l.value[c].visible})}function K(){p("toggleMultipleSelectMode")}function O(t){if(t===void 0)return;const c=t.get(o.messageItem.conversationID)||[],i=l.value.findIndex(m=>m.key==="translate");for(let m=0;m<c.length;++m){const{messageID:v,visible:T}=c[m];if(v===o.messageItem.ID){l.value[i].text=u.t(T?"TUIChat.隐藏":"TUIChat.翻译"),l.value[i].visible=!!T;return}}l.value[i].text=u.t("TUIChat.翻译")}function A(t){if(t===void 0)return;const c=t.get(o.messageItem.conversationID)||[],i=l.value.findIndex(m=>m.key==="convert");for(let m=0;m<c.length;++m){const{messageID:v,visible:T}=c[m];if(v===o.messageItem.ID){l.value[i].text=u.t(T?"TUIChat.隐藏":"TUIChat.转文字"),l.value[i].visible=!!T;return}}l.value[i].text=u.t("TUIChat.转文字")}return s({messageToolDom:_}),(t,c)=>!y(H)&&!t.messageItem.hasRiskContent?(h(),M("div",{key:0,ref_key:"messageToolDom",ref:_,class:P(["dialog-item",y(k)?"dialog-item-web":"dialog-item-h5"])},[y(n).EmojiReaction?me(t.$slots,"TUIEmojiPlugin",{key:0},void 0,!0):E("",!0),N("div",{class:P(["dialog-item-list",y(k)?"dialog-item-list-web":"dialog-item-list-h5"])},[(h(!0),M(R,null,de(y(l),(i,m)=>(h(),M(R,null,[i.renderCondition()?(h(),M("div",{key:i.key,class:"list-item",onClick:v=>L(m),onMousedown:v=>z(i.key)},[pe(te,{file:i.iconUrl,size:"15px"},null,8,["file"]),N("span",xe,ve(i.text),1)],40,Me)):E("",!0)],64))),256))],2)],2)):E("",!0)}});const At=ee(be,[["__scopeId","data-v-b7150281"]]);export{At as default};
