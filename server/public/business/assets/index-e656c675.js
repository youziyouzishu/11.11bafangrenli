import"./adapter-vue-20243c9c.js";import{z as f,q as E,X as w,_ as X}from"./@tencentcloud-25a17c42.js";import{c as j}from"./icon-close-aa3d72bb.js";import $ from"./Icon-fec85db6.js";import H from"./index-3a577aae.js";import T from"./index-15293322.js";import J from"./index-05c3d16c.js";import{d as D}from"./env-6b0ecdb8.js";import{d as K,r as d,aU as Q,b2 as W,w as Y,o as i,t as Z,aM as ee,a as n,a9 as O,aV as t,aw as m,G as _,c,F as h,aj as L,u as b}from"./@vue-25170201.js";import"./tim-upload-plugin-5e9dfffb.js";import"./tim-profanity-filter-plugin-23d0f338.js";import"./vue-04189d9a.js";import"./marked-7f3c3653.js";import"./trtc-cloud-js-sdk-ca6139e0.js";import"./trtc-sdk-v5-8c3e4b7a.js";import"./pinia-1182f1fa.js";import"./mitt-f7ef348c.js";import"./interactjs-c534f49a.js";import"./rtc-detect-1f468b1b.js";const te={class:"header"},ae={class:"header-text"},se={class:"header-close-icon"},re={class:"read-status-counter-container"},oe=["onClick"],ne={class:"status-text"},ie={class:"status-count"},ce={class:"read-status-member-list"},le={key:0,class:"empty-list-tip"},ue={class:"username"},de={class:"username"},me={key:2,class:"fetch-more-container"},fe=K({__name:"index",props:{message:{default:()=>({})}},emits:["setReadReceiptPanelVisible"],setup(P,{emit:S}){const V=S,g=P;let C="",R="";const z=["unread","read"],l={unread:!1,read:!1,close:!1},p=d(!1),y=d(!1),v=d(!1),I=d(!1),r=d("unread"),s=d(B());Q(async()=>{await x(),W(()=>{v.value=!0})}),Y(()=>g.message.readReceiptInfo.readCount,()=>{x()});async function M(a="all"){const o=E.getMessageModel(g.message.ID);let e={},u={};(a==="all"||a==="unread")&&(e=await w.getGroupMessageReadMemberList({message:o,filter:1,cursor:C,count:100}),e&&(C=e.data.cursor,e.data.isCompleted&&(l.unread=!0))),(a==="all"||a==="read")&&(u=await w.getGroupMessageReadMemberList({message:o,filter:0,cursor:R,count:100}),u&&(R=u.data.cursor,u.data.isCompleted&&(l.read=!0)));const{unreadCount:N,readCount:q}=o.readReceiptInfo;return{unreadResult:{count:N,...e.data},readResult:{count:q,...u.data}}}async function A(){if(!(l[r.value]||p.value)&&(p.value=!0,r.value==="unread"||r.value==="read")){const{unreadResult:a,readResult:o}=await M(r.value);F();try{s.value.unread.memberList=s.value.unread.memberList.concat(a.unreadUserInfoList||[]),s.value.read.memberList=s.value.read.memberList.concat(o.readUserInfoList||[])}finally{p.value=!1}}}async function x(){C="",R="",I.value=!1,l.unread=!1,l.read=!1;const{unreadResult:a,readResult:o}=await M("all");F(),k("read",o.count,o.readUserInfoList),k("unread",a.count,a.unreadUserInfoList),k("close")}function F(){l.read&&l.unread&&(I.value=!0)}function k(a,o,e){s.value[a].count=o,s.value[a].memberList=e||[]}function B(){return{read:{tabName:f.t("TUIChat.已读"),count:void 0,memberList:[]},unread:{tabName:f.t("TUIChat.未读"),count:void 0,memberList:[]},close:{tabName:f.t("TUIChat.关闭"),count:void 0,memberList:[]}}}function G(a){r.value=a}function U(){y.value=!0,setTimeout(()=>{V("setReadReceiptPanelVisible",!1)},200)}return(a,o)=>(i(),Z(H,{maskColor:"transparent",onOnOverlayClick:U},{default:ee(()=>[n("div",{class:O({"read-receipt-panel":!0,"read-receipt-panel-mobile":t(D),"read-receipt-panel-close-mobile":t(D)&&t(y)})},[n("div",te,[n("div",ae,m(t(f).t("TUIChat.消息详情")),1),n("div",se,[_($,{size:"12px",hotAreaSize:"8",file:t(j),onOnClick:U},null,8,["file"])])]),n("div",re,[(i(),c(h,null,L(z,e=>n("div",{key:e,class:O({"read-status-counter":!0,active:e===t(r)}),onClick:u=>G(e)},[n("div",ne,m(t(s)[e].tabName),1),n("div",ie,m(t(s)[e].count===void 0?"":t(s)[e].count),1)],10,oe)),64))]),n("div",ce,[t(s)[t(r)].count===0&&t(v)?(i(),c("div",le," - "+m(t(f).t("TUIChat.空"))+" - ",1)):t(v)?(i(),c(h,{key:1},[t(r)==="unread"?(i(!0),c(h,{key:0},L(t(s)[t(r)].memberList,e=>(i(),c("div",{key:e.userID,class:"read-status-member-container"},[_(T,{class:"read-status-avatar",useSkeletonAnimation:"",url:e.avatar||""},null,8,["url"]),n("div",ue,m(e.nick||e.userID),1)]))),128)):b("",!0),t(r)==="read"?(i(!0),c(h,{key:1},L(t(s)[t(r)].memberList,e=>(i(),c("div",{key:e.userID,class:"read-status-member-container"},[_(T,{class:"read-status-avatar",useSkeletonAnimation:"",url:e.avatar},null,8,["url"]),n("div",de,m(e.nick||e.userID),1)]))),128)):b("",!0)],64)):b("",!0),t(v)?(i(),c("div",me,[_(J,{isFetching:t(p),isTerminateObserve:t(I),onOnExposed:A},null,8,["isFetching","isTerminateObserve"])])):b("",!0)])],2)]),_:1}))}});const Oe=X(fe,[["__scopeId","data-v-ee287e9c"]]);export{Oe as default};
